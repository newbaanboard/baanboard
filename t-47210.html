<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="Afs Problem, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] Afs Problem AFS/DDC/OLE: Function servers" />
	
	<title>Afs Problem [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="index.html">Newbaanboard</a> &gt; <a href="index.html">Baan SIGs</a> &gt; <a href="index.html">AFS/DDC/OLE: Function servers</a> &gt; Afs Problem</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">gget79</div><div class="date">23rd January 2008, 18:36</div></div><div class="posttext">Hi ,  <br />
  <br />
I am working with Baan Vc  <br />
  <br />
I am doing a AFS function, It has to create a Sales Order (collect order type), but via AFS I don't get to execute warehousing (tdsls4246m000) and invoicing (tdsls4247m000).  <br />
  <br />
I am doing a trace with afs.log and this tell me:  <br />
  <br />
250dll-&gt;serv (starttdsls4500m000100)  <br />
260serv&lt;-4gl (init.ready)  <br />
tdsls4500m000(260)-RUNNING:  <br />
250dll-&gt;serv (starttdsls4100s0001tdsls4500m000114)  <br />
261serv&lt;-4gl (init.ready)  <br />
tdsls4100s000(261)-RUNNING:  <br />
250dll-&gt;serv (syncadd260)  <br />
tdsls4500m000(260)-RUNNING:syncadd  <br />
260serv&lt;-4gl (syncadd0)  <br />
tdsls4500m000(260)-RUNNING:  <br />
&gt;tdsls4100s000(261) put.field:tdsls400.ofbp 000000009  <br />
&gt;tdsls4100s000(261) put.field:tdsls400.cofc VENTA  <br />
&gt;tdsls4100s000(261) put.field:tdsls400.sotp VMR  <br />
&gt;tdsls4100s000(261) put.field:tdsls400.orno VMR  <br />
&gt;tdsls4100s000(261) put.field:tdsls400.corn 1713  <br />
&gt;tdsls4100s000(261) put.field:tdsls400.crep 400  <br />
&gt;tdsls4100s000 enum.answer tdslss0065:1  <br />
250dll-&gt;serv (enum.answertdslss00651261)  <br />
tdsls4100s000(261)-RUNNING:enum.answer  <br />
261serv&lt;-4gl (enum.answer0)  <br />
tdsls4100s000(261)-RUNNING:  <br />
&gt;tdsls4100s000 handle.subproc tdslss0065 ignore  <br />
250dll-&gt;serv (handle.subsessiontdslss00654261)  <br />
&gt;tdsls4500m000 insert  <br />
250dll-&gt;serv (add.set+save261)  <br />
tdsls4100s000(261)-RUNNING:add.set+save  <br />
262serv&lt;-4gl (api.child.startedtdsls4501m000261)  <br />
261serv&lt;-4gl (add.set+save00)  <br />
tdsls4100s000(261)-RUNNING:  <br />
&lt;tdsls4500m000   <br />
&gt;tdsls4100s000 enum.answer tdslss0065:1  <br />
250dll-&gt;serv (enum.answertdslss00651261)  <br />
tdsls4100s000(261)-RUNNING:enum.answer  <br />
261serv&lt;-4gl (enum.answer0)  <br />
tdsls4100s000(261)-RUNNING:  <br />
&gt;tdsls4100s000 handle.subproc tdslss0065 ignore  <br />
250dll-&gt;serv (handle.subsessiontdslss00654261)  <br />
&gt;tdsls4100s000 get.field:tdsls400.orno  <br />
&lt;tdsls4100s000(261) get.field:tdsls400.orno=VMR000894  <br />
&gt;tdsls4100s000 end.session  <br />
250dll-&gt;serv (end.program261)  <br />
tdsls4100s000(261)-RUNNING:end.program  <br />
261serv&lt;-4gl (end.program0)  <br />
tdsls4100s000(261)-RUNNING:  <br />
261dll-&gt;serv (tdsls4100s000: exit(261))  <br />
&gt;tdsls4500m000 end.session  <br />
250dll-&gt;serv (end.program260)  <br />
tdsls4500m000(260)-RUNNING:end.program  <br />
(0)-RUNNING:end.program  <br />
260serv&lt;-4gl (end.program0)  <br />
tdsls4500m000(260)-RUNNING:  <br />
260dll-&gt;serv (tdsls4500m000: exit(260))  <br />
tdsls4501m000waiting for prev cont.proc  <br />
262serv&lt;-4gl (init.ready)  <br />
tdsls4501m000(262)-RUNNING:  <br />
tdsls4501m000waiting 10 mSec  <br />
&gt;tdsls4501m000(262) put.field:tdsls401.orno VMR000894  <br />
&gt;tdsls4501m000 change.view  <br />
250dll-&gt;serv (start.set262)  <br />
tdsls4501m000(262)-RUNNING:start.set  <br />
262serv&lt;-4gl (start.setEOF0)  <br />
tdsls4501m000(262)-RUNNING:  <br />
&lt;tdsls4501m000 0 no view found  <br />
250dll-&gt;serv (starttdsls4101s0001tdsls4501m000114)  <br />
263serv&lt;-4gl (init.ready)  <br />
tdsls4101s000(263)-RUNNING:  <br />
250dll-&gt;serv (syncadd262)  <br />
tdsls4501m000(262)-RUNNING:syncadd  <br />
262serv&lt;-4gl (syncadd0)  <br />
tdsls4501m000(262)-RUNNING:  <br />
&gt;tdsls4101s000(263) put.field:tdsls401.orno VMR000894  <br />
&gt;tdsls4101s000(263) put.field:tdsls401.pono 1  <br />
&gt;tdsls4101s000(263) put.field:tdsls401.item.segment.1 0301  <br />
&gt;tdsls4101s000 handle.subproc tdsls11033 ignore  <br />
250dll-&gt;serv (handle.subsessiontdsls110334263)  <br />
&gt;tdsls4101s000(263) put.field:tdsls401.oqua 6  <br />
&gt;tdsls4101s000 handle.subproc 00009057 ignore  <br />
250dll-&gt;serv (handle.subsession000090574263)  <br />
&gt;tdsls4101s000 handle.subproc tdsls4811s000 kill  <br />
250dll-&gt;serv (handle.subsessiontdsls4811s0005263)  <br />
&gt;tdsls4101s000 insert  <br />
250dll-&gt;serv (add.set+save263)  <br />
tdsls4101s000(263)-RUNNING:add.set+save  <br />
263serv&lt;-4gl (add.set+save01)  <br />
tdsls4101s000(263)-RUNNING:  <br />
&lt;tdsls4101s000   <br />
&gt;tdsls4101s000 get.field:tdsls401.pono  <br />
&lt;tdsls4101s000(263) get.field:tdsls401.pono=1  <br />
&gt;tdsls4101s000 get.field:tdsls401.sqnb  <br />
&lt;tdsls4101s000(263) get.field:tdsls401.sqnb=0  <br />
&gt;tdsls4501m000 enum.answer tdsls41016:1  <br />
250dll-&gt;serv (enum.answertdsls410161263)  <br />
tdsls4101s000(263)-RUNNING:enum.answer  <br />
263serv&lt;-4gl (enum.answer0)  <br />
tdsls4101s000(263)-RUNNING:  <br />
250dll-&gt;serv (enum.answertdsls410161262)  <br />
tdsls4501m000(262)-RUNNING:enum.answer  <br />
262serv&lt;-4gl (enum.answer0)  <br />
tdsls4501m000(262)-RUNNING:  <br />
&gt;tdsls4501m000 enum.answer ciloc0001:1  <br />
250dll-&gt;serv (enum.answerciloc00011263)  <br />
tdsls4101s000(263)-RUNNING:enum.answer  <br />
263serv&lt;-4gl (enum.answer0)  <br />
tdsls4101s000(263)-RUNNING:  <br />
250dll-&gt;serv (enum.answerciloc00011262)  <br />
tdsls4501m000(262)-RUNNING:enum.answer  <br />
262serv&lt;-4gl (enum.answer0)  <br />
tdsls4501m000(262)-RUNNING:  <br />
&gt;tdsls4101s000 end.session  <br />
250dll-&gt;serv (end.program263)  <br />
tdsls4101s000(263)-RUNNING:end.program  <br />
263serv&lt;-4gl (end.program0)  <br />
tdsls4101s000(263)-RUNNING:  <br />
263dll-&gt;serv (tdsls4101s000: exit(263))  <br />
&gt;tdsls4501m000 end.session  <br />
250dll-&gt;serv (end.program262)  <br />
tdsls4501m000(262)-RUNNING:end.program  <br />
(0)-RUNNING:end.program  <br />
264serv&lt;-4gl (api.child.startedtdsls4246m000262)  <br />
264serv&lt;-4gl (startup)  <br />
264dll-&gt;serv (tdsls4246m000: exit(264))  <br />
265serv&lt;-4gl (api.child.startedtdsls4247m000262)  <br />
265serv&lt;-4gl (startup)  <br />
265dll-&gt;serv (tdsls4247m000: exit(265))  <br />
262serv&lt;-4gl (end.program0)  <br />
tdsls4501m000(262)-RUNNING:  <br />
262dll-&gt;serv (tdsls4501m000: exit(262))  <br />
  <br />
  <br />
How can I understand this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">23rd January 2008, 20:01</div></div><div class="posttext">You should be able to look at your code and relate each step in the code with what is in the log file.  So for example starttdsls4500m000100 - means you did a command which started the tdsls4500m000 session, which then looks like it activated tdsls4100s000.  Then you can see where you put the data.  I am not familiar with these sessions so I can help a whole lot.  Maybe posting your code will help someone see something.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gget79</div><div class="date">23rd January 2008, 20:06</div></div><div class="posttext">You should be able to look at your code and relate each step in the code with what is in the log file.  So for example starttdsls4500m000100 - means you did a command which started the tdsls4500m000 session, which then looks like it activated tdsls4100s000.  Then you can see where you put the data.  I am not familiar with these sessions so I can help a whole lot.  Maybe posting your code will help someone see something.<br />
<br />
Hi Mark,<br />
<br />
The source is the following:<br />
<br />
declaration:<br />
<br />
	#pragma used dll ottstpapihand		|Baan API handler<br />
	#include &lt;bic_dam&gt;	|include tools functions para progress indicator<br />
	#include &lt;bic_tt&gt;<br />
	<br />
	table	tttgfd422<br />
	<br />
	|getxxx.sn<br />
	extern domain tcmcs.long secu.f, secu.t<br />
	|getxxx.en<br />
   <br />
	|* Variables de Pantalla<br />
	extern	domain	tcdate			m.fecha     | Fecha de procesamiento<br />
	extern	domain	tclogn			m.user      | Usuario<br />
	extern	domain   tcmcs.str50   	m.file  		| Archivo de transacciones<br />
   extern   domain   tcmcs.str100  	que.accion  | Acci√≥n<br />
<br />
   |* Variables del API<br />
	long	rec.read<br />
	long	rec.writ<br />
	long	rec.rej<br />
	long	ret.code<br />
	<br />
	string	data.line(2048)<br />
	string	err(215)<br />
	<br />
   domain   tcdate fecha.orden<br />
<br />
	|*	Variables de Lectura de archivo txt<br />
	string   orden.cliente(20)									|* orden cliente<br />
   string	partner.cliente(9), partner.receptor(9)	|* partners<br />
   string	dpto.ventas(6), representante(6)				|* dpto.ventas, representante<br />
   string	cond.pago(3)										|* condicion de pago<br />
	string	posicion(5)											|* posicion<br />
	string	articulo(47)										|* articulo<br />
	string	fecha(15), cant.pedida(15), descuento(15)	|* fecha, cantidad pedida, descuento<br />
	<br />
		<br />
	extern 	domain	tcmcs.str40   		errfile	| archivo de error<br />
	<br />
	extern	domain   tcmcs.str60	arch.inp 	| Archivo de entrada<br />
	extern	domain   tcmcs.str60	arch.out 	| Archivo de Salida (errores)<br />
	long	inp.fp 					| Puntero archivo de entrada<br />
	extern	domain   tcbool	procesa<br />
	extern	domain	tcmcs.long	rec.total   	| Registros Totales para usar en el indicador de progreso<br />
	extern 	domain	tcsern	sern<br />
	domain 	tcmcs.str80	que.formato	<br />
	long		rec.proc    		| Registros Procesados<br />
	long 		num.registros <br />
	long  	tempreg<br />
	<br />
	domain	tcmcs.s100m		error.mess<br />
	<br />
	extern	domain tcorno	   ovta.orno<br />
	extern	domain tcpono	   ovta.pono, ovta.sqnb<br />
	extern	domain tcmcs.str5	   aux.pono, aux.sqnb<br />
	long 		ret<br />
	extern	domain	tcorno	aux.orno<br />
	domain	tcmcs.str80	recover.msg<br />
	extern	domain	tcmcs.str30		aux.corn<br />
	<br />
	extern	domain	tcsess	programa<br />
<br />
	<br />
|****************************** form section **********************************<br />
<br />
  <br />
group.1: <br />
init.group:<br />
   que.accion = &quot;Iniciando Proceso&quot;<br />
   m.fecha = date.num()<br />
   m.user = logname$<br />
	get.screen.defaults()<br />
	<br />
<br />
|****************************** choice section ********************************<br />
<br />
choice.cont.process:<br />
before.choice:<br />
	inp.fp = 0<br />
	| validar los datos de la pantalla si no pasa choice.again()<br />
	que.accion = &quot;Paso 1 de 5: Verificando Informaci√≥n Archivo de Entrada&quot;<br />
	muestra.accion(que.accion) <br />
on.choice:<br />
	if lee.datos()  then 		| Mandar a una tabla temporal <br />
		if valida.datos() then 		| Valida Datos de la tabla <br />
			if procesa.datos() then 	 | Lee la tabla temporal y procesa lops registros <br />
				message(&quot;Proceso Concluido con √©xito&quot;) <br />
			else<br />
				message(&quot;Existieron problemas revisar el registro de errores&quot;)				<br />
			endif <br />
		else<br />
			message(&quot;Existieron problemas al validar las ordenes, revisar la sesi√≥n de errores&quot;)<br />
		endif <br />
	else<br />
		message(&quot;No existen datos en el archivo de entrada %s&quot;, m.file)<br />
	endif<br />
	<br />
<br />
|****************************** field section *********************************<br />
<br />
<br />
|****************************** function section ******************************<br />
<br />
functions:<br />
function domain tcbool lee.datos()<br />
{<br />
	return(true)<br />
}<br />
<br />
function domain tcbool valida.datos()<br />
{<br />
	return(true) <br />
}<br />
<br />
<br />
function domain tcbool validacion.linea() <br />
{<br />
	return(true)<br />
}<br />
<br />
function muestra.accion(domain tcmcs.str60 que.accion)<br />
{<br />
	display(&quot;que.accion&quot;) <br />
	refresh()<br />
}<br />
<br />
function domain tcbool procesa.datos()<br />
{<br />
	domain tcbool ok.procesa.datos, primer.registro<br />
	<br />
	ok.procesa.datos = true <br />
	primer.registro = true <br />
	aux.orno = &quot;&quot;<br />
<br />
	num.registros = 0 <br />
	tempreg = 0<br />
<br />
	if not crea.ordenes() then <br />
		ok.procesa.datos = false <br />
	endif<br />
	<br />
	que.accion = &quot;&quot;<br />
	muestra.accion(que.accion) <br />
	return(ok.procesa.datos) <br />
}<br />
<br />
function domain tcbool crea.ordenes()<br />
{<br />
	ovta.orno = &quot;&quot;<br />
		<br />
	if not crear.cabecera.ovta() then	<br />
		error.mess = &quot;ERR: Ord &quot;<br />
		return(false)<br />
	else<br />
		if not crear.linea.ovta() then	<br />
			error.mess = &quot;ERR: Ord &quot;  &amp; &quot;posicion &quot; <br />
			return(false)<br />
		endif<br />
	endif	<br />
	return(true)<br />
}<br />
<br />
function domain tcbool crear.cabecera.ovta()<br />
{<br />
	| Sincronizar con sesion single<br />
	ret = stpapi.synchronize.dialog(&quot;tdsls4500m000&quot;, &quot;add&quot;, error.mess)<br />
	if not ret then<br />
		error.mess = &quot;Ord. venta. &quot; &amp;<br />
			    &quot;Sincr tdsls4100s000: &quot; &amp; error.mess<br />
		stpapi.end.session(&quot;tdsls4500m000&quot;)		<br />
		return(false)<br />
	endif<br />
<br />
	| Llenar datos de cabecera de orden de venta<br />
	<br />
	stpapi.put.field(&quot;tdsls4100s000&quot;, &quot;tdsls400.ofbp&quot;, &quot;000000009&quot;)		|partner<br />
| 	stpapi.put.field(&quot;tdsls4100s000&quot;, &quot;tdsls400.stbp&quot;, tdcpe031.stbp)		|partner<br />
	stpapi.put.field(&quot;tdsls4100s000&quot;, &quot;tdsls400.cofc&quot;, &quot;VENTA&quot;)          |Departamento ventas<br />
	stpapi.put.field(&quot;tdsls4100s000&quot;, &quot;tdsls400.sotp&quot;, &quot;VMR&quot;)      		|tipo de orden de venta	<br />
	stpapi.put.field(&quot;tdsls4100s000&quot;, &quot;tdsls400.orno&quot;, &quot;VMR&quot;)		      |serie de la orden<br />
	stpapi.put.field(&quot;tdsls4100s000&quot;, &quot;tdsls400.corn&quot;, &quot;1713&quot;)    |Orden Cliente<br />
	stpapi.put.field(&quot;tdsls4100s000&quot;, &quot;tdsls400.crep&quot;, &quot;400&quot;)    |vendedor<br />
| 	stpapi.put.field(&quot;tdsls4100s000&quot;, &quot;tdsls400.cwar&quot;, tdcpe030.cwar)    |Almacen<br />
	<br />
	<br />
	stpapi.enum.answer(&quot;tdsls4100s000&quot;,&quot;tdslss0065&quot;, tcyesno.yes)<br />
	stpapi.handle.subproc(&quot;tdsls4100s000&quot;,&quot;tdslss0065&quot;,&quot;ignore&quot;)<br />
	<br />
	ret = stpapi.insert(&quot;tdsls4500m000&quot;, true, error.mess)<br />
	<br />
	if not ret then<br />
		stpapi.recover(&quot;tdsls4100s000&quot;, recover.msg)<br />
		error.mess = &quot; Al Guardar &quot; &amp; error.mess	<br />
		stpapi.end.session(&quot;tdsls4100s000&quot;)<br />
		stpapi.end.session(&quot;tdsls4500m000&quot;)<br />
		return(false)<br />
	endif<br />
	<br />
	stpapi.enum.answer(&quot;tdsls4100s000&quot;,&quot;tdslss0065&quot;, tcyesno.yes)<br />
	stpapi.handle.subproc(&quot;tdsls4100s000&quot;,&quot;tdslss0065&quot;,&quot;ignore&quot;)<br />
	stpapi.get.field(&quot;tdsls4100s000&quot;, &quot;tdsls400.orno&quot;, ovta.orno)<br />
	stpapi.end.session(&quot;tdsls4100s000&quot;)<br />
	stpapi.end.session(&quot;tdsls4500m000&quot;)<br />
<br />
return(true)<br />
}<br />
<br />
function domain tcbool crear.linea.ovta()<br />
{<br />
	programa = prog.name$<br />
	export(&quot;programa&quot;, programa)<br />
<br />
| Ubicar orde. de venta<br />
	stpapi.put.field(&quot;tdsls4501m000&quot;, &quot;tdsls401.orno&quot;, ovta.orno)<br />
	ret = stpapi.change.view(&quot;tdsls4501m000&quot;, error.mess)<br />
	if not isspace(error.mess) then<br />
		error.mess = &quot;No se encontr√≥ la orden &quot; &amp; ovta.orno &amp; &quot;: &quot; &amp; error.mess<br />
		return(false)<br />
	endif<br />
<br />
	| Sincronizar con sesion single tdsls4101s000 - Lineas de orden vta<br />
	ret = stpapi.synchronize.dialog(&quot;tdsls4501m000&quot;, &quot;add&quot;, error.mess)<br />
	if not ret then<br />
		error.mess = &quot;Ord Venta. &quot; &amp; &quot;Sincr tdsls4101s000: &quot; &amp; error.mess<br />
		return(false)<br />
	endif<br />
	<br />
	stpapi.put.field(&quot;tdsls4101s000&quot;, &quot;tdsls401.orno&quot;, ovta.orno)<br />
	stpapi.put.field(&quot;tdsls4101s000&quot;, &quot;tdsls401.pono&quot;, str$(&quot;1&quot;))<br />
| 	stpapi.put.field(&quot;tdsls4101s000&quot;, &quot;tdsls401.cwar&quot;, tdcpe030.cwar)<br />
<br />
	|getxxx.so<br />
| 	select 	ttgfd422.*<br />
| 	from 		ttgfd422<br />
| 	where 	ttgfd422._index2 = { &quot;tc&quot;, &quot;item&quot; }<br />
| 	and    	ttgfd422._compnr = 0<br />
| 	order by ttgfd422._index2<br />
| 	selectdo<br />
	|getxxx.eo<br />
| 		stpapi.put.field(&quot;tdsls4101s000&quot;, &quot;tdsls401.item.segment.&quot;&amp; str$(ttgfd422.sequ) , &quot;0301&quot;(ttgfd422.spos;ttgfd422.leng)<br />
		stpapi.put.field(&quot;tdsls4101s000&quot;, &quot;tdsls401.item.segment.1&quot;, &quot;0301&quot;)<br />
|getxxx.o endselect <br />
	<br />
	stpapi.handle.subproc(&quot;tdsls4101s000&quot;,&quot;tdsls11033&quot;,&quot;ignore&quot;)<br />
	<br />
	<br />
	stpapi.put.field(&quot;tdsls4101s000&quot;, &quot;tdsls401.oqua&quot;, str$(&quot;6&quot;))<br />
		<br />
	|Enviamos Kill al mensaje de Stock<br />
	stpapi.handle.subproc(&quot;tdsls4101s000&quot;,&quot;00009057&quot;,&quot;ignore&quot;)<br />
	stpapi.handle.subproc(&quot;tdsls4101s000&quot;,&quot;tdsls4811s000&quot;,&quot;kill&quot;)<br />
	<br />
	<br />
	ret = stpapi.insert(&quot;tdsls4101s000&quot;, true, error.mess)<br />
	if not ret then<br />
		stpapi.recover(&quot;tdsls4101s000&quot;, recover.msg)<br />
		error.mess = &quot;Linea: &quot; &amp; error.mess		<br />
		stpapi.end.session(&quot;tdsls4101s000&quot;)<br />
		stpapi.end.session(&quot;tdsls4501m000&quot;)<br />
		return(false)<br />
	endif<br />
<br />
<br />
	stpapi.get.field(&quot;tdsls4101s000&quot;, &quot;tdsls401.pono&quot;, aux.pono)<br />
	stpapi.get.field(&quot;tdsls4101s000&quot;, &quot;tdsls401.sqnb&quot;, aux.sqnb)<br />
	|getxxx.sn<br />
	stpapi.enum.answer(&quot;tdsls4501m000&quot;,&quot;tdsls41016&quot;, tcyesno.yes)<br />
	stpapi.enum.answer(&quot;tdsls4501m000&quot;,&quot;ciloc0001&quot;, tcyesno.yes)<br />
	|getxxx.en<br />
	stpapi.end.session(&quot;tdsls4101s000&quot;)<br />
	stpapi.end.session(&quot;tdsls4501m000&quot;)<br />
<br />
	return(true)<br />
}<br />
|** End of program script</div></div><hr />



</div>
</body>
</html>