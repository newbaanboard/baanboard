<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="AFS on session tfacr2240m000 and tfacp2230m000, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] AFS on session tfacr2240m000 and tfacp2230m000 AFS/DDC/OLE: Function servers" />
	
	<title>AFS on session tfacr2240m000 and tfacp2230m000 [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="index.html">Newbaanboard</a> &gt; <a href="index.html">Baan SIGs</a> &gt; <a href="index.html">AFS/DDC/OLE: Function servers</a> &gt; AFS on session tfacr2240m000 and tfacp2230m000</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">newbie007</div><div class="date">24th August 2010, 21:51</div></div><div class="posttext">Hi,<br />
<br />
I have created a session with stpapi functions for tfacr2240m000 and tfacp2230m000. When I fill in all the field values and execute the stpapi.cont.process, it looks like it is running but nothing happens. I get an error message &quot; &lt;Ctrl&gt;[A]: Simulate Write Off Payment Differences&quot; while execute the stpapi.cont.process. I don't have the source code to look debug.<br />
<br />
<br />
Here is the code<br />
<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;cuno.f&quot;,tfacr900.scuno)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;cuno.t&quot;,tfacr900.scuno)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;ttyp.f&quot;,tfacr900.ttyp)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;ttyp.t&quot;,tfacr900.ttyp)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;ninv.f&quot;,str$(tfacr900.ninv))<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;ninv.t&quot;,str$(tfacr900.ninv))<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;iyer.f&quot;,str$(1999))<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;iprd.f&quot;,str$(1))<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;iyer.t&quot;,year.s)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;iprd.t&quot;,month.s)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;ccur.f&quot;,&quot;USD&quot;)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;ccur.t&quot;,&quot;USD&quot;)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;user.ccur&quot;,&quot;USD&quot;)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;max.amount&quot;,str$(999999999.00))<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;max.perc&quot;,str$(100.00))<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;doc.date&quot;,str$(date.num()))<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;fin.year&quot;,year.s)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;fin.prod&quot;,month.s)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;vat.year&quot;,year.s)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;vat.prod&quot;,month.s)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;rep.year&quot;,str$(0))<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;rep.prod&quot;,str$(0))<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;tfacr000.pdif&quot;,tfacr000.pdif)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;tfgld003.psep&quot;,&quot;/&quot;)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;tfacr200.cuno&quot;,tfacr900.scuno)<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;documnet&quot;,str$(document))<br />
	stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;print.details&quot;,str$(etol(tcyesno.no)))<br />
       stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;sim.pay.difference&quot;,str$(0))<br />
|stpapi.set.report(tfacr2240m000&quot;,&quot;rtfacr2240110002&quot;,device.f,error.msg)<br />
	stpapi.continue.process(&quot;tfacr2240m000&quot;,error.msg)<br />
	stpapi.get.mess.code(&quot;tfacr2240m000&quot;, error.msg)<br />
<br />
if (strip$(error.msg) &lt;&gt; &quot;&quot; and strip$(error.msg) &lt;&gt; &quot;Process is gone&quot;) then	<br />
		message(&quot;Write of ACR Payment Process = %s&quot;,error.msg)	endif		<br />
	stpapi.end.session(&quot;tfacr2240m000&quot;)<br />
<br />
<br />
here is the AFS log;<br />
<br />
LOGGING STARTED<br />
08-24-2010<br />
8-&gt;get.fields<br />
8&lt;-get.fields 0 cuno.f 1 user.ccur 0 cuno.t 1 ttyp.f 1 ttyp.t 1 ninv.f 1 ninv.t 1 iyer.f 1 tfgld003.psep 0 iprd.f 1 iyer.t 1 tfgld003.psep 0 iprd.t 1 ccur.f 1 ccur.t 1 max.amount 1 max.perc 1 doc.date 1 fin.year 1 tfgld003.psep 0 fin.prod 1 rep.year 1 tfgld003.psep 0 rep.prod 1 vat.year 1 tfgld003.psep 0 vat.prod 1 document 1 print.details 1 tfacr000.pdif 0 batch 0 tfacr200.cuno 0<br />
&gt;tfacr2240m000 put.field:cuno.f LBS101<br />
&gt;tfacr2240m000 put.field:cuno.t LBS101<br />
&gt;tfacr2240m000 put.field:ttyp.f SIV<br />
&gt;tfacr2240m000 put.field:ttyp.t SIV<br />
&gt;tfacr2240m000 put.field:ninv.f 20027683<br />
&gt;tfacr2240m000 put.field:ninv.t 20027683<br />
&gt;tfacr2240m000 put.field:iyer.f 1999<br />
&gt;tfacr2240m000 put.field:iprd.f 1<br />
&gt;tfacr2240m000 put.field:iyer.t 2010<br />
&gt;tfacr2240m000 put.field:iprd.t 08<br />
&gt;tfacr2240m000 put.field:ccur.f USD<br />
&gt;tfacr2240m000 put.field:ccur.t USD<br />
&gt;tfacr2240m000 put.field:user.ccur USD<br />
&gt;tfacr2240m000 put.field:max.amount 999999999<br />
&gt;tfacr2240m000 put.field:max.perc 100<br />
&gt;tfacr2240m000 put.field:doc.date 734008<br />
&gt;tfacr2240m000 put.field:fin.year 2010<br />
&gt;tfacr2240m000 put.field:fin.prod 08<br />
&gt;tfacr2240m000 put.field:vat.year 2010<br />
&gt;tfacr2240m000 put.field:vat.prod 08<br />
&gt;tfacr2240m000 put.field:rep.year 0<br />
&gt;tfacr2240m000 put.field:rep.prod 0<br />
&gt;tfacr2240m000 put.field:tfacr000.pdif ARP<br />
&gt;tfacr2240m000 put.field:documnet 20<br />
&gt;tfacr2240m000 put.field:print.details 2<br />
&gt;tfacr2240m000 put.field:sim.pay.difference 0<br />
&gt;tfacr2240m000 continue.process<br />
8-&gt;cont.process<br />
8&lt;-cont.process 1<br />
&lt;tfacr2240m000 &lt;Ctrl&gt;[A]: Simulate Write Off Payment Differences<br />
&gt;tfacr2240m000 get.mess.code<br />
&lt;tfacr2240m000 tfacrs0176          <br />
&gt;tfacr2240m000 end.session<br />
8-&gt;end.program<br />
9&lt;-exit.child 0<br />
8&lt;-end.program 1 <br />
8&lt;-exit.child<br />
&gt;tfacr2240m000 end.session<br />
12-&gt;end.program<br />
13&lt;-exit.child 0<br />
12&lt;-end.program 1 <br />
12&lt;-exit.child<br />
<br />
<br />
Can anyone suggest what might be the issue ?. Any suggestion are appreciated.<br />
<br />
Thanks<br />
Newbie07</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">25th August 2010, 15:52</div></div><div class="posttext">What version of Baan are you on?  We don't use this session or at least I have never used it.  My question is what is in the stpapi.continue error.msg field? As a matter of fact I would remove the stpapi.get.mess.code. Very seldom do I use that.  Also check the form - on my system there are three buttons.  The simulate button would be choice.user.0 I believe on my system. Just want to double check that they did not do something different on your session.<br />
<br />
I also added some code tags and turned smiles off on the post to make it easier to read.  You can edit the post to see what all I did.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">newbie007</div><div class="date">27th August 2010, 06:47</div></div><div class="posttext">Thanks Mark.<br />
We are on BaanIVc4 SP16. I have asked baan to the latest debug object for otfacr2240 but since I don't have ptfacr2240. I cannot see what is happening in the code. I checked the form to make sure that continue.process is not executing user.0. On executing stpapi.cont.process on tfacr2240m000, the error.msg variable has &quot;Ctrl&gt;[A]: Simulate Write Off Payment Differences&quot; not sure why I am getting this. I have all the stpapi.put.fields entered correctly, I am able to process the invoice manually without any issue.  But thru AFS, I get this error message.<br />
<br />
Also, I have removed the  command, stpapi.get.mess.code from the code and still have the same issue.<br />
<br />
thanks<br />
Newbie</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">27th August 2010, 16:53</div></div><div class="posttext">Several things I noticed after looking some more - and I would look at them in this order.<br />
<br />
(1) Is that code your actual code?  The field document is mis-spelled in the stpapi.put.<br />
(2) Do you get the same error if print the details and set the report<br />
(3) Can you add a screen shot of the form for your system?  Several fields you are putting are not on my system.  The main one is  stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;sim.pay.difference&quot;,str$(0)).  Not on our system - is this a yes/no field or what?<br />
(4) I don't think you need to put tfgld003.psep field.  Just a side item.<br />
(5) And last but not least - I have to ask just to confirm.  Have you double checked to see if it is actually working?  I just noticed the message tfacrs0176 is just a warning on our system.<br />
<br />
Now - the misspelled document field might just be the solution, but it could be several other things.  The object or the stpapi libraries them selves - but I would save that for last.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">newbie007</div><div class="date">27th August 2010, 19:11</div></div><div class="posttext">Hi Mark,<br />
<br />
Please see my replies in bold<br />
<br />
<br />
(1) Is that code your actual code? The field document is mis-spelled in the stpapi.put.<br />
<br />
---&gt; I have corrected the my code to have the &quot;document&quot; spelled correct and still get the same error message.<br />
<br />
<br />
(2) Do you get the same error if print the details and set the report<br />
<br />
----&gt; Strangely, when I have the report set as &quot;print.details = tcyesno.yes&quot;, the program worked and processed(wrote off) the invoice.<br />
<br />
----&gt; if print.details = tcyesno.no, then nothing happens...<br />
<br />
(3) Can you add a screen shot of the form for your system? Several fields you are putting are not on my system. The main one is stpapi.put.field(&quot;tfacr2240m000&quot;,&quot;sim.pay.difference&quot;,str$(0)). Not on our system - is this a yes/no field or what?<br />
<br />
----&gt; sim.pay.difference is one of the fields in the script which is set if you want to simulate. I just wanted to make sure it is set to No&quot; . It's domain is tcbool. <br />
<br />
(4) I don't think you need to put tfgld003.psep field. Just a side item.<br />
<br />
-----&gt; since the program is looking at the tfgld003.psep on the afs.log, i just wanted to be sure, I am passing the correct value, to be sure that this is not the reason why I am getting the error.<br />
<br />
<br />
(5) And last but not least - I have to ask just to confirm. Have you double checked to see if it is actually working? I just noticed the message tfacrs0176 is just a warning on our system.<br />
<br />
---&gt; Yeah, I checked to make sure if the invoice got processed. As it creates the batch and the tfacr200 will have a the write-off document and the balance of the original invoice will be &quot;zero&quot;.  <br />
<br />
The process didn't create any batch or process the ACR invoice.<br />
<br />
<br />
Now - the misspelled document field might just be the solution, but it could be several other things. The object or the stpapi libraries them selves - but I would save that for last. <br />
<br />
----&gt; I have the lastest SPI libraries, so I don't think that is an issue.<br />
<br />
<br />
thanks<br />
Newbie</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">27th August 2010, 20:08</div></div><div class="posttext">Okay - form looks like our system.  The stpapi.put for the sim.pay.difference and for tflgd003.psep really do not do anything - I would remove them(that is just me).  At least with #2 you have a work around - you can always sent the report to a dummy file I do that a lot.  Something you can try - define the report(issue the stpapi.report command) but set the print details field back to NO.  Run it again.  I think on all of the AFS code I have written if the session called for a report I always did the stpapi.set.report(not 100% sure on that, but might very well be true).<br />
<br />
It probably is something in the script for the session, but I am not sure what.  If printing the report works then you at least have a work around.  Just the basic code you included should work and I was really hoping it was the misspelled field called document.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">newbie007</div><div class="date">31st August 2010, 19:25</div></div><div class="posttext">Thanks Mark..<br />
<br />
I have one more question?.<br />
<br />
Example of Data:<br />
<br />
Say I have invoices SIV 10000001, SIV 10000010 which needs to be written off. I also have invoices SIV 10000002 which I don't want to write off<br />
<br />
Issue:<br />
<br />
I am calling tfacr2240m000 from a custom program and passing the  transaction type and invoice numbers  to be written off one at a time as the invoice number are not is a continuous range. Each time the program runs it creates a batch number and a write off document number.  So if you have 1000 odd invoices not in a range, then you would end up with 1000 batch numbers and write off document numbers. I am wondering, if there is a way to have only one batch number and one document number for the batch of 1000 odd non continuous  invoices numbers to be written off. Any ideas?.<br />
<br />
thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">31st August 2010, 20:28</div></div><div class="posttext">That turns out to be a functional question I can not really answer.  I have never written one for these sessions.  The few I have written usually first create a batch and then go into the subsessions to create the transactions.  The few I have written in the tfgld area usually start with tfgld1101m000(I think).</div></div><hr />



</div>
</body>
</html>