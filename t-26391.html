<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="Maintain Replenishment Orders, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] Maintain Replenishment Orders AFS/DDC/OLE: Function servers" />
	
	<title>Maintain Replenishment Orders [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="index.html">Newbaanboard</a> &gt; <a href="index.html">Baan SIGs</a> &gt; <a href="index.html">AFS/DDC/OLE: Function servers</a> &gt; Maintain Replenishment Orders</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">pedromrs</div><div class="date">13th February 2006, 18:55</div></div><div class="posttext">Hello all,<br />
<br />
Did anyone have success creating Replenishment orders via AFS?<br />
I have been successfull in creating the header for the order (session tdrpl0110m100). <br />
When I call the subsession I noticed in the AFS.log that it won't collect the necessary information from the main session. When I try to save the line it comes up with something like &quot;Can't find order reference&quot;. <br />
Not sure if this is the problem but the tdrpl0110m100 is actually not on the Baan explorer. There's a tdrpl0105m000 that calls tdrpl0110m100.<br />
<br />
Here is part of my code:<br />
<br />
             |Colocar numero de ordem - Serie<br />
	stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.orno&quot;, &quot;2&quot; )<br />
	<br />
	|Colocar tipo de ordem<br />
	stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.cotp&quot;, &quot;RP1&quot; )<br />
	<br />
	|Colocar armazem de origem<br />
	stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.rwar&quot;, &quot;006&quot; )<br />
	<br />
	|Colocar armazem de destino<br />
	stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.dwar&quot;, &quot;C6F&quot; )<br />
	<br />
	|Colocar data da ordem<br />
	stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.odat&quot;, str$(data) )<br />
	<br />
	|Data prevista de entrega<br />
	stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.pddt&quot;, str$(data+10) )<br />
	<br />
	|Data prevista de recepção<br />
	stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.prdt&quot;, str$(data+10) )<br />
	<br />
	|Tentar inserir o record	<br />
	ret=stpapi.insert( &quot;tdrpl0110m100&quot;, true, error )<br />
	<br />
		<br />
	|Verificar se existiu um erro<br />
	if (ret=0) then<br />
	<br />
		message(error)<br />
		|Fazer o recover<br />
		stpapi.recover( &quot;tdrpl0110m100&quot;, error )<br />
	else<br />
		|Vamos buscar o numero da ordem recem-criada<br />
		stpapi.get.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.orno&quot;, orno )<br />
		<br />
		|Preparar subsessão de linhas<br />
		stpapi.handle.subproc( &quot;tdrpl0110m100&quot;, &quot;tdrpl0111s100&quot;, &quot;add&quot; )		<br />
		<br />
		|Disparar subsessão		<br />
		stpapi.change.view( &quot;tdrpl0110m100&quot; )<br />
		<br />
		|Colocar numero da ordem<br />
		stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.orno&quot;, orno )<br />
		<br />
		|Colocar a posicao<br />
		stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.pono&quot;, &quot;1&quot; )<br />
		<br />
		|Colocar tipo de ordem<br />
		stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl100.cotp&quot;, &quot;RP1&quot; )<br />
	<br />
		|Colocar a sequencia<br />
		|stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.srnb&quot;, &quot;1&quot; )<br />
		<br />
		|Colocar Item<br />
		stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.item&quot;, item )<br />
		<br />
		|Colocar Unidade<br />
		stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.cuni&quot;, &quot;Un &quot; )<br />
		<br />
		|Colocar Quantidade<br />
		stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.oqua&quot;, str$(qana) )<br />
		<br />
		|Colocar armazem de origem<br />
		stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.rwar&quot;, &quot;006&quot; )<br />
		<br />
		|Colocar armazem de destino<br />
		stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.dwar&quot;, &quot;C6F&quot; )<br />
		<br />
		|Colocar data da ordem<br />
		stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.odat&quot;, str$(data) )<br />
		<br />
		|Data prevista de entrega<br />
		stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.pddt&quot;, str$(data+10) )<br />
		<br />
		|Data prevista de recepção<br />
		stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.prdt&quot;, str$(data+10) )<br />
	<br />
		|Inserir Record<br />
		ret=stpapi.insert( &quot;tdrpl0111s100&quot;, true, error )<br />
		|ret=stpapi.save( &quot;tdrpl0111s100&quot;, error )<br />
		<br />
		if (ret=0) then<br />
	<br />
			message(error)<br />
			|Fazer o recover<br />
			stpapi.recover( &quot;tdrpl0111s100&quot;, error )<br />
		else<br />
			message(&quot;Sucesso Linhas&quot;)			<br />
		endif<br />
		<br />
		|Encerrar sessão de linhas<br />
		stpapi.end.session( &quot;tdrpl0111s100&quot; , error  )<br />
	endif<br />
<br />
Thank you,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">13th February 2006, 19:29</div></div><div class="posttext">Not sure about your version, but from ours I would expect to see something like this<br />
<br />
<br />
	ret=stpapi.insert( &quot;tdrpl0110m100&quot;, true, error )<br />
	stpapi.handle.subproc( &quot;tdrpl0110m100&quot;, &quot;tdrpl0111s100&quot;, &quot;add&quot; )	<br />
	|To activate lines		<br />
	stpapi.continue.process( &quot;tdrpl0110m100&quot; )<br />
<br />
<br />
But then again our tdrpl0110m100 activates tdrpl0111s000, but we do have a tdrpl0111s100 on the system.  Not real familiar with these sessions and have not actually done an AFS routine for them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pedromrs</div><div class="date">13th February 2006, 19:39</div></div><div class="posttext">Mark,<br />
<br />
Thanks. That did the trick. I did not try that one because the generated dll from the session didn't brought that one up. As I didn't touch AFS code for over a year now I did not remember to try it.<br />
<br />
So my code works for adding replenishment orders if you change the code to reflect Marks suggestion.<br />
<br />
Thanks again,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fsamuels</div><div class="date">15th March 2006, 21:09</div></div><div class="posttext">I wonder if some can give me the where I should add the code that did the trick.<br />
I am new on this and I try to convert this code to vba code in excel and it want add items to the replenishment order.<br />
<br />
Regards<br />
Fredrik<br />
<br />
<br />
---------------<br />
  Call ConnectBaan<br />
   <br />
    Dim BaanSess As String<br />
    Dim SessField  As String<br />
    Dim sDll As String<br />
    <br />
    Dim sReturnString As String<br />
    sReturnString = Space(128)<br />
<br />
    Dim sValue As String<br />
<br />
<br />
'  |Colocar numero de ordem - Serie<br />
 '   stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.orno&quot;, &quot;2&quot; )<br />
    BaanSess = &quot;tdrpl0110m100&quot;<br />
    SessField = &quot;tdrpl105.orno&quot;<br />
    sValue = &quot;2&quot;<br />
  <br />
    sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
    <br />
    <br />
'    |Colocar tipo de ordem<br />
 '   stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.cotp&quot;, &quot;RP1&quot; )<br />
    <br />
    SessField = &quot;tdrpl105.cotp&quot;<br />
    sValue = &quot;RP1&quot;<br />
       <br />
    sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
    <br />
    <br />
  '  |Colocar armazem de origem<br />
  '  stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.rwar&quot;, &quot;006&quot; )<br />
    <br />
    SessField = &quot;tdrpl105.rwar&quot;<br />
    sValue = &quot;200&quot;<br />
       <br />
    sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
    <br />
        <br />
  '  |Colocar armazem de destino<br />
   ' stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.dwar&quot;, &quot;C6F&quot; )<br />
    SessField = &quot;tdrpl105.dwar&quot;<br />
    sValue = &quot;21D&quot;<br />
       <br />
    sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
    <br />
    <br />
  '  |Colocar data da ordem<br />
  '  stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.odat&quot;, str$(data) )<br />
    SessField = &quot;tdrpl105.odat&quot;<br />
    sValue = Date<br />
    sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
   <br />
  <br />
  '  |Data prevista de entrega<br />
  '  stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.pddt&quot;, str$(data+10) )<br />
  <br />
    SessField = &quot;tdrpl105.pddt&quot;<br />
    sValue = Date + 10<br />
    sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
   <br />
  <br />
  '  |Data prevista de recepção<br />
  '  stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.prdt&quot;, str$(data+10) )<br />
    SessField = &quot;tdrpl105.prdt&quot;<br />
    sValue = Date<br />
    sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
    <br />
    <br />
  '  |Tentar inserir o record<br />
  '  ret = stpapi.Insert(&quot;tdrpl0110m100&quot;, True, Error)<br />
    <br />
    <br />
   ' sDll = &quot;stpapi.Insert(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,1,&quot; &amp; sReturnString &amp; &quot;)&quot;<br />
   ' Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
<br />
Dim sErrMsg As String<br />
Dim ret<br />
<br />
sErrMsg = Space(50)<br />
      ret = BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, &quot;stpapi.insert(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,1,&quot; &amp; Chr(34) &amp; sErrMsg &amp; Chr(34) &amp; &quot;)&quot;)<br />
<br />
MsgBox (&quot;ret = &quot; &amp; CStr(ret) &amp; Chr(10) &amp; _<br />
            &quot;sErrMsg = &quot; &amp; sErrMsg &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.Error = &quot; &amp; BaanObj.Error &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.ReturnValue = &quot; &amp; BaanObj.returnvalue &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.FunctionCall = &quot; &amp; BaanObj.FunctionCall)<br />
            <br />
 <br />
<br />
If BaanObj.Error &lt;&gt; 0 Then<br />
            ' Send mail (sometime in the future?)<br />
        <br />
            ret = BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, &quot;stpapi.recover( &quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot; ,&quot; &amp; Chr(34) &amp; sErrMsg &amp; Chr(34) &amp; &quot;)&quot;)<br />
     <br />
        Else<br />
        <br />
  '  Else<br />
     <br />
     '   |Vamos buscar o numero da ordem recem-criada<br />
    '    stpapi.get.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl105.orno&quot;, orno )<br />
        <br />
        Dim sOrno As String<br />
        SessField = &quot;tdrpl105.orno&quot;<br />
        <br />
        sDll = &quot;stpapi.get.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sReturnString &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
<br />
        sOrno = GetValueFromStapiGet(BaanObj.FunctionCall, BaanSess, SessField)<br />
       <br />
  <br />
        '      |Preparar subsessão de linhas<br />
        '      stpapi.handle.subproc( &quot;tdrpl0110m100&quot;, &quot;tdrpl0111s100&quot;, &quot;add&quot; )<br />
        <br />
          SessField = &quot;tdrpl0111s100&quot;<br />
          sValue = &quot;add&quot;<br />
          sDll = &quot;stpapi.handle.subproc(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
          Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
  <br />
  <br />
  '<br />
  '      |Disparar subsessão<br />
  '      stpapi.Change.View (&quot;tdrpl0110m100&quot;)<br />
     <br />
<br />
        sErrMsg = Space(50)<br />
        ret = BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, &quot;stpapi.change.view(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sErrMsg &amp; Chr(34) &amp; &quot;)&quot;)<br />
<br />
        MsgBox (&quot;ret = &quot; &amp; CStr(ret) &amp; Chr(10) &amp; _<br />
            &quot;sErrMsg = &quot; &amp; sErrMsg &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.Error = &quot; &amp; BaanObj.Error &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.ReturnValue = &quot; &amp; BaanObj.returnvalue &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.FunctionCall = &quot; &amp; BaanObj.FunctionCall)<br />
  <br />
  <br />
  '      |Colocar numero da ordem<br />
  '      stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.orno&quot;, orno )<br />
        subBaanSess = &quot;tdrpl0111s100&quot;<br />
        SessField = &quot;tdrpl100.orno&quot;<br />
        sValue = sOrno<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
              <br />
      <br />
  '      |Colocar a posicao<br />
  '      stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.pono&quot;, &quot;1&quot; )<br />
        SessField = &quot;tdrpl100.pono&quot;<br />
        sValue = &quot;1&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
   <br />
  <br />
  '      |Colocar tipo de ordem<br />
  '      stpapi.put.field( &quot;tdrpl0110m100&quot;, &quot;tdrpl100.cotp&quot;, &quot;RP1&quot; )<br />
        SessField = &quot;tdrpl100.cotp&quot;<br />
        sValue = &quot;RP1&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
  <br />
  <br />
  '<br />
 '       |Colocar a sequencia<br />
 '       |stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.srnb&quot;, &quot;1&quot; )<br />
        SessField = &quot;tdrpl100.srnb&quot;<br />
        sValue = &quot;1&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
   <br />
 <br />
 '       |Colocar Item<br />
 '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.item&quot;, item )<br />
        SessField = &quot;tdrpl100.item&quot;<br />
        sValue = &quot;LZF083256/1&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
 <br />
 <br />
 '       |Colocar Unidade<br />
 '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.cuni&quot;, &quot;Un &quot; )<br />
       ' SessField = &quot;tdrpl100.cuni&quot;<br />
       ' sValue = &quot;Un &quot;<br />
       ' sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
       ' Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
 <br />
 <br />
 <br />
 <br />
 '       |Colocar Quantidade<br />
 '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.oqua&quot;, str$(qana) )<br />
        SessField = &quot;tdrpl100.oqua&quot;<br />
        sValue = &quot;10&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
 <br />
 <br />
 '       |Colocar armazem de origem<br />
 '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.rwar&quot;, &quot;006&quot; )<br />
        SessField = &quot;tdrpl100.rwar&quot;<br />
        sValue = &quot;200&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
        <br />
        <br />
        <br />
 '       |Colocar armazem de destino<br />
 '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.dwar&quot;, &quot;C6F&quot; )<br />
        SessField = &quot;tdrpl100.dwar&quot;<br />
        sValue = &quot;21D&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
        <br />
        <br />
        <br />
        <br />
 '       |Colocar data da ordem<br />
 '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.odat&quot;, str$(data) )<br />
        SessField = &quot;tdrpl100.odat&quot;<br />
        sValue = Date<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
        <br />
        'Data prevista de entrega<br />
        '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.pddt&quot;, str$(data+10) )<br />
               <br />
        SessField = &quot;tdrpl100.pddt&quot;<br />
        sValue = Date<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
      <br />
        <br />
'        |Data prevista de recepção<br />
'        stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.prdt&quot;, str$(data+10) )<br />
        SessField = &quot;tdrpl100.prdt&quot;<br />
        sValue = Date<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
      <br />
     <br />
'        |Inserir Record<br />
'        ret = stpapi.Insert(&quot;tdrpl0111s100&quot;, True, Error)<br />
'        |ret=stpapi.save( &quot;tdrpl0111s100&quot;, error )<br />
                      <br />
            <br />
        'Belive I need this<br />
        'SessField = &quot;tdrpl105.orno&quot;<br />
        'sValue = sOrno<br />
       <br />
        'sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        'Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
                  <br />
        <br />
        sErrMsg = Space(128)<br />
        ret = BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, &quot;stpapi.insert(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,1,&quot; &amp; Chr(34) &amp; sErrMsg &amp; Chr(34) &amp; &quot;)&quot;)<br />
<br />
        MsgBox (&quot;ret = &quot; &amp; CStr(ret) &amp; Chr(10) &amp; _<br />
            &quot;sErrMsg = &quot; &amp; sErrMsg &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.Error = &quot; &amp; BaanObj.Error &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.ReturnValue = &quot; &amp; BaanObj.returnvalue &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.FunctionCall = &quot; &amp; BaanObj.FunctionCall)<br />
                      <br />
           <br />
        <br />
        <br />
        End If<br />
<br />
----------------------------------:confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pedromrs</div><div class="date">16th March 2006, 00:13</div></div><div class="posttext">Replace the change.view() for the continue.process call</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fsamuels</div><div class="date">16th March 2006, 08:27</div></div><div class="posttext">I try that with no success.<br />
       sErrMsg = Space(50)<br />
        BaanObj.ParseExecFunction &quot;ottstpapihand&quot;, &quot;stpapi.continue.process(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sErrMsg &amp; Chr(34) &amp; &quot;)&quot;<br />
  <br />
  <br />
  '      |Colocar numero da ordem<br />
  '      stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.orno&quot;, orno )<br />
        SessField = &quot;tdrpl100.orno&quot;<br />
        sValue = &quot;30991&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
<br />
It get error -10 then I try to put field with &quot;stpapi.put.field&quot;<br />
<br />
Any proposal?<br />
:confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fsamuels</div><div class="date">16th March 2006, 09:08</div></div><div class="posttext">It works now but i dont understand why<br />
I add a &quot;stpapi.put.field&quot; before i stpapi.continue.process on the childsession <br />
and now it works<br />
<br />
       SessField = &quot;tdrpl100.orno&quot;<br />
        sValue = &quot;30991&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
              <br />
              <br />
              <br />
        sErrMsg = Space(50)<br />
        sDll = &quot;stpapi.continue.process(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sErrMsg &amp; Chr(34) &amp; &quot;)&quot;<br />
        ret = BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, sDll)<br />
   MsgBox (&quot;ret = &quot; &amp; CStr(ret) &amp; Chr(10) &amp; _<br />
            &quot;sErrMsg = &quot; &amp; sErrMsg &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.Error = &quot; &amp; BaanObj.Error &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.ReturnValue = &quot; &amp; BaanObj.returnvalue &amp; Chr(10) &amp; _<br />
            &quot;BaanObj.FunctionCall = &quot; &amp; BaanObj.FunctionCall)<br />
<br />
Can someone wise explain this for me?<br />
:cool:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">16th March 2006, 16:21</div></div><div class="posttext">Sometimes everything essential to a sub-session does not make it from the main session when using API code.  So in some cases you may have to work around this problem - put the fields, do a look up, etc.  Since I am not familiar with these sessions I really can not say what the problem could be.  It could also just be that you need the latest patches on the objects.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vandana</div><div class="date">11th January 2007, 06:41</div></div><div class="posttext">Dear pedromrs <br />
<br />
Hi, I would like to have source of AFS of maintining RPL header part from you, can u send me on g_shirsat@yahoo.com<br />
<br />
Thanks<br />
<br />
Ganesh</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fsamuels</div><div class="date">12th January 2007, 07:10</div></div><div class="posttext">'This is my sourcode for this Excel Macro that I was playing with for some time ago.<br />
'Hope you find that you need in this.<br />
'To use this you need a sheet in Excel that is named RO<br />
'Please not ask how it works since I am very busy right now..<br />
<br />
'Good luck<br />
<br />
<br />
<br />
Dim BaanObj As Object<br />
Dim dllname As String<br />
Dim dllfunction As String<br />
<br />
Option Explicit<br />
<br />
Private db As New ADODB.Connection<br />
 Dim iFast As Integer<br />
 <br />
Private Sub connectDb()<br />
   On Error Resume Next<br />
    db.Open &quot;Provider=sqloledb;Data Source=knasqlcl02\sql02;Initial Catalog=FLS;User Id=******;Password=*****;&quot;<br />
<br />
End Sub<br />
<br />
Function PopulateBaanField(BaanObj, sSession, sTable, sField, sValue)<br />
    ' filling the Baan field with the value<br />
    Dim s<br />
    Dim sTest As String<br />
    sTest = Space(128)<br />
    <br />
    FieldName = sTable &amp; &quot;.&quot; &amp; sField<br />
    <br />
    s = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; sSession &amp; Chr(34) &amp; &quot;, &quot; &amp; _<br />
        Chr(34) &amp; sTable &amp; &quot;.&quot; &amp; sField &amp; Chr(34) &amp; &quot;, &quot; &amp; _<br />
        Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
    <br />
    Call BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, s)<br />
    If BaanObj.Error &lt;&gt; 0 Or BaanObj.returnvalue &lt;&gt; &quot;&quot; Then<br />
        BaanObj.Quit<br />
    End If<br />
   <br />
'Call BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, &quot;stpapi.get.field(&quot; &amp; Chr(34) &amp; sSession &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sTable &amp; &quot;.&quot; &amp; sField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sTest &amp; Chr(34) &amp; &quot;)&quot;)<br />
'Call BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, &quot;stpapi.end.session(&quot; &amp; Chr(34) &amp; sSession &amp; Chr(34) &amp; &quot;)&quot;)<br />
 '  If BaanObj.Error &lt;&gt; 0 Or BaanObj.ReturnValue &lt;&gt; &quot;&quot; Then<br />
  '      BaanObj.Quit<br />
   ' End If<br />
 'tempstr = BaanObj.ReturnValue<br />
<br />
<br />
'MsgBox &quot;numRecepción--&gt;&gt; &quot; &amp; sTest<br />
<br />
End Function<br />
<br />
Function GetValueFromStapiGet(fc As String, sn As String, fd As String)<br />
GetValueFromStapiGet = Mid$(fc, 18 + Len(sn) + 3 + Len(fd) + 4)<br />
GetValueFromStapiGet = Left$(GetValueFromStapiGet, Len(GetValueFromStapiGet) - 2)<br />
GetValueFromStapiGet = Left(GetValueFromStapiGet, Len(GetValueFromStapiGet) - 1)<br />
<br />
End Function<br />
<br />
<br />
Private Sub ConnectBaan()<br />
    On Error GoTo CannotCreateBaan<br />
        <br />
    ' Baan4<br />
      If BaanObj Is Nothing Then<br />
  <br />
   Set BaanObj = CreateObject(&quot;Baan4.Application&quot;)<br />
    Set BaanObj = BaanObj<br />
  <br />
  End If<br />
  <br />
         <br />
    ' Baan5<br />
    'Set BaanObj = CreateObject(&quot;Baan.Application&quot;)<br />
<br />
    BaanObj.Timeout = 20<br />
<br />
Exit Sub<br />
    <br />
CannotCreateBaan:<br />
    MsgBox &quot;Can not connect to Baan&quot;<br />
    End<br />
End Sub<br />
<br />
Private Sub DisconnectBaan()<br />
    If Not BaanObj Is Nothing Then<br />
        BaanObj.Quit<br />
        Set BaanObj = Nothing<br />
    End If<br />
End Sub<br />
<br />
Private Sub SendtoBAAN(ByVal dllname As String, ByVal dllfunction As String)<br />
    Dim returnvalue As String<br />
    <br />
    If BaanObj Is Nothing Then<br />
        ConnectBaan<br />
        If BaanObj Is Nothing Then<br />
            End<br />
        End If<br />
    End If<br />
    BaanObj.ParseExecFunction dllname, dllfunction<br />
        <br />
    Dim errormsg As String<br />
    Dim Errorsw  As Boolean<br />
    <br />
    errormsg = &quot;&quot;<br />
    If BaanObj.Error &lt;&gt; 0 Then<br />
        Select Case BaanObj.Error<br />
            Case Is = -1<br />
                errormsg = &quot;DLL Unknown&quot;<br />
            Case Is = -2<br />
                errormsg = &quot;Function Unknown&quot;<br />
            Case Is = -3<br />
                errormsg = &quot;Syntax Error in Function Call&quot;<br />
        End Select<br />
        MsgBox &quot;Call to Baan DLL failed, error = &quot; &amp; errormsg &amp; vbNewLine &amp; BaanObj.Error<br />
        <br />
    End If<br />
    returnvalue = Val(BaanObj.returnvalue)<br />
    Errorsw = False<br />
    If returnvalue = False Then<br />
        Errorsw = True<br />
    End If<br />
    Exit Sub<br />
<br />
AutomationError:<br />
    Cells(2, 3) = &quot;Baan IV automation error: &quot; &amp; BaanObj.Error<br />
    End<br />
End Sub<br />
<br />
<br />
Public Sub RepleinsmentMain()<br />
<br />
Dim sAsk As String<br />
sAsk = MsgBox(&quot;Do you want to create replenishment order&quot;, vbYesNo + vbQuestion)<br />
<br />
If sAsk = vbNo Then Exit Sub<br />
<br />
<br />
'31002<br />
   Call ConnectBaan<br />
   Dim sReplenishmentorder As String<br />
   <br />
   If Not ReplenishmentHeader(&quot;200&quot;, &quot;21D&quot;, sReplenishmentorder) Then<br />
        Call DisconnectBaan<br />
<br />
    Exit Sub<br />
    End If<br />
<br />
<br />
<br />
   'For loop later on<br />
   <br />
   Sheets(&quot;RO&quot;).Select<br />
<br />
    Cells(1, 2) = sReplenishmentorder<br />
<br />
    Dim y As Integer<br />
    y = 4<br />
    Dim sItem As String<br />
    Dim iQuantity As Integer<br />
    <br />
    <br />
    Do While Not Cells(y, 1) = &quot;&quot;<br />
        Cells(y, 1).Select<br />
        sItem = Cells(y, 1)<br />
        iQuantity = Cells(y, 5)<br />
        <br />
   If Not ReplenishmentAdditem(sReplenishmentorder, sItem, iQuantity) Then<br />
        Call DisconnectBaan<br />
<br />
    Exit Sub<br />
    DoEvents<br />
    <br />
   End If<br />
        <br />
        <br />
        DoEvents<br />
        y = y + 1<br />
        <br />
    Loop<br />
    <br />
   MsgBox &quot;Done&quot;, vbInformation<br />
   <br />
   <br />
Call DisconnectBaan<br />
<br />
End Sub<br />
<br />
Private Function ReplenishmentAdditem(sReplenishmentorder As String, sItem As String, iQuantity As Integer) As Boolean<br />
    Dim BaanSess As String<br />
    Dim subBaanSess As String<br />
    <br />
    Dim SessField  As String<br />
    Dim sDll As String<br />
    Dim sErrMsg As String<br />
    <br />
    Dim sReturnString As String<br />
    sReturnString = Space(128)<br />
<br />
    Dim sValue As String<br />
<br />
    subBaanSess = &quot;tdrpl0111s100&quot;<br />
    BaanSess = &quot;tdrpl0110m100&quot;<br />
      <br />
    Dim ret As Variant<br />
    <br />
     Dim sOrno As String<br />
       <br />
        SessField = &quot;tdrpl105.orno&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sReplenishmentorder &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
        <br />
        <br />
        sErrMsg = Space(128)<br />
        sDll = &quot;stpapi.Find(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sErrMsg &amp; Chr(34) &amp; &quot;)&quot;<br />
<br />
        ret = BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, sDll)<br />
        If BaanObj.returnvalue &lt;&gt; 1 Then<br />
            stpapi_End_session (BaanSess)<br />
             MsgBox &quot;Replenishmentorder: &quot; &amp; sReplenishmentorder &amp; &quot; not exist&quot;<br />
            Exit Function<br />
        End If<br />
<br />
        sValue = &quot;add&quot;<br />
        sDll = &quot;stpapi.handle.subproc(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
 <br />
        <br />
        'This make it possible to stpapi.continue.process downunder<br />
        SessField = &quot;tdrpl100.orno&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sReplenishmentorder &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
              <br />
              <br />
    ' |To activate lines<br />
   ' stpapi.continue.process (&quot;tdrpl0110m100&quot;)<br />
        sErrMsg = Space(50)<br />
        sDll = &quot;stpapi.continue.process(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sErrMsg &amp; Chr(34) &amp; &quot;)&quot;<br />
        ret = BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, sDll)<br />
   'MsgBox (&quot;ret = &quot; &amp; CStr(ret) &amp; Chr(10) &amp; _<br />
    '        &quot;sErrMsg = &quot; &amp; sErrMsg &amp; Chr(10) &amp; _<br />
     '       &quot;BaanObj.Error = &quot; &amp; BaanObj.Error &amp; Chr(10) &amp; _<br />
      '      &quot;BaanObj.ReturnValue = &quot; &amp; BaanObj.returnvalue &amp; Chr(10) &amp; _<br />
       '     &quot;BaanObj.FunctionCall = &quot; &amp; BaanObj.FunctionCall)<br />
  <br />
 <br />
        'Add Item<br />
        SessField = &quot;tdrpl100.item&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sItem &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
 <br />
 <br />
 '       |Colocar Unidade<br />
 '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.cuni&quot;, &quot;Un &quot; )<br />
       ' SessField = &quot;tdrpl100.cuni&quot;<br />
       ' sValue = &quot;Un &quot;<br />
       ' sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
       ' Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
 <br />
        'Add Quantity<br />
        SessField = &quot;tdrpl100.oqua&quot;<br />
        sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; CStr(iQuantity) &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
 <br />
 <br />
 '       |Colocar armazem de origem<br />
 '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.rwar&quot;, &quot;006&quot; )<br />
  '      SessField = &quot;tdrpl100.rwar&quot;<br />
  '      sValue = &quot;200&quot;<br />
  '      sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
  '      Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
        <br />
        <br />
        <br />
 '       |Colocar armazem de destino<br />
 '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.dwar&quot;, &quot;C6F&quot; )<br />
   '     SessField = &quot;tdrpl100.dwar&quot;<br />
    '    sValue = &quot;21D&quot;<br />
     '   sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
      '  Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
        <br />
        <br />
        <br />
        <br />
 '       |Colocar data da ordem<br />
 '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.odat&quot;, str$(data) )<br />
   '     SessField = &quot;tdrpl100.odat&quot;<br />
   '     sValue = Date<br />
   '     sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
    '    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
        <br />
        'Data prevista de entrega<br />
        '       stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.pddt&quot;, str$(data+10) )<br />
               <br />
     '   SessField = &quot;tdrpl100.pddt&quot;<br />
     '   sValue = &quot;20070101&quot;<br />
     '   sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
     '   Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
      <br />
        <br />
'        |Data prevista de recepção<br />
'        stpapi.put.field( &quot;tdrpl0111s100&quot;, &quot;tdrpl100.prdt&quot;, str$(data+10) )<br />
    '    SessField = &quot;tdrpl100.prdt&quot;<br />
    '    sValue = Date<br />
    '    sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
    '    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
      <br />
     <br />
'        |Inserir Record<br />
'        ret = stpapi.Insert(&quot;tdrpl0111s100&quot;, True, Error)<br />
'        |ret=stpapi.save( &quot;tdrpl0111s100&quot;, error )<br />
                      <br />
            <br />
        <br />
        sErrMsg = Space(128)<br />
        ret = BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, &quot;stpapi.insert(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;,1,&quot; &amp; Chr(34) &amp; sErrMsg &amp; Chr(34) &amp; &quot;)&quot;)<br />
<br />
      '  MsgBox (&quot;ret = &quot; &amp; CStr(ret) &amp; Chr(10) &amp; _<br />
       '     &quot;sErrMsg = &quot; &amp; sErrMsg &amp; Chr(10) &amp; _<br />
        '    &quot;BaanObj.Error = &quot; &amp; BaanObj.Error &amp; Chr(10) &amp; _<br />
         '   &quot;BaanObj.ReturnValue = &quot; &amp; BaanObj.returnvalue &amp; Chr(10) &amp; _<br />
          '  &quot;BaanObj.FunctionCall = &quot; &amp; BaanObj.FunctionCall)<br />
                      <br />
<br />
    sDll = &quot;stpapi.End.session(&quot; &amp; Chr(34) &amp; subBaanSess &amp; Chr(34) &amp; &quot;)&quot;<br />
   Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
    <br />
    <br />
    sDll = &quot;stpapi.End.session(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
<br />
<br />
ReplenishmentAdditem = True<br />
<br />
End Function<br />
<br />
 <br />
Private Function stpapi_End_session(sSession As String) As Boolean<br />
    Dim sDll As String<br />
    <br />
    sDll = &quot;stpapi.End.session(&quot; &amp; Chr(34) &amp; sSession &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
<br />
    stpapi_End_session = True<br />
<br />
End Function<br />
<br />
<br />
Private Function ReplenishmentHeader(sMainStorage As String, sPwStorage As String, ByRef sReplenishmentorder As String) As Boolean<br />
    Dim BaanSess As String<br />
    Dim SessField  As String<br />
    Dim sDll As String<br />
    <br />
    Dim sReturnString As String<br />
    sReturnString = Space(128)<br />
<br />
    Dim sValue As String<br />
    Dim dDate As Date<br />
<br />
<br />
    BaanSess = &quot;tdrpl0110m100&quot;<br />
    SessField = &quot;tdrpl105.cotp&quot;<br />
    sValue = &quot;RP1&quot;<br />
    sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sValue &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
    <br />
    <br />
   'sMainStorage<br />
    SessField = &quot;tdrpl105.rwar&quot;<br />
    sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sMainStorage &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
    <br />
    'PwStorage<br />
    SessField = &quot;tdrpl105.dwar&quot;<br />
       <br />
    sDll = &quot;stpapi.put.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sPwStorage &amp; Chr(34) &amp; &quot;)&quot;<br />
    Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
    <br />
    Dim sErrMsg As String<br />
    sErrMsg = Space(128)<br />
       <br />
    Dim ret As Variant<br />
<br />
    ret = BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, &quot;stpapi.insert(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,1,&quot; &amp; Chr(34) &amp; sErrMsg &amp; Chr(34) &amp; &quot;)&quot;)<br />
<br />
    <br />
<br />
    If BaanObj.Error &lt;&gt; 0 Then<br />
            ' Send mail (sometime in the future?)<br />
    <br />
    '   MsgBox (&quot;ret = &quot; &amp; CStr(ret) &amp; Chr(10) &amp; _<br />
    '        &quot;sErrMsg = &quot; &amp; sErrMsg &amp; Chr(10) &amp; _<br />
    '        &quot;BaanObj.Error = &quot; &amp; BaanObj.Error &amp; Chr(10) &amp; _<br />
    '        &quot;BaanObj.ReturnValue = &quot; &amp; BaanObj.returnvalue &amp; Chr(10) &amp; _<br />
    '        &quot;BaanObj.FunctionCall = &quot; &amp; BaanObj.FunctionCall)<br />
            <br />
     <br />
     <br />
            ret = BaanObj.ParseExecFunction(&quot;ottstpapihand&quot;, &quot;stpapi.recover( &quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot; ,&quot; &amp; Chr(34) &amp; sErrMsg &amp; Chr(34) &amp; &quot;)&quot;)<br />
            stpapi_End_session (BaanSess)<br />
            Exit Function<br />
            <br />
        Else<br />
        <br />
        SessField = &quot;tdrpl105.orno&quot;<br />
        <br />
        sDll = &quot;stpapi.get.field(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; SessField &amp; Chr(34) &amp; &quot;,&quot; &amp; Chr(34) &amp; sReturnString &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
<br />
        sReplenishmentorder = GetValueFromStapiGet(BaanObj.FunctionCall, BaanSess, SessField)<br />
       <br />
        sDll = &quot;stpapi.End.session(&quot; &amp; Chr(34) &amp; BaanSess &amp; Chr(34) &amp; &quot;)&quot;<br />
        Call SendtoBAAN(&quot;ottstpapihand&quot;, sDll)<br />
    <br />
    End If<br />
<br />
<br />
'31002<br />
    ReplenishmentHeader = True<br />
<br />
End Function</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pedromrs</div><div class="date">12th January 2007, 10:36</div></div><div class="posttext">Vandana,<br />
<br />
If you look at my first post that code works with the changes suggested by Mark on the second post.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vandana</div><div class="date">13th January 2007, 09:32</div></div><div class="posttext">Dear Pedros,<br />
<br />
Can u please send me ur code for rpl order thru AFS<br />
<br />
Thanks<br />
<br />
Vandana</div></div><hr />



</div>
</body>
</html>