<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="how to avoid duplicate entry, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] how to avoid duplicate entry Tools Administration &amp; Installation" />
	
	<title>how to avoid duplicate entry [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="../index.html">Newbaanboard</a> &gt; <a href="../index.html">Baan Quick Support: Functional &amp; Technical</a> &gt; <a href="../index.html">Tools Administration &amp; Installation</a> &gt; how to avoid duplicate entry</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">4th June 2013, 07:13</div></div><div class="posttext">Hi<br />
This is existing code. I want to avoid duplicate cins during entry data. I want to pop up message like &quot;serial no entered already exist&quot;. <br />
Please help me.<br />
<br />
field.tsrep124.cins:		<br />
before.zoom:						|jsz#1112.sn<br />
	save.ccon = tssma301.ccon<br />
	zoom.ccon = tssma301.ccon<br />
	zoom.cins = &quot;&quot;<br />
	zoom.cloc = tssma301.cloc	|jsz#1112.en<br />
<br />
check.input:   <br />
         <br />
	if tssma301.sert = tssma.sert.call then<br />
           <br />
		if tsrep124.cins = tssma301.cins and<br />
			(not isspace(tsrep124.cins) or <br />
			 not isspace(tssma301.cins)) then		|jsz#1112.n<br />
			set.input.error(&quot;tssmas0155&quot;)<br />
                        <br />
                else<br />
			if not isspace(tsrep124.cins) then	|jsz#1112.n<br />
				select	tssma102.*<br />
				from		tssma102<br />
				where		tssma102._index1 = {:tsrep124.cins}<br />
				as set with 1 rows<br />
				selectdo<br />
                                   	if tssma102.cloc &lt;&gt; tssma301.cloc then<br />
						set.input.error(&quot;tsmt.loca&quot;)<br />
					endif<br />
				selectempty<br />
					set.input.error(&quot;tssmas0201&quot;)<br />
                                       <br />
                                endselect<br />
			endif				|jsz#1112.n<br />
		endif<br />
              <br />
	endif<br />
	if tssma301.sert = tssma.sert.service then<br />
           <br />
		if not isspace(tsrep124.cins) then	|jsz#1112.n<br />
			select	tssma102.*<br />
			from		tssma102<br />
			where		tssma102._index1 = {:tsrep124.cins}<br />
			as set with 1 rows<br />
			selectdo<br />
				if tssma102.cloc &lt;&gt; tssma301.cloc then<br />
					set.input.error(&quot;tsmt.loca&quot;)<br />
				endif<br />
			selectempty<br />
				set.input.error(&quot;tssmas0201&quot;)<br />
                                <br />
			endselect<br />
		endif				|jsz#1112.n<br />
               <br />
	endif</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">4th June 2013, 07:15</div></div><div class="posttext">please help me</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">4th June 2013, 09:34</div></div><div class="posttext">I am not aware of Baan IV but a question for you, is it a customized table? If yes, you can make it as index field and it wont allow duplicate entries.<br />
<br />
If not , you can write a simple select statement in before.input to check if the same value appears in the table, if yes you can do this:-<br />
<br />
<br />
message(&quot;Record already exist&quot;)<br />
input.again()</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">4th June 2013, 11:32</div></div><div class="posttext">Yes, this customization session. The session look like attachment. I want to make sure user received message as &quot;Duplicate SN&quot; when they enter the same SN within 1 service order.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">4th June 2013, 11:39</div></div><div class="posttext">i am added the function select statement as below and added the function as per suggested but i still able to enter duplicate serial no.<br />
<br />
field.tsrep124.cins:		<br />
before.zoom:						|jsz#1112.sn<br />
	save.ccon = tssma301.ccon<br />
	zoom.ccon = tssma301.ccon<br />
	zoom.cins = &quot;&quot;<br />
	zoom.cloc = tssma301.cloc	|jsz#1112.en<br />
<br />
before.input:<br />
check.serialno()<br />
<br />
-----------------------------------------------------------<br />
function check.serialno()<br />
{<br />
select tsrep124.*, tssma102.*, tssma301.*<br />
from tsrep124, tssma102, tssma301<br />
where tsrep124.orno = tssma301.orno<br />
selectdo<br />
   if tsrep124.cins = tssma102.cins then<br />
        message(&quot;Already Exist&quot;)<br />
        input.again()<br />
   endif<br />
endselect</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">4th June 2013, 14:45</div></div><div class="posttext">Hi,<br />
<br />
Make it like this:-<br />
<br />
after.input: | you can also use when.field.chages<br />
check.serialno()<br />
                | OR<br />
                |when.field.chages: <br />
                |check.serialno()<br />
<br />
<br />
-----------------------------------------------------------<br />
function check.serialno()<br />
{<br />
flag = 0 | declare flag as long or with domain tcpono<br />
select tsrep124.*, tssma102.*, tssma301.*<br />
from tsrep124, tssma102, tssma301<br />
where tsrep124.orno = tssma301.orno<br />
selectdo<br />
if tsrep124.cins = tssma102.cins then<br />
     flag = 1<br />
endif<br />
endselect[/QUOTE]<br />
<br />
if flag = 1 then<br />
     message(&quot;Already Exist&quot;)<br />
     input.again()<br />
endif<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vamsi_gujjula</div><div class="date">4th June 2013, 22:45</div></div><div class="posttext">Hi Bhushan, <br />
<br />
i guess  nolihayati isma  is talking about this type -3 form ,  when you can enter simultaneously more than 1 record  and save them at time.<br />
<br />
so i suppose he wants to check for those entered record.?<br />
<br />
nolihayati ism  can you clarify on that ?<br />
<br />
as bhushan said that field can anyways be placed in the key if checking is not for the entered records.<br />
<br />
regards<br />
vamsi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">5th June 2013, 04:36</div></div><div class="posttext">Hi vansi,<br />
Yes, I am using form type 3 and i want to check data entry. I dont want to allow user to enter the same serial number in same 1 service order.<br />
<br />
Hi Bushan,<br />
I have tried the code but the session still able to save the duplicate error without any message. Below are my full script.<br />
<br />
declaration:<br />
<br />
	table	ttsrep124	| Multi Installation Service Orders<br />
	table	ttsrep100<br />
	table	ttssma301	| Service Orders<br />
	table	ttssma102	| Installations<br />
	table	ttssma110	| Locations<br />
	table	ttssma220	| Contracts<br />
	table	ttcmcs002<br />
	table	ttssma911<br />
<br />
	table	ttssma920<br />
	table	ttssma204<br />
	table	ttssma904<br />
	table	ttssma210<br />
	table	ttccom010<br />
	table	ttcmcs008<br />
<br />
	table	ttssma124<br />
<br />
	table	ttssma107	| Items by Installation Type	|jsz#1112.sn<br />
	table	ttiitm001	| Items								<br />
	table ttssma950<br />
	table	ttssma720											|jsz#1112.en<br />
<br />
	extern	domain	tcorno		zoom.orno<br />
	extern	domain	tssma.cloc	zoom.cloc<br />
	extern	domain	tssma.cins	zoom.cins<br />
	extern	domain	tssma.ccon	save.ccon<br />
	extern	domain	tssma.ccon	zoom.ccon			|jsz#1112.sn<br />
<br />
	extern domain tcyesno		zoom.offer<br />
	extern domain tcyesno		zoom.pric				|jsz#1112.en<br />
<br />
	extern domain tcamnt			cins.pric				|jsz#1112.sn<br />
	extern domain tcamnt			cins.cert				|jsz#1112.en<br />
	extern domain tcamnt			spac.pric				| standard packet price<br />
	extern domain tcdisc			spac.disc				| customer discount<br />
	extern domain tcdisc			spac.cert				| certificate price<br />
	extern domain tcmcs.int		spac.dlev, spac.plev | found Price/Discount-Level<br />
	extern domain tcmcs.str40	mt.plev, mt.dlev<br />
	extern domain tcyesno		spac.widi<br />
	extern domain tsmt.yesno	blocked		| all/without blocked	|jsz#0413.n<br />
<br />
	extern domain tssma.cloc	pricing.cloc	|jsz#1112.sn<br />
	extern domain tssma.ctyp	pricing.ctyp<br />
	extern domain tcnama			cins.eper.nama<br />
	extern domain tssma.desc	f.desc<br />
			 domain tssma.seqn	hold.seqn<br />
			 domain tssma.seqn	last.seqn<br />
			 domain tcmcs.str14  sess<br />
			 domain tcmcs.str215 rcrd.cuno<br />
			 domain tcmcs.str215 rcrd.orno<br />
					  long			zoom.allowed<br />
        extern domain tcpono		flag  | Noli<br />
<br />
	domain tcmcs.st13 session$						|jsz#1112.en<br />
<br />
	#include &quot;itccom0001&quot;<br />
	#include &quot;itssma0020.999&quot;<br />
	#include &quot;itcmcs0095&quot;                     |jsz#1112.sn<br />
<br />
	#pragma used session tssma3110s999<br />
<br />
	#pragma used dll &quot;otsmstdll0001&quot;<br />
<br />
|**************************** program sections *********************************<br />
before.program:<br />
	tcmcs0095.read.parm(&quot;tssma950&quot;)<br />
	hold.seqn = 0										|jsz#1112.en<br />
	blocked = tsmt.yesno.no							|jsz#0413.n	<br />
<br />
|****************************** choice section ********************************<br />
<br />
|****************************** form section **********************************<br />
form.1:<br />
init.form:<br />
	import(&quot;zoom.orno&quot;, zoom.orno)<br />
<br />
	select	tssma301.*<br />
	from		tssma301<br />
	where		tssma301._index1 = {:zoom.orno}<br />
	as set with 1 rows<br />
	selectdo<br />
		zoom.cloc = tssma301.cloc<br />
		if not isspace(tssma301.cins) then	|jsz#1112.sn<br />
			select	tssma102.*<br />
			from		tssma102<br />
			where		tssma102._index1 = {:tssma301.cins}<br />
			as set with 1 rows<br />
			selectdo<br />
			selectempty<br />
                                <br />
				db.set.to.default(ttssma102)<br />
			endselect<br />
		endif				|jsz#1112.en<br />
	selectempty<br />
	endselect<br />
<br />
	db.retry.point()<br />
<br />
	select	tsrep100.*		|jsz#1112.sn<br />
	from		tsrep100 for update<br />
	where		tsrep100._index1 = {:zoom.orno}<br />
	as set with 1 rows<br />
	selectdo<br />
		if tssma301.sert &lt;&gt; tssma.sert.service then<br />
			if tsrep100.sdat = 0 then<br />
				tsrep100.sdat = tssma301.ddt1<br />
				db.update(ttsrep100, db.retry)<br />
			endif<br />
		endif<br />
	selectempty<br />
		db.set.to.default(ttsrep100)<br />
<br />
		tsrep100.orno = zoom.orno<br />
		if tssma301.corn &gt; 0 then<br />
			select	tssma920.*<br />
			from		tssma920<br />
			where		tssma920._index1 = {:tssma301.corn}<br />
			as set with 1 rows<br />
			selectdo<br />
				tsrep100.sdat = tssma920.sdat<br />
				tsrep100.edat = tssma920.edat<br />
			selectempty<br />
			endselect<br />
		else<br />
			tsrep100.sdat = tssma301.ddt1<br />
		endif<br />
                <br />
		db.insert(ttsrep100)<br />
	endselect		<br />
<br />
	commit.transaction()		|jsz#1112.en<br />
<br />
	tsrep124.orno = zoom.orno<br />
|&lt;	tsrep124.cins = &quot;&quot;		|jsz#1112.o<br />
	tsrep124.seqn = 1			|jsz#1112.n<br />
	store.occ.min()<br />
<br />
	tsrep124.orno = zoom.orno<br />
|&lt;	tsrep124.cins = &quot;zzzzzzzzzzzzzzzzzzzz&quot;			|jsz#1112.o<br />
	tsrep124.seqn = 9999		|jsz#1112.n<br />
	store.occ.max()<br />
<br />
	select	tsrep124.*<br />
	from		tsrep124<br />
	where		tsrep124._index1 = {:zoom.orno}<br />
	as set with 1 rows<br />
	selectdo<br />
                 <br />
		if tssma301.sert &lt;&gt; tssma.sert.service then<br />
			select	tsrep124.*<br />
			from		tsrep124 for update<br />
			where		tsrep124._index1 = {:zoom.orno}<br />
			selectdo<br />
                                check.serialno()<br />
				if tsrep124.pric = 0.0 and<br />
				   not isspace(tsrep124.cpac) then<br />
<br />
					look.for.price()<br />
					tsrep124.pric = spac.pric<br />
					tsrep124.cpri = spac.cert<br />
					tsrep124.ctyp = pricing.ctyp<br />
					tsrep124.cloc = pricing.cloc<br />
					db.update(ttsrep124, db.retry)<br />
					commit.transaction()<br />
				endif<br />
			selectempty<br />
			endselect	<br />
<br />
			select	tsrep124.*<br />
			from		tsrep124<br />
			where		tsrep124._index1 = {:zoom.orno}<br />
			as set with 1 rows<br />
			selectdo<br />
			selectempty<br />
			endselect	<br />
		endif<br />
<br />
		execute(find.data)<br />
	selectempty<br />
		if tssma301.sert = tssma.sert.service and<br />
			not isspace(tssma301.cins) then<br />
			db.set.to.default(ttsrep124)<br />
<br />
			tsrep124.orno = zoom.orno<br />
			tsrep124.seqn = 1						|jsz#1112.n<br />
			tsrep124.prin = 1						|jsz#1112.n<br />
			tsrep124.cins = tssma301.cins<br />
			tsrep124.cloc = tssma301.cloc<br />
			tsrep124.ctyp = tssma301.ctyp<br />
			tsrep124.ccon = tssma301.ccon<br />
			tsrep124.qana = 1.0<br />
<br />
			tsrep124.trdt = date.num()<br />
			tsrep124.trtm = ((time.num() / 3600) * 100) + ((time.num() \ 3600) / 60)<br />
			tsrep124.tlog = logname$<br />
<br />
			tsrep124.item = tssma102.item		|jsz#1112.n<br />
<br />
			db.insert(ttsrep124)<br />
			commit.transaction()<br />
<br />
			execute(find.data)<br />
		else<br />
			tsrep124.orno = zoom.orno<br />
			display.all()<br />
			execute(start.set)<br />
			execute(add.set)<br />
		endif<br />
	endselect<br />
	display(&quot;blocked&quot;)				|jsz#0413.n<br />
<br />
|****************************** field section *********************************<br />
field.tsrep124.orno:<br />
before.input:<br />
	if choice = start.set then<br />
		tsrep124.orno = zoom.orno<br />
		display(&quot;tsrep124.orno&quot;)<br />
		refresh()<br />
		attr.input = false<br />
	endif<br />
<br />
field.tsrep124.seqn:		|jsz#1112.sn<br />
before.input:<br />
	if choice = add.set then<br />
		on.main.table(search.last.used.seqn)<br />
		tsrep124.seqn = last.seqn<br />
		tsrep124.prin = last.seqn		|jsz#1112.n<br />
		display(&quot;tsrep124.prin&quot;)<br />
		display(&quot;tsrep124.seqn&quot;)<br />
		refresh()<br />
		attr.input = false	<br />
	endif						|jsz#1112.en<br />
<br />
field.tsrep124.prin:<br />
check.input:<br />
	if tsrep124.prin = 0 then<br />
		set.input.error(&quot;&quot;)<br />
	endif<br />
<br />
field.tsrep124.cins:		<br />
before.zoom:						|jsz#1112.sn<br />
	save.ccon = tssma301.ccon<br />
	zoom.ccon = tssma301.ccon<br />
	zoom.cins = &quot;&quot;<br />
	zoom.cloc = tssma301.cloc	|jsz#1112.en<br />
<br />
<br />
check.input:   <br />
         <br />
	if tssma301.sert = tssma.sert.call then<br />
                if tsrep124.cins = tssma301.cins and<br />
			(not isspace(tsrep124.cins) or <br />
			 not isspace(tssma301.cins)) then		|jsz#1112.n<br />
			set.input.error(&quot;tssmas0155&quot;)<br />
                        <br />
                else<br />
			if not isspace(tsrep124.cins) then	|jsz#1112.n<br />
				select	tssma102.*<br />
				from		tssma102<br />
				where		tssma102._index1 = {:tsrep124.cins}<br />
				as set with 1 rows<br />
				selectdo<br />
                                   	if tssma102.cloc &lt;&gt; tssma301.cloc then<br />
						set.input.error(&quot;tsmt.loca&quot;)<br />
					endif<br />
				selectempty<br />
					set.input.error(&quot;tssmas0201&quot;)<br />
                                       <br />
                                endselect<br />
			endif				|jsz#1112.n<br />
		endif<br />
              <br />
	endif<br />
	if tssma301.sert = tssma.sert.service then<br />
           	if not isspace(tsrep124.cins) then	|jsz#1112.n<br />
			select	tssma102.*<br />
			from		tssma102<br />
			where		tssma102._index1 = {:tsrep124.cins}<br />
			as set with 1 rows<br />
			selectdo<br />
				if tssma102.cloc &lt;&gt; tssma301.cloc then<br />
					set.input.error(&quot;tsmt.loca&quot;)<br />
				endif<br />
			selectempty<br />
				set.input.error(&quot;tssmas0201&quot;)<br />
                                <br />
			endselect<br />
		endif				|jsz#1112.n<br />
               <br />
	endif<br />
<br />
<br />
field.tsrep124.item:		|jsz#1112.sn<br />
before.input:<br />
	if not isspace(tsrep124.cins) then<br />
		tsrep124.item = tssma102.item<br />
		display(&quot;tsrep124.item&quot;)<br />
		refresh()<br />
		attr.input = false<br />
	endif<br />
check.input:<br />
	if isspace(tsrep124.cins) then<br />
		select	tssma107.*<br />
		from		tssma107<br />
		where		tssma107._index1 = {:tsrep124.item}<br />
		as set with 1 rows<br />
		selectdo<br />
		selectempty<br />
			set.input.error(&quot;tssma9121item&quot;)<br />
		endselect<br />
	endif<br />
<br />
field.tsrep124.cpac:<br />
check.input:<br />
	if isspace(tsrep124.cpac) then<br />
|		set.input.error(&quot;tssmat2041&quot;)<br />
	endif<br />
after.display:<br />
	look.for.price()<br />
after.input:<br />
	look.for.price()<br />
<br />
field.tsrep124.cert:<br />
after.display:<br />
	look.for.price()<br />
after.input:<br />
	look.for.price()<br />
<br />
field.tsrep124.reas:<br />
before.input:<br />
	if tsrep124.plan = tcyesno.yes then<br />
		tsrep124.reas = &quot;&quot;<br />
		display(&quot;tssma921.reas&quot;)<br />
		refresh()<br />
		attr.input = false<br />
	endif<br />
check.input:<br />
	if tsrep124.plan = tcyesno.no and<br />
		tsrep124.reas = &quot;&quot; then<br />
		set.input.error(&quot;tssma2182.reas&quot;)<br />
	endif<br />
<br />
field.tsrep124.stdt:<br />
before.input:<br />
	if tsrep124.plan = tcyesno.yes then<br />
		tsrep124.stdt = 0<br />
		display(&quot;tssma921.stdt&quot;)<br />
		refresh()<br />
		attr.input = false<br />
	endif<br />
check.input:<br />
	if tsrep124.plan = tcyesno.no and<br />
		tsrep124.stdt = 0 then<br />
		set.input.error(&quot;tssma2182.stdt&quot;)<br />
	endif<br />
<br />
field.tssma102.locd:<br />
before.display:<br />
	if isspace(tsrep124.cins) then<br />
		tssma102.locd = &quot;&quot;<br />
	endif<br />
<br />
field.f.desc:	<br />
before.display:<br />
	find.pricing.data()<br />
<br />
field.tssma101.desc:	<br />
before.display:<br />
	find.pricing.data()<br />
<br />
field.cins.eper.nama:<br />
before.display:<br />
	enduser.installation()	|jsz#1112.en<br />
<br />
|****************************** choice section ********************************<br />
choice.user.0:<br />
before.choice:<br />
	select	tssma124.*<br />
	from		tssma124<br />
	where		tssma124.orno = :zoom.orno<br />
	as set with 1 rows<br />
	selectdo<br />
		choice.again()<br />
	selectempty<br />
	endselect<br />
on.choice:<br />
	link.to.contract()<br />
after.choice:<br />
	execute(first.set)<br />
<br />
choice.user.1:				|Special Items<br />
on.choice:<br />
	zoom.orno = tsrep124.orno<br />
	if prog.name$ = &quot;tsrep5124s001&quot; then<br />
		zoom.to$(&quot;tsrep5129s000&quot;,z.session,&quot;&quot;,&quot;tssma3101&quot;,0)	<br />
	else<br />
		zoom.to$(&quot;tsrep1129s000&quot;,z.session,&quot;&quot;,&quot;tssma3101&quot;,0)	<br />
	endif<br />
<br />
choice.user.2:				|Conditions<br />
on.choice:<br />
	zoom.orno = tsrep124.orno<br />
	if prog.name$ = &quot;tsrep5124s001&quot; then<br />
		zoom.to$(&quot;tsrep5100s001&quot;,z.session,&quot;&quot;,&quot;tssma3101&quot;,0)	<br />
	else<br />
		zoom.to$(&quot;tsrep1100s001&quot;,z.session,&quot;&quot;,&quot;tssma3101&quot;,0)<br />
	endif<br />
after.choice:<br />
	execute(find.data)<br />
<br />
choice.user.3:					|jsz#1112.sn<br />
on.choice:	<br />
	zoom.orno = tsrep124.orno<br />
	zoom.cloc = tssma301.cloc<br />
	zoom.offer = tcyesno.yes<br />
	zoom.pric  = tcyesno.yes<br />
	zoom.to$(&quot;tsrep9421m000&quot;,z.session,&quot;tsrep1124s001&quot;,&quot;&quot;,0)<br />
<br />
choice.user.4:<br />
on.choice:	<br />
	zoom.allowed = check.for.costing.orders()<br />
	session$  = &quot;tssma3110s999&quot;<br />
	zoom.orno = tsrep124.orno<br />
<br />
	if not zoom.allowed then<br />
		sess 	  = &quot;tssma3510m000&quot;<br />
		rcrd.orno = &quot;&quot;<br />
		rcrd.orno = str$(edit$(tsrep124.orno,&quot;99999999&quot;))<br />
		tsmst.dll0001.update.session(sess, rcrd.orno)<br />
		session$ = &quot;tssma3510m000&quot;<br />
	endif<br />
	zoom.to$(session$,z.session,&quot;tssma301.orno&quot;,&quot;&quot;,0)<br />
<br />
after.update.db.commit:<br />
	hold.seqn = 0				|jsz#1112.en<br />
<br />
choice.user.7:					|jsz#0413.sn<br />
before.choice:<br />
	if blocked = tsmt.yesno.no then<br />
		blocked = tsmt.yesno.yes<br />
	else<br />
		blocked = tsmt.yesno.no<br />
	endif<br />
	display(&quot;blocked&quot;)<br />
	refresh()<br />
after.choice:<br />
	execute(find.data)		|jsz#0413.en<br />
<br />
|****************************** main table section ****************************<br />
main.table.io:<br />
after.read:							|jsz#0413.sn<br />
	if blocked = tsmt.yesno.yes then<br />
		if tsrep124.plan = tcyesno.no then<br />
			skip.io(&quot;&quot;)<br />
	   endif<br />
	endif								|jsz#0413.en<br />
before.write:<br />
	find.pricing.data()						|jsz#1112.sn<br />
	if tssma301.sert = tssma.sert.service then<br />
		tsrep124.ctyp = pricing.ctyp<br />
		tsrep124.cloc = pricing.cloc<br />
		tsrep124.ccon = tssma301.ccon<br />
	else											<br />
		if isspace(tsrep124.cins) then<br />
			tsrep124.ctyp = pricing.ctyp<br />
			tsrep124.cloc = pricing.cloc<br />
			tsrep124.ccon = tssma301.ccon<br />
		else										|jsz#1112.en<br />
			tsrep124.ctyp = tssma102.ctyp<br />
			tsrep124.cloc = tssma102.cloc<br />
			tsrep124.ccon = tssma102.ccon<br />
		endif										|jsz#1112.n<br />
	endif											|jsz#1112.n<br />
	tsrep124.qana = 1.0<br />
<br />
	tsrep124.trdt = date.num()<br />
	tsrep124.trtm = ((time.num() / 3600) * 100) + ((time.num() \ 3600) / 60)<br />
	tsrep124.tlog = logname$<br />
<br />
	if tsrep124.plan = tcyesno.yes then	|jsz#1112.sn<br />
		tsrep124.reas = &quot;&quot;<br />
	endif<br />
<br />
before.rewrite:<br />
	if tsrep124.plan = tcyesno.yes then<br />
		tsrep124.reas = &quot;&quot;<br />
	endif<br />
	look.for.price()<br />
	tsrep124.pric = spac.pric<br />
	tsrep124.cpri = spac.cert<br />
	tsrep124.ctyp = pricing.ctyp<br />
	tsrep124.cloc = pricing.cloc			|jsz#1112.en<br />
<br />
|****************************** function section ******************************<br />
functions:<br />
<br />
function link.to.contract()<br />
{<br />
	long	found<br />
<br />
	select	tsrep124.*	|jsz#1112.sn<br />
	from		tsrep124<br />
	where		tsrep124._index1 = {:zoom.orno}<br />
	selectdo<br />
		if isspace(tsrep124.cins) then<br />
			mess(&quot;tsrep1124a&quot;, 1) |&quot;Link not possible - Check Blank Installations!&quot;<br />
			return<br />
		endif<br />
	selectempty<br />
	endselect				|jsz#1112.en<br />
<br />
	db.retry.point()<br />
<br />
	found = false<br />
<br />
	select	tsrep124.*, tssma102.*<br />
	from		tsrep124 for update, tssma102<br />
	where		tsrep124._index1 = {:zoom.orno}<br />
	and		tsrep124.cins refers to tssma102<br />
	selectdo<br />
		found = true<br />
<br />
		itssma0020.find.standard.price(tssma102.cuno,<br />
						tssma102.cpac, <br />
						tssma102.ctyp, <br />
						tssma102.sdat,<br />
						tssma102.cins,<br />
						tssma102.cloc,<br />
						tssma301.ccur,<br />
						tssma102.cert,<br />
						tssma102.ccon,<br />
						0,<br />
						spac.widi,	<br />
						spac.dlev, spac.plev,<br />
						spac.cert, spac.disc, spac.pric)<br />
		spac.cert = icom0001.domain.round(spac.cert,<br />
					  &quot;tcamnt&quot;,<br />
					  tssma301.ccur,<br />
					  tcmcs002.crnd)<br />
		spac.pric = icom0001.domain.round(spac.pric,<br />
					  &quot;tcamnt&quot;,<br />
					  tssma301.ccur,<br />
					  tcmcs002.crnd)<br />
<br />
		if spac.disc then<br />
			spac.pric = spac.pric - (spac.pric / 100 * spac.disc)<br />
		endif<br />
<br />
		tsrep124.cert = tssma102.cert<br />
		tsrep124.cpri = spac.cert<br />
<br />
		tsrep124.pric = spac.pric<br />
		<br />
		select	tssma911.*<br />
		from		tssma911<br />
		where		tssma911._index1 = {:tssma102.cpac}<br />
		as set with 1 rows<br />
		selectdo<br />
			tsrep124.cjob = tssma911.sjob		<br />
		selectempty<br />
		endselect<br />
<br />
		db.update(ttsrep124, db.retry)<br />
		commit.transaction()<br />
	selectempty<br />
	endselect<br />
	<br />
	if found then<br />
		tscon.dll0001.link.order.to.contract(zoom.orno)<br />
	endif<br />
}<br />
<br />
|******************************************************************************<br />
function search.last.used.seqn()		|jsz#1112.sn<br />
{<br />
	select	tsrep124.seqn<br />
	from 		tsrep124<br />
	where		tsrep124._index1 = {:tsrep124.orno}<br />
	order by tsrep124.seqn desc<br />
	as set with 1 rows<br />
	selectdo<br />
		last.seqn = tsrep124.seqn + 1<br />
	selectempty<br />
		last.seqn = 1<br />
	endselect<br />
<br />
	if hold.seqn &gt;= last.seqn then<br />
		last.seqn = hold.seqn + 1<br />
	endif<br />
	hold.seqn = last.seqn<br />
}<br />
<br />
function look.for.price()<br />
{<br />
	find.pricing.data()<br />
<br />
	itssma0020.find.standard.price(<br />
					tssma301.cuno,<br />
					tsrep124.cpac,<br />
					pricing.ctyp,<br />
				   tsrep100.sdat,<br />
					tsrep124.cins, <br />
					pricing.cloc,<br />
				   tssma301.ccur,<br />
					tsrep124.cert,<br />
					tssma301.ccon,<br />
					0,<br />
					spac.widi,<br />
					spac.dlev, spac.plev,<br />
					spac.cert, spac.disc, spac.pric)<br />
	spac.cert = icom0001.domain.round(spac.cert,<br />
					  &quot;tcamnt&quot;,<br />
					  tssma301.ccur,<br />
					  tcmcs002.crnd)<br />
	spac.pric = icom0001.domain.round(spac.pric,<br />
					  &quot;tcamnt&quot;,<br />
					  tssma301.ccur,<br />
					  tcmcs002.crnd)<br />
<br />
	if tssma950.rabd = tcyesno.yes then<br />
		if spac.widi = tcyesno.yes then<br />
			cins.pric = spac.pric<br />
		else<br />
			cins.pric = (spac.pric - ( spac.pric / 100 * spac.disc ))<br />
		endif<br />
		cins.pric = icom0001.domain.round(cins.pric,<br />
						  &quot;tcamnt&quot;,<br />
						  tssma301.ccur,<br />
						  tcmcs002.crnd)<br />
	else<br />
		if spac.widi = tcyesno.yes then<br />
			cins.pric = round(spac.pric,0,1)<br />
		else<br />
			cins.pric = round((spac.pric - ( spac.pric / 100 * spac.disc )),0,1)<br />
		endif<br />
		cins.cert = round(spac.cert,0,1)<br />
	endif<br />
	cins.cert = spac.cert<br />
	cins.pric = cins.pric + cins.cert<br />
	<br />
	display(&quot;cins.pric&quot;)<br />
	display(&quot;cins.cert&quot;)<br />
	display(&quot;spac.pric&quot;)<br />
	display(&quot;spac.disc&quot;)<br />
	refresh()	<br />
}<br />
<br />
function	find.pricing.data()<br />
{<br />
	pricing.cloc = &quot;&quot;<br />
	pricing.ctyp = &quot;&quot;<br />
	f.desc = &quot;&quot;<br />
<br />
	if not isspace(tsrep124.cins) then<br />
		select	tssma102.*, tssma101.*<br />
		from		tssma102, tssma101<br />
		where		tssma102._index1 = {:tsrep124.cins}<br />
		and		tssma102.ctyp refers to tssma101<br />
		as set with 1 rows<br />
		selectdo<br />
			pricing.cloc = tssma102.cloc<br />
			pricing.ctyp = tssma102.ctyp<br />
			f.desc = tssma102.desc<br />
		selectempty<br />
		endselect<br />
	else<br />
		select	tssma107.*, tiitm001.*, tssma101.*<br />
		from		tssma107, tiitm001, tssma101<br />
		where		tssma107._index1 = {:tsrep124.item}<br />
		and		tssma107.item refers to tiitm001<br />
		and		tssma107.ctyp refers to tssma101<br />
		as set with 1 rows<br />
		selectdo<br />
			pricing.cloc = tssma301.cloc<br />
			pricing.ctyp = tssma107.ctyp<br />
			f.desc = tiitm001.dsca<br />
		selectempty<br />
		endselect<br />
	endif<br />
}<br />
<br />
function	enduser.installation()<br />
{<br />
	cins.eper.nama = &quot;&quot;<br />
<br />
	if not isspace(tsrep124.cins) then<br />
		select	tssma102.eper<br />
		from		tssma102<br />
		where		tssma102._index1 = {:tsrep124.cins}<br />
		as set with 1 rows<br />
		selectdo<br />
			if not isspace(tssma102.eper) then<br />
				select	tssma720.*<br />
				from		tssma720<br />
				where		tssma720._index1 = {:tssma102.euno, :tssma102.eper}<br />
				as set with 1 rows<br />
				selectdo<br />
					cins.eper.nama = tssma720.nama<br />
				selectempty	<br />
				endselect<br />
			endif<br />
		selectempty	<br />
		endselect<br />
	endif<br />
}<br />
<br />
function long check.for.costing.orders()		|jsz#1112.sn<br />
{<br />
	if tssma301.swor = tssma.swor.costed or<br />
	   tssma301.swor = tssma.swor.history or<br />
	   tssma301.swor = tssma.swor.cancelled then<br />
		mess(&quot;tssmas0420&quot;,1,<br />
		enum.descr$(&quot;tssma.swor&quot;, tssma301.swor))<br />
		| Service order is %s, changing not allowed<br />
		return(0)<br />
	endif<br />
	if isspace(tssma301.ccon) then<br />
		if isspace(tssma301.cins)  and<br />
			tssma301.corn = 0 and			|jsz#0513.n<br />
		   tssma301.sert = tssma.sert.service then<br />
			mess(&quot;tssmas0261&quot;,1)<br />
				| Calculating actual costs not allowed,<br />
				| first assign installation<br />
			return(0)<br />
		endif<br />
	endif<br />
	if tssma301.swor = tssma.swor.free or<br />
	   tssma301.swor = tssma.swor.planned then<br />
		mess(&quot;tssmas0452&quot;,1)<br />
			| Actual costs only allowed if status in &quot;in progress&quot;<br />
		return(0)<br />
	endif<br />
<br />
	return(1)<br />
}					|jsz#1112.en<br />
<br />
function check.serialno()<br />
{<br />
flag = 0 <br />
<br />
select tsrep124.*, tssma102.*, tssma301.*<br />
from tsrep124, tssma102, tssma301<br />
where tsrep124.orno = tssma301.orno<br />
and tsrep124.cins refers to tssma102<br />
and tssma102.ccon = tsrep124.ccon<br />
selectdo<br />
if tsrep124.cins = zoom.cins then<br />
     flag = 1<br />
endif<br />
endselect<br />
<br />
if flag = 1 then<br />
     message(&quot;Already Exist&quot;)<br />
     input.again()<br />
endif<br />
}<br />
|******** END OF SOURCE *******************************************************</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">5th June 2013, 04:42</div></div><div class="posttext">refer screen capture</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">5th June 2013, 07:21</div></div><div class="posttext">field.tsrep124.cins:	<br />
before.zoom:	 |jsz#1112.sn<br />
save.ccon = tssma301.ccon<br />
zoom.ccon = tssma301.ccon<br />
zoom.cins = &quot;&quot;<br />
zoom.cloc = tssma301.cloc	|jsz#1112.en<br />
<br />
I can see zoom.cins is kept blank here. And then in the check.serialno() function you are checking<br />
<br />
if tsrep124.cins = zoom.cins then<br />
flag = 1<br />
endif which will always return flag  = 0 and hence, duplicate values will be assigned.<br />
<br />
I am not aware of the functionality of your code, but I will suggest you to dubug it and check your zoom.cins if it is getting any value or not. <br />
<br />
If not try assigning it the value of tsrep124.cins.<br />
<br />
In the previous post you did this in your if statement:-<br />
<br />
if tsrep124.cins = tssma102.cins then and now you have changed it to <br />
<br />
if tsrep124.cins = zoom.cins then<br />
<br />
Check it under debugger, I guess the problem is in your function and with the variable zoom.cins.<br />
<br />
<br />
<br />
You can call the function like this:-<br />
<br />
field.tsrep124.cins:<br />
<br />
after.field:<br />
<br />
check.serialno()<br />
<br />
And also check the if condition in your function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">5th June 2013, 12:05</div></div><div class="posttext">Hi,<br />
I manage to avoid duplicate record inserted if i am clicked button save after single record<br />
<br />
But If I using tab cursor to move from 1 field to  another field....i still facing the same issue.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">5th June 2013, 13:43</div></div><div class="posttext">For that you need to do something like this:-<br />
<br />
in the field section of your last field of the record (on the form), you have to insert the values in table.<br />
<br />
e.g:<br />
<br />
field.field_name:<br />
<br />
after.input:<br />
<br />
<br />
|assign your values here(if any form fields)<br />
<br />
db.insert(table_name,db.retry)<br />
commit.transaction()<br />
<br />
And then you can code your rest of the things, where you assign the serial number and print numbers etc.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vamsi_gujjula</div><div class="date">5th June 2013, 16:00</div></div><div class="posttext">an alternative is use a dynamic array .<br />
<br />
<br />
field.tsrep124.cins:<br />
check.input:<br />
         check if tsrep124.cins exists in dynamic array <br />
                 if present, then set.input.error<br />
after.input:<br />
                 <br />
          insert the value in dynamic array<br />
<br />
choice.update.db:<br />
after.choice:<br />
             release the array.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">6th June 2013, 09:36</div></div><div class="posttext">i have tried the solution but when i using the 'tab' cursor, the prev record not auto save and with that, we still can enter duplicate serial no.<br />
<br />
if i am able to auto insert the record after the last field in the same row....my problem already resolve......adushhh</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">6th June 2013, 09:38</div></div><div class="posttext">* auto save record into table....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">6th June 2013, 10:19</div></div><div class="posttext">You can try this:<br />
<br />
While inputting the values in the table, collect them in variables in<br />
<br />
after.input section of each field.<br />
<br />
Then,<br />
<br />
in <br />
<br />
before.new.object:<br />
<br />
pass the values to table fields like<br />
<br />
tsrep124.cins = cins | cins is the variable<br />
<br />
and then<br />
<br />
db.insert(ttsrep124,db.retry)<br />
<br />
<br />
and then you can start with giving serial number to new fields.<br />
<br />
before.new.object is triggered after a tab in your form when you move to new record.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">6th June 2013, 10:49</div></div><div class="posttext">not understand...this is my latest code... when i should update it?<br />
<br />
declaration:<br />
<br />
	table	ttsrep124	| Multi Installation Service Orders<br />
	table	ttsrep100<br />
	table	ttssma301	| Service Orders<br />
	table	ttssma102	| Installations<br />
	table	ttssma110	| Locations<br />
	table	ttssma220	| Contracts<br />
	table	ttcmcs002<br />
	table	ttssma911<br />
<br />
	table	ttssma920<br />
	table	ttssma204<br />
	table	ttssma904<br />
	table	ttssma210<br />
	table	ttccom010<br />
	table	ttcmcs008<br />
<br />
	table	ttssma124<br />
<br />
	table	ttssma107	| Items by Installation Type	|jsz#1112.sn<br />
	table	ttiitm001	| Items								<br />
	table ttssma950<br />
	table	ttssma720											|jsz#1112.en<br />
<br />
	extern	domain	tcorno		zoom.orno<br />
	extern	domain	tssma.cloc	zoom.cloc<br />
	extern	domain	tssma.cins	zoom.cins<br />
	extern	domain	tssma.ccon	save.ccon<br />
	extern	domain	tssma.ccon	zoom.ccon			|jsz#1112.sn<br />
<br />
	extern domain tcyesno		zoom.offer<br />
	extern domain tcyesno		zoom.pric				|jsz#1112.en<br />
<br />
	extern domain tcamnt			cins.pric				|jsz#1112.sn<br />
	extern domain tcamnt			cins.cert				|jsz#1112.en<br />
	extern domain tcamnt			spac.pric				| standard packet price<br />
	extern domain tcdisc			spac.disc				| customer discount<br />
	extern domain tcdisc			spac.cert				| certificate price<br />
	extern domain tcmcs.int		spac.dlev, spac.plev | found Price/Discount-Level<br />
	extern domain tcmcs.str40	mt.plev, mt.dlev<br />
	extern domain tcyesno		spac.widi<br />
	extern domain tsmt.yesno	blocked		| all/without blocked	|jsz#0413.n<br />
<br />
	extern domain tssma.cloc	pricing.cloc	|jsz#1112.sn<br />
	extern domain tssma.ctyp	pricing.ctyp<br />
	extern domain tcnama			cins.eper.nama<br />
	extern domain tssma.desc	f.desc<br />
			 domain tssma.seqn	hold.seqn<br />
			 domain tssma.seqn	last.seqn<br />
			 domain tcmcs.str14  sess<br />
			 domain tcmcs.str215 rcrd.cuno<br />
			 domain tcmcs.str215 rcrd.orno<br />
					  long			zoom.allowed<br />
        <br />
        extern	domain	tssma.cins	cins.current |noli<br />
<br />
	domain tcmcs.st13 session$						|jsz#1112.en<br />
<br />
	#include &quot;itccom0001&quot;<br />
	#include &quot;itssma0020.999&quot;<br />
	#include &quot;itcmcs0095&quot;                     |jsz#1112.sn<br />
<br />
	#pragma used session tssma3110s999<br />
<br />
	#pragma used dll &quot;otsmstdll0001&quot;<br />
<br />
|**************************** program sections *********************************<br />
before.program:<br />
	tcmcs0095.read.parm(&quot;tssma950&quot;)<br />
	hold.seqn = 0										|jsz#1112.en<br />
	blocked = tsmt.yesno.no							|jsz#0413.n	<br />
<br />
|****************************** choice section ********************************<br />
<br />
|****************************** form section **********************************<br />
form.1:<br />
init.form:<br />
	import(&quot;zoom.orno&quot;, zoom.orno)<br />
<br />
	select	tssma301.*<br />
	from		tssma301<br />
	where		tssma301._index1 = {:zoom.orno}<br />
	as set with 1 rows<br />
	selectdo<br />
		zoom.cloc = tssma301.cloc<br />
		if not isspace(tssma301.cins) then	|jsz#1112.sn<br />
			select	tssma102.*<br />
			from		tssma102<br />
			where		tssma102._index1 = {:tssma301.cins}<br />
			as set with 1 rows<br />
			selectdo<br />
			selectempty<br />
                                <br />
				db.set.to.default(ttssma102)<br />
			endselect<br />
		endif				|jsz#1112.en<br />
	selectempty<br />
	endselect<br />
<br />
	db.retry.point()<br />
<br />
	select	tsrep100.*		|jsz#1112.sn<br />
	from		tsrep100 for update<br />
	where		tsrep100._index1 = {:zoom.orno}<br />
	as set with 1 rows<br />
	selectdo<br />
		if tssma301.sert &lt;&gt; tssma.sert.service then<br />
			if tsrep100.sdat = 0 then<br />
				tsrep100.sdat = tssma301.ddt1<br />
				db.update(ttsrep100, db.retry)<br />
			endif<br />
		endif<br />
	selectempty<br />
		db.set.to.default(ttsrep100)<br />
<br />
		tsrep100.orno = zoom.orno<br />
		if tssma301.corn &gt; 0 then<br />
			select	tssma920.*<br />
			from		tssma920<br />
			where		tssma920._index1 = {:tssma301.corn}<br />
			as set with 1 rows<br />
			selectdo<br />
				tsrep100.sdat = tssma920.sdat<br />
				tsrep100.edat = tssma920.edat<br />
			selectempty<br />
			endselect<br />
		else<br />
			tsrep100.sdat = tssma301.ddt1<br />
		endif<br />
                <br />
		db.insert(ttsrep100)<br />
	endselect		<br />
<br />
	commit.transaction()		|jsz#1112.en<br />
<br />
	tsrep124.orno = zoom.orno<br />
|&lt;	tsrep124.cins = &quot;&quot;		|jsz#1112.o<br />
	tsrep124.seqn = 1			|jsz#1112.n<br />
	store.occ.min()<br />
<br />
	tsrep124.orno = zoom.orno<br />
|&lt;	tsrep124.cins = &quot;zzzzzzzzzzzzzzzzzzzz&quot;			|jsz#1112.o<br />
	tsrep124.seqn = 9999		|jsz#1112.n<br />
	store.occ.max()<br />
<br />
	select	tsrep124.*<br />
	from		tsrep124<br />
	where		tsrep124._index1 = {:zoom.orno}<br />
	as set with 1 rows<br />
	selectdo<br />
                 <br />
		if tssma301.sert &lt;&gt; tssma.sert.service then<br />
			select	tsrep124.*<br />
			from		tsrep124 for update<br />
			where		tsrep124._index1 = {:zoom.orno}<br />
			selectdo<br />
                                 <br />
				if tsrep124.pric = 0.0 and<br />
				   not isspace(tsrep124.cpac) then<br />
<br />
					look.for.price()<br />
					tsrep124.pric = spac.pric<br />
					tsrep124.cpri = spac.cert<br />
					tsrep124.ctyp = pricing.ctyp<br />
					tsrep124.cloc = pricing.cloc<br />
					db.update(ttsrep124, db.retry)<br />
					commit.transaction()<br />
                                        <br />
				endif<br />
			selectempty<br />
			endselect	<br />
<br />
			select	tsrep124.*<br />
			from		tsrep124<br />
			where		tsrep124._index1 = {:zoom.orno}<br />
			as set with 1 rows<br />
			selectdo<br />
			selectempty<br />
			endselect	<br />
		endif<br />
<br />
		execute(find.data)<br />
	selectempty<br />
		if tssma301.sert = tssma.sert.service and<br />
			not isspace(tssma301.cins) then<br />
			db.set.to.default(ttsrep124)<br />
<br />
			tsrep124.orno = zoom.orno<br />
			tsrep124.seqn = 1						|jsz#1112.n<br />
			tsrep124.prin = 1						|jsz#1112.n<br />
			tsrep124.cins = tssma301.cins<br />
			tsrep124.cloc = tssma301.cloc<br />
			tsrep124.ctyp = tssma301.ctyp<br />
			tsrep124.ccon = tssma301.ccon<br />
			tsrep124.qana = 1.0<br />
<br />
			tsrep124.trdt = date.num()<br />
			tsrep124.trtm = ((time.num() / 3600) * 100) + ((time.num() \ 3600) / 60)<br />
			tsrep124.tlog = logname$<br />
<br />
			tsrep124.item = tssma102.item		|jsz#1112.n<br />
<br />
			db.insert(ttsrep124)<br />
			commit.transaction()<br />
<br />
			execute(find.data)<br />
		else<br />
			tsrep124.orno = zoom.orno<br />
			display.all()<br />
			execute(start.set)<br />
			execute(add.set)<br />
		endif<br />
	endselect<br />
	display(&quot;blocked&quot;)				|jsz#0413.n<br />
<br />
|****************************** field section *********************************<br />
field.tsrep124.orno:<br />
before.input:<br />
	if choice = start.set then<br />
		tsrep124.orno = zoom.orno<br />
		display(&quot;tsrep124.orno&quot;)<br />
		refresh()<br />
		attr.input = false<br />
	endif<br />
<br />
field.tsrep124.seqn:		|jsz#1112.sn<br />
before.input:<br />
	if choice = add.set then<br />
		on.main.table(search.last.used.seqn)<br />
		tsrep124.seqn = last.seqn<br />
		tsrep124.prin = last.seqn		|jsz#1112.n<br />
                display(&quot;tsrep124.prin&quot;)<br />
		display(&quot;tsrep124.seqn&quot;)<br />
                refresh()<br />
                attr.input = false	<br />
	endif						|jsz#1112.en<br />
<br />
after.input: | Noli<br />
check.serialno()<br />
<br />
<br />
<br />
<br />
<br />
<br />
field.tsrep124.prin:<br />
check.input:<br />
	if tsrep124.prin = 0 then<br />
		set.input.error(&quot;&quot;)<br />
	endif<br />
<br />
field.tsrep124.cins:		<br />
before.zoom:						|jsz#1112.sn<br />
	save.ccon = tssma301.ccon<br />
	zoom.ccon = tssma301.ccon<br />
	zoom.cins = &quot;&quot;<br />
	zoom.cloc = tssma301.cloc	|jsz#1112.en<br />
<br />
<br />
check.input:   <br />
        <br />
	if tssma301.sert = tssma.sert.call then<br />
                if tsrep124.cins = tssma301.cins and<br />
			(not isspace(tsrep124.cins) or <br />
			 not isspace(tssma301.cins)) then		|jsz#1112.n<br />
			set.input.error(&quot;tssmas0155&quot;)<br />
                	<br />
                else<br />
			if not isspace(tsrep124.cins) then	|jsz#1112.n<br />
				select	tssma102.*<br />
				from		tssma102<br />
				where		tssma102._index1 = {:tsrep124.cins}<br />
				as set with 1 rows<br />
				selectdo<br />
                           	        if tssma102.cloc &lt;&gt; tssma301.cloc then<br />
						set.input.error(&quot;tsmt.loca&quot;)<br />
					endif<br />
				selectempty<br />
					set.input.error(&quot;tssmas0201&quot;)<br />
                                       <br />
                                endselect<br />
			endif				|jsz#1112.n<br />
		endif<br />
              <br />
	endif<br />
<br />
	if tssma301.sert = tssma.sert.service then<br />
           	if not isspace(tsrep124.cins) then	|jsz#1112.n<br />
			select	tssma102.*<br />
			from		tssma102<br />
			where		tssma102._index1 = {:tsrep124.cins}<br />
			as set with 1 rows<br />
			selectdo<br />
                                if tssma102.cloc &lt;&gt; tssma301.cloc then<br />
					set.input.error(&quot;tsmt.loca&quot;)<br />
				endif<br />
                                <br />
			selectempty<br />
				set.input.error(&quot;tssmas0201&quot;)<br />
                                <br />
			endselect<br />
		endif				|jsz#1112.n<br />
               <br />
	endif<br />
<br />
<br />
after.input:    | Noli<br />
check.serialno()	<br />
<br />
		<br />
<br />
field.tsrep124.item:		|jsz#1112.sn<br />
before.input:<br />
        <br />
	if not isspace(tsrep124.cins) then<br />
		tsrep124.item = tssma102.item<br />
		display(&quot;tsrep124.item&quot;)<br />
		refresh()<br />
		attr.input = false<br />
	endif<br />
check.input:<br />
        <br />
	if isspace(tsrep124.cins) then<br />
		select	tssma107.*<br />
		from		tssma107<br />
		where		tssma107._index1 = {:tsrep124.item}<br />
		as set with 1 rows<br />
		selectdo<br />
		selectempty<br />
			set.input.error(&quot;tssma9121item&quot;)<br />
		endselect<br />
	endif<br />
<br />
field.tsrep124.cpac:<br />
check.input:<br />
	if isspace(tsrep124.cpac) then<br />
|		set.input.error(&quot;tssmat2041&quot;)<br />
	endif<br />
after.display:<br />
	look.for.price()<br />
after.input:<br />
	look.for.price()<br />
<br />
field.tsrep124.cert:<br />
after.display:<br />
	look.for.price()<br />
after.input:<br />
	look.for.price()<br />
<br />
field.tsrep124.reas:<br />
before.input:<br />
	if tsrep124.plan = tcyesno.yes then<br />
		tsrep124.reas = &quot;&quot;<br />
		display(&quot;tssma921.reas&quot;)<br />
		refresh()<br />
		attr.input = false<br />
	endif<br />
check.input:<br />
	if tsrep124.plan = tcyesno.no and<br />
		tsrep124.reas = &quot;&quot; then<br />
		set.input.error(&quot;tssma2182.reas&quot;)<br />
	endif<br />
<br />
field.tsrep124.stdt:<br />
before.input:<br />
	if tsrep124.plan = tcyesno.yes then<br />
		tsrep124.stdt = 0<br />
		display(&quot;tssma921.stdt&quot;)<br />
		refresh()<br />
		attr.input = false<br />
	endif<br />
check.input:<br />
	if tsrep124.plan = tcyesno.no and<br />
		tsrep124.stdt = 0 then<br />
		set.input.error(&quot;tssma2182.stdt&quot;)<br />
	endif<br />
<br />
field.tssma102.locd:<br />
before.display:<br />
	if isspace(tsrep124.cins) then<br />
		tssma102.locd = &quot;&quot;<br />
	endif<br />
<br />
field.f.desc:	<br />
before.display:<br />
	find.pricing.data()<br />
<br />
field.tssma101.desc:	<br />
before.display:<br />
	find.pricing.data()<br />
<br />
field.cins.eper.nama:<br />
before.display:<br />
	enduser.installation()	|jsz#1112.en<br />
<br />
after.display:<br />
        refresh()<br />
        <br />
<br />
<br />
<br />
|****************************** choice section ********************************<br />
choice.user.0:<br />
before.choice:<br />
	select	tssma124.*<br />
	from		tssma124<br />
	where		tssma124.orno = :zoom.orno<br />
	as set with 1 rows<br />
	selectdo<br />
		choice.again()<br />
	selectempty<br />
	endselect<br />
on.choice:<br />
	link.to.contract()<br />
after.choice:<br />
	execute(first.set)<br />
<br />
choice.user.1:				|Special Items<br />
on.choice:<br />
	zoom.orno = tsrep124.orno<br />
	if prog.name$ = &quot;tsrep5124s001&quot; then<br />
		zoom.to$(&quot;tsrep5129s000&quot;,z.session,&quot;&quot;,&quot;tssma3101&quot;,0)	<br />
	else<br />
		zoom.to$(&quot;tsrep1129s000&quot;,z.session,&quot;&quot;,&quot;tssma3101&quot;,0)	<br />
	endif<br />
<br />
choice.user.2:				|Conditions<br />
on.choice:<br />
	zoom.orno = tsrep124.orno<br />
	if prog.name$ = &quot;tsrep5124s001&quot; then<br />
		zoom.to$(&quot;tsrep5100s001&quot;,z.session,&quot;&quot;,&quot;tssma3101&quot;,0)	<br />
	else<br />
		zoom.to$(&quot;tsrep1100s001&quot;,z.session,&quot;&quot;,&quot;tssma3101&quot;,0)<br />
	endif<br />
after.choice:<br />
	execute(find.data)<br />
<br />
choice.user.3:					|jsz#1112.sn<br />
on.choice:	<br />
	zoom.orno = tsrep124.orno<br />
	zoom.cloc = tssma301.cloc<br />
	zoom.offer = tcyesno.yes<br />
	zoom.pric  = tcyesno.yes<br />
	zoom.to$(&quot;tsrep9421m000&quot;,z.session,&quot;tsrep1124s001&quot;,&quot;&quot;,0)<br />
<br />
choice.user.4:<br />
on.choice:	<br />
	zoom.allowed = check.for.costing.orders()<br />
	session$  = &quot;tssma3110s999&quot;<br />
	zoom.orno = tsrep124.orno<br />
<br />
	if not zoom.allowed then<br />
		sess 	  = &quot;tssma3510m000&quot;<br />
		rcrd.orno = &quot;&quot;<br />
		rcrd.orno = str$(edit$(tsrep124.orno,&quot;99999999&quot;))<br />
		tsmst.dll0001.update.session(sess, rcrd.orno)<br />
		session$ = &quot;tssma3510m000&quot;<br />
	endif<br />
	zoom.to$(session$,z.session,&quot;tssma301.orno&quot;,&quot;&quot;,0)<br />
<br />
after.update.db.commit:<br />
	hold.seqn = 0				|jsz#1112.en<br />
<br />
choice.user.7:					|jsz#0413.sn<br />
before.choice:<br />
	if blocked = tsmt.yesno.no then<br />
		blocked = tsmt.yesno.yes<br />
	else<br />
		blocked = tsmt.yesno.no<br />
	endif<br />
	display(&quot;blocked&quot;)<br />
	refresh()<br />
after.choice:<br />
	execute(find.data)		|jsz#0413.en<br />
<br />
|****************************** main table section ****************************<br />
main.table.io:<br />
after.read:							|jsz#0413.sn<br />
	if blocked = tsmt.yesno.yes then<br />
		if tsrep124.plan = tcyesno.no then<br />
			skip.io(&quot;&quot;)<br />
	   endif<br />
	endif								|jsz#0413.en<br />
before.write:<br />
        <br />
	find.pricing.data()						|jsz#1112.sn<br />
	if tssma301.sert = tssma.sert.service then<br />
		tsrep124.ctyp = pricing.ctyp<br />
		tsrep124.cloc = pricing.cloc<br />
		tsrep124.ccon = tssma301.ccon<br />
	else											<br />
		if isspace(tsrep124.cins) then<br />
				<br />
			tsrep124.ctyp = pricing.ctyp<br />
			tsrep124.cloc = pricing.cloc<br />
			tsrep124.ccon = tssma301.ccon<br />
                        <br />
		else										|jsz#1112.en<br />
			tsrep124.ctyp = tssma102.ctyp<br />
			tsrep124.cloc = tssma102.cloc<br />
			tsrep124.ccon = tssma102.ccon<br />
		endif										|jsz#1112.n<br />
	endif											|jsz#1112.n<br />
	tsrep124.qana = 1.0<br />
<br />
	tsrep124.trdt = date.num()<br />
	tsrep124.trtm = ((time.num() / 3600) * 100) + ((time.num() \ 3600) / 60)<br />
	tsrep124.tlog = logname$<br />
<br />
	if tsrep124.plan = tcyesno.yes then	|jsz#1112.sn<br />
		tsrep124.reas = &quot;&quot;<br />
	endif<br />
        <br />
        <br />
<br />
before.rewrite:<br />
	if tsrep124.plan = tcyesno.yes then<br />
		tsrep124.reas = &quot;&quot;<br />
	endif<br />
	look.for.price()<br />
	tsrep124.pric = spac.pric<br />
	tsrep124.cpri = spac.cert<br />
	tsrep124.ctyp = pricing.ctyp<br />
	tsrep124.cloc = pricing.cloc			|jsz#1112.en<br />
        <br />
        <br />
|****************************** function section ******************************<br />
functions:<br />
<br />
function link.to.contract()<br />
{<br />
	long	found<br />
<br />
	select	tsrep124.*	|jsz#1112.sn<br />
	from		tsrep124<br />
	where		tsrep124._index1 = {:zoom.orno}<br />
	selectdo<br />
		if isspace(tsrep124.cins) then<br />
			mess(&quot;tsrep1124a&quot;, 1) |&quot;Link not possible - Check Blank Installations!&quot;<br />
			return<br />
		endif<br />
	selectempty<br />
	endselect				|jsz#1112.en<br />
<br />
	db.retry.point()<br />
<br />
	found = false<br />
<br />
	select	tsrep124.*, tssma102.*<br />
	from		tsrep124 for update, tssma102<br />
	where		tsrep124._index1 = {:zoom.orno}<br />
	and		tsrep124.cins refers to tssma102<br />
	selectdo<br />
		found = true<br />
<br />
		itssma0020.find.standard.price(tssma102.cuno,<br />
						tssma102.cpac, <br />
						tssma102.ctyp, <br />
						tssma102.sdat,<br />
						tssma102.cins,<br />
						tssma102.cloc,<br />
						tssma301.ccur,<br />
						tssma102.cert,<br />
						tssma102.ccon,<br />
						0,<br />
						spac.widi,	<br />
						spac.dlev, spac.plev,<br />
						spac.cert, spac.disc, spac.pric)<br />
		spac.cert = icom0001.domain.round(spac.cert,<br />
					  &quot;tcamnt&quot;,<br />
					  tssma301.ccur,<br />
					  tcmcs002.crnd)<br />
		spac.pric = icom0001.domain.round(spac.pric,<br />
					  &quot;tcamnt&quot;,<br />
					  tssma301.ccur,<br />
					  tcmcs002.crnd)<br />
<br />
		if spac.disc then<br />
			spac.pric = spac.pric - (spac.pric / 100 * spac.disc)<br />
		endif<br />
<br />
		tsrep124.cert = tssma102.cert<br />
		tsrep124.cpri = spac.cert<br />
<br />
		tsrep124.pric = spac.pric<br />
		<br />
		select	tssma911.*<br />
		from		tssma911<br />
		where		tssma911._index1 = {:tssma102.cpac}<br />
		as set with 1 rows<br />
		selectdo<br />
			tsrep124.cjob = tssma911.sjob		<br />
		selectempty<br />
		endselect<br />
<br />
		db.update(ttsrep124, db.retry)<br />
		commit.transaction()<br />
	selectempty<br />
	endselect<br />
	<br />
	if found then<br />
		tscon.dll0001.link.order.to.contract(zoom.orno)<br />
	endif<br />
}<br />
<br />
|******************************************************************************<br />
function search.last.used.seqn()		|jsz#1112.sn<br />
{<br />
	select	tsrep124.seqn<br />
	from 		tsrep124<br />
	where		tsrep124._index1 = {:tsrep124.orno}<br />
	order by tsrep124.seqn desc<br />
	as set with 1 rows<br />
	selectdo<br />
		last.seqn = tsrep124.seqn + 1<br />
	selectempty<br />
		last.seqn = 1<br />
	endselect<br />
<br />
	if hold.seqn &gt;= last.seqn then<br />
		last.seqn = hold.seqn + 1<br />
	endif<br />
	hold.seqn = last.seqn<br />
	        <br />
        <br />
}<br />
<br />
function look.for.price()<br />
{<br />
	find.pricing.data()<br />
<br />
	itssma0020.find.standard.price(<br />
					tssma301.cuno,<br />
					tsrep124.cpac,<br />
					pricing.ctyp,<br />
					tsrep100.sdat,<br />
					tsrep124.cins, <br />
					pricing.cloc,<br />
				   tssma301.ccur,<br />
					tsrep124.cert,<br />
					tssma301.ccon,<br />
					0,<br />
					spac.widi,<br />
					spac.dlev, spac.plev,<br />
					spac.cert, spac.disc, spac.pric)<br />
	spac.cert = icom0001.domain.round(spac.cert,<br />
					  &quot;tcamnt&quot;,<br />
					  tssma301.ccur,<br />
					  tcmcs002.crnd)<br />
	spac.pric = icom0001.domain.round(spac.pric,<br />
					  &quot;tcamnt&quot;,<br />
					  tssma301.ccur,<br />
					  tcmcs002.crnd)<br />
<br />
	if tssma950.rabd = tcyesno.yes then<br />
		if spac.widi = tcyesno.yes then<br />
			cins.pric = spac.pric<br />
		else<br />
			cins.pric = (spac.pric - ( spac.pric / 100 * spac.disc ))<br />
		endif<br />
		cins.pric = icom0001.domain.round(cins.pric,<br />
						  &quot;tcamnt&quot;,<br />
						  tssma301.ccur,<br />
						  tcmcs002.crnd)<br />
	else<br />
		if spac.widi = tcyesno.yes then<br />
			cins.pric = round(spac.pric,0,1)<br />
		else<br />
			cins.pric = round((spac.pric - ( spac.pric / 100 * spac.disc )),0,1)<br />
		endif<br />
		cins.cert = round(spac.cert,0,1)<br />
	endif<br />
	cins.cert = spac.cert<br />
	cins.pric = cins.pric + cins.cert<br />
	<br />
	display(&quot;cins.pric&quot;)<br />
	display(&quot;cins.cert&quot;)<br />
	display(&quot;spac.pric&quot;)<br />
	display(&quot;spac.disc&quot;)<br />
	refresh()	<br />
}<br />
<br />
function	find.pricing.data()<br />
{<br />
	pricing.cloc = &quot;&quot;<br />
	pricing.ctyp = &quot;&quot;<br />
	f.desc = &quot;&quot;<br />
<br />
	if not isspace(tsrep124.cins) then<br />
		select	tssma102.*, tssma101.*<br />
		from		tssma102, tssma101<br />
		where		tssma102._index1 = {:tsrep124.cins}<br />
		and		tssma102.ctyp refers to tssma101<br />
		as set with 1 rows<br />
		selectdo<br />
			pricing.cloc = tssma102.cloc<br />
			pricing.ctyp = tssma102.ctyp<br />
			f.desc = tssma102.desc<br />
		selectempty<br />
		endselect<br />
	else<br />
		select	tssma107.*, tiitm001.*, tssma101.*<br />
		from		tssma107, tiitm001, tssma101<br />
		where		tssma107._index1 = {:tsrep124.item}<br />
		and		tssma107.item refers to tiitm001<br />
		and		tssma107.ctyp refers to tssma101<br />
		as set with 1 rows<br />
		selectdo<br />
			pricing.cloc = tssma301.cloc<br />
			pricing.ctyp = tssma107.ctyp<br />
			f.desc = tiitm001.dsca<br />
		selectempty<br />
		endselect<br />
	endif<br />
}<br />
<br />
function	enduser.installation()<br />
{<br />
	cins.eper.nama = &quot;&quot;<br />
<br />
	if not isspace(tsrep124.cins) then<br />
		select	tssma102.eper<br />
		from		tssma102<br />
		where		tssma102._index1 = {:tsrep124.cins}<br />
		as set with 1 rows<br />
		selectdo<br />
			if not isspace(tssma102.eper) then<br />
				select	tssma720.*<br />
				from		tssma720<br />
				where		tssma720._index1 = {:tssma102.euno, :tssma102.eper}<br />
				as set with 1 rows<br />
				selectdo<br />
					cins.eper.nama = tssma720.nama<br />
				selectempty	<br />
				endselect<br />
			endif<br />
		selectempty	<br />
		endselect<br />
                <br />
	endif<br />
}<br />
<br />
function long check.for.costing.orders()		|jsz#1112.sn<br />
{<br />
	if tssma301.swor = tssma.swor.costed or<br />
	   tssma301.swor = tssma.swor.history or<br />
	   tssma301.swor = tssma.swor.cancelled then<br />
		mess(&quot;tssmas0420&quot;,1,<br />
		enum.descr$(&quot;tssma.swor&quot;, tssma301.swor))<br />
		| Service order is %s, changing not allowed<br />
		return(0)<br />
	endif<br />
	if isspace(tssma301.ccon) then<br />
		if isspace(tssma301.cins)  and<br />
			tssma301.corn = 0 and			|jsz#0513.n<br />
		   tssma301.sert = tssma.sert.service then<br />
			mess(&quot;tssmas0261&quot;,1)<br />
				| Calculating actual costs not allowed,<br />
				| first assign installation<br />
			return(0)<br />
		endif<br />
	endif<br />
	if tssma301.swor = tssma.swor.free or<br />
	   tssma301.swor = tssma.swor.planned then<br />
		mess(&quot;tssmas0452&quot;,1)<br />
			| Actual costs only allowed if status in &quot;in progress&quot;<br />
		return(0)<br />
	endif<br />
<br />
	return(1)<br />
}					|jsz#1112.en<br />
<br />
function check.serialno()   | Noli<br />
{<br />
                                cins.current = tssma102.cins<br />
                                <br />
				select tsrep124.cins, tsrep124.ccon, tsrep124.cloc, <br />
                                       tssma102.cins, tssma102.ccon, tssma102.cloc <br />
                                from tsrep124, tssma102 for update<br />
                                where tsrep124.cins refers to tssma102<br />
                                <br />
                                selectdo<br />
                                                               <br />
                                   	if cins.current = tsrep124.cins and <br />
                                      	   (tsrep124.ccon = tssma102.ccon or<br />
                                       	    tsrep124.cloc = tssma102.cloc ) then <br />
                                      	    	  message(&quot;SN already exist&quot;)<br />
                                       	      	  input.again()<br />
                                                  cins.current = tssma102.cins<br />
                                             <br />
                                   	else<br />
                                      		   tsrep124.cins = cins.current                                                                    <br />
                                   	endif                              <br />
                                   <br />
                                endselect<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vamsi_gujjula</div><div class="date">6th June 2013, 18:32</div></div><div class="posttext">@Bhushan  , i dont think before.new.object: is there in baan iv , correct me if i am wrong.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">7th June 2013, 07:44</div></div><div class="posttext">Hi Vamsi,<br />
<br />
Oh. Sorry, I am not aware of 4C4. I will take that back. In LN we use this to trigger something on tab.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">7th June 2013, 12:23</div></div><div class="posttext">Hi,<br />
<br />
As per update yesterday, i am having issue to control duplicate entry while using tab cursor... <br />
<br />
For today, i able to check previous record entered alth not yet click save. But<br />
only successful for 1 record before current entry....<br />
<br />
What i means is....I click button insert, i fill up the information(seq 5- since seq 1-4 alrdy in table) and move to next field using tab until last field and curson will auto go to seq 6....script able to check data in seq 6 if equal to seq 5..message pop up.<br />
<br />
But i if already enter seq 5 ,6 and in seq 7, i enter the same SN as per seq 5, script still unsuccessfull.....<br />
<br />
refer screen capture attached. Please provide advice.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">7th June 2013, 13:38</div></div><div class="posttext">Hello,<br />
<br />
You, can try this:-<br />
<br />
For the last field in the record (in your case I guess its Item)<br />
<br />
do this:-<br />
<br />
field.field_name:<br />
<br />
after.input:<br />
<br />
execute(add.set)<br />
to.field(fieldname) | Here give the name of your first field in the record (In your case Seq)<br />
  <br />
<br />
I tried it at my side and it worked.<br />
Hope it works at your side too.<br />
<br />
You add this in your code:-<br />
<br />
field.tsrep124.item:<br />
<br />
after.input:<br />
<br />
execute(add.set)<br />
to.field(tsrep124.seqn)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nolihayati isma</div><div class="date">9th June 2013, 17:58</div></div><div class="posttext">Hi,<br />
<br />
I have tried to add the suggestion above but it's not worked in my script. I still able to<br />
save duplicate record.<br />
<br />
execute(add.set) should add the record to table right? but in this case, when i checked in table the record still not added until i click icon save or icon save+exit or ctrl I.<br />
<br />
do you have skype id or gtalk, so we can chat online?</div></div><hr />



</div>
</body>
</html>