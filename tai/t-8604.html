<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="Monitoring logged in Users, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] Monitoring logged in Users Tools Administration &amp; Installation" />
	
	<title>Monitoring logged in Users [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="../index.html">Newbaanboard</a> &gt; <a href="../index.html">Baan Quick Support: Functional &amp; Technical</a> &gt; <a href="../index.html">Tools Administration &amp; Installation</a> &gt; Monitoring logged in Users</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">dhnish</div><div class="date">25th January 2003, 05:07</div></div><div class="posttext">Hi<br />
<br />
Hope someone can assist me. Is there a tool which I could use <br />
to monitor number of users logged into Baan sorted by Department ???? <br />
Pls assist . Thank you and have a nice day<br />
<br />
Yours in service<br />
.d</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Paul P</div><div class="date">25th January 2003, 05:24</div></div><div class="posttext">Dear .d,<br />
<br />
You can use something similar to licmon.exe that BaanERP provides for NT boxes in your {$BSE}\bin directory. It doesn't sort by department, however, unless your user IDs contain departmental coding too. If you don't have too many users, probably no departmental sorting is still bearable<br />
<br />
Rgds,<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">victor_cleto</div><div class="date">26th January 2003, 22:01</div></div><div class="posttext">There are always ways to get information if you know exactly what you are looking for and how to get it...<br />
The users in Baan are or super or normal users. How do you know that a user is from a certain department, special login coding, special name when created in UX and/or Baan, special authorizations?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dhnish</div><div class="date">28th January 2003, 06:17</div></div><div class="posttext">Hi<br />
<br />
Thanks guys.<br />
Well appreciated</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Old Vens</div><div class="date">28th January 2003, 08:34</div></div><div class="posttext">Hi, <br />
 You can also add the department code in /etc/passwd in GECOS field (it is a comment field) and with the help of a small shell script you can easily monitor who is logged in from what departments. It is also helpful when your company is lacking licences to provide every department to work only in their schedule time.<br />
:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dhnish</div><div class="date">29th January 2003, 03:13</div></div><div class="posttext">Hi<br />
<br />
Dear Old Vens,<br />
<br />
Received your reply.<br />
Yes, i was able to add into the 'comment field' . But I dont' understand about the script you mentioned. Furthermore with this , can I use licmon6.1 to monitor OR need I use something else?<br />
Pls help................<br />
<br />
ps: perhaps if you could help me with the script I would be able to understand better.<br />
<br />
Thank you and have a nice day<br />
<br />
Yours in service<br />
.d</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Old Vens</div><div class="date">29th January 2003, 08:14</div></div><div class="posttext">Hi, <br />
<br />
Frankly speaking there are several scripts providing this kind of monitoring. The idea is first scanning all OS ps grepping bshells among them then remember the needed fields (awk can help) then scanning /etc/passwd and sending to the output its contents matching working bshells. Finally the sort is needed in order to see the result in proper way.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">suhas-mahajan</div><div class="date">29th January 2003, 10:18</div></div><div class="posttext">Dear,<br />
<br />
I faced same problem but finally succeed,  We are having three different plants at diffrent locations, diffrent department and contact nos.<br />
I created a master table with login code, name, dept, contact no. fields. Using licmon, I have taken out to a text file and later file to table. Using same logic, I have given facilities like send message, kill session, print reports etc.<br />
<br />
-Suhas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dhnish</div><div class="date">29th January 2003, 10:49</div></div><div class="posttext">Hi<br />
<br />
Dont' quite understand why you need to create a table ?<br />
At end of the day is this being monitored by end-users or by<br />
administrators ?<br />
Apologize for any inconvenience caused , i'am new...<br />
Pls assist</div></div><hr />


<div class="post"><div class="posttop"><div class="username">suhas-mahajan</div><div class="date">29th January 2003, 11:52</div></div><div class="posttext">Dear Dhnish,<br />
<br />
It is only for Administrators, I made a menu driven program and everytime it refreshes when you select any option.<br />
<br />
-Suhas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tokselampit</div><div class="date">24th April 2003, 07:33</div></div><div class="posttext">Hi, <br />
<br />
I use a script &quot;login_user&quot; in my server (hp-ux) to list BaaN users by their respective departments. I've attached a screen-shots for viewing. <br />
<br />
Basically, the login_user scripts gives u the no. of ascii &amp; gui BaaN users in each department and the details of who is log in.<br />
<br />
If this is what you are looking for, then I will be gladly give u the scripts for testing.<br />
<br />
regards,<br />
<br />
Mok</div></div><hr />


<div class="post"><div class="posttop"><div class="username">amarpreet</div><div class="date">24th April 2003, 09:55</div></div><div class="posttext">Dear Suhas,<br />
<br />
Can u please elaborate how u have written that session &amp; how ur using it through licmon. I found it very intersting , will be thankful if u can provide a detailed documentation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">suhas-mahajan</div><div class="date">25th April 2003, 08:14</div></div><div class="posttext">Hi Amarpreet,<br />
<br />
Really it is very interesting. This utility act as a BaaN Administrator. Which will facilitates to select a active user or all users, send a message to selected user or all users, display users log on date, time, server name etc. info., display opened session(s) for particular or all users by entering random criteria. It also facilitates to kill particular active BaaN user or specific session or all users with specific session. It can give plant-wise, department-wise, active user list with his contact no. It has good User Interface and tough security to not work on other server. This is frequently being used.<br />
<br />
Please find attached herewith screenshot of small tool of this utility called &quot;Plantwise, Deptwise active user list.&quot; <br />
<br />
How I made this, I already wrote.<br />
<br />
-Suhas<br />
:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">amarpreet</div><div class="date">25th April 2003, 08:29</div></div><div class="posttext">Dear Suhas<br />
<br />
I am unable to find any attachment. I think u just missed to attach it.<br />
<br />
Thanks again. <br />
<br />
How is Aurangabad. It must be too hot these days there.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">suhas-mahajan</div><div class="date">25th April 2003, 08:50</div></div><div class="posttext">Hi Amarpreet, (Your name is good)<br />
<br />
No, because of size it is not accepted, I converted it in .jpg, please find now.<br />
<br />
Aurangabad is good, yes, it is hot upto 44, but rarely I come across.<br />
<br />
-Suhas:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sibon1</div><div class="date">25th April 2003, 09:10</div></div><div class="posttext">i have written my own program using native baan. you can see all active baan user by company; you can sort them by processID, UserID, LogonDate and Company; you also can kill a specific process or send a notice to a active user; if you wish, you can see the open sessions of a user.<br />
<br />
You can find the source in the Code &amp; Utilities forum right here (http://www.baanboard.com/baanboard/showthread.php?s=&amp;threadid=9763)<br />
<br />
it works good and fast for me on Windows 2000 Server; i never tested it on Unix.<br />
<br />
Josef N.<br />
<br />
-- <br />
Admin comment: moved the source code to the Code &amp; Utilities forum and linked from here</div></div><hr />


<div class="post"><div class="posttop"><div class="username">learner</div><div class="date">3rd May 2003, 20:26</div></div><div class="posttext">Could u attach the script for this small utility which seems to be very useful !!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evertsen</div><div class="date">4th May 2003, 00:28</div></div><div class="posttext">Learner, follow the link in sibon1's last post above.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">learner</div><div class="date">4th May 2003, 12:28</div></div><div class="posttext">Thanks, yaah i found the link to the script, but some words i can't understand since those r not english words, seems portugese.<br />
<br />
Can it be converted into english ?<br />
<br />
Regards<br />
<br />
Learner</div></div><hr />


<div class="post"><div class="posttop"><div class="username">victor_cleto</div><div class="date">7th May 2003, 20:43</div></div><div class="posttext">I can positively confirm that it is not portuguese :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">patvdv</div><div class="date">8th May 2003, 00:08</div></div><div class="posttext">Mmm Victor, are you sure the version of Pedro Sousa isn't portuguese? :)<br />
<br />
Josef's version is in German by the way. Maybe if you ask the authors nicely, they will translate their work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chjagge</div><div class="date">17th May 2003, 00:13</div></div><div class="posttext">I've done this using a combination of C using the ci_server, shell scripts and a in house written Baan dll.  There are three levels of monitoring and I lock down any user/department/company I need to.<br />
1) by Company,<br />
2) Cost Center (dept)<br />
3) User.<br />
<br />
Do a search on chjagge in this forum and you should find the scripts I posted up. If you cannot find it I can post it again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">learner</div><div class="date">17th May 2003, 20:37</div></div><div class="posttext">Hi,<br />
<br />
Kindly post the script , although i searched through that keyword but i could only only find the screen shots of the system ( jpg image) &amp; not the actuall script.<br />
<br />
Waiting for your reply.<br />
<br />
Regards<br />
<br />
Learner</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evertsen</div><div class="date">18th May 2003, 06:24</div></div><div class="posttext">I believe this is the post chjagge is referring to License (http://www.baanboard.com/baanboard/showthread.php?s=&amp;postid=30782#post30782).  It contains the code for the dll.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">learner</div><div class="date">18th May 2003, 06:45</div></div><div class="posttext">Thanks i will go through the script.<br />
<br />
Regards<br />
<br />
Learner</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chjagge</div><div class="date">23rd June 2003, 19:57</div></div><div class="posttext">Sorry for taking so long to responed to you. Here is the C program<br />
<br />
#include &lt;stdio.h&gt;<br />
#include &lt;string.h&gt;<br />
long check_login(int flogin); /* Baan dll login_dll */<br />
long baan_logout(); /* Baan dll login_dll */<br />
void log_in(int flogin);<br />
void log_out();<br />
<br />
int main (argc, argv)<br />
int   argc;<br />
char  *argv[];<br />
{<br />
        int i_login;<br />
	i_login = atoi(argv[2]);<br />
	i_login--;<br />
        start_ci( argv[0] );<br />
        if ((strcmp(argv[1], &quot;in&quot;)) == 0)<br />
	{<br />
		log_in(999);<br />
	}<br />
	else<br />
	{<br />
	  if ((strcmp(argv[1], &quot;out&quot;)) == 0)<br />
	  {<br />
	           log_out();<br />
          }<br />
	  else<br />
          {<br />
  	     if ((strcmp(argv[1], &quot;re&quot;)) == 0)<br />
             {<br />
		      log_in(i_login);<br />
             }<br />
          }<br />
	}<br />
	stop_ci();<br />
        return 0;<br />
}<br />
<br />
void log_in(int flogin)<br />
{<br />
	long retval;<br />
	retval = check_login(flogin);<br />
<br />
	switch (retval)<br />
	{<br />
		case 1:<br />
			printf(&quot;1&quot;);<br />
			break;<br />
		case 2:<br />
			/* printf(&quot;Login at this time not possible.\n&quot;); */<br />
			/* printf(&quot;Max users for your department has been reached\n&quot;); */<br />
                        printf(&quot;2&quot;);<br />
			break;<br />
		case 3:<br />
			/* printf(&quot;Missing Cost Center\n&quot;); */<br />
			printf(&quot;3&quot;);<br />
			break;<br />
		case 4:<br />
			/* printf(&quot;Number of licences assigned to you exceeded\n&quot;); */<br />
                        printf(&quot;4&quot;);<br />
			break;<br />
		case 5:<br />
			/* printf(&quot;User missing from logon - Cost Center file\n&quot;); */<br />
			printf(&quot;5&quot;);<br />
			break;<br />
		case 6:<br />
			/* printf(&quot;You have exceeded the Company login limit\n&quot;); */<br />
			printf(&quot;6&quot;);<br />
			break;<br />
		default:<br />
                        printf(&quot;0&quot;);<br />
			/* printf(&quot;Invalid Code\n&quot;); */<br />
			break;<br />
	}<br />
}<br />
<br />
void log_out()<br />
{<br />
<br />
	long retval;<br />
	retval = baan_logout();<br />
<br />
 	if (retval == 7)<br />
	{<br />
		printf(&quot;7&quot;);<br />
	}<br />
	else<br />
	{<br />
		printf(&quot;1&quot;);<br />
	}<br />
}<br />
<br />
Here is the Baan dll<br />
<br />
|******************************************************************************<br />
|* tctkndll0002  0  VRC B40O c2 bta0<br />
|* Evaluate Login<br />
|* bsp<br />
|* 06-07-02 [08:02]<br />
|******************************************************************************<br />
|* Script Type: Library<br />
|******************************************************************************<br />
|******************************************************************************<br />
|* tctkn9201  0  VRC B40O c2 bta0<br />
|* Update User logon reference counter<br />
|* Christopher R  Jaggernauth    <br />
|* 2002-03-08<br />
|******************************************************************************<br />
|* Main table tctkn021 User logon reference counter, Form Type 4<br />
|******************************************************************************<br />
                                                                                <br />
|****************************** declaration section ***************************<br />
<br />
	table	ttctkn021	| User logon reference counter<br />
	table   ttctkn022	| Cost Center Max Users<br />
        table   ttctkn023	| License Usage Limit by Company<br />
	table   ttctkn024	| Parent Company - SubCompany Link<br />
	table   tttaad200	| User Data <br />
<br />
	domain	tcmcs.str12   	user.f	fixed<br />
	domain	tcmcs.str12   	user.t	fixed<br />
	domain	tcmcs.long		maxusers.w<br />
	domain	tfgld.dimx		costcenter.w<br />
	domain  tcmcs.long		comp.users<br />
	domain	tfgld.dimx		parent.comp<br />
                string		buf.tctkn021(1) based<br />
		<br />
#include &quot;/baan/bse/application/tcB40O_c2_bta0/ptctkn/ptkndll00010&quot;<br />
<br />
function extern long baan_logout()<br />
{<br />
<br />
	long    count<br />
	long    ret<br />
<br />
	ret = 1<br />
	user.f = strip$(logname$)<br />
	user.t = strip$(logname$)<br />
        db.retry.point()<br />
<br />
        select      tctkn021.*<br />
        from          tctkn021 for update<br />
        where tctkn021._compnr = 100<br />
        and   tctkn021._index1 inrange {:user.f}<br />
                                     and {:user.t}<br />
        order by tctkn021._index1<br />
        selectdo<br />
                | update set<br />
                if tctkn021.logc &gt; 0 then<br />
                        tctkn021.logc = tctkn021.logc - 1<br />
                        db.update(ttctkn021, db.retry)<br />
                endif<br />
                count = count + 1<br />
                if count &gt; 50 then<br />
                        count = 0<br />
                        commit.transaction()<br />
                endif<br />
        selectempty<br />
		ret = 7<br />
                | message(&quot;User Missing from Logon - Cost Center file&quot;)<br />
        endselect<br />
<br />
        commit.transaction()<br />
	return(ret)<br />
}<br />
<br />
function extern long check_login(long flogin)<br />
{<br />
	long	count<br />
	user.f = strip$(logname$)<br />
	user.t = strip$(logname$)<br />
	long ret<br />
	<br />
	ret = 1		| true and allow login if ret is 1<br />
	db.retry.point()<br />
	<br />
|*** Re align login count with that in UNIX<br />
        if flogin &lt;&gt; 999 then<br />
           select tctkn021.*<br />
           from tctkn021 for update<br />
           where tctkn021._compnr = 100 <br />
           and  tctkn021._index1 inrange {:user.f}<br />
                                  and {:user.t}<br />
           order by tctkn021._index1<br />
           selectdo<br />
                tctkn021.logc = flogin<br />
                db.update(ttctkn021, db.retry)<br />
		commit.transaction()<br />
           selectempty<br />
           endselect<br />
        endif<br />
|*** Above select re-align login counts with that on UNIX<br />
<br />
	select      tctkn021.* <br />
	from	      tctkn021 for update<br />
	where tctkn021._compnr = 100     <br />
 	and  tctkn021._index1 inrange {:user.f}<br />
	                             and {:user.t}<br />
	order by tctkn021._index1<br />
	selectdo<br />
		| update set<br />
	   if (tctkn021.conu &gt; tctkn021.logc) then<br />
		costcenter.w = tctkn021.dimx<br />
		sum.users.for.cost.center()<br />
<br />
		select tctkn022.*<br />
		from tctkn022<br />
		where tctkn022._compnr = 100<br />
		and tctkn022._index1 = {:costcenter.w}<br />
		selectdo<br />
			if tctkn022.maxu &gt; maxusers.w then<br />
				sum.users.for.company()<br />
                                if under.company.max() then<br />
					ret = 1		| Used only for emphasis since already initialized above<br />
					tctkn021.logc = tctkn021.logc + 1<br />
					db.update(ttctkn021, db.retry)<br />
                                else<br />
				|	message(&quot;Login at this time is not possible. Max users for company has been reached&quot;)<br />
					ret = 6<br />
				endif<br />
			else<br />
				ret = 2<br />
			|	message(&quot;Login at this time is not possible. Max users for your department has been reached&quot;)<br />
			endif<br />
		selectempty<br />
			ret = 3<br />
			| message(&quot;Missing Cost Center&quot;)<br />
		endselect<br />
<br />
		count = count + 1<br />
		if count &gt; 50 then<br />
			count = 0<br />
			commit.transaction()<br />
		endif<br />
          else<br />
		ret = 4<br />
		| message (&quot;Number of licenses assigned to you exceeded. Limit - &quot; &amp; str$(tctkn021.conu) &amp; &quot; licenses&quot;)<br />
	    endif<br />
<br />
	selectempty<br />
		ret = 5<br />
		| message(&quot;User Missing from Logon - Cost Center file&quot;)<br />
	endselect<br />
	<br />
	commit.transaction()<br />
	return (ret)<br />
}<br />
<br />
function sum.users.for.cost.center()<br />
{<br />
	select sum(tctkn021.logc):maxusers.w<br />
	from tctkn021<br />
	where tctkn021._compnr = 100<br />
	and tctkn021._index2 = {:costcenter.w}<br />
	selectdo<br />
	endselect<br />
}<br />
<br />
function sum.users.for.company()<br />
{<br />
        domain  tcncmp  save.comp<br />
        domain  tcncmp  user.comp<br />
        long    len.tctkn021<br />
<br />
        db.row.length(ttctkn021, len.tctkn021)<br />
        alloc.mem(buf.tctkn021, len.tctkn021)<br />
        buf.tctkn021 = rcd.ttctkn021<br />
        comp.users = 0<br />
        save.comp = get.compnr()<br />
        select  tctkn024.*<br />
        from    tctkn024<br />
        where   tctkn024._compnr = 100<br />
        and     tctkn024._index1 = {:save.comp}<br />
        selectdo<br />
                parent.comp = tctkn024.pcmp<br />
        selectempty<br />
		parent.comp = &quot;&quot;<br />
        endselect<br />
<br />
        select  tctkn021.*<br />
        from    tctkn021<br />
        where   tctkn021._compnr = 100<br />
        order by tctkn021._index1<br />
        selectdo<br />
                select  ttaad200.*<br />
                from    ttaad200<br />
                where   ttaad200._compnr = 0<br />
                and     ttaad200._index1 = {:tctkn021.user}<br />
                selectdo<br />
                        user.comp = ttaad200.comp<br />
                        select  tctkn024.*<br />
                        from    tctkn024<br />
                        where   tctkn024._compnr = 100<br />
                        and     tctkn024._index2 = {:parent.comp, :user.comp}<br />
                        order by tctkn024._index2<br />
                        selectdo<br />
                                comp.users = comp.users + tctkn021.logc<br />
                        endselect<br />
                endselect<br />
	endselect<br />
        rcd.ttctkn021 = buf.tctkn021<br />
     	free.mem(buf.tctkn021)<br />
}<br />
<br />
function domain tcbool under.company.max()<br />
{<br />
        select  tctkn023.*<br />
        from    tctkn023<br />
        where   tctkn023._compnr = 100<br />
        and     tctkn023._index1 = {:parent.comp}<br />
        order by tctkn023._index1<br />
        selectdo<br />
                if tctkn.dll0001.decrypt(tctkn023.musr, tctkn023.pcmp) &gt;<br />
                   comp.users then<br />
                        return(true)<br />
                endif<br />
        endselect<br />
        return(false)<br />
}<br />
<br />
Here is the makefile:<br />
LD=${BSE}/api/lib<br />
CFLAGS=-g -I${BSE}/api/include<br />
LINKFLAGS=-g<br />
CC=cc<br />
<br />
BIC=bic6.1<br />
BIC_CSTUB=bic_cstub6.1<br />
BICFLAGS=<br />
BICINCL=-I ${BSE}/gfd<br />
<br />
all:	ci_login<br />
<br />
ci_login:	ci_login.o c_login_dll.o<br />
	${CC} ${LINKFLAGS} ci_login.o c_login_dll.o 	\<br />
	${LD}/libci.a	\<br />
	${LD}/libalbsh.a \<br />
	${LD}/libipc.a	\<br />
	${LD}/libtss.a	\<br />
	${LD}/libyybsh.a \<br />
	${LD}/libhal.a \<br />
	${LD}/libalbsh.a \<br />
	-lm -o $@<br />
<br />
ci_login.o:	ci_login.c<br />
	${CC} -c ${CFLAGS} ci_login.c -o $@<br />
<br />
c_login_dll.o:	c_login_dll.c<br />
	${CC} -c ${CFLAGS} c_login_dll.c -o $@<br />
<br />
c_login_dll.c:	qloginobj_dll<br />
	${BIC_CSTUB} -s -d qloginobj_dll -o $@<br />
<br />
qloginobj_dll:	login_dll<br />
	${BIC} ${BICFLAGS} login_dll -o $@<br />
<br />
clean:<br />
	rm -f ci_login ci_login.o c_login_dll.o c_login_dll.c qloginobj_dll<br />
<br />
Here is the unix script .profile<br />
PATH=$HOME/bin:${PATH:-/usr/bin:.}<br />
export PATH<br />
stty dec<br />
tset -I -Q<br />
PS1=&quot;`hostname`:$LOGNAME&gt; &quot;<br />
MAIL=/usr/spool/mail/$USER<br />
pwd<br />
<br />
BSE=/baan/bse<br />
BSE_TMP=/baan/bse/tmp<br />
BSE_SORT=/baan/bse/tmp<br />
PATH=$BSE/bin:$PATH<br />
TERM=vt100<br />
export BSE BSE_TMP BSE_SORT PATH TERM<br />
SKIP_FIN_POST=TRUE<br />
export SKIP_FIN_POST<br />
umask o+rw <br />
stty erase &quot;^H&quot;<br />
cd /usr/users/licmon/loginscr<br />
COUNT=0<br />
UCOUNT=0<br />
COUNT=`ci_login in $UCOUNT`<br />
if [ $COUNT -gt 1 ]; then<br />
   BCOUNT=`ps -ef|grep bisam|grep $USER|wc -l`<br />
   ICOUNT=`ps -ef|grep informix|grep $USER|wc -l`<br />
   if [ $BCOUNT -gt $ICOUNT ]; then<br />
      UCOUNT=$BCOUNT<br />
   else<br />
      UCOUNT=$ICOUNT<br />
   fi<br />
   echo Rebuild reference count for $USER and retrying login sequence.<br />
   COUNT=0<br />
   COUNT=`ci_login re $UCOUNT`<br />
fi<br />
if [ $COUNT -eq 4 ]; then<br />
   ba6.1 tctknt202m000<br />
   COUNT=8<br />
fi<br />
if [ $COUNT -eq 1 ]; then<br />
   ba6.1<br />
   COUNT=`ci_login out 99`<br />
   if [ $COUNT -eq 7 ]; then<br />
     echo Login missing from Cost center table<br />
   fi<br />
cd /usr/users/bsp<br />
elif [ $COUNT -eq 2 ]; then<br />
   echo Login at this time not possible. Max Users for your department has been<br />
reached<br />
   sleep 5<br />
elif [ $COUNT -eq 3 ]; then<br />
   echo Missing Cost Center<br />
   sleep 5<br />
elif [ $COUNT -eq 4 ]; then<br />
   echo Number of licenses assigned to you has been exceeded!!!!<br />
   sleep 5<br />
elif [ $COUNT -eq 5 ]; then<br />
   echo User Login does not exists in Cost Center File<br />
   sleep 5<br />
elif [ $COUNT -eq 6 ]; then<br />
   echo Company login limt has been exceeded<br />
   sleep 5<br />
elif [ $COUNT -eq 0 ]; then<br />
   echo Invalid Parameter<br />
   sleep 5<br />
fi<br />
exit<br />
<br />
<br />
Here is the encryption dll.<br />
function extern long tctkn.dll0001.decrypt(string in.code(12), string key(6))<br />
| The function takes an 8-character string and converts back to a number.  If<br />
| the convertion fails, the function returns the value -1.<br />
{<br />
	long	check.total<br />
	long	curr.num<br />
	long	i<br />
	long	key.num<br />
	long	return.val<br />
	long	total.num<br />
<br />
    if session.found() then<br />
	check.total = 0<br />
	total.num = 0<br />
	key.num = 0<br />
	for i = 1 to 6<br />
		key.num = key.num + asc(key(i;1))<br />
	endfor<br />
	for i = 1 to 7<br />
		curr.num = (asc(in.code(i + 1;1)) - 66) / 2<br />
		check.total = check.total + curr.num<br />
		total.num = total.num + curr.num * lpow(13, 7 - i)<br />
	endfor<br />
	if asc(in.code(1;1)) - 65 &lt;&gt; (check.total \ 26) then<br />
		return(-1)<br />
	endif<br />
	return.val = total.num - key.num * 100000<br />
	if return.val &lt; 0 then<br />
		return.val = -1<br />
	endif<br />
	return(return.val)<br />
    endif<br />
    return(-1)<br />
}<br />
<br />
function extern string tctkn.dll0001.encrypt(long in.num, string key(6))<br />
| The function encrypt takes a non-negative number (in.num) and converts it<br />
| into an 8-character string.  A key is used for encryption/decryption.<br />
{<br />
	long	check.total<br />
	long	curr.num<br />
	long	encrypt.num<br />
	long	i<br />
	long	key.num<br />
	string	return.str(8)<br />
<br />
    if session.found() then<br />
	check.total = 0<br />
	key.num = 0<br />
	for i = 1 to 6<br />
		key.num = key.num + asc(key(i;1))<br />
	endfor<br />
	encrypt.num = key.num * 100000 + in.num<br />
	for i = 1 to 7<br />
		curr.num = encrypt.num / lpow(13, 7 - i)<br />
		return.str(i + 1;1) = chr$(66 + curr.num * 2)<br />
		check.total = check.total + curr.num<br />
		encrypt.num = encrypt.num \ lpow(13, 7 - i)<br />
	endfor<br />
	return.str(1;1) = chr$(65 + check.total \ 26)<br />
	return(return.str)<br />
    endif<br />
    return(&quot;&quot;)<br />
}<br />
<br />
function domain tcbool session.found()<br />
{<br />
<br />
	on case prog.name$<br />
	case &quot;tctkn9201s000&quot;:<br />
	case &quot;tctkn9203s000&quot;:<br />
	case &quot;tctknt104m000&quot;:<br />
	case &quot;ottstpciserver&quot;:<br />
		return(true)<br />
	default:<br />
	endcase<br />
        return(false)<br />
}<br />
<br />
Here is tctknt202m000:<br />
|* tctknt202  0  VRC B40O c2 bta0<br />
|* Terminate user Baan session<br />
|* Christopher Jaggernauth       <br />
|* 2002-07-24<br />
|******************************************************************************<br />
|* Main table tctkn021 User logon reference counter, Form Type 4<br />
|******************************************************************************<br />
                                                                                <br />
|****************************** declaration section ***************************<br />
declaration:<br />
	extern	domain	tcmcs.str12   	user.w	fixed<br />
	<br />
<br />
|****************************** form section **********************************<br />
<br />
form.1:<br />
init.form:<br />
	get.screen.defaults()<br />
	user.w = logname$<br />
	display(&quot;user.w&quot;)<br />
	refresh()<br />
<br />
|****************************** choice section ********************************<br />
<br />
choice.cont.process:<br />
on.choice:<br />
	read.main.table()<br />
<br />
|****************************** function section ******************************<br />
<br />
functions:<br />
<br />
function read.main.table() <br />
{<br />
	long ret.val<br />
	if (ask.enum(&quot;tdilc40079&quot;, tcyesno.no) = tcyesno.yes) then<br />
		ret.val = shell (&quot;kill `ps -efu $LOGNAME|grep -v grep|grep -w -f /usr/users/licmon/loginscr/bshell.dat|awk '{print $2}'`&quot;, SHELL_NO_OUTPUT)<br />
	endif<br />
}<br />
<br />
Hope this helps. Have fun.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vishbaan</div><div class="date">24th October 2005, 15:11</div></div><div class="posttext">hi suhaas<br />
<br />
on the license utility, it is quite useful; sometimes back we were forced with similar situation to have licenses allocated by company. I attempted the similar way and added the program in bms mask during boot time to check the user dept and total dount for the user dept. etc..<br />
<br />
since I could not cope up with the shell, run prog commands could not quite well do it; <br />
<br />
would you mind giving me a dump of these components you did in baan.<br />
<br />
thanks<br />
<br />
VISH</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ganesh_kapase</div><div class="date">28th October 2005, 21:19</div></div><div class="posttext">Hi Suhas<br />
<br />
It seems your utility is good. Can we allocate users locationwise / departmentwise ? I mean to say suppose we are having 20 licenses and having 10 departments. And if we want to allocate 2 users to each department can we do it ?<br />
<br />
If not tell me alternates if any.<br />
<br />
<br />
Regards,<br />
<br />
<br />
GANESH - Kolhapur<br />
(Can u remember me, we had telephonic conversation in few months back)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">suhas-mahajan</div><div class="date">31st October 2005, 10:32</div></div><div class="posttext">Vish,<br />
<br />
Yes, M$ systems lacking scipting too much, batch programming has so many limitations. In Unix/Linux, you can hold and initialize logged on user ID and use it for external programs using BMS mask or IPCINFO.<br />
<br />
Unfortunately, this is not developed using BaaN scripting. This is a DOS based external program, internally uses licmon.exe, bshcmd.exe and few exe's downloaded from www.sysinternal.com to run it on client side.<br />
<br />
Ganesh,<br />
<br />
Thanks for the compliments, This utility can not allocate licences locationwise / dept. wise. It is post event trapping and 99% real time monitoring tool. But, later you can monitor it and send messages to users to logged out or can ring them seeing extension no. or kill them, if they are not using maintain sessions.<br />
<br />
If you are facing licence distribution problem, you can configure session_timeout mechanism into dbresource file. This definately helps you lot.<br />
<br />
Yes, I recognised and remember you.<br />
<br />
Regards &amp; Happy Diwali to everybody.<br />
<br />
-Suhas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chjagge</div><div class="date">31st October 2005, 15:35</div></div><div class="posttext">The script I posted above can allocate by department, companies.  You can shut down a department eg Finance whenever finance to run a rebuild on finance only without affecting the rest of the company.   It takes a bit of implementation but it works well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mama123</div><div class="date">13th November 2007, 02:35</div></div><div class="posttext">Hi there,<br />
<br />
may i know how to kill or kick the user from the licmon?<br />
the incident was the user pc hang, so the baan license still hanging in licmon and it do not clear off, need to wait for more than 1/2 hours only disappear from the licmon.<br />
<br />
pls advice<br />
<br />
thanks<br />
<br />
nice day</div></div><hr />


<div class="post"><div class="posttop"><div class="username">suhas-mahajan</div><div class="date">13th November 2007, 06:29</div></div><div class="posttext">Hi,<br />
<br />
Please refer to -<br />
<br />
1. http://www.baanboard.com/baanboard/showthread.php?t=25098&amp;highlight=licmon<br />
<br />
2. http://www.baanboard.com/baanboard/showthread.php?t=12824&amp;highlight=licmon<br />
<br />
3. http://www.baanboard.com/baanboard/showthread.php?t=28142&amp;highlight=licmon<br />
<br />
Hope this helps.<br />
<br />
regards,<br />
<br />
-Suhas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ahmer91</div><div class="date">13th November 2007, 08:27</div></div><div class="posttext">there is a command in unix that will show you the list of all the users logged into to baaan<br />
<br />
# ps -ef |grep baan<br />
<br />
but you will not be able to sort out by company.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mama123</div><div class="date">30th November 2007, 09:59</div></div><div class="posttext">hi there,<br />
<br />
is there any idea to restrict the user login more than 1 time?<br />
i wanna restrict the the user login 1 Baan, do not allow them login 2 Baan using the same user ID, bcos lack of license issues.<br />
<br />
thanks for help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">victor_cleto</div><div class="date">30th November 2007, 17:48</div></div><div class="posttext">Search the threads for killing users and restrict logins.<br />
These 2 topics have been very well discussed all over the Tools section (for UNIXes and even Windows), please do not ask the same questions over and over again - search first and read as much as possible.</div></div><hr />



</div>
</body>
</html>