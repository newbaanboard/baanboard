<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="DEV: Export any Baan table to (proper) Excel, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] DEV: Export any Baan table to (proper) Excel Code &amp; Utilities" />
	
	<title>DEV: Export any Baan table to (proper) Excel [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="index.html">Newbaanboard</a> &gt; <a href="index.html">Baan SIGs</a> &gt; <a href="index.html">Code &amp; Utilities</a> &gt; DEV: Export any Baan table to (proper) Excel</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">Francesco</div><div class="date">28th September 2007, 12:33</div></div><div class="posttext">One of the tasks that I concider annoying is to provide table exports in the only tool that anybody can use...Excel.<br />
<br />
To come up with a more permanent solution, I developed this session for BaanIV. With a bit of sluething it should work in any Baan version.<br />
This session will export any baan table, optionaly using selection criteria, to an excel XML sheet. Dates, enums and what not are all properly converted.<br />
<br />
Oh, the attached screenshots are in Dutch but it has an option for multiple languages and comes in English too. <br />
<br />
Enjoy!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sukesh75</div><div class="date">29th September 2007, 10:17</div></div><div class="posttext">Has anyone tried this out? I imported this into our environment using Import data dictionary session and copied the forms from its present language to english. Upon running the session &quot;Baan Data Export Tool&quot; i get the error &quot;Error Reading From Dump&quot;.<br />
 <br />
Did i miss anything?<br />
Apart from that, when i click on the edit form button on the Maintain Forms, i just get a blank box with no fields for both the forms in Baan Data Export Tool session. <br />
 <br />
sk</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">2nd October 2007, 16:25</div></div><div class="posttext">I have problems also.  I have sent Francesco an email asking for assistance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">3rd October 2007, 15:20</div></div><div class="posttext">Received a message from Francesco - he will try to retrieve a copy of the correct dump.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Arthas</div><div class="date">5th October 2007, 11:48</div></div><div class="posttext">I can't help raising a wry smile of sympathy with your situation - we know what you're going through.<br />
My record for reverse engineering a VB macro using Safari ODBC drivers into raw informix sql is:<br />
Before: three days<br />
After: seven seconds.<br />
Revenge is sweet.............. and I shall watch this thread with great interest...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Francesco</div><div class="date">10th October 2007, 09:19</div></div><div class="posttext">As pointed out, my dumpfile did not include the source or the forms for this session. Oops, sorry, this must have been an update and not a full dump.<br />
<br />
So to set things straight, here are the forms (Dutch only, I'm afraid) and the missing source.<br />
<br />
<br />
|******************************************************************************<br />
|* Data Export Tool<br />
|* Francesco Frentrop            <br />
|* 2007-07-11<br />
|******************************************************************************<br />
|* Main table , Form Type 4<br />
|******************************************************************************<br />
                                                                                <br />
|****************************** declaration section ***************************<br />
declaration:<br />
	<br />
	table	tttaad100		| Company data<br />
	table	tttadv101		| Modules<br />
	table	tttadv112		| Package VRC's<br />
	table	tttadv130		| Descriptions per language<br />
	table	tttadv140		| Display Labels per PVRC<br />
	table	tttadv400		| Domains<br />
	table	tttadv401		| Enum Values<br />
	table	tttadv402		| Enum Descriptions<br />
	table	tttadv420		| Table Definitions<br />
	table	tttadv421		| Table Indexes<br />
	table	tttadv422		| Table Fields<br />
<br />
	domain	tcclan		lang	| Language<br />
	domain	ttaad.pacc	PACC	| Package VRC<br />
	domain	ttadv.vers	version<br />
	domain	ttadv.rele	release<br />
	domain	ttadv.cust	customer<br />
<br />
	string	sTABLE(9)		| Table<br />
	string	sVRC(10)		| VRC<br />
<br />
	string	expr(5020)		| Expression string<br />
	string	strBuffer	BASED<br />
<br />
	long	sql			| SQL ID<br />
	long	exp_id			| Expression ID<br />
	long	app_id			| Applicaion ID<br />
	long	ret<br />
	long	fp			| File Pointer<br />
	long	fp_log			| File Pointer to log file<br />
<br />
	string	bdet.author(32)		| Author<br />
	string	bdet.create.date(20)	| Creation Date<br />
	string	bdet.version(7)		| XML version No<br />
	string	datum.style(24)<br />
	string	time.style(24)<br />
<br />
	double	width.factor<br />
	long	EXCEL.LIMIT<br />
	long	error.status<br />
<br />
	string	local.dir(128)		| Directory for export<br />
	<br />
	string	sdat(12)<br />
	string	syear(4)<br />
	string	smonth(2)<br />
	string	sday(2)<br />
	string	shr(2)<br />
	string	smin(2)<br />
	string	ssec(2)<br />
	string	rkey(12)<br />
<br />
	|*********************** Table data  **********************************<br />
	long	field.count<br />
	long	row.count<br />
	long	row.len<br />
<br />
	long	format.row.type<br />
	long	format.row.name<br />
	long	format.row.type.len<br />
	long	format.row.name.len<br />
	long	format.row.header<br />
	long	format.row.header.len<br />
	long	format.row.width<br />
	long	format.row.width.len<br />
	long	format.row.cdom<br />
	long	format.row.cdom.len<br />
	long	format.row.cpac<br />
	long	format.row.cpac.len<br />
<br />
	string	format.row(101, 1024)<br />
<br />
	<br />
	|***********************  Messages  **********************************	<br />
	string	error1(255)<br />
	string	error2(255)<br />
	string	error3(255)<br />
	string	error4(255)<br />
	string	error5(255)<br />
	string	error6(255)<br />
	string	error7(255)<br />
	string	error8(255)<br />
	string	error9(255)<br />
	string	error10(255)<br />
<br />
	string	status1(255)<br />
	string	status2(255)<br />
	string	status3(255)<br />
	string	status4(255)<br />
	string	status5(255)<br />
	string	status6(255)<br />
	string	status7(255)<br />
	string	status8(255)<br />
	string	status9(255)<br />
<br />
	|********************** form fields ***********************************<br />
	extern	domain	tcmcs.str2     	cpac.f<br />
	extern	domain	tcmcs.str3	cmod.f<br />
	extern	domain	tcmcs.str3	flno.f<br />
<br />
	extern	domain	ttyeno        	layout.on<br />
	extern	domain	ttyeno        	limit.on<br />
	extern	domain	ttyeno		timestamp.on<br />
<br />
	extern	domain	tcmcs.str50	status<br />
	extern	domain	tcmcs.long	rcd.counter<br />
	extern	domain	tcmcs.long	limit.no<br />
	extern	domain	tcmcs.str80	table.name<br />
<br />
	extern	domain	tcmcs.str8	form.index(11)<br />
	extern	domain	tcmcs.str50	value.f(11)<br />
	extern	domain	tcmcs.str50	value.t(11)<br />
	extern	domain	tcmcs.str4	form.from(11)<br />
	extern	domain	tcmcs.str4	form.to(11)<br />
	extern	domain	tcmcs.str16	form.desc(11)<br />
	extern	domain	ttyeno		index.active(11)<br />
		domain	tcmcs.long	form.type(11)<br />
<br />
	|********************** includes **************************************<br />
        #pragma used dll ottdllbw<br />
<br />
	#include &lt;bic_tt&gt;<br />
<br />
<br />
Before.Program:<br />
<br />
	PACC = curr.pacc$<br />
	lang = language$<br />
<br />
	error.status = 0<br />
<br />
	format.row.type		= 9<br />
	format.row.name		= 1<br />
	format.row.type.len	= 2<br />
	format.row.name.len	= 8<br />
	format.row.header	= 11<br />
	format.row.header.len	= 70<br />
	format.row.width	= 81<br />
	format.row.width.len	= 7<br />
	format.row.cdom		= 88<br />
	format.row.cdom.len	= 12<br />
	format.row.cpac		= 100<br />
	format.row.cpac.len	= 2<br />
<br />
	set.error.messages()<br />
	set.status.messages()<br />
<br />
	sdat = dte$()<br />
	syear = &quot;20&quot; &amp; sdat(5;2)<br />
	smonth = sdat(1;2)<br />
	sday = sdat (3;2)<br />
	shr = sdat(7;2)<br />
	smin = sdat(9;2)<br />
	ssec = sdat(11;2)<br />
	<br />
	ret = tt.user(logname$, bdet.author)<br />
	bdet.create.date = syear &amp; &quot;-&quot; &amp; smonth &amp; &quot;-&quot; &amp; sday &amp; &quot;T&quot; &amp; shr &amp; &quot;:&quot; &amp; smin &amp; &quot;:&quot; &amp; ssec &amp; &quot;Z&quot;<br />
	bdet.version = &quot;11.6568&quot;<br />
	datum.style = &quot; ss:StyleID=&quot;&quot;s23&quot;&quot;&quot;<br />
	time.style = &quot; ss:StyleID=&quot;&quot;s24&quot;&quot;&quot;<br />
	width.factor = 7.27<br />
<br />
	local.dir = &quot;C:\Temp\&quot;<br />
<br />
	EXCEL.LIMIT = 65536<br />
	set.status(1)<br />
<br />
|****************************** form section **********************************<br />
<br />
form.all:<br />
form.1:<br />
init.form:<br />
	limit.on = ttyeno.no<br />
	layout.on = ttyeno.yes<br />
	timestamp.on = ttyeno.no<br />
	refresh()<br />
	display.all()<br />
<br />
	|get.screen.defaults()<br />
form.2:<br />
before.form:<br />
	ret = load.indexes()<br />
	if ret = -1 then<br />
		Message(&quot;Bestoa nie!!&quot;)		| TODO<br />
	endif<br />
<br />
|****************************** choice section ********************************<br />
<br />
choice.cont.process:<br />
on.choice:<br />
	start.process()<br />
<br />
<br />
|****************************** field section *********************************<br />
<br />
field.cpac.f:<br />
check.input:<br />
if len(strip$(cpac.f)) &lt;&gt; 2 then<br />
	set.input.error(error7, cpac.f)<br />
endif<br />
<br />
<br />
field.cmod.f:<br />
check.input:<br />
if len(strip$(cmod.f)) &lt;&gt; 3 then<br />
	set.input.error(error7, cmod.f)<br />
endif<br />
before.zoom:<br />
	ttadv101.cpac = cpac.f<br />
field.flno.f:<br />
check.input:<br />
while len(flno.f) &lt; 3<br />
	flno.f = &quot;0&quot; &amp; flno.f<br />
endwhile<br />
before.zoom:<br />
	ttadv420.cpac = cpac.f<br />
	ttadv420.cmod = cmod.f<br />
when.field.changes:<br />
	rkey = cmod.f &amp; flno.f<br />
	determine.vrc()<br />
<br />
	select	ttadv130.desc<br />
	from	ttadv130<br />
	where	ttadv130._compnr = 000<br />
	and	ttadv130.cpac = :cpac.f<br />
	and	ttadv130.kdes = ttadv.kdes.table<br />
	and	ttadv130.rkey = :rkey<br />
	and	ttadv130.clan = :lang<br />
	as set with 1 rows<br />
	selectdo<br />
		table.name = ttadv130.desc<br />
		refresh()<br />
		display.all()<br />
	endselect<br />
<br />
|****************************** function section ******************************<br />
<br />
functions:<br />
<br />
function start.process()<br />
{<br />
	string	tmp.file(128)<br />
	string	local.path(128)<br />
	string	file.name(20)<br />
<br />
	status = &quot;&quot;<br />
	error.status = 0<br />
	rcd.counter = 0<br />
<br />
	determine.vrc()<br />
<br />
	tmp.file = creat.tmp.file$( bse.tmp.dir$() )<br />
<br />
	fp = seq.open(tmp.file, &quot;a&quot;)<br />
	fp_log = seq.open(bse.dir$() &amp; &quot;\log\cccom9000.log&quot;, &quot;w&quot;)<br />
<br />
	set.status(2)<br />
<br />
	process.table()<br />
<br />
	set.status(8)<br />
	ret = seq.close(fp)<br />
	ret = seq.close(fp_log)<br />
<br />
	if not error.status then<br />
		if timestamp.on = ttyeno.yes then<br />
			file.name = sTABLE &amp; dte$()<br />
		else<br />
			file.name = sTABLE<br />
		endif<br />
<br />
		if layout.on = ttyeno.yes then<br />
			file.name = file.name &amp; &quot;.xls&quot;<br />
		else<br />
			file.name = file.name &amp; &quot;.csv&quot;<br />
		endif<br />
<br />
		local.path = strip$(local.dir) &amp; strip$(file.name)<br />
<br />
		ret = server2client(tmp.file, strip$(local.path), 1, 0)<br />
		app_id = app_start(&quot;excel.exe &quot; &amp; local.path, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;)<br />
		set.status(9)<br />
	else<br />
		Message(&quot;No data to be exported. Error Status: %d&quot;, error.status)<br />
	endif<br />
}<br />
<br />
function void determine.vrc()<br />
{<br />
	long result, sequ<br />
	<br />
	sequ = 1<br />
	result = 0<br />
<br />
	while result = 0<br />
	<br />
		select	*<br />
		from	ttadv112<br />
		where	ttadv112._compnr = 000<br />
		and	ttadv112.pacc = :PACC<br />
		and	ttadv112.cpac = :cpac.f<br />
		and	ttadv112.sequ = :sequ<br />
		selectdo<br />
			version = ttadv112.vers<br />
			release = ttadv112.rele<br />
			customer = ttadv112.cust<br />
<br />
			select	ttadv420.*<br />
			from	ttadv420<br />
			where   ttadv420._compnr = 000<br />
			and	ttadv420.cpac = :ttadv112.cpac<br />
			and	ttadv420.cmod = :cmod.f<br />
			and	ttadv420.flno = :flno.f<br />
			and	ttadv420.vers = :version<br />
			and	ttadv420.rele = :release<br />
			and	ttadv420.cust = :customer<br />
			and	ttadv420.expi = ttyeno.no<br />
			selectdo<br />
				result = 1<br />
				sTABLE = ttadv420.cpac &amp; ttadv420.cmod &amp; ttadv420.flno<br />
				sVRC   = version &amp; release &amp; customer<br />
			selectempty<br />
				sequ = sequ + 1<br />
			endselect<br />
		selectempty<br />
			result = -1<br />
			message(error4, PACC, cpac.f, sequ)<br />
			error.status = 4<br />
		endselect<br />
<br />
	endwhile<br />
}<br />
<br />
function process.table()<br />
{<br />
	| I know, select is strictly speaking not necessary here<br />
<br />
	select	ttadv420.*<br />
	from	ttadv420<br />
	where   ttadv420._compnr = 000<br />
	and	ttadv420.cpac = :ttadv112.cpac<br />
	and	ttadv420.cmod = :cmod.f<br />
	and	ttadv420.flno = :flno.f<br />
	and	ttadv420.vers = :version<br />
	and	ttadv420.rele = :release<br />
	and	ttadv420.cust = :customer<br />
	and	ttadv420.expi = ttyeno.no<br />
	selectdo<br />
			process.data()<br />
	endselect<br />
}<br />
<br />
function void process.data()<br />
{<br />
	long	x<br />
	string	strParse(2048)<br />
	string	from.value(50)<br />
	string	to.value(50)<br />
	<br />
	set.status(3)<br />
		<br />
	ret = get.table.info(sTABLE, field.count, row.count, row.len)<br />
	if ret then<br />
		error.status = 3<br />
		message(error3, ret)<br />
	else<br />
		set.status(4)<br />
		if layout.on = ttyeno.yes then<br />
			create.xml.header()<br />
		endif<br />
<br />
		if layout.on = ttyeno.yes then<br />
			for x = 1 to field.count<br />
				ret = seq.puts(&quot;   &lt;Column ss:Width=&quot;&quot;&quot; &amp; strip$(format.row(format.row.width, x;format.row.width.len)) &amp; &quot;&quot;&quot;/&gt;&quot;, fp)<br />
			endfor<br />
		endif<br />
<br />
		write.header()<br />
<br />
		free.mem(strBuffer)<br />
		alloc.mem(strBuffer,row.len)<br />
<br />
		build.expr()<br />
<br />
		ret = seq.puts(expr, fp_log)<br />
<br />
		strParse = &quot;select * from &quot; &amp; sTABLE<br />
		ret = 0<br />
		for x = 1 to 11<br />
			if (strip$(form.index(1, x)) &lt;&gt; &quot;&quot;) and (strip$(value.t(1, x)) &lt;&gt; &quot;&quot;) then<br />
				if ret = 0 then <br />
					from.value = &quot; where &quot;<br />
					ret = 1<br />
				else<br />
					from.value = &quot; and &quot;<br />
				endif<br />
				on case form.type(x)<br />
				case DB.LONG:<br />
				case DB.DOUBLE:<br />
				case DB.INTEGER:<br />
				case DB.FLOAT:<br />
					if strip$(value.f(1, x)) = &quot;&quot; then<br />
						from.value = from.value &amp; strip$(form.index(1, x)) &amp; &quot; &gt;= &quot; &amp; &quot;0&quot;<br />
					else<br />
						if isdigit(strip$(value.f(1, x))) then<br />
							from.value = from.value &amp; strip$(form.index(1, x)) &amp; &quot; &gt;= &quot; &amp; strip$(value.f(1, x))<br />
						else<br />
							Message(error8, form.index(1, x))<br />
						endif<br />
					endif<br />
					if isdigit(strip$(value.t(1, x))) then <br />
						to.value = &quot; and &quot; &amp; strip$(form.index(1, x)) &amp; &quot; &lt;= &quot; &amp; strip$(value.t(1, x))<br />
					else<br />
						message(error8, form.index(1, x))<br />
					endif<br />
					break<br />
				case DB.STRING:<br />
				case DB.MULTIBYTE:<br />
					from.value = from.value &amp; strip$(form.index(1, x)) &amp; &quot; &gt;= &quot; &amp; &quot;&quot;&quot;&quot; &amp; strip$(value.f(1, x)) &amp; &quot;&quot;&quot;&quot;<br />
					to.value = &quot; and &quot; &amp; strip$(form.index(1, x)) &amp; &quot; &lt;= &quot; &amp; &quot;&quot;&quot;&quot; &amp; strip$(value.t(1, x)) &amp; &quot;&quot;&quot;&quot;<br />
					break<br />
				default:<br />
					from.value = &quot;&quot;<br />
					to.value = &quot;&quot;<br />
					Message(error9, form.index(1, x))<br />
				endcase<br />
				strParse = strParse &amp; strip$(from.value) &amp; strip$(to.value)<br />
			endif<br />
		endfor<br />
		if limit.on = ttyeno.yes then<br />
			strParse = strParse &amp; &quot; as set with &quot; &amp; str$(limit.no) &amp; &quot; rows&quot;<br />
		endif<br />
<br />
		ret = seq.puts(strParse, fp_log)<br />
<br />
		sql = sql.parse(strParse)<br />
<br />
		if not sql then<br />
			error.status = 1<br />
			Message(Error1)<br />
			goto SKIP<br />
		endif<br />
<br />
		set.status(5)<br />
		sql.exec(sql)<br />
		error.bypass = 1<br />
		while (true)<br />
			ret = sql.fetch(sql)<br />
			on case ret<br />
			case eendfile:<br />
				break<br />
			case enorec:<br />
				error.status = 6<br />
				message(error6, strParse)<br />
			case enotable:<br />
				error.status = 10<br />
				message(error10, sTABLE)<br />
			case 0:<br />
				rcd.counter = rcd.counter + 1<br />
				display(&quot;rcd.counter&quot;)<br />
				|refresh()<br />
				strBuffer = s.expr$(exp_id)<br />
				write.row()<br />
				if rcd.counter = EXCEL.LIMIT then<br />
					error.status = 5<br />
					message(error5)<br />
					break<br />
				else<br />
					continue<br />
				endif<br />
			default:<br />
				error.status = 2<br />
				message(error2, ret, strParse)<br />
				<br />
			endcase<br />
			break<br />
		endwhile<br />
		error.bypass = 0<br />
<br />
		set.status(6)<br />
	<br />
		sql.break(sql)<br />
		sql.close(sql)<br />
		sql = 0<br />
<br />
		free.mem(strBuffer)<br />
		expr.free(exp_id)<br />
		expr = &quot;&quot;<br />
<br />
		if layout.on = ttyeno.yes then<br />
			create.xml.footer()<br />
		endif<br />
	SKIP:<br />
	endif<br />
}<br />
<br />
function long get.table.info(string table.name(8), ref long no_fields, ref long no_rows, ref long row_len)<br />
{	<br />
	long	result<br />
	long	no_keys, no_columns, int_length, real_length<br />
	string	domain_name(14), default_val(1)<br />
	long	offset, size, dept, type, flag<br />
	string	column.name(18)<br />
<br />
	string	cpac(2)<br />
	string	cmod(3)<br />
	string	flno(3)<br />
	domain	ttadv.clab	clab<br />
<br />
	result = 0<br />
	no_fields = 0<br />
<br />
	cpac = table.name(1;2)<br />
	cmod = table.name(3;3)<br />
	flno = table.name(6;3)<br />
<br />
	ret = rdi.table(table.name, no_keys, no_columns, int_length, real_length)<br />
	row_len = int_length * 1.1	| Add 10% fudge because it doesn't work @TODO@<br />
<br />
	select	*<br />
	from	ttadv422<br />
	where	ttadv422._compnr = 000<br />
	and	ttadv422.cpac = :cpac<br />
	and	ttadv422.cmod = :cmod<br />
	and	ttadv422.flno = :flno<br />
	and	ttadv422.vers = :version<br />
	and	ttadv422.rele = :release<br />
	and	ttadv422.cust = :customer<br />
	order by ttadv422.fdno<br />
	selectdo<br />
		no_fields = no_fields + 1<br />
		type = get.field.type(table.name, ttadv422.fdnm)<br />
		format.row(format.row.name, no_fields) = ttadv422.fdnm<br />
		format.row(format.row.type, no_fields) = str$(type)<br />
<br />
		if strip$(ttadv422.clab) &lt;&gt; &quot;&quot; then<br />
			clab = ttadv422.clab<br />
		else<br />
			clab = ttadv422.cpac &amp; ttadv422.cmod &amp; ttadv422.flno &amp; &quot;.&quot; &amp; ttadv422.fdnm<br />
		endif<br />
<br />
		format.row(format.row.header, no_fields) = get.field.desc(lang, cpac.f, clab)<br />
<br />
		column.name = table.name &amp; &quot;.&quot; &amp; ttadv422.fdnm<br />
		ret = rdi.column(column.name, domain_name, offset, size, dept, type, flag, default_val)<br />
		if size = 0 then <br />
			size = 1<br />
		endif<br />
		if type = DB.ENUM then<br />
			size = 12<br />
		endif<br />
		format.row(format.row.width, no_fields) = str$(size * width.factor)<br />
<br />
		format.row(format.row.cdom, no_fields) = ttadv422.cdom<br />
		format.row(format.row.cpac, no_fields) = ttadv422.pacd<br />
		if (type = DB.BITSET) or (type = DB.COMBINED) then<br />
			no_fields = no_fields - 1<br />
		endif<br />
	selectempty<br />
		result = 1<br />
	endselect<br />
<br />
	return(result)<br />
}<br />
<br />
function void write.header()<br />
{<br />
	string	header(2048)<br />
	long	x<br />
<br />
	if layout.on = ttyeno.yes then<br />
		ret = seq.puts(&quot;   &lt;Row ss:StyleID=&quot;&quot;s22&quot;&quot;&gt;&quot;, fp)<br />
		for x = 1 to field.count<br />
			ret = seq.puts(&quot;    &lt;Cell&gt;&lt;Data ss:Type=&quot;&quot;String&quot;&quot;&gt;&quot; &amp; strip$(format.row(format.row.header, x;format.row.header.len)) &amp; &quot;&lt;/Data&gt;&lt;/Cell&gt;&quot;, fp)<br />
		endfor<br />
		ret = seq.puts(&quot;   &lt;/Row&gt;&quot;, fp)<br />
	else<br />
		for x = 1 to field.count<br />
			header = header &amp; strip$(format.row(format.row.header, x;format.row.header.len)) &amp; &quot;;&quot;<br />
		endfor<br />
		ret = seq.puts(strip$(header), fp)<br />
	endif<br />
}<br />
<br />
function void write.row()<br />
{<br />
	string	tmp.field(1024)<br />
	string	data.type(12)<br />
	string	read.char(1)<br />
	string	cell.style(24)<br />
	string	cdom(12)<br />
	string	cpac(2)<br />
	long	type<br />
	long	x, y<br />
	long	cnst<br />
	long	buffer.len<br />
<br />
	if layout.on = ttyeno.yes then<br />
		ret = seq.puts(&quot;   &lt;Row&gt;&quot;, fp)<br />
<br />
		y = 1<br />
<br />
		for x = 1 to field.count<br />
			tmp.field = &quot;&quot;<br />
			read.char = &quot;&quot;<br />
<br />
			strBuffer = strip$(strBuffer)<br />
			buffer.len = len(strBuffer)<br />
		<br />
			while read.char &lt;&gt; &quot;;&quot; and y &lt;= buffer.len<br />
				read.char = strBuffer(y;1)<br />
				if read.char &lt;&gt; &quot;;&quot; then<br />
					tmp.field = tmp.field &amp; read.char<br />
				endif<br />
				y = y + 1<br />
			endwhile<br />
		<br />
			type = lval(format.row(format.row.type, x;format.row.type.len))<br />
			cdom = format.row(format.row.cdom, x;format.row.cdom.len)<br />
			cpac = format.row(format.row.cpac, x;format.row.cpac.len)<br />
<br />
			ret = xml.prep(tmp.field)<br />
<br />
			on case type<br />
		        case DB.BYTE:	<br />
				data.type = &quot;Number&quot;<br />
				cell.style = &quot;&quot;<br />
	                	break<br />
			case DB.DATE:<br />
				data.type = &quot;DateTime&quot;<br />
				cell.style = datum.style<br />
				format.date.for.excel(tmp.field, data.type, cell.style)<br />
				break<br />
			case DB.TIME:<br />
				data.type = &quot;DateTime&quot;<br />
				cell.style = time.style<br />
				format.time.for.excel(tmp.field, data.type, cell.style)<br />
				break<br />
			case DB.DOUBLE:<br />
				data.type = &quot;Number&quot;<br />
				cell.style = &quot;&quot;<br />
				break<br />
			case DB.ENUM:<br />
				cnst = lval(tmp.field)<br />
				if cnst &lt;&gt; 0 then<br />
					select	*<br />
					from	ttadv401<br />
					where	ttadv401._compnr = 000<br />
					and	ttadv401.cpac = :cpac<br />
					and	ttadv401.cdom = :cdom<br />
					and	ttadv401.cnst = :cnst<br />
					as set with 1 rows<br />
					selectdo<br />
						select	*<br />
						from	ttadv402<br />
						where	ttadv402._compnr = 000<br />
						and	ttadv402.clan = :lang<br />
						and	ttadv402.cpac = :ttadv401.cpac<br />
						and	ttadv402.cdom = :ttadv401.cdom<br />
						and	ttadv402.vers = :ttadv401.vers<br />
						and	ttadv402.rele = :ttadv401.rele<br />
						and	ttadv402.cust = :ttadv401.cust<br />
						and	ttadv402.ctnm = :ttadv401.ctnm<br />
						as set with 1 rows<br />
						selectdo<br />
							tmp.field = ttadv402.edes<br />
						selectempty<br />
							tmp.field = &quot;#&quot; &amp; ttadv401.ctnm<br />
						endselect<br />
					selectempty<br />
						tmp.field = &quot;##&quot; &amp; cpac &amp; &quot;.&quot; &amp; cdom &amp; &quot;.&quot; &amp; &quot;##&quot; &amp; tmp.field<br />
					endselect<br />
				else<br />
					tmp.field = &quot;&quot;<br />
				endif<br />
				data.type = &quot;String&quot;<br />
				cell.style = &quot;&quot;<br />
				break<br />
			case DB.FLOAT:<br />
				data.type = &quot;Number&quot;<br />
				cell.style = &quot;&quot;<br />
                		break<br />
			case DB.INTEGER:<br />
				data.type = &quot;Number&quot;<br />
				cell.style = &quot;&quot;<br />
	                	break<br />
			case DB.LONG:<br />
				data.type = &quot;Number&quot;<br />
				cell.style = &quot;&quot;<br />
				break<br />
			case DB.STRING:<br />
				data.type = &quot;String&quot;<br />
				cell.style = &quot;&quot;<br />
				break<br />
			case DB.MULTIBYTE:<br />
				data.type = &quot;String&quot;<br />
				cell.style = &quot;&quot;<br />
				break<br />
			default:<br />
				data.type = &quot;String&quot;<br />
				cell.style = &quot;&quot;<br />
			endcase<br />
<br />
			ret = seq.puts(&quot;    &lt;Cell&quot; &amp; cell.style &amp; &quot;&gt;&lt;Data ss:Type=&quot; &amp; &quot;&quot;&quot;&quot; &amp; strip$(data.type) &amp; &quot;&quot;&quot;&quot; &amp; &quot;&gt;&quot; &amp; strip$(tmp.field) &amp; &quot;&lt;/Data&gt;&lt;/Cell&gt;&quot;, fp)<br />
		endfor<br />
<br />
		ret = seq.puts(&quot;   &lt;/Row&gt;&quot;, fp)<br />
	else<br />
		ret = seq.puts(strBuffer, fp)<br />
	endif	<br />
}<br />
<br />
function void format.date.for.excel(ref string num.str, ref string type.str, ref string style.str)<br />
{<br />
	long	date.val<br />
<br />
	long	year<br />
	long	month<br />
	long	day<br />
<br />
	string	syear(4)<br />
	string	smonth(2)<br />
	string	sday(2)<br />
	<br />
	date.val = lval(num.str)<br />
	if date.val &lt; 693596 then<br />
		num.str = &quot;&quot;<br />
		type.str = &quot;String&quot;<br />
		style.str = &quot;&quot;<br />
	else<br />
		num.to.date(date.val, year, month, day)<br />
		syear = str$(year)<br />
		if month &lt; 10 then<br />
			smonth = &quot;0&quot; &amp; str$(month)<br />
		else<br />
			smonth = str$(month)<br />
		endif<br />
		if day &lt; 10 then<br />
			sday = &quot;0&quot; &amp; str$(day)<br />
		else<br />
			sday = str$(day)<br />
		endif<br />
		<br />
		num.str = syear &amp; &quot;-&quot; &amp; smonth &amp; &quot;-&quot; &amp; sday &amp; &quot;T00:00:00.000&quot;<br />
	endif<br />
}<br />
<br />
function void format.time.for.excel(ref string num.str, ref string type.str, ref string style.str)<br />
{<br />
	long	num.val<br />
	long	hrs<br />
	long	mins<br />
	long	secs<br />
<br />
	num.val = lval(num.str)<br />
<br />
	if num.val &lt; 1 then<br />
		num.str = &quot;&quot;<br />
		type.str = &quot;String&quot;<br />
		style.str = &quot;&quot;<br />
	else<br />
		secs = num.val \ 3600<br />
		mins = (num.val - secs) \ 60<br />
		hrs = (num.val - secs - (mins * 60)) / 60.0<br />
		num.str = &quot;1899-12-31T&quot; &amp; str$(hrs) &amp; &quot;:&quot; &amp; str$(mins) &amp; &quot;:&quot; &amp; str$(secs) &amp; &quot;.000&quot;<br />
	endif<br />
}<br />
function void build.expr()<br />
{<br />
	long	fld.type<br />
	string	fld.name(8)<br />
	long	x<br />
<br />
	expr = &quot;&quot;<br />
<br />
	for x = 1 to field.count<br />
		fld.name = format.row(format.row.name, x;format.row.name.len)<br />
		fld.type = lval(format.row(format.row.type, x;format.row.type.len))<br />
		add.field.to.row(fld.name, fld.type)<br />
	endfor<br />
	exp_id = expr.compile(expr)<br />
}<br />
<br />
function domain ttcdes get.field.desc(domain tclang language, domain ttadv.cpac package, domain ttadv.clab label)<br />
{<br />
	domain	ttcdes		cdes<br />
<br />
	select	ttadv140.desc<br />
	from	ttadv140<br />
	where	ttadv140._compnr = 000<br />
	and	ttadv140.clan = :language<br />
	and	ttadv140.cpac = :package<br />
	and	ttadv140.clab = :label<br />
	as set with 1 rows<br />
	selectdo<br />
		cdes = ttadv140.desc<br />
	endselect<br />
<br />
	| OR??<br />
	| ret = getlabel (lang, ttadv422.cpac, clab, leng, lhgt, vers, rele, cust)<br />
<br />
	return(strip$(cdes))<br />
}<br />
<br />
function long get.field.type(string table.name(8), string field.name(8))<br />
{<br />
	long		offset, size, dept, type, flag<br />
	string		domain_name(14), default_val<br />
	<br />
	ret = rdi.column(table.name &amp; &quot;.&quot; &amp; field.name, domain_name, offset, size, dept, type, flag, default_val)<br />
<br />
	return(type)<br />
}<br />
<br />
function add.field.to.row(domain ttadv.fdnm field, long type)<br />
{<br />
	string		action(24)<br />
	string		close.bracket(6)<br />
	<br />
	action = &quot;&quot;<br />
	close.bracket = &quot;)&quot;<br />
	on case type<br />
        case DB.BYTE:	<br />
		action = &quot;str(val(&quot;	|-<br />
		close.bracket = &quot;))&quot;<br />
                break<br />
	case DB.INTEGER:		|+<br />
		action = &quot;str(&quot;<br />
                break<br />
	case DB.LONG:			|+<br />
		action = &quot;str(&quot;<br />
		break<br />
	case DB.FLOAT:<br />
		action = &quot;str(&quot;<br />
                break<br />
	case DB.TIME:<br />
		action = &quot;str(&quot;<br />
		break<br />
	case DB.DOUBLE:			|+<br />
		action = &quot;str(&quot;<br />
		break<br />
	case DB.STRING:			|+<br />
		action = &quot;strip(&quot;<br />
		break<br />
	case DB.DATE:			|+<br />
		action = &quot;str(&quot;<br />
		break<br />
	case DB.TEXT:<br />
		action = &quot;str(&quot;<br />
		break<br />
	case DB.ENUM:			|+<br />
		action = &quot;str(&quot;<br />
		break<br />
	case DB.BITSET:<br />
		action = &quot;skip&quot;<br />
		break<br />
	case DB.COMBINED:<br />
		action = &quot;skip&quot;<br />
		break<br />
	case DB.MULTIBYTE:		|+<br />
		action = &quot;strip(&quot;<br />
		break<br />
	default:<br />
		action = &quot;skip&quot;<br />
	endcase<br />
	<br />
	if expr &lt;&gt; &quot;&quot; then<br />
		expr = expr &amp; &quot; &amp; &quot;&quot;;&quot;&quot; &amp; &quot;<br />
	endif<br />
<br />
	if strip$(action) &lt;&gt; &quot;skip&quot; then<br />
		expr = expr &amp; action &amp; sTABLE &amp; &quot;.&quot; &amp; strip$(field) &amp; close.bracket<br />
	else<br />
		|expr = expr &amp; &quot;&quot;&quot;;&quot;&quot;&quot;<br />
	endif<br />
}<br />
<br />
function void create.xml.header()<br />
{<br />
	ret = seq.puts(&quot;&lt;?xml version=&quot;&quot;1.0&quot;&quot;?&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;&lt;?mso-application progid=&quot;&quot;Excel.Sheet&quot;&quot;?&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;&lt;Workbook xmlns=&quot;&quot;urn:schemas-microsoft-com:office:spreadsheet&quot;&quot;&quot;, fp)<br />
	ret = seq.puts(&quot; xmlns:o=&quot;&quot;urn:schemas-microsoft-com:office:office&quot;&quot;&quot;, fp)<br />
	ret = seq.puts(&quot; xmlns:x=&quot;&quot;urn:schemas-microsoft-com:office:excel&quot;&quot;&quot;, fp)<br />
	ret = seq.puts(&quot; xmlns:ss=&quot;&quot;urn:schemas-microsoft-com:office:spreadsheet&quot;&quot;&quot;, fp)<br />
	ret = seq.puts(&quot; xmlns:html=&quot;&quot;http://www.w3.org/TR/REC-html40&quot;&quot;&gt;&quot;, fp)<br />
	ret = seq.puts(&quot; &lt;DocumentProperties xmlns=&quot;&quot;urn:schemas-microsoft-com:office:office&quot;&quot;&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;LastAuthor&gt;&quot; &amp; strip$(bdet.author) &amp; &quot;&lt;/LastAuthor&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;Created&gt;&quot; &amp; bdet.create.date &amp; &quot;&lt;/Created&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;LastSaved&gt;&quot; &amp; bdet.create.date &amp; &quot;&lt;/LastSaved&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;Version&gt;&quot; &amp; bdet.version &amp; &quot;&lt;/Version&gt;&quot;, fp)<br />
	ret = seq.puts(&quot; &lt;/DocumentProperties&gt;&quot;, fp)<br />
	ret = seq.puts(&quot; &lt;ExcelWorkbook xmlns=&quot;&quot;urn:schemas-microsoft-com:office:excel&quot;&quot;&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;WindowHeight&gt;12660&lt;/WindowHeight&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;WindowWidth&gt;19020&lt;/WindowWidth&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;WindowTopX&gt;120&lt;/WindowTopX&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;WindowTopY&gt;120&lt;/WindowTopY&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;ProtectStructure&gt;False&lt;/ProtectStructure&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;ProtectWindows&gt;False&lt;/ProtectWindows&gt;&quot;, fp)<br />
	ret = seq.puts(&quot; &lt;/ExcelWorkbook&gt;&quot;, fp)<br />
	ret = seq.puts(&quot; &lt;Styles&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;Style ss:ID=&quot;&quot;Default&quot;&quot; ss:Name=&quot;&quot;Normal&quot;&quot;&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Alignment ss:Vertical=&quot;&quot;Bottom&quot;&quot;/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Borders/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Font/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Interior/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;NumberFormat/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Protection/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;/Style&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;Style ss:ID=&quot;&quot;s21&quot;&quot;&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Font x:Family=&quot;&quot;Swiss&quot;&quot; ss:Bold=&quot;&quot;1&quot;&quot;/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;/Style&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;Style ss:ID=&quot;&quot;s22&quot;&quot;&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Font x:Family=&quot;&quot;Swiss&quot;&quot; ss:Bold=&quot;&quot;1&quot;&quot;/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;/Style&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;Style ss:ID=&quot;&quot;s23&quot;&quot;&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Font x:Family=&quot;&quot;Swiss&quot;&quot; ss:Bold=&quot;&quot;0&quot;&quot;/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;NumberFormat ss:Format=&quot;&quot;[$-413]dd\ mmm\ yyyy;@&quot;&quot;/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;/Style&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;Style ss:ID=&quot;&quot;s24&quot;&quot;&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Font x:Family=&quot;&quot;Swiss&quot;&quot; ss:Bold=&quot;&quot;0&quot;&quot;/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;NumberFormat ss:Format=&quot;&quot;Short Time&quot;&quot;/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;/Style&gt;&quot;, fp)<br />
	ret = seq.puts(&quot; &lt;/Styles&gt;&quot;, fp)<br />
	ret = seq.puts(&quot; &lt;Worksheet ss:Name=&quot;&quot;BDET - &quot; &amp; sTABLE &amp; &quot;&quot;&quot;&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;Table&gt;&quot;, fp)<br />
}<br />
<br />
function void create.xml.footer()<br />
{<br />
	ret = seq.puts(&quot;  &lt;/Table&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;WorksheetOptions xmlns=&quot;&quot;urn:schemas-microsoft-com:office:excel&quot;&quot;&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;PageSetup&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;    &lt;PageMargins x:Bottom=&quot;&quot;0.984251969&quot;&quot; x:Left=&quot;&quot;0.78740157499999996&quot;&quot;&quot;, fp)<br />
	ret = seq.puts(&quot;     x:Right=&quot;&quot;0.78740157499999996&quot;&quot; x:Top=&quot;&quot;0.984251969&quot;&quot;/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;/PageSetup&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Print&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;    &lt;ValidPrinterInfo/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;    &lt;PaperSizeIndex&gt;9&lt;/PaperSizeIndex&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;    &lt;HorizontalResolution&gt;600&lt;/HorizontalResolution&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;    &lt;VerticalResolution&gt;600&lt;/VerticalResolution&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;/Print&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Selected/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;FreezePanes/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;FrozenNoSplit/&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;SplitHorizontal&gt;1&lt;/SplitHorizontal&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;TopRowBottomPane&gt;2&lt;/TopRowBottomPane&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;ActivePane&gt;2&lt;/ActivePane&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;Panes&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;    &lt;Pane&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;     &lt;Number&gt;3&lt;/Number&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;     &lt;ActiveRow&gt;7&lt;/ActiveRow&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;     &lt;ActiveCol&gt;5&lt;/ActiveCol&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;    &lt;/Pane&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;/Panes&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;ProtectObjects&gt;False&lt;/ProtectObjects&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;   &lt;ProtectScenarios&gt;False&lt;/ProtectScenarios&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;  &lt;/WorksheetOptions&gt;&quot;, fp)<br />
	ret = seq.puts(&quot; &lt;/Worksheet&gt;&quot;, fp)<br />
	ret = seq.puts(&quot;&lt;/Workbook&gt;&quot;, fp)<br />
}<br />
<br />
function void set.status(long stat)<br />
{<br />
	on case stat<br />
	case 1:<br />
		status = status1<br />
		break<br />
	case 2:<br />
		status = status2<br />
		break<br />
	case 3:<br />
		status = status3<br />
		break<br />
	case 4:<br />
		status = status4<br />
		break<br />
	case 5:<br />
		status = status5<br />
		break<br />
	case 6:<br />
		status = status6<br />
		break<br />
	case 7:<br />
		status = status7<br />
		break<br />
	case 8:<br />
		status = status8<br />
		break<br />
	case 9:<br />
		status = status9<br />
		break<br />
	endcase<br />
<br />
	refresh()<br />
	display.all()<br />
}<br />
<br />
<br />
function void set.error.messages()<br />
{<br />
	on case lval(lang)<br />
	case 1:<br />
		error1 = &quot;Onjuiste query gegenereerd door BDET&quot;<br />
		error2 = &quot;Error %d heeft zich voorgedaan bij het uitvoeren van de query: %s&quot;<br />
		error3 = &quot;Fout %d bij verzamelen tabelgegevens.&quot;<br />
		error4 = &quot;Geen VRK data in %s voor pakket %s, volgnr %d. Tabel bestaat niet.&quot;<br />
		error5 = &quot;Tabel heeft meer records dan Excel kan verwerken.&quot;<br />
		error6 = &quot;De query '%s' gaf geen records terug.&quot;<br />
		error7 = &quot;Invoer niet juist: '%s'&quot;<br />
		error8 = &quot;Index %s heeft een numerieke waarde nodig.&quot;<br />
		error9 = &quot;Index %s kan niet worden verwerkt door BDET.&quot;<br />
		error10= &quot;Tabel %s bestaat niet in het huidige bedrijf.&quot;<br />
		break<br />
	default:<br />
		error1 = &quot;BDET generated illegal query&quot;<br />
		error2 = &quot;Error %d occurred during execution of query: %s&quot;<br />
		error3 = &quot;Error %d collecting table data.&quot;<br />
		error4 = &quot;No VRC data in %s for package %s, sequence %d. Table does not exist.&quot;<br />
		error5 = &quot;Number of records in table exceed Excel limitation.&quot;<br />
		error6 = &quot;The query '%s' did not return any records.&quot;<br />
		error7 = &quot;Input not valid: '%s'&quot;<br />
		error8 = &quot;Index %s requires a numeric value.&quot;<br />
		error9 = &quot;BDET can not parse index %s.&quot;<br />
		error10= &quot;Table %s does not exist in the current company.&quot;<br />
		break<br />
	endcase<br />
}<br />
<br />
function void set.status.messages()<br />
{<br />
	on case lval(lang)<br />
	case 1:<br />
		status1 = &quot;Initialiseren&quot;<br />
		status2 = &quot;&quot;<br />
		status3 = &quot;Tabelgegevens verzamelen&quot;<br />
		status4 = &quot;Kopgegevens aanmaken&quot;<br />
		status5 = &quot;Regels verwerken&quot;<br />
		status6 = &quot;Voetregel aanmaken&quot;<br />
		status7 = &quot;&quot;<br />
		status8 = &quot;Programma afsluiten&quot;<br />
		status9 = &quot;Gereed&quot;<br />
		break<br />
	default:<br />
		status1 = &quot;Initialising&quot;<br />
		status2 = &quot;&quot;<br />
		status3 = &quot;Collecting table data&quot;<br />
		status4 = &quot;Creating header&quot;<br />
		status5 = &quot;Processing lines&quot;<br />
		status6 = &quot;Creating footer&quot;<br />
		status7 = &quot;&quot;<br />
		status8 = &quot;Closing application&quot;<br />
		status9 = &quot;Ready&quot;<br />
		break<br />
	endcase<br />
}<br />
<br />
function long xml.prep(ref string inp.string)<br />
{<br />
	long x, result, a<br />
	string	outp.string(255)<br />
	string	c<br />
	<br />
	result = 0<br />
	outp.string = &quot;&quot;<br />
<br />
	for x = 1 to len(inp.string)<br />
		c = inp.string(x; 1)<br />
		a = asc(c)<br />
		if a &lt;&gt; 32 and (a &lt; 39 or (a &gt; 57 and a &lt; 65) or a &gt; 122) then<br />
			outp.string = outp.string &amp; &quot;&amp;#&quot; &amp; str$(a) &amp; &quot;;&quot;<br />
			result = x<br />
		else<br />
			outp.string = outp.string &amp; c<br />
		endif<br />
	endfor<br />
	inp.string = strip$(outp.string)<br />
	return(result)<br />
}<br />
<br />
function long load.indexes()<br />
{<br />
	long	rv	| return value<br />
	long	x, y<br />
	<br />
	domain	ttadv.clab	clab<br />
<br />
	string	field.name.t(15)<br />
	string	field.name.f(15)<br />
<br />
	rv = 0<br />
<br />
	for x = 1 to 11<br />
		form.index(1,x) = &quot;&quot;<br />
		value.f(1,x) = &quot;&quot;<br />
		value.t(1,x) = &quot;&quot;<br />
		index.active(x) = ttyeno.no<br />
	endfor<br />
	<br />
	select	*<br />
	from	ttadv421<br />
	where	ttadv421._compnr = 000<br />
	and	ttadv421.cpac = :cpac.f<br />
	and	ttadv421.cmod = :cmod.f<br />
	and	ttadv421.flno = :flno.f<br />
	and	ttadv421.vers = :version<br />
	and	ttadv421.rele = :release<br />
	and	ttadv421.cust = :customer<br />
	and	ttadv421.acti = ttyeno.yes<br />
	order by ttadv421.indn<br />
	selectdo<br />
		rv = 1<br />
		| Add index fields to index array on form<br />
		for x = 1 to 24<br />
			if strip$(ttadv421.part(1, x)) &lt;&gt; &quot;&quot; and ttadv421.part(1,x;3) &lt;&gt; &quot;c00&quot; and ttadv421.part(1,x;3) &lt;&gt; &quot;cmb&quot; then<br />
				for y = 1 to 11<br />
					if form.index(1, y) = ttadv421.part(1, x) then<br />
						y = 12<br />
					else<br />
						if strip$(form.index(1, y)) = &quot;&quot; then<br />
							form.index(1, y) = ttadv421.part(1, x)<br />
							clab = get.label(form.index(1, y))<br />
							form.desc(1, y) = get.field.desc(lang, cpac.f, clab)<br />
							form.type(y) = get.field.type(cpac.f &amp; cmod.f &amp; flno.f, ttadv421.part(1, x))<br />
							y = 12<br />
						endif<br />
					endif<br />
				endfor<br />
			else<br />
				x = 25<br />
			endif<br />
		endfor<br />
	selectempty<br />
		| No index found for this table (or table does not exist)<br />
		rv = -1<br />
	selecteos<br />
	endselect<br />
<br />
	for x = 1 to 11<br />
		field.name.f = &quot;value.f(&quot; &amp; str$(x) &amp; &quot;)&quot;<br />
		field.name.t = &quot;value.t(&quot; &amp; str$(x) &amp; &quot;)&quot;<br />
		if strip$(form.index(1, x)) &lt;&gt; &quot;&quot; then<br />
			form.from(1,x) = &quot;From&quot;<br />
			inputfield.visible(field.name.f)<br />
			form.to(1, x) = &quot;To&quot;<br />
			inputfield.visible(field.name.t)<br />
		else<br />
			form.from(1,x) = &quot;&quot;<br />
			inputfield.invisible(field.name.f)<br />
			form.to(1, x) = &quot;&quot;<br />
			inputfield.invisible(field.name.t)<br />
		endif			<br />
	endfor<br />
<br />
	refresh()<br />
	display.all()<br />
<br />
	return(rv)<br />
}<br />
<br />
function domain ttadv.clab get.label(domain ttadv.fdnm field.name)<br />
{<br />
	domain ttadv.clab rv<br />
<br />
	select	*<br />
	from	ttadv422<br />
	where	ttadv422._compnr = 000<br />
	and	ttadv422.cpac = :cpac.f<br />
	and	ttadv422.cmod = :cmod.f<br />
	and	ttadv422.flno = :flno.f<br />
	and	ttadv422.vers = :version<br />
	and	ttadv422.rele = :release<br />
	and	ttadv422.cust = :customer<br />
	and	ttadv422.fdnm = :field.name<br />
	selectdo<br />
		if strip$(ttadv422.clab) &lt;&gt; &quot;&quot; then<br />
			rv = ttadv422.clab<br />
		else<br />
			rv = cpac.f &amp; cmod.f &amp; ttadv422.flno &amp; &quot;.&quot; &amp; ttadv422.fdnm<br />
		endif<br />
	selectempty<br />
		rv = &quot;&quot;<br />
	endselect<br />
 <br />
	return(rv)<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Francesco</div><div class="date">10th October 2007, 09:34</div></div><div class="posttext">While I'm at it:<br />
<br />
Export tabel = Export table (bet you didn't see that one coming)<br />
Conversie naar Excel XML formaat = Conversion to Excel XML format(1)<br />
Maximaal aantal export regels = Maximum number of export lines (2)<br />
Tijdvermelding op bestandsnaam = Time stamp on file name (3)<br />
<br />
Veld = Field<br />
Omschrijving = Description<br />
Criteria = ...<br />
<br />
So much for Dutch 1.01. Baan traditionals can change the English any way they like as long as it's no longer comprehensible ;)<br />
<br />
(1) Uncheck this box to get a regular fast-n-dirty ASCII dump<br />
(2) large tables can take a few minutes to process. This is the preview button<br />
(3) The temporary file on the client's computer will be re-used every time to save on the clutter. Adding a unique time-stamp allows exports to be re-used or to do multiple exports without having to close excel each time (file in use)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">11th October 2007, 00:06</div></div><div class="posttext">Thanks for the tool and the language lesson. :)  I just used the script to rebuild the forms in english.  I just tested on small sets.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">steventay</div><div class="date">31st October 2007, 17:13</div></div><div class="posttext">can post the english copy.. how do i import in...? i am new in baan..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">31st October 2007, 19:44</div></div><div class="posttext">Actually if I was you - I would just create a session and then copy the script into the new session.  Then from the form picture and the script you can create your own form.  The script was the important piece.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">suhas-mahajan</div><div class="date">14th November 2007, 13:02</div></div><div class="posttext">Hi Francesco,<br />
<br />
Thanks for useful gift. <br />
<br />
I am curious to know, how form two fields will be activated.<br />
<br />
Please help.<br />
<br />
regards,<br />
<br />
-Suhas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">14th November 2007, 15:27</div></div><div class="posttext">When you click on form2 it does the load.indexes routine.  This will load the form 2 fields.  On form 2 you should have fields set up as arrays - like the attached (keep in mind I have added a few things).  Hope I answered your question.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dthomson</div><div class="date">21st November 2007, 17:32</div></div><div class="posttext">Nice work, thanks for this. So far it has worked on all the table that I have tried.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shah_bs</div><div class="date">24th July 2008, 21:34</div></div><div class="posttext">This is wonderful.<br />
<br />
Francesco: I have a request - where did you find all the documentation related to creating the XML output for EXCEL - is this in a textbook I can buy? Or is it all 'get your hands dirty' type of experience?<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manojsharma</div><div class="date">29th July 2008, 10:55</div></div><div class="posttext">Hi <br />
<br />
Nice utility but my question is what abt big tables like tfgld418 etc. which have millions of records</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">29th July 2008, 16:36</div></div><div class="posttext">I believe the program limits the number of rows exported to the excel limit(65536).  On my version as you typed in the index values to extract it displayed the number of rows that would be exported - but it still limited you to 65536.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">en@frrom</div><div class="date">29th August 2008, 12:26</div></div><div class="posttext">Francesco,<br />
<br />
Nice work! I created my &quot;own version&quot; based on your code, along with some adjustments/optimalizations. Still want to optimize it a bit, for instance allowing zoom on the selection fields, counting number of records to be selected on the fly, allowing entering local patch on form, etc. <br />
<br />
It works fine, only thing is: when I export from any table only a few records, everything goes fine, but as soon as the selection is a bit larger, I get the error 'Problems During Load - Table' when Excel tries to open the file. It seems related to the amount of charachters in the file, rather than the number of records exported. In other words if each record contains only 1 field, it works fine upto approx. 500 records, yet if each record contains 40 fields, it will work fine only for approx. 5 records...<br />
<br />
Anyone an idea what causes this? It must be some Excel-XML tagging that goes wrong...<br />
<br />
Thanks in advance!<br />
<br />
<br />
Regards,<br />
Eli Nager</div></div><hr />


<div class="post"><div class="posttop"><div class="username">en@frrom</div><div class="date">18th September 2008, 11:01</div></div><div class="posttext">I see nobody &quot;bit&quot; yet on my question in my previous post (error 'problems during load - table' when Excel tries to open the file...), and I didn't yet have the time to look for the solution. <br />
<br />
I optimized the session a bit more here and there, for instance enabling it to work for Tools tables, fixed some beauty issues, etc. My next planned optimization is to enable selecting on dates, both num and utc, and enums. Both are now only possible by entering the numeric value, which isn't very practical... Also zooming from selection fields would be great, and in general I would love to have the dynamic selection fields on the form assigned with the correct domain attributes like field length, input length, alligning, etc. <br />
<br />
In other words, when entering a selection of areas, which is a string of 3 positions, I want the field to show 3 positions and also allow only three, activate the zoom on areas. When entering a Tools Patch which is a right aligned string, I want the input to be right aligned as well. When entering an enum, it would be great to be able to select the desired from-to values from an enum drop down list (although I doubt if this is possible), and when selecting a date, the field should behave like a date field, i.e. allowing to enter '01092008' or 01 for first day of month or '+10' for +10 days, etc. Also the zoom to the BaaN calendar will be active...<br />
<br />
After my next 'bored' night, I will let you know what I achieved...<br />
<br />
<br />
Regards,<br />
En</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NPRao</div><div class="date">18th September 2008, 21:36</div></div><div class="posttext">En,<br />
<br />
I am working on my version which is more in a DLL mode to simplify for our usage and to make it generic. I faced similar issues when the Excel program could not open the file and found it to be usually tag issues.<br />
<br />
I am referring to the links -<br />
<br />
Microsoft Office XML formats (http://en.wikipedia.org/wiki/Microsoft_Office_XML_formats)<br />
<br />
Save to SpreadsheetML and Extracting Data (http://www.brainbell.com/tutorials/ms-office/excel/Save_To_SpreadsheetML_And_Extracting_Data.htm)<br />
<br />
MS has extensive documentation @ Microsoft Office File Formats Documentation (http://go.microsoft.com/fwlink/?LinkId=119249)<br />
<br />
Francesco's program is good but works for table based data and I like to make a generic one so one can generate Excel based spreadsheets/reports or use with a dynamic query on a table like his program.<br />
<br />
My version to create Excel sheet requires only 3-4 calls -<br />
fp = seq.open(fname, &quot;w&quot;)<br />
...<br />
create.xml.header(fp, &quot;NP_Test&quot;)<br />
|write.header.row(fp, col.names)<br />
write.row(fp, col.names, data.types, styleids)<br />
...<br />
write.row(fp, col.values, data.types, styleids2, 3, 5)<br />
create.xml.footer(fp)<br />
e = seq.close(fp)<br />
view.with.excel(fname)<br />
In other words, when entering a selection of areas, which is a string of 3 positions, I want the field to show 3 positions and also allow only three, activate the zoom on areas.<br />
You can use some of the predefined variables to achieve this -<br />
string attr.adju(1) 4 &quot;l&quot; align left, &quot;r&quot; align right, &quot;c&quot; align center <br />
string attr.conv(1) 4 &quot;u&quot; convert to upper case, &quot;l&quot; convert to lower case <br />
long attr.dbmaxlen 4R Maximum length of database field. <br />
long attr.imax 4R Maximum input length. <br />
long attr.maxlen 4R Maximum display length of current field. <br />
long attr.minlen 4 Minimum length of current field. <br />
or the rdi* and tt.align.according.domain() functions etc.<br />
<br />
Instead of using the static session, you might be better off creating your windows screen using low level functions create.object() so can you have more control on field creations on the fly based on datatype. The latest tools have the new functions - Programmable dialogs (http://www.baanboard.com/programmers_manual_baanerp_help_functions_programmable_dialogs_synopsis) which can simplify it.<br />
it would be great to be able to select the desired from-to values from an enum drop down list (although I doubt if this is possible)<br />
You can use - set.list.values.for.field() (http://www.baanboard.com/programmers_manual_baanerp_help_functions_form_and_form_field_operations_set_list_values_for_field)<br />
when selecting a date, the field should behave like a date field, i.e. allowing to enter '01092008' or 01 for first day of month or '+10' for +10 days, etc. Also the zoom to the BaaN calendar will be active...<br />
Refer to the links - <br />
<br />
Use of session ttstpcalendar (http://www.baanboard.com/baanboard/showthread.php?t=5329&amp;highlight=ttstpcalendar)<br />
<br />
Return Field for Calendar (http://www.baanboard.com/baanboard/showthread.php?t=9778&amp;highlight=WTHANG)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Hitesh Shah</div><div class="date">22nd September 2008, 18:49</div></div><div class="posttext">I optimized the session a bit more here and there, for instance enabling it to work for Tools tables, fixed some beauty issues, etc. My next planned optimization is to enable selecting on dates, both num and utc, and enums. Both are now only possible by entering the numeric value, which isn't very practical... Also zooming from selection fields would be great, and in general I would love to have the dynamic selection fields on the form assigned with the correct domain attributes like field length, input length, alligning, etc. <br />
<br />
In other words, when entering a selection of areas, which is a string of 3 positions, I want the field to show 3 positions and also allow only three, activate the zoom on areas. When entering a Tools Patch which is a right aligned string, I want the input to be right aligned as well. When entering an enum, it would be great to be able to select the desired from-to values from an enum drop down list (although I doubt if this is possible), and when selecting a date, the field should behave like a date field, i.e. allowing to enter '01092008' or 01 for first day of month or '+10' for +10 days, etc. Also the zoom to the BaaN calendar will be active...<br />
<br />
After my next 'bored' night, I will let you know what I achieved...<br />
<br />
<br />
Regards,<br />
En<br />
<br />
If u dont have time develop something on ur own and wish to use something readily available and done by others, our baan2excel  project on sourceforge.net already has all these (dates , enum/set  , domain specific zooms , user defined finctions ,case conversions , field alignment.domain range validations , legal / illegal characters etc ). The reference programme for this is  pdll91420 . <br />
<br />
Our ERPJewels is completely separate set of programs in tu module with all new tables , domains  , labels in tu module only  (which one can import in customized VRC ) and further it has very good integration with any baan report. So u can provide XL sheets on the fly from any report , authorize  it to any user and it's  there in the repositiory for use in future. <br />
<br />
There is good online help for the same also .<br />
<br />
Though this tool works with ascii files , but can very well be adopted for xml structures .</div></div><hr />


<div class="post"><div class="posttop"><div class="username">en@frrom</div><div class="date">23rd September 2008, 09:43</div></div><div class="posttext">Heya Hitesh,<br />
<br />
Thanks for your offer. I am sure your tools are jewels indeed, however I find it much more fun to play around with it on my own than getting a ready made tool... :) And since this is no high priority requirement but rather a nice-to-have optimizer, I am not so bothered by my current lack of time...<br />
<br />
Thanks again and good luck!<br />
En</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Hitesh Shah</div><div class="date">23rd September 2008, 19:16</div></div><div class="posttext">Hi En , <br />
<br />
Thanks for the reply. <br />
<br />
Being developer myself I know the joys of developent by self and hence can very well understand and appreciate ur preferences. Goodluck to u in these endevors .</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NPRao</div><div class="date">4th November 2008, 03:56</div></div><div class="posttext">I believe the program limits the number of rows exported to the excel limit(65536). On my version as you typed in the index values to extract it displayed the number of rows that would be exported - but it still limited you to 65536.<br />
Mark,<br />
<br />
I found a neat solution on the site: Exporting Data into Excel in Multiple Worksheets (http://www.codeproject.com/KB/aspnet/Export_to_Excel.aspx?fid=401377&amp;df=90&amp;mpp=25&amp;noise=3&amp;sort=Position&amp;view=Quick&amp;select=2764013#xx2764013xx) to keep a counter to keep track of the number of rows and when it hits the limit close the current worksheet and start with the next one. <br />
foreach (DataRow x in source.Tables[0].Rows){<br />
rowCount++;<br />
//if the number of rows is &gt; 63000 create a new page to continue output<br />
if (rowCount == 63000){<br />
<br />
rowCount = 0;<br />
sheetCount++;<br />
excelDoc.Write(&quot;&lt;/Table&gt;&quot;);<br />
excelDoc.Write(&quot; &lt;/Worksheet&gt;&quot;);<br />
excelDoc.Write(&quot;&lt;Worksheet ss:Name=\&quot;Report_Sheet&quot; + sheetCount + &quot;\&quot;&gt;&quot;);<br />
excelDoc.Write(&quot;&lt;Table&gt;&quot;);<br />
excelDoc.Write(&quot;&lt;Row&gt;&quot;);</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mpchheda</div><div class="date">23rd March 2010, 13:15</div></div><div class="posttext">I have imported and installed the session. It is working fine. <br />
But while opening excel, i am getting error - file (tablename.xls) not found in c:\tmp. Please check the file name.<br />
Our baan BSE is - D:\baan and tmp is D:\baan\tmp<br />
<br />
can anybody guide me to configure the correct output path in script ?<br />
Regards,<br />
Manish</div></div><hr />


<div class="post"><div class="posttop"><div class="username">en@frrom</div><div class="date">2nd February 2011, 16:51</div></div><div class="posttext">Hey all,<br />
<br />
Whoever (still) uses this session, I have a nice new challenge: make this session compatible for running in job mode. With the current code this session can no way run in job. I would love to make this session available fro job.process. It will then not offer selection ranges, but will dump the entire table. <br />
<br />
Due to lack of time I cannot do it myself, but would be greatful if someone would find it helpful as well, and would invest in it...<br />
<br />
Best regards,<br />
Eli Nager</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Hitesh Shah</div><div class="date">3rd February 2011, 18:35</div></div><div class="posttext">We already have program which can very well take xl exports in job mode (even considering/changing selection parameters intelligently like changing from to period dates , fiscal  period based on system date etc)  . So I basically dont need  &amp; know this program.<br />
<br />
However based on our experience many years back I c only one challenge i see in job mode is that a program can not be zoomed or  activated . We had solved this problem will converting the session functionality to  dll  and that had resolved the problem permanently. <br />
<br />
Also  if  baan enums and dates are ok to u in tools export format , plain tools export (ttaad4226m000 ) with comma separator followed by batch script to rename the .S file to .csv can very well serve a purpose.<br />
<br />
May be this help you or any volunteer to solve this challenge.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">en@frrom</div><div class="date">3rd February 2011, 18:48</div></div><div class="posttext">Hitesh Thanks for your response. I have meanwhile adjusted the session last night to make it job compatible. I couldn't resist... :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Esther</div><div class="date">2nd September 2011, 15:00</div></div><div class="posttext">I know it's an old thread, but i have to say that i've been adapting this session and i'm very impressed with it's working. It's very very useful.<br />
<br />
Thanks for your work Francesco :)</div></div><hr />



</div>
</body>
</html>