<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="AFS - problem running session in a job, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] AFS - problem running session in a job AFS/DDC/OLE: Function servers" />
	
	<title>AFS - problem running session in a job [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="index.html">Newbaanboard</a> &gt; <a href="index.html">Baan SIGs</a> &gt; <a href="index.html">AFS/DDC/OLE: Function servers</a> &gt; AFS - problem running session in a job</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">aobrien</div><div class="date">2nd September 2003, 20:36</div></div><div class="posttext">Hello,<br />
     I'm trying to run a  session in a baan job, and am receiving errors.  I am using AFS to execute an item transfer - the item transfer session is a custom session.  Here's my problem:  I am executing the following code in order to transfer material for an  item from one warehouse to another:<br />
<br />
string error(500)<br />
<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;transfer.item.segment.1&quot;, transfer.item(1; 9) )<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;transfer.item.segment.2&quot;, transfer.item(10; 38) )<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;cwar.f&quot;, cwar.f )<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;item.cuni&quot;, item.cuni )<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;loca.f&quot;, loca.f )<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;clot&quot;, clot )<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;order.quan&quot;, str$(order.quan) )	<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;initial&quot;, &quot;AFS&quot; )<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;receive.item.segment.1&quot;, receive.item(1; 9) )	<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;receive.item.segment.2&quot;, receive.item(10; 38) )<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;cwar.t&quot;, cwar.t )<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;loca.t&quot;, loca.t )<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;trans.order.type&quot;, &quot;ICT&quot; )<br />
stpapi.put.field( &quot;whinhp202m200&quot;, &quot;proc.trans.order&quot;, str$(etol(tcyesno.yes)) )<br />
<br />
stpapi.form.command( &quot;whinhp202m200&quot;, 5, &quot;exec.cont.process&quot;, error )<br />
<br />
stpapi.end.session( &quot;whinhp202m200&quot; , error  )     <br />
<br />
<br />
If I run this session manually, the material transfers correctly.  If I run this session through a BaaN job, I receive the error &quot;Item not allowed.&quot;  This sounds like an error that is generated when the fields on the screen are not correctly populated (perhaps the field buffer is losing values).  <br />
<br />
I can't figure out what the difference is between running this session manually, and running it as a job.  <br />
<br />
Any help would be greatly appreciated!<br />
<br />
Thanks,<br />
Amy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gfasbender</div><div class="date">2nd September 2003, 21:26</div></div><div class="posttext">What happens when yo run session whinhp202m200 in a job?<br />
<br />
And if it's a customized session, why not compile it in debug mode and trace through the code?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aobrien</div><div class="date">2nd September 2003, 22:05</div></div><div class="posttext">If I run session, whinhp202m200 in a job, it runs correctly.<br />
<br />
I have activated the job myself and run the job in debug.  When I activate the job myself, it runs correctly.  When I allow the job daemon to kick off the job, I receive errors for the transfer.  Is it possible to view code in debug when the job daemon kicks off the job?<br />
<br />
Amy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">2nd September 2003, 23:12</div></div><div class="posttext">I am by no means an expert on Job Daemon, but are all the environment variables set correctly for the job itself?  Are there any defaults or permissions you may have that the job daemon does not have?  Just some guesses.  This may just be a setup issue.  <br />
<br />
Mark</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aobrien</div><div class="date">9th September 2003, 23:32</div></div><div class="posttext">I worked through the environment variables with someone else in my company and everything appears to be fine.  We did find some solutions on the baan website that may apply to this problem, and service pack 15 will have to be installed.  For right now, I am running the script from a visual basic program, and everything is working well.<br />
<br />
Thanks,<br />
Amy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">9th September 2003, 23:47</div></div><div class="posttext">Please return and let us know if you find a solution for future reference.<br />
<br />
Thanks and good luck.<br />
<br />
Mark</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Paul P</div><div class="date">16th September 2003, 07:04</div></div><div class="posttext">Dear Amy,<br />
<br />
We did massive barcode integration to our client's 5c environment using AFS, including purchasing, production, and sales activities. All the AFS integration sessions are periodically run using job daemon. We didn't run into any problem using the AFS sessions under job daemon. Basically in our case, if it runs outside job daemon, it also runs inside job daemon.<br />
<br />
It's a bit hard for me to diagnose your case since you are trying to control a customised session through AFS :(<br />
<br />
Rgds,<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sujoy.sen</div><div class="date">16th September 2003, 15:58</div></div><div class="posttext">Paul,<br />
<br />
It is possible that some of these problems are resolved in 5c. In version 5b SP13, there does seem to be a problem. The following excerpt of code based on a standard Baan session runs into the same problem reported by Amy:<br />
<br />
<br />
current.date = utc.num()<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.item.segment.1&quot;, item(1; 9))<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.item.segment.2&quot;, item(10; 38))<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.stun&quot;, stun)<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.vstr&quot;, str$(net.chg.qty))<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.cdat&quot;, str$(current.date))<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.recd&quot;, recd)<br />
ret1 = stpapi.insert(&quot;whinh5501m000&quot;, true, error_msg1)<br />
if not ret1 then<br />
   handle.error(time, tisfc.spectyp.palletizer, &quot;whinh5101s00x&quot;, error_msg1)<br />
   ret2 = stpapi.recover(&quot;whinh5101s000&quot;, error_msg2)<br />
endif<br />
return(ret1)<br />
<br />
<br />
Here again, the code works fine when run manually and even when the job is activated manually but when queued and run through a job daemon (or cron) the above section of code fails. By that, I mean the buffered field values from the stpapi.put.field() calls are lost and the stpapi.insert() call returns a failure code (ret1 above). The error message indicates the loss of the buffered field values. <br />
<br />
The consistent pattern seems to be a call to stpapi.insert() or stpapi.form.command() directly after a series of stpapi.put.field() calls. Other programs using AFS but not exhibiting this particular pattern work fine when run by a job daemon. Available information on the Baan Support site seems to indicate that this problem may be solved in SP15 on 5b. It'll probably be a few months before we get to SP15. In the mean time, we have also logged a case with Baan to see if they have any answers for us.<br />
<br />
Thanks,<br />
Sujoy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NvanBeest</div><div class="date">16th September 2003, 16:07</div></div><div class="posttext">Hi Sujoy<br />
<br />
Have you tried to fool the system yet?  Replace the code with the following, and see what it gives you.  It worked for me in BaanIV.  Maybe also works in ERP...<br />
<br />
<br />
current.date = utc.num()<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.item.segment.1&quot;, item(1; 9))<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.item.segment.2&quot;, item(10; 38))<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.stun&quot;, stun)<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.vstr&quot;, str$(net.chg.qty))<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.cdat&quot;, str$(current.date))<br />
stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.recd&quot;, recd)<br />
ret1 = stpapi.insert(&quot;whinh5501m000&quot;, false, error_msg1) | Don't save yet...<br />
if not ret1 then<br />
   handle.error(time, tisfc.spectyp.palletizer, &quot;whinh5101s00x&quot;, error_msg1)<br />
   ret2 = stpapi.recover(&quot;whinh5101s000&quot;, error_msg2)<br />
else<br />
   | Re-enter the field values<br />
   stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.item.segment.1&quot;, item(1; 9))<br />
   stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.item.segment.2&quot;, item(10; 38))<br />
   stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.stun&quot;, stun)<br />
   stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.vstr&quot;, str$(net.chg.qty))<br />
   stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.cdat&quot;, str$(current.date))<br />
   stpapi.put.field(&quot;whinh5101s000&quot;, &quot;whinh501.recd&quot;, recd)<br />
   ret1 = stpapi.save(&quot;whinh5501m000&quot;, error_msg1) | Now try to save...<br />
   if not ret1 then<br />
      handle.error(time, tisfc.spectyp.palletizer, &quot;whinh5101s00x&quot;, error_msg1)<br />
      ret2 = stpapi.recover(&quot;whinh5101s000&quot;, error_msg2)<br />
   endif<br />
endif<br />
return(ret1)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sujoy.sen</div><div class="date">16th September 2003, 18:55</div></div><div class="posttext">Nico,<br />
<br />
Thanks for your suggestion. I tried it out. As before, the code works fine when run manually and even when the job is activated manually. However, previously the job would terminate successfully and our internal error log would get updated with the error message generated, but with these latest changes, the job goes into perpetual status of &quot;Running&quot; and doesn't come out of it on its own (I had to Cancel the job). So it looks like there is something else going on, but things still aren't working quite right. <br />
<br />
Thanks again for your help.<br />
Sujoy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NvanBeest</div><div class="date">16th September 2003, 19:03</div></div><div class="posttext">Thanks again for your help :( It seems that I only helped in a negative way!  Sorry!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sujoy.sen</div><div class="date">16th September 2003, 20:09</div></div><div class="posttext">I already have my application working through an OLE call from VB, but I wanted to see if there was a way to do this through a Baan Job, just in case I ran into problems with OLE and needed a backup solution. So it was time well spent to try out your suggestion.<br />
Thanks,<br />
Sujoy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vahdani</div><div class="date">16th September 2003, 20:36</div></div><div class="posttext">Hello Amy,<br />
<br />
you have not included you full source code. From my experience the major reason why sessions fail to function when run as job is the following: The code in form sections (init.form, before.form,..) of the script are not executed when the session is run as job. please check your code.<br />
<br />
Toni</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lsiyengar</div><div class="date">5th February 2004, 21:27</div></div><div class="posttext">I have a similar problem but with the session to convert non lot item to lot controlled items.<br />
I logged a case with Baan support and they have aggreed that it is a bug and they will fix it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prasad_m_p</div><div class="date">2nd April 2004, 10:14</div></div><div class="posttext">Hi,<br />
<br />
We had faced similar problem while using AFS, it turned out to be problem of start option of the session. when session was started there was no default record on the form so it was giving similar error message &quot;Item not allowed&quot; when we used stpapi.put.field<br />
<br />
Can you try to change start option OR best will be execute first.set and then perform your operations. <br />
<br />
May be this will solve the problem.<br />
<br />
Prasad.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aobrien</div><div class="date">2nd April 2004, 15:51</div></div><div class="posttext">Thanks to everyone for your suggestions.  Service packs 14 and 15 were recently installed into our test company (For version B50B).  I tested running this session through a BaaN job, and it is working correctly now.  <br />
<br />
Amy</div></div><hr />



</div>
</body>
</html>