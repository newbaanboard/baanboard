<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="Audit file structure, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] Audit file structure Tools Development" />
	
	<title>Audit file structure [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="../index.html">Newbaanboard</a> &gt; <a href="../index.html">Baan Quick Support: Functional &amp; Technical</a> &gt; <a href="../index.html">Tools Development</a> &gt; Audit file structure</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">baan_user</div><div class="date">27th April 2007, 13:54</div></div><div class="posttext">I need to read the audit files on the server generated by turning auditing on certain tables. We do not have development licence.<br />
<br />
Is it possible to read the generated audit files from C / C++ or SQL Server.<br />
<br />
I need to understand the structure of these files, so that I can read them and use them to generate our own reports.<br />
<br />
Thanks for all your help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mr_suleyman</div><div class="date">27th April 2007, 14:33</div></div><div class="posttext">There are lot's of thread about Audit file .Use search option on board.<br />
<br />
<br />
G.Luck !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">baan_user</div><div class="date">30th April 2007, 12:39</div></div><div class="posttext">Dear Sir,<br />
<br />
I have searched the whole forum for audit file / audit file structure / audit / audit sql server etc. and went through all the links which came up. Then I searched support.baan.com (useless), google etc and came up with no useful information that I am looking for.<br />
<br />
Again if anyone knows the file structures of audit files and how they can be read from C / c# / SQL Server or anything outside baan 4gl, it will be a great help.<br />
<br />
I have used tools to search for strings in tools objects like ottaad4160, ottaad4460, but this does not come up with any useful information.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Marioth</div><div class="date">30th April 2007, 14:16</div></div><div class="posttext">Try to run the session with option &quot;Run programm&quot; the session is ttaad4461m000</div></div><hr />


<div class="post"><div class="posttop"><div class="username">norwim</div><div class="date">30th April 2007, 16:09</div></div><div class="posttext">Hi there,<br />
<br />
as I have no Baan system at hand atm, I can only guess that the session mentioned above is the correct one, extracting the audit information from the seq. files they have been written to.<br />
I wouldn't bother and try decrypting these files, any information kept there is compressed to a large degree and I never came across any information about the audit file structure.<br />
Instead I would create a job calling the Baan session that prints out the audit information, call this job periodically and eventually write a small script that processes this output to give you the information needed in a shorter overview.<br />
For this you don't need a development licence.<br />
<br />
hth<br />
<br />
Norbert</div></div><hr />


<div class="post"><div class="posttop"><div class="username">baan_user</div><div class="date">3rd May 2007, 12:59</div></div><div class="posttext">Thanks Norbert. Incidently this is exactly what baan suggested me to do. <br />
<br />
My argument to baan was that the audit files are for us (the baan users) so why not allow us to read them and print the information using standard reporting tools. What good is this audit information if the outputs are not user friendly, we cannot change them and we cannot use these files to generate audit reports from other reporting tools.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">norwim</div><div class="date">3rd May 2007, 16:18</div></div><div class="posttext">Hi Baan-User,<br />
<br />
I think that this is a kind of philosophical question. Think about transaction logs of oracle - as long as you can use them to roll back you really don't need to know their data structure.<br />
Audit information is collected regardless of the DB in use and kept outside the database, which I think is a nice thing to have. <br />
As the script which you may need to change the format of the print output, is indeed easy to create, I don't see a problem here.<br />
If you need help with the script, drop me a line:<br />
norbert.wimmer ATsigN ono.de<br />
<br />
hth<br />
<br />
Norbert</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shah_bs</div><div class="date">3rd May 2007, 20:50</div></div><div class="posttext">So, back to the original 'request' - assuming you still really want to do this in C/C++ etc (!!).<br />
<br />
I assume you are using BW Client (BAAN IVc3).<br />
<br />
On the main menu, click on the BAAN IV Tools to highlight.<br />
Then click on the &lt;Help&gt; item on the menu bar, and choose &quot;Contents&quot;.<br />
<br />
In the popup that comes up, scroll down to &quot;Database Management&quot; and select &quot;Audit Management&quot; - inside of that, there is a link to a document called &quot;Audit Management&quot; - select that and click &quot;Relations&quot; and then browse around under that and you should get to the Audit File formats.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">baan_user</div><div class="date">4th May 2007, 15:32</div></div><div class="posttext">Thanks for the useful tip. Under display audit sequences, I found the audit file formats. I need to do this outside baan tools as we do not have development licence.  If it helps other, I am pasting the information below :<br />
<br />
Format of Audit Files (tttech0080sf0050)<br />
---------------------------------------<br />
    INDEX<br />
<br />
    auditdef6.1<br />
<br />
    Info File<br />
<br />
    Sequence File<br />
<br />
    audit_spec File<br />
<br />
<br />
    * auditdef6.1<br />
<br />
    This file is used to specify the directories in which audit files should<br />
    be created. This file is located in $BSE/lib. There is one such file for<br />
    each BSE environment.<br />
<br />
    This file has following structure (similar to isamdef6.1).<br />
<br />
        &lt;Table Name&gt;:&lt;Company Number&gt;:&lt;Directory Name&gt;<br />
<br />
    Following is meaning of each field.<br />
<br />
    - Table Name<br />
          This indicates the table. This can be in following formats:<br />
<br />
                &quot;*&quot;         - This means all tables in all packages.<br />
                Package     - This means all tables in this package<br />
                              E.g tf,td etc.<br />
                Package &amp; Module code   - All tables in the module<br />
                                          E.g tccom,ttadv.<br />
                Package, Module and<br />
                       table number     - E.g ttadv999,tccom010.<br />
<br />
    - Company Number<br />
          Tables can be selected based on company number. E.g.:<br />
<br />
                *       - All companies.<br />
                100     - Company 100 only.<br />
                100,000 - Company 100 and 000.<br />
<br />
    - Directory<br />
          Directory in which the audit files will be stored.<br />
          Under this directory, another directory will be created, whose<br />
          name will be:<br />
                a&lt;Package + Module Code&gt;<br />
<br />
<br />
    * Info File<br />
<br />
    There is one info file per table per company number.<br />
    The info file can be read using the 4 GL functions or the dictionary<br />
    programs.<br />
<br />
    The info file contains controlling information for sequence files<br />
    ( called info header ) followed by sequence headers of all sequence<br />
    files created.<br />
<br />
    Format of the info file name is<br />
<br />
         a&lt;mmmnnn&gt;&lt;company number&gt;.inf<br />
<br />
         'mmm' means module code<br />
         'nnn' means table number<br />
<br />
    E.g for table ttadv999, company 0, the name will be<br />
<br />
         aadv999000.inf<br />
<br />
    Structure of the info file is a header called info header, followed by<br />
    multiple sequence headers, one for each sequence created.<br />
<br />
    Info header:<br />
<br />
    - Version Information<br />
          Used to store the version information. This should never be<br />
          modified by the application by any means. Length: 4 bytes<br />
<br />
    - Table name<br />
          The table for which audit information is stored.<br />
          Length: 8 bytes<br />
<br />
    - Company Number<br />
          The company of the table.<br />
          Length: 2 bytes<br />
<br />
    - Status<br />
          Specifies whether sequence reuse is allowed or not.<br />
          Length: 1 byte<br />
<br />
    - From Sequence Number<br />
          Audit data will be stored in sequence files specified<br />
          from this value. Length: 2 bytes<br />
<br />
    - To Sequence Number<br />
          The last sequence file after which sequence reuse will<br />
          be started or the user will have to take appropriate action<br />
          like deleting the existing file before reusing them.<br />
          Length: 2 bytes<br />
<br />
    - End Sequence Number<br />
          Specifies the last sequence written in the info file.<br />
          This field is for internal use by Audit Server only ! The user<br />
          should never change this by any means otherwise the audit<br />
          server will not work correctly. Length: 2 bytes<br />
<br />
    - Max. Size of 1 audit file in Bytes<br />
          Specifies the maximum file size of a sequence file.<br />
          Length: 4 bytes<br />
<br />
    - Security Level<br />
          This determines the users who have access to the<br />
          information in the audit files. The security permissions regarding<br />
          access to audit information are stored here. Length: 2 bytes<br />
<br />
    - Current Sequence Number<br />
          Determines the current sequence number that will be used to<br />
          write the audit data in the sequence file. Length: 2 bytes<br />
<br />
    - Offset in current sequence file.<br />
          Specifies the offset in the current sequence file where the<br />
          audit data will be written. Length: 4 bytes<br />
<br />
    - Reserved space<br />
          Reserved space reserved for future use. Application<br />
          programs should never use this space as this space may be used by<br />
          a future release of the audit server. Length: 8 bytes<br />
<br />
    - Length of following sequence header<br />
          Length: 2 bytes<br />
<br />
<br />
    Sequence Header:<br />
<br />
    Each sequence file also contains a sequence header at start of it. The<br />
    info file contains copies of sequence headers for all sequences created.<br />
<br />
    - Sequence Number<br />
          This specifies the sequence number of the sequence file.<br />
          Length: 2 bytes<br />
<br />
    - Creation Date<br />
          This specifies the creation date of sequence file.<br />
          Length: 8 bytes; format: YYYYMMDD<br />
<br />
    - Creation Time<br />
          This specifies the creation time of sequence file.<br />
          Length: 6 bytes; format: HHMMSS<br />
<br />
    - Termination Date<br />
          This specifies the termination date of sequence file.<br />
          Length: 8 bytes; format: YYYYMMDD<br />
<br />
    - Termination Time<br />
          This specifies the termination time of sequence file.<br />
          Length: 6 bytes; format: HHMMSS<br />
<br />
    - Status<br />
          The status gives information to user whether the sequence<br />
          file was user terminated or was closed because of DD change or<br />
          because a transaction data was not possible to accommodate in<br />
          sequence file. Length: 2 bytes<br />
<br />
    - Number of transaction in the sequence<br />
          This specifies the data of number of transactions present<br />
          in sequence file. Length: 2 bytes<br />
<br />
    - Application Info - 1<br />
      Application Info - 2<br />
      Application Info - 3<br />
      Application Info - 4<br />
          These bytes are reserved for storing data specific to the<br />
          application. If the application needs to store any information<br />
          in audit files, these fields should be used to store that<br />
          information. Length: 4 bytes (per application info)<br />
<br />
    - Number of fields being audited<br />
          The total number of fields being audited. Length: 2 bytes<br />
<br />
    - Number of fields in primary index (Length: 1 byte)<br />
          Indicates how many fields are in primary key.<br />
<br />
    - Field Name (Length: 8 bytes)<br />
      Field Type (Length: 1 byte)<br />
      Field Depth (Length: 1 byte)<br />
      Field Length (Length: 2 bytes)<br />
<br />
          Field information for all fields being audited. First, the<br />
          fields, which are part of the primary index are written, in the<br />
          same sequence as they are in the primary index. Next, all<br />
          remaining fields are written in the order in which they occur<br />
          in the table DD. E.g if fields f1, f2, f3, f4 are being audited<br />
          and the primary index is on f4, f2 then field information will<br />
          be written first for f4, next for f2. Then it will be written<br />
          for all remaining fields.<br />
<br />
    - Reserved space<br />
          This reserved space may be used in future. Length: 8 bytes<br />
<br />
    - Length of following sequence header<br />
          Length: 2 bytes<br />
<br />
    Sequence header:<br />
    ...<br />
    ...<br />
<br />
<br />
    * Sequence File<br />
<br />
    Multiple sequence files are used to store audit data for each<br />
    table/company number combination. The sequence files can be read using<br />
    the 4 GL functions or the dictionary programs.<br />
<br />
    Format of the sequence file name is<br />
<br />
         a&lt;mmmnnn&gt;&lt;company number&gt;.&lt;sequence file number&gt;<br />
<br />
         'mmm' means module code<br />
         'nnn' means table number<br />
<br />
    E.g for table ttadv999, company number 0, there can be sequence files<br />
<br />
         aadv999000.000<br />
         aadv999000.001<br />
         aadv999000.002<br />
         aadv999000.003<br />
              ....<br />
<br />
    The sequence file contains the table name and company number, followed<br />
    by the sequence header. This is followed by transaction data of multiple<br />
    transactions. Transaction data is followed by a transaction header and<br />
    contains multiple audit rows generated for the transaction.<br />
<br />
    Sequence File Layout.<br />
<br />
    - Table Name<br />
          Length: 8 bytes<br />
<br />
    - Company Number<br />
          Length: 2 bytes<br />
<br />
    - Length of sequence header<br />
          Length: 2 bytes<br />
<br />
    - Sequence Header<br />
          Explained above.<br />
<br />
    - Transaction Header<br />
<br />
    - Transaction Data ( Audit rows )<br />
<br />
    - Transaction Header<br />
<br />
    - Transaction Data ( Audit rows )<br />
<br />
    - Transaction Header<br />
<br />
    - Transaction Data ( Audit rows )<br />
<br />
         ....<br />
<br />
    The format of the sequence header is already described above, in info<br />
    file description. The format of the transaction header is as follows:<br />
<br />
    Transaction Header Format:<br />
          We need to log both Unix user id &amp; BAAN User name. This<br />
          is because a Unix user can operate using different BAAN user<br />
          names by changing the &quot;USER&quot; environment variable. Different<br />
          BAAN users can have different table privileges in SQL<br />
          databases. So, both should be stored. Using unix user id, print<br />
          programs can find the unix login name etc.<br />
<br />
    - Unix user id       (Length: 4 bytes)<br />
    - BAAN User Name     (Length: 8 bytes)<br />
    - Date ( YYYYMMDD )  (Length: 8 bytes)<br />
    - Time ( HHMMSS )    (Length: 6 bytes)<br />
    - Session Name       (Length: 15 bytes)<br />
    - Transaction Status (Length: 1 byte)<br />
           Transaction Status can have following values.<br />
                COMMIT_DONE<br />
                ABORT_DONE<br />
<br />
    - Number of audit rows in the transaction (Length: 2 bytes)<br />
    - Total bytes of data of this transaction (Length: 4 bytes)<br />
<br />
<br />
    Transaction Data Format:<br />
<br />
    - Length of the row (Length: 2 bytes)<br />
    - Application Data  (Length: 4 bytes)<br />
    - Type of operation (Length: 1 byte)<br />
    - Row Data<br />
<br />
<br />
    In every audit row, 4 bytes space is kept to store application data.<br />
    This data is stored and manipulated by 4-GL applications and not by the<br />
    audit server. The audit server just keeps the 4 byte extra space to be<br />
    used later. &quot;Type of operation&quot; is a single character field, indicating<br />
    the database action done on the table. Following are the characters used<br />
    for indicating audited database actions.<br />
<br />
         C  - Create Table.<br />
         L  - Clear Table.<br />
         R  - Drop ( Remove ) Table.<br />
         I  - Insert row.<br />
         D  - Delete row.<br />
         U  - Update row.<br />
<br />
    In the audit row, the row data is present only for row level actions.<br />
    The field values, whenever stored, are stored in the same format as<br />
    their data type. Thus a value for a &quot;long&quot; field is also stored as long<br />
    in the audit row. The length of each field entry in the audit row is the<br />
    same as the length of the column.<br />
<br />
    For insert, the row data consist of field values ( i.e the values to be<br />
    inserted ) of all audited fields, in the order in which they occur in<br />
    the audit DD.<br />
<br />
    For delete, the row data consist of field values ( of the row to be<br />
    deleted ) of all audited fields, in the order in which they occur in<br />
    the audit DD.<br />
<br />
    In case of update, not all fields in the table may be updated. So, apart<br />
    from storing field values, a identifier is required to specify the field<br />
    to which this data belongs to. Here, field numbers are used for<br />
    identifying the fields. A field number for a field is its position in<br />
    the AUDIT DD ( starting with field 0 ).<br />
<br />
    A entry for a field contains the following information:<br />
<br />
    - Field Number         - 2 Bytes<br />
    - Is the value changed - 1 Byte  ( 'Y' or 'N' ).<br />
    - Old Value<br />
    - New Value<br />
<br />
    Here, if a field is changed, both old and new values are stored. If a<br />
    primary audited key field is not changed, only the old value is stored.<br />
    For other audited fields, if they are not changed, nothing is stored.<br />
    For all primary key audited fields and all other audited fields which<br />
    are changed, these entries are made to make the audit data.<br />
<br />
    For more information on audit rows and examples, refer to chapter<br />
    Audit Management.<br />
<br />
<br />
    * audit_spec File<br />
<br />
    For specifying audit file parameters, a file named &quot;audit_spec&quot; is used.<br />
    This file resides in the $BSE/lib directory. There is one such file for<br />
    each BSE environment.<br />
<br />
    Format of the file is<br />
<br />
         &lt;Table Name&gt;:&lt;Company Number&gt;:&lt;Audit Specifications&gt;<br />
<br />
    Following is meaning of each field.<br />
<br />
    - Table Name<br />
          This indicates the table. This can be in following formats:<br />
<br />
             &quot;*&quot;         - This means all tables in all packages.<br />
             Package     - This means all tables in this package<br />
                           E.g tf,td etc.<br />
             Package &amp; Module code - All tables in the module<br />
                                     E.g tccom,ttadv.<br />
             Package, Module and<br />
                    table number   - E.g ttadv999,tccom010.<br />
<br />
    - Company<br />
          This can be either a in one of following formats.<br />
<br />
             *       - All companies.<br />
             100     - Single company e.g company 100 only.<br />
             100,000 - Comma separated list of companies e.g<br />
                       company 100 and 000.<br />
<br />
    - Specifications<br />
          The following specifications can be put in the file.<br />
<br />
            - Start Sequence.<br />
              This is specified by the keyword &quot;FROMSEQ&quot; or &quot;fromseq&quot;. The<br />
              start sequence is always 000. The user can not change this.<br />
<br />
            - To Sequence.<br />
              This is specified by the keyword &quot;TOSEQ&quot; or &quot;toseq&quot; followed<br />
              by a sequence number.<br />
              Note that there should be a space between the keyword and<br />
              the sequence number.<br />
<br />
                E.g<br />
                    TOSEQ 999<br />
                or<br />
                    toseq 999<br />
<br />
              If the end sequence is not specified for a table/company<br />
              combination, default is 999.<br />
<br />
            - Maximum sequence file size.<br />
              This is specified by the keyword &quot;MAXSEQSIZE&quot; or &quot;MAXSEQSIZE&quot;<br />
              followed by a size specification.<br />
              Note that there should be a space between the keyword and<br />
              the size specification.<br />
<br />
              The size can be specified in<br />
<br />
                 - bytes e.g MAXSEQSIZE 10000<br />
                   ( This means 10000 bytes )<br />
<br />
                 - Kilobytes e.g MAXSEQSIZE 10K<br />
                   ( This means 10K bytes or 10*1024 bytes )<br />
<br />
                 - Megabytes e.g MAXSEQSIZE 2M<br />
                   ( This means 2M bytes or 2*1024*1024 bytes )<br />
<br />
              Note that for Kbyte and Mbyte specifications the characters<br />
              'K' and 'M' should be UPPERCASE ONLY and there should be no<br />
              space between the number and the specification character.<br />
<br />
              If maximum sequence size is not specified for a table/company<br />
              combination, default is 512K.<br />
<br />
            - Whether sequences can be reused or not.<br />
<br />
              If existing sequences can be reused without deleting first,<br />
              the keyword &quot;SEQREUSE&quot; or &quot;seqreuse&quot; should be put in the<br />
              specifications. If this is not wanted, don't put the keyword<br />
              in the specifications. If this is not specified for a table,<br />
              the sequence reused is not allowed.<br />
<br />
            - Security Assigned to current table/company number<br />
              audit files.<br />
              This is specified as keyword &quot;SECURITY&quot; or &quot;security&quot; followed<br />
              by a security number. Note that there should be a space<br />
              between the keyword and the security specifications. E.g<br />
<br />
                  SECURITY 4<br />
<br />
                  or<br />
<br />
                  security 4<br />
<br />
              The different security levels along with their codes are as<br />
              follows:<br />
<br />
                  SECURITY                VALUE<br />
                  --------                -----<br />
                  PRINT                     4<br />
                  CLEAN                     8<br />
                  MAINTAIN                 16<br />
                  APPLICATION DEFINED      32<br />
<br />
              The combination of these is explained in Authorizations.<br />
              To specify CLEAN + MAINTAIN, security is specified as security<br />
              24 ( which is sum of 8 + 16 ).<br />
<br />
              APPLICATION DEFINED cannot be combined with PRINT and CLEAN.<br />
              It can be combined with MAINTAIN permissions ONLY.<br />
<br />
         Note that these specifications can be put in any order.<br />
<br />
    IT IS STRONGLY ADVISED THAT THE AUDIT_SPEC FILE SHOULD HAVE A DEFAULT<br />
    ENTRY COVERING ALL TABLES/COMPANY NUMBERS.<br />
    This can be done with a &quot;*&quot; for table and company number fields. This<br />
    should be the last line of the file.<br />
<br />
    A sample audit_spec file may look as follows:<br />
<br />
         ttadv999:000:TOSEQ 99 FROMSEQ 000 MAXSEQSIZE 2M<br />
         tt:000:seqreuse toseq 49 maxseqsize 1M<br />
         tf:000:toseq 49 seqreuse maxseqsize 20K<br />
         *:*:FROMSEQ 000 TOSEQ 499 MAXSEQSIZE 100K<br />
<br />
<br />
    NOTE<br />
         It is important that the audit_spec file should have read<br />
         permission for all users and write permission for the &quot;root&quot; user<br />
         only. Thus, users other than &quot;root&quot; will not be able to change the<br />
         security parameter in the file, allowing them illegal access.</div></div><hr />



</div>
</body>
</html>