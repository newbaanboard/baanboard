<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="Problems reading XML file., baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] Problems reading XML file. Tools Development" />
	
	<title>Problems reading XML file. [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="../index.html">Newbaanboard</a> &gt; <a href="../index.html">Baan Quick Support: Functional &amp; Technical</a> &gt; <a href="../index.html">Tools Development</a> &gt; Problems reading XML file.</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">baanware</div><div class="date">21st October 2004, 11:54</div></div><div class="posttext">Hi All,<br />
<br />
I am trying to read an XML file, but cannot make my program identify the contents of the xml-element. I have made the script below to create a simple xml-file describing my problem. The resulting file looks as follows:<br />
<br />
&lt;?xml version=&quot;1.0&quot;?&gt;<br />
&lt;Supplier&gt;<br />
        &lt;SupplierID&gt;123456&lt;/SupplierID&gt;<br />
        &lt;Name&gt;Customer Named XXX&lt;/Name&gt;<br />
        &lt;Address&gt;Address YYY&lt;/Address&gt;<br />
&lt;/Supplier&gt;<br />
<br />
<br />
The file was generated by the following sample function:<br />
<br />
function create.xml.document( domain tcsuno i.suno,<br />
                              domain tcnama i.nama,<br />
                              domain tcnamc i.namc)<br />
{<br />
BaanDocId = xmlNewNode(&quot;Supplier&quot;) |* , XML_ELEMENT, dtdId)<br />
<br />
retVal = xmlNewDataElement(&quot;SupplierID&quot;, strip$(shiftl$(i.suno)), BaanDocId)<br />
retVal = xmlNewDataElement(&quot;Name&quot;,       strip$(shiftl$(i.nama)), BaanDocId)<br />
retVal = xmlNewDataElement(&quot;Address&quot;,    strip$(shiftl$(i.namc)), BaanDocId)<br />
<br />
fd = seq.open(&quot;file.xml&quot;, &quot;w&quot; )<br />
<br />
retVal = xmlWritePretty(fd, BaanDocId, 0 )<br />
<br />
retVal = seq.close(fd)<br />
<br />
retVal = xmlDelete(BaanDocId, 0)<br />
}<br />
<br />
<br />
Having written the file, I try to read it, and to determine the contents of the &lt;Name&gt; element. <br />
<br />
function read.xml.document()<br />
{<br />
  long    fileid<br />
  long    suppliernode<br />
<br />
  string  error_string(120)<br />
<br />
  string xml.data(50)<br />
<br />
  |open the xml file for reading.<br />
  fd = seq.open (&quot;file.xml&quot;, &quot;r&quot; )<br />
<br />
  |parse the xml file<br />
  fileid = xmlread(fd, error_string)<br />
  seq.close(fd)<br />
<br />
  |determine the data-elements<br />
  suppliernode = xmlfindmatch(&quot;&lt;Supplier&gt;&quot;, fileid)<br />
  if (suppliernode &lt;&gt; 0 ) then<br />
    retval = xmlgetdataelement(suppliernode,  &quot;&lt;Name&gt;&quot;, xml.data)<br />
    retval = xmlgetdataelement(suppliernode,  &quot;Name&quot;,   xml.data)<br />
    retval = xmlgetdataelement(suppliernode,  &quot;&quot;,       xml.data)<br />
  endif<br />
<br />
  retval = xmldelete(fileid, 0)<br />
}<br />
<br />
<br />
As you can see I have tried several ways to isolate the content of the &quot;Name&quot; element , but none of them results in the expected value<br />
of the result-string xml.data ( = &quot;Customer Named XXX&quot;). <br />
<br />
Can anyone tell me how to do?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">FransG</div><div class="date">21st October 2004, 16:56</div></div><div class="posttext">Replace xmlFindMatch with xmlFindFirst...<br />
<br />
|determine the data-elements<br />
suppliernode = xmlFindFirst(&quot;Supplier&quot;, fileid)<br />
if (suppliernode &lt;&gt; 0 ) then<br />
    retval = xmlgetdataelement(suppliernode, &quot;Name&quot;, xml.data)<br />
endif<br />
<br />
There is not need to put '&lt;' and '&gt;' within the tagname string.<br />
<br />
xmlFindFirst assigns the first valid node to suppliernode. Where xmlFindMatch will return an a new XML structure with matching nodes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">baanware</div><div class="date">21st October 2004, 17:57</div></div><div class="posttext">Hi FransG<br />
<br />
Thanks a lot. Everything seems to work beautifully now.<br />
...Hard to believe that something that simple could cause such problems. <br />
<br />
Anyway, just to make the XML handling more understandable to me, I have a little additional question. Suppose that we have a multilevel structure - e.g. a BOM:<br />
<br />
&lt;?xml version=&quot;1.0&quot;?&gt;<br />
&lt;BillOfMaterial&gt;<br />
  &lt;MainItemId&gt;123456&lt;/MainItemId&gt;<br />
  &lt;SubItem&gt;<br />
    &lt;Position&gt;10&lt;/Position&gt;<br />
    &lt;Sequence&gt;1&lt;/Sequence&gt;<br />
    &lt;SubItemId&gt;23456&lt;/SubItemId&gt;<br />
    &lt;NetQuantity&gt;12.0&lt;/NetQuantity&gt;<br />
  &lt;/SubItem&gt;  <br />
  &lt;SubItem&gt;<br />
    &lt;Position&gt;10&lt;/Position&gt;<br />
    &lt;Sequence&gt;1&lt;/Sequence&gt;<br />
    &lt;SubItemId&gt;345678&lt;/SubItemId&gt;<br />
    &lt;NetQuantity&gt;24.0&lt;/NetQuantity&gt;<br />
  &lt;/SubItem&gt;  <br />
&lt;/BillOfMaterial&gt;<br />
<br />
How would you position the first and the second occurance of &quot;SubItem&quot;. <br />
  xmlFindFirst(&quot;SubItem&quot;, fileid)<br />
will give you the first one, but how do I find or &quot;activate&quot; the following occurances?<br />
<br />
Furthermore: If I had multiple BOM's in the same XML file would the same methodology be applicable?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">FransG</div><div class="date">22nd October 2004, 09:03</div></div><div class="posttext">Hi,<br />
<br />
If you have multiple BOMs in one xml document then you need another root node (i.e. doc).<br />
<br />
<br />
&lt;?xml version=&quot;1.0&quot;?&gt;<br />
&lt;doc&gt;<br />
&lt;BillOfMaterial&gt;<br />
&lt;MainItemId&gt;123456&lt;/MainItemId&gt;<br />
&lt;SubItem&gt;<br />
&lt;Position&gt;10&lt;/Position&gt;<br />
&lt;Sequence&gt;1&lt;/Sequence&gt;<br />
&lt;SubItemId&gt;23456&lt;/SubItemId&gt;<br />
&lt;NetQuantity&gt;12.0&lt;/NetQuantity&gt;<br />
&lt;/SubItem&gt;<br />
&lt;SubItem&gt;<br />
&lt;Position&gt;20&lt;/Position&gt;<br />
&lt;Sequence&gt;1&lt;/Sequence&gt;<br />
&lt;SubItemId&gt;345678&lt;/SubItemId&gt;<br />
&lt;NetQuantity&gt;24.0&lt;/NetQuantity&gt;<br />
&lt;/SubItem&gt;<br />
&lt;/BillOfMaterial&gt;<br />
&lt;BillOfMaterial&gt;<br />
&lt;MainItemId&gt;789012&lt;/MainItemId&gt;<br />
&lt;SubItem&gt;<br />
&lt;Position&gt;10&lt;/Position&gt;<br />
&lt;Sequence&gt;1&lt;/Sequence&gt;<br />
&lt;SubItemId&gt;34567&lt;/SubItemId&gt;<br />
&lt;NetQuantity&gt;12.0&lt;/NetQuantity&gt;<br />
&lt;/SubItem&gt;<br />
&lt;SubItem&gt;<br />
&lt;Position&gt;20&lt;/Position&gt;<br />
&lt;Sequence&gt;1&lt;/Sequence&gt;<br />
&lt;SubItemId&gt;834567&lt;/SubItemId&gt;<br />
&lt;NetQuantity&gt;24.0&lt;/NetQuantity&gt;<br />
&lt;/SubItem&gt;<br />
&lt;/BillOfMaterial&gt;<br />
&lt;/doc&gt;<br />
<br />
<br />
In this xml document there are two BOMs both with two subitems. In order to read the xml document I guess you should use something like the following code fragment:<br />
<br />
function read.xml.document()<br />
{<br />
long fd<br />
long xml.id<br />
long bom.id<br />
long sub.item.id<br />
long ret.val<br />
string error_string(120)<br />
<br />
string xml.data1(50)<br />
string xml.data2(50)<br />
string xml.data3(50)<br />
string xml.data4(50)<br />
string xml.data5(50)<br />
<br />
|* Open the xml file for reading.<br />
fd = seq.open (&quot;file.xml&quot;, &quot;r&quot; )<br />
<br />
|* Parse the xml file<br />
xml.id = xmlread(fd, error_string)<br />
seq.close(fd)<br />
<br />
|* First check if there is a BOM present.<br />
bom.id = xmlFindFirst(&quot;BillOfMaterial&quot;, xml.id)<br />
|* Loop through the BOMs in the xml document.<br />
while bom.id &lt;&gt; 0<br />
ret.val = xmlGetDataElement(bom.id, &quot;MainItemId&quot;, xml.data1)<br />
sub.item.id = xmlFindFirst(&quot;SubItem&quot;, bom.id)<br />
|* Loop through the Sub Items in the BOM.<br />
while sub.item.id &lt;&gt; 0<br />
ret.val = xmlGetDataElement(sub.item.id, &quot;SubItemId&quot;, xml.data2)<br />
ret.val = xmlGetDataElement(sub.item.id, &quot;Position&quot;, xml.data3)<br />
ret.val = xmlGetDataElement(sub.item.id, &quot;Sequence&quot;, xml.data4)<br />
ret.val = xmlGetDataElement(sub.item.id, &quot;NetQuantity&quot;, xml.data5)<br />
|* Check for another component (sub item).<br />
sub.item.id = xmlGetRightSibling(sub.item.id)<br />
endwhile<br />
|* Check for another BOM.<br />
bom.id = xmlGetRightSibling(bom.id)<br />
endwhile<br />
<br />
ret.val = xmlDelete(xml.id, 0)<br />
}<br />
<br />
<br />
I haven't tested the code, but I think you get an idea about it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">baanware</div><div class="date">2nd November 2004, 13:37</div></div><div class="posttext">Hi Frans,<br />
<br />
Thanks for your competent suggestions. Now everything seems to work just as I wanted. <br />
<br />
XML isn't that difficult ...as soon as the basic principles and terminology is understood. As usual it would have been helpfull with documentation from Baan (...SSA). <br />
Luckilly I (/we) have Baanboard !!!<br />
<br />
Best regards</div></div><hr />



</div>
</body>
</html>