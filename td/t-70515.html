<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="Invoices printing issue-display last record with 2 lines, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] Invoices printing issue-display last record with 2 lines Tools Development" />
	
	<title>Invoices printing issue-display last record with 2 lines [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="../index.html">Newbaanboard</a> &gt; <a href="../index.html">Baan Quick Support: Functional &amp; Technical</a> &gt; <a href="../index.html">Tools Development</a> &gt; Invoices printing issue-display last record with 2 lines</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">tracylee</div><div class="date">19th October 2017, 07:38</div></div><div class="posttext">Hi, I have customize the invoices printing. I got 5 item on invoices but when print the report is show 6 item. For last record is same as previously record. If 1 item, then report printing will show 2 lines. So, how can i printing the data without duplicate last record? I try use lattr.break = true also cannot work. Please advise.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">srprks</div><div class="date">19th October 2017, 08:18</div></div><div class="posttext">can you post your code</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tracylee</div><div class="date">19th October 2017, 09:44</div></div><div class="posttext">can you post your code<br />
<br />
Thanks for your reply. Sure.<br />
<br />
I use detail.1 to display the items.<br />
<br />
Below is my report script.<br />
<br />
<br />
|******************************************************************************<br />
|* Component	: cisli120011000   VRC B60  a  sy48	(FP6)<br />
|* Name		: Invoices<br />
|* Author	: Jan-Willem Sonderlo<br />
|* Date Written	: 29-12-2009 [16:45]<br />
|******************************************************************************<br />
|*	Rev.No. 7  ciB60asy48  11 Mar 09 rhaitsma<br />
|* Input field 'r.inventory.unit' changed into 'r.inv.unit.dsun'.<br />
|* Input field 'r.order.unit' changed into 'r.order.unit.dsun'.<br />
|* Input field 'r.price.unit' changed into 'r.price.unit.dsun'.<br />
|*	Rev.No. 8  ciB60asy48  11 Mar 09 rhaitsma<br />
|* Input field 'r.item' is changed into 'r.inv.line.item'.<br />
|*	Rev.No. 9  ciB60asy48  25 May 09 rhaitsma<br />
|* Porting of SL 236047. Solution 235838 makes it possible that the payment<br />
|* method fields can be left empty on the payment schedule lines. If that is<br />
|* done, then the payment method of the business partner must be used.<br />
|* In case the payment method is entered on the sales invoice, then this method<br />
|* should overrule the payment method array. But this should only be done in<br />
|* case the payment method array is retrieved from the invoice-to BP.<br />
|* (ERP-00000-54910)<br />
|*	Rev.No. 2  ciB60asy49  09 Jun 09 rhaitsma<br />
|* 800-166993, charge type 'Service' has been added to domain cisli.chtp.<br />
|*	Rev.No. 3  ciB60asy49  12 Jun 09 wvdmolen<br />
|* FP6-SBI, introduced detail 63 to print the SBI-correction amount on a<br />
|* separate line<br />
|*	Rev.No. 4  ciB60asy49  24 Jun 09 apluijm<br />
|* FP6-SBI, Arno Pluijm, 2009-06-24<br />
|* Shipment Line added to report<br />
|*	Rev.No. 2  ciB60asy50  03 Jul 09 rhaitsma<br />
|* r.ih.am.service was not taken into account when calculating r.goods.net.amnt.<br />
|*	Rev.No. 3  ciB60asy50  06 Jul 09 rhaitsma<br />
|* Output argument added for external print functions (number of BR / Invoices<br />
|* printed).<br />
|*	Rev.No. 4  ciB60asy50  22 Jul 09 rhaitsma<br />
|* Draft printing must be handled via new printing DLL (cisli.dll9002 is<br />
|* replaced by cisli.dll1200).<br />
|*	Rev.No. 5  ciB60asy50  24 Jul 09 rhaitsma<br />
|* 800-169033, Tax summary was not printed for draft invoices (printing<br />
|* initiated from external packages). Reason is that tables cisli206/9 were not<br />
|* committed and therefore the content of these tables was not known in other<br />
|* processes (like the invoice report) than the current process.<br />
|*	Rev.No. 2  ciB60asy51  25 Aug 09 rhaitsma<br />
|* Porting of SL 239649. For service orders the location address must be printed<br />
|* on the invoice instead of the ship-to address.<br />
|* (ERP-00000-61390)<br />
|*	Rev.No. 3  ciB60asy51  27 Aug 09 rhaitsma<br />
|* 800-169465, printing of item is handled via printing options of the invoicing<br />
|* method.<br />
|* Printing of Shipment Reference, Delivery Point and Packing Slip (External) is<br />
|* done.<br />
|*	Rev.No. 4  ciB60asy51  27 Aug 09 rhaitsma<br />
|* 800-169465, description of delivery point is also printed.<br />
|*	Rev.No. 5  ciB60asy51  31 Aug 09 rhaitsma<br />
|* Field cisli255.sitx (Service Item Text) has been added.<br />
|*	Rev.No. 6  ciB60asy51  02 Sep 09 apluijm<br />
|* 200-167043, Arno Pluijm, 2009-09-02<br />
|* tcbano length 25-&gt;34, see http://www.ecbs.org/download/tr201/poland.pdf<br />
|* for a description on domestic account number and IBAN numbers in Poland.<br />
|*	Rev.No. 2  ciB60asy52  10 Sep 09 rhaitsma<br />
|* 800-169783, lay-out enhancements have been done on the invoice report.<br />
|*	Rev.No. 3  ciB60asy52  14 Sep 09 rhaitsma<br />
|* 800-169881, The label 'Department' is now flexible. In case the department<br />
|* is a sales office, then 'Sales Office' is shown, in case the department is a<br />
|* service department, then 'Service Department' is shown, etc.<br />
|* In case of multiple departments, the label remains 'Department'.<br />
|*	Rev.No. 4  ciB60asy52  15 Sep 09 rhaitsma<br />
|* 800-169912, The second discount [Days] field is the same as the first<br />
|* discount [Days] field. It should read r.top.disc.per2 instead.<br />
|*	Rev.No. 5  ciB60asy52  17 Sep 09 rhaitsma<br />
|* VSC-warnings solved.<br />
|*	Rev.No. 6  ciB60asy52  18 Sep 09 rhaitsma<br />
|* 800-170388, all amount fields are printed with format %A005 (like it is done<br />
|* in the Sales Order Acknowledgement report).<br />
|*	Rev.No. 7  ciB60asy52  18 Sep 09 rhaitsma<br />
|* 800-170395, tax summary is now printed in the details (once for every<br />
|* invoice). Background: the tax summary content is imported. This is needed<br />
|* because of draft printing (no commit, hence no table-content of cisli206/9<br />
|* can be read in another process). For sales, project and some other origins,<br />
|* the printing is done afterwards (the previous record is printed). In this<br />
|* case the imported values contain data of the current record, where the<br />
|* not-imported data contains data of the previous record.<br />
|*	Rev.No. 8  ciB60asy52  21 Sep 09 rhaitsma<br />
|* 800-170395, calculation of tax summary amount in home currency was incorrect.<br />
|*	Rev.No. 2  ciB60asy53  23 Sep 09 rhaitsma<br />
|* 800-170545, field cisli245.cuns (Delivered Quantity Unit) was not used.<br />
|*	Rev.No. 3  ciB60asy53  24 Sep 09 rhaitsma<br />
|* More space reserved for 'Total (Rounded)' label.<br />
|*	Rev.No. 4  ciB60asy53  25 Sep 09 rhaitsma<br />
|* 800-170429, a percentage sign is added if the discount percentage is<br />
|* displayed.<br />
|*	Rev.No. 2  ciB60ast6  01 Oct 09 rhaitsma<br />
|* 800-170874, the alternative item as present on the report represented the<br />
|* alternative item code used by the customer. This concept is now replaced by<br />
|* the storing of the customer item code in the CI tables.<br />
|*	Rev.No. 3  ciB60ast6  13 Oct 09 rhaitsma<br />
|* 800-171180, the bank reference number was not printed.<br />
|*	Rev.No. 4  ciB60ast6  16 Oct 09 rhaitsma<br />
|* 800-171180, if the country of the financial company differs from the country<br />
|* of the invoice-to BP, then the bank reference is not applicable. The bank<br />
|* reference field must be empty in that case.<br />
|*	Rev.No. 5  ciB60ast6  19 Oct 09 rhaitsma<br />
|* Report fields have been synchronized with the external declarions of the<br />
|* print DLL.<br />
|*	Rev.No. 6  ciB60ast6  28 Oct 09 rhaitsma<br />
|* Label cisli.srvo (Service Order) is replaced by cisli.cost.type (Cost Type).<br />
|*	Rev.No. 7  ciB60ast6  28 Oct 09 rhaitsma<br />
|* Fields re-arranged.<br />
|*	Rev.No. 8  ciB60ast6  28 Oct 09 rhaitsma<br />
|* More space reserved for labels because of translation.<br />
|*	Rev.No. 9  ciB60ast6  04 Nov 09 rhaitsma<br />
|* Variable 'r.suppr' must be handled for all detail lines.<br />
|*	Rev.No. 2  ciB60asy54  04 Dec 09 rhaitsma<br />
|* Porting of SL243517, Fatal error when printing the payment schedule on an<br />
|* invoice. Error: Use of NULL pointer on ''. This happens because function<br />
|* 'initialize.invoice.line.data' is not always triggered.<br />
|* (ERP-00000-70703)<br />
|*	Rev.No. 3  ciB60asy54  10 Feb 10 rhaitsma<br />
|* FIN-083, payment schedules are also possible for credit notes.<br />
|*	Rev.No. 4  ciB60asy54  15 Feb 10 rhaitsma<br />
|* Library cisli.dll0001 is removed from the library list.<br />
|*	Rev.No. 5  ciB60asy54  18 Feb 10 rhaitsma<br />
|* Domain of billing request changed from cisli.brid (long(9)) into tcorno<br />
|* (string(9)).<br />
|*	Rev.No. 7  ciB60asy54  11 Mar 10 fmargiot<br />
|* TCS 800-172163: fmargiot 11/03/2010 Report changed to show discount amount<br />
|* decimal<br />
|*	Rev.No. 8  ciB60asy54  02 Apr 10 fmargiot<br />
|* fmargiot: The domain bpmdm.info (string 50) was replaced by tcmail (string<br />
|* 100).<br />
|*	Rev.No. 9  ciB60asy54  22 Apr 10 eprovoos<br />
|* Porting solution 245507 , Erik Provoost 2010-22-04<br />
|* When an order discount is applicable for an order, this must be printed on<br />
|* the invoice. But the amount printed is the amount of the last invoice line.<br />
|* Infor365 216499<br />
|*	Rev.No. 10  ciB60asy54  07 May 10 fmargiot<br />
|* Invoice printing anomaly regarding product variant<br />
|* Infor365 270294<br />
|*	Rev.No. 11  ciB60asy54  07 May 10 fmargiot<br />
|* Invoice printing anomaly regarding product variant<br />
|* Infor365 270294<br />
|*	Rev.No. 13  ciB60asy54  07 May 10 fmargiot<br />
|* Invoice printing anomaly regarding product variant<br />
|* Infor365 270294<br />
|*	Rev.No. 14  ciB60asy54  27 May 10 fmargiot<br />
|* SOL 247375, fmargiot 27-05-2010<br />
|* Different ship to BP addresses not displayed<br />
|* Infor365 273109<br />
|*	Rev.No. 15  ciB60asy54  28 May 10 eprovoos<br />
|* Discount percentage of the previous line can be printed on an invoice line<br />
|* without discount.<br />
|* Infor365 275037<br />
|*	Rev.No. 16  ciB60asy54  22 Jun 10 fmargiot<br />
|* SOL 248171, Filippo Margiotta, 2010-06-21<br />
|* Material Serial NO from Maintenance Sales not printed in the invoice.<br />
|* Infor365 274383<br />
|*	Rev.No. 17  ciB60asy54  25 Jun 10 fmargiot<br />
|* SOL 248127, Filippo Margiotta, 2010-06-23<br />
|* Installment number is not printed on the invoice.<br />
|* Infor365 275715<br />
|*	Rev.No. 18  ciB60asy54  25 Jun 10 rhaitsma<br />
|* 800-172954, labels for First Reference, Second Reference and Customer Order<br />
|* have been added.<br />
|*	Rev.No. 2  ciB60asy56  27 Aug 10 rhaitsma<br />
|* Porting of SL 249703. Currently both the delivery date and the delivery time<br />
|* is part of the aggregation criteria for combining multiple sales order<br />
|* invoice lines. This is too detailed. Only the delivery date part is relevant.<br />
|* (Infor365: 284403)<br />
|*	Rev.No. 2  ciB60asy57  08 Sep 10 rhaitsma<br />
|* PD49299, The concept of additional fields is added in cisli240 and in<br />
|* cisli245.<br />
|*	Rev.No. 3  ciB60asy57  08 Sep 10 rhaitsma<br />
|* PD49299, the 'Additional Information' fields are added as input fields to the<br />
|* invoice report. There is no layout defined for these fields, because most<br />
|* customers use a customized report.<br />
|*	Rev.No. 4  ciB60asy57  21 Sep 10 rhaitsma<br />
|* PD49299, The concept of additional fields is added in cisli240 and in<br />
|* cisli245.<br />
|*	Rev.No. 2  ciB60asy59  04 Dec 10 apluijm<br />
|* temp checkin<br />
|*	Rev.No. 3  ciB60asy59  13 Dec 10 rhaitsma<br />
|* 800-176216, the index of cisli247 is extended with 'Receipt' and 'Receipt<br />
|* Line', because in theory (in case of direct delivery) an issue and a receipt<br />
|* can result in an identical shipment/receipt number. Consequently duplicates<br />
|* could arise. (Infor365: 286791)<br />
|*	Rev.No. 4  ciB60asy59  15 Dec 10 rhaitsma<br />
|* 800-176183, option 'Print Item Text' is added in the BR Additions.<br />
|*	Rev.No. 2  ciB60asy61  09 Sep 11 rhaitsma<br />
|* Pinting of tax code in tax summary must be done once for every tax code.<br />
|*	Rev.No. 3  ciB60asy61  13 Sep 11 rhaitsma<br />
|* 800-179186, allignment of text in Workspace was incorrect. The report is<br />
|* rendered mono-spaced (see SL 1006824).<br />
|*	Rev.No. 4  ciB60asy61  15 Sep 11 rhaitsma<br />
|* Porting of SL 1001034, Updating cisli209.dsca with name of county, district,<br />
|* state rather than repeating the enum description itself.<br />
|* (Infor365: 303791)<br />
|*	Rev.No. 5  ciB60asy61  15 Sep 11 rhaitsma<br />
|* 800-179186, alignment of Tax Text is changed from 'Right' to 'Not<br />
|* Applicable'.<br />
|*	Rev.No. 6  ciB60asy61  21 Sep 11 rhaitsma<br />
|* Filling of 'r.order.line.disc' is handled.<br />
|*	Rev.No. 7  ciB60asy61  05 Oct 11 rhaitsma<br />
|* Porting of SL 1061448. Back-end changes for MSRS Reporting.<br />
|*	Rev.No. 8  ciB60asy61  05 Oct 11 rhaitsma<br />
|* Porting of SL 1061448. Back-end changes for MSRS Reporting.<br />
|*	Rev.No. 9  ciB60asy61  03 Nov 11 rhaitsma<br />
|* 800-179680, the data related to interest invoices as printed on the invoice<br />
|* report is synchronized with the way it is displayed in the 'Interest Invoice<br />
|* Data' session.<br />
|*	Rev.No. 10  ciB60asy61  04 Nov 11 rhaitsma<br />
|* Sales Order Invoice Component Lines is extended with 'Route' and<br />
|* 'Carrier/LSP'.<br />
|*<br />
|* Raju Kuripally ciB61Ma7 09 Nov 2011<br />
|* When an invoice report is customized and the sort order is changed to<br />
|* Ascending, the lot data is not printed correctly on the invoice.<br />
|* Infor365 317647<br />
|* Delivery Notes are not printed on invoice report.<br />
|* Infor365 328365<br />
|* Changes are marked with 1025761.<br />
|*	Rev.No. 11  ciB60asy61  18 Nov 11 rkuripal<br />
|* Solution 1025761 has been ported.<br />
|* When an invoice report is customized and the sort order is changed to<br />
|* Ascending, the lot data is not printed correctly on the invoice.<br />
|* Infor365 317647<br />
|* Delivery Notes are not printed on invoice report.<br />
|* Infor365 328365<br />
|*	Rev.No. 12  ciB60asy61  09 Dec 11 rkuripal<br />
|* Solution for Defect 335391(Infor365) has been ported.<br />
|* The Description of the 'Payment terms' is printing as Discount instead of<br />
|* Payment Terms on the Invoice report.<br />
|* In layout After.field r.copy.nr 41 , the label modified to 'Terms of<br />
|* Payment'. The label 'Discount' is added on the left in the next layout:<br />
|* After.field r.copy.nr 45<br />
|*	Rev.No. 13  ciB60asy61  15 Dec 11 pboorla<br />
|* Porting SOL 1063890, Praveen Boorla<br />
|* Defect: 331312<br />
|* Shipment Information is missing in case of split delivery is done for a<br />
|* sales order line.  The quantity is getting accumulated to one shipment line.<br />
|*	Rev.No. 14  ciB60asy61  20 Dec 11 rhaitsma<br />
|* FD51566, Archiving enhancements.<br />
|*	Rev.No. 15  ciB60asy61  23 Dec 11 rkuripal<br />
|* DF-333144<br />
|* Printing the Pay by BP bank account with branch details on the invoice<br />
|* report.<br />
|* Layout After.field r.copy.nr 65:<br />
|* Domestic Bank id and International bank id and International Bank account<br />
|* number has been added to the layout.<br />
|*	Rev.No. 16  ciB60asy61  23 Dec 11 rkuripal<br />
|* Solution 1059289 ported.<br />
|* When an invoice draft report is printed in the Contract Installment<br />
|* session(tsctm4204m000), the item serial number is not printed on the invoice<br />
|* report.<br />
|* Infor365 328509<br />
|* Report cisli120011000:<br />
|* Added an input field to the report and inserted after the Item and<br />
|* description field of Detail 9.<br />
|*	Rev.No. 17  ciB60asy61  16 Jan 12 rhaitsma<br />
|* LND-3072, Domain of source type is changed from cisli.srct into cisli.srtp.<br />
|*	Rev.No. 18  ciB60asy61  23 Jan 12 rhaitsma<br />
|* LND-3072, Add Contract and Contract Line to cisli230/5-cisli3xx.<br />
|*	Rev.No. 19  ciB60asy61  10 Feb 12 rhaitsma<br />
|* Porting of SL 1125571, Error 205 out of range on cisli275.oref (Original<br />
|* Order Reference) when system tries to add a high ascii sign in a field of<br />
|* type string. (Infor365: 345422)<br />
|*	Rev.No. 20  ciB60asy61  02 Mar 12 rhaitsma<br />
|* Invoice to BP name is printed on the invoice.<br />
|*	Rev.No. 21  ciB60asy61  14 Mar 12 rhaitsma<br />
|* BINT error, variable 'r.activity' changed into 'r.ts.activity'.<br />
|*	Rev.No. 2  ciB60asy63  25 Apr 12 rhaitsma<br />
|* 800-184626, Units are not correctly shown on the invoice.<br />
|*	Rev.No. 3  ciB60asy63  26 Apr 12 rhaitsma<br />
|* Porting of SL 1042709, The invoiced quantity (= delivered quantity) is<br />
|* printed in the delivery unit. This should be done in order line unit. (Like<br />
|* in FP3). New variable is introduced so that in the report 3 delivered<br />
|* quantities are available: in order line unit, in delivery unit and in<br />
|* inventory unit. Standard report will print quantities in order line unit.<br />
|* Customizations can be done to print in delivery unit.<br />
|* (Infor365 321025)<br />
|*	Rev.No. 4  ciB60asy63  30 Apr 12 pboorla<br />
|* Ported Solution: 1063221 Defect: 330862 (Infor365)<br />
|* Discount details are not printed correctly on Invoice.  In case of printing<br />
|* of discount as 'Net' the other discount details like the discount percentage<br />
|* etc should also be printed on the Invoice.<br />
|*	Rev.No. 5  ciB60asy63  01 May 12 pboorla<br />
|* Porting Solution: 1129414 InforXtreme Defect: 347473<br />
|* The customer order number for sales orders are taken from Sales Invoice<br />
|* Headers(cisli240).  But when the customer order number is present in lines<br />
|* (cisli245) then that should be printed on the Invoice.<br />
|*	Rev.No. 2  ciB60asy65  04 Jul 12 rhaitsma<br />
|* Introduction of Billable Lines (cisli810) table.<br />
|*	Rev.No. 2  ciB60asy66  31 Aug 12 rhaitsma<br />
|* Table cisli247 is replaced by table cisli312.<br />
|*	Rev.No. 3  ciB60asy66  17 Sep 12 rhaitsma<br />
|* Unused delivery notes variables are commented in the report script.<br />
|*	Rev.No. 2  ciB60asy67  04 Oct 12 rhaitsma<br />
|* Cognos, argument 'r.no.of.pr.lines' is added so that the MS reporting service<br />
|* can easily detect the last printed invoice line.<br />
|*	Rev.No. 3  ciB60asy67  04 Oct 12 rhaitsma<br />
|* Porting of KB 1146030, Each shipment line is printed individually on the<br />
|* invoice report, when a Sales Order line having multiple shipment lines is<br />
|* processed from Central invoicing and that is printed from Central Invoicing.<br />
|* (InforXtreme: 353928)<br />
|*	Rev.No. 4  ciB60asy67  10 Oct 12 rhaitsma<br />
|* Integration TP-CI extended. The fields 'Area', 'Warehouse', 'Delivery Point',<br />
|* 'Delivery Terms', 'Point of Title Passage', 'Carrier', 'Weight' and 'Weight<br />
|* Unit' are passed from the contract to Invoicing.<br />
|*	Rev.No. 5  ciB60asy67  24 Oct 12 rmahesh<br />
|* Detail 15 0 Condition based on source type replacd by condition based labour<br />
|* type filled yes/no.<br />
|*	Rev.No. 2  ciB60asy72  31 Dec 12 rmahesh<br />
|* Added r.goods.gross.am as report input fields. Not used in the layout.<br />
|*	Rev.No. 3  ciB60asy72  23 Jan 13 rhaitsma<br />
|* Porting of KB 1371107. The customer order line and customer order sequence<br />
|* are missing when<br />
|* printing an invoice in the MS format.<br />
|* (InforXtreme: 387045)<br />
|*	Rev.No. 4  ciB60asy72  06 Feb 13 rmahesh<br />
|* original Invoice specification in the invoice report. for credit notes.<br />
|*	Rev.No. 5  ciB60asy72  11 Feb 13 rmahesh<br />
|* Print Original Invoice related changes.<br />
|*	Rev.No. 6  ciB60asy72  11 Feb 13 rhaitsma<br />
|* KB 1375252, the delivery terms code is not printed on the invoice.<br />
|* (InforXtreme: 389168)<br />
|*	Rev.No. 2  ciB60asy74  07 May 13 rmahesh<br />
|* 800-190694 - Your ID - Invoice to bp name not printed.<br />
|*	Rev.No. 3  ciB60asy74  16 May 13 rmahesh<br />
|* 800-191132 -  Component lines not selected correctly resulting in fatal error<br />
|* when allocating memory.<br />
|*	Rev.No. 4  ciB60asy74  16 May 13 rmahesh<br />
|* .<br />
|*	Rev.No. 2  ciB60asy76  05 Jul 13 bpape<br />
|* With aggragation level 'Activity' or 'Activity/Cost type' the quantity, unit<br />
|* and price should not be shown on the invoice and the serial number should be<br />
|* added.<br />
|* DF 400629, KB 1398488<br />
|*	Rev.No. 2  ciB60asy77  11 Jul 13 rhaitsma<br />
|* 800-192539, the price must not be shown for Customer Claim and Supplier<br />
|* Claim.<br />
|*	Rev.No. 3  ciB60asy77  17 Jul 13 rhaitsma<br />
|* Label changes in 'Tax' group box.<br />
|*	Rev.No. 4  ciB60asy77  15 Aug 13 rhaitsma<br />
|* 800-192805, Too much space reserved for the cost object.<br />
|*	Rev.No. 5  ciB60asy77  23 Sep 13 eprovoos<br />
|* Porting SOL 1432259, Erik Provoost, 2013-09-11<br />
|* Although it is possible to aggregate on cost component, the cost component<br />
|* itself is not printed on the invoice.<br />
|* InforXtreme 417266<br />
|*	Rev.No. 6  ciB60asy77  30 Sep 13 rhaitsma<br />
|* Aggregate Tax implementation<br />
|* Porting SOL 1451250, Erik Provoost, 2013-11-18<br />
|* Configuration lines are not printed on the invoice (as was done in earlier<br />
|* FP's).<br />
|* InforXtreme 426629<br />
|*	Rev.No. 7  ciB60asy77  18 Nov 13 eprovoos<br />
|* Porting SOL 1451250, Erik Provoost, 2013-11-18<br />
|* Configuration lines are not printed on the invoice (as was done in earlier<br />
|* FP's).<br />
|* InforXtreme 426629<br />
|*	Rev.No. 8  ciB60asy77  22 Nov 13 eprovoos<br />
|* Porting KB 1419676 Erik Provoost 2013-11-22<br />
|* Since MS reporting can not handle layout.again(), serial number fields are<br />
|* not available in SSRS for Invoice. New tools function should provide this<br />
|* option.<br />
|* InforXtreme 410846<br />
|*	Rev.No. 9  ciB60asy77  27 Nov 13 rmahesh<br />
|* Progress Payment request.<br />
|*	Rev.No. 10  ciB60asy77  04 Feb 14 eprovoos<br />
|* SOL 1472358, Erik Provoost, 2014-01-31<br />
|* Incomplete fix 1039380. Default terms of payment is determined from<br />
|* Schedules or invoice line, and lastly from BP. But after that it is<br />
|* overwritten again.<br />
|* Internal remark.<br />
|*	Rev.No. 11  ciB60asy77  18 Feb 14 bpape<br />
|* Texts starting with &lt; are for internal use only and should not be printed on<br />
|* external reports. This is currently not done for item text.<br />
|* DF 435488; KB 1468471<br />
|*	Rev.No. 12  ciB60asy77  17 Mar 14 bpape<br />
|* Add Material Pricing information to the invoice report.<br />
|* PD#52351, marked with lnd-8235<br />
|*	Rev.No. 13  ciB60asy77  19 Mar 14 bpape<br />
|* Rectify domain usage. r.order.line is tcsli.orln<br />
|*	Rev.No. 14  ciB60asy77  06 May 14 eprovoos<br />
|* Line discounts smaller than 1.00 are not printed on the invoice line.<br />
|* lval() is used in the print condition and this truncates the argument.<br />
|*	Rev.No. 2  ciB60asy79  05 Jun 14 rhaitsma<br />
|* 800-196679, domain bpmdm.telp --&gt;tctelp.<br />
|*	Rev.No. 4  ciB60asy79  06 Jun 14 rmahesh<br />
|* Enable tax handling in different currency than the net invoice currency by<br />
|* creating separate net and tax invoices. See cd# 52961.<br />
|*	Rev.No. 5  ciB60asy79  20 Jun 14 fvantoly<br />
|* 800-196848 'Rebate Agreement Text' should be renamed into 'Invoice Text'<br />
|* throughout invoicing<br />
|*<br />
|* SOL 1504265<br />
|* Because the discount percentage is stored in a string ending in &quot; %&quot;, the<br />
|* val() function in print condition cannot handle this and no percentage is<br />
|* printed. Val() is moved to report script.<br />
|* InforXtreme 454361<br />
|*	Rev.No. 6  ciB60asy79  24 Jun 14 eprovoos<br />
|* Porting SOL 1504265, Erik Provoost, 2014-06-06<br />
|* Because the discount percentage is stored in a string ending in &quot; %&quot;, the<br />
|* val() function cannot handle this and no percentage is printed<br />
|* InforXtreme 454361<br />
|*	Rev.No. 7  ciB60asy79  26 Jun 14 fvantoly<br />
|* SOL 1506962, Robert Haitsma, 2014-06-04 The invoice-to contact and the<br />
|* business entity identifier are not available on the invoice report. (No<br />
|* InforXtreme defect available).<br />
|*	Rev.No. 2  ciB60asy81  29 Jul 14 rhaitsma<br />
|* 800-197620, For the reference activity based pricing topic 3 new fields must<br />
|* be added to the billable line and printed on the invoice: Reference Activity,<br />
|* Master Routing and Routing Option.<br />
|*	Rev.No. 3  ciB60asy81  30 Jul 14 bpape<br />
|* Add r.ih.fees.penalty to the report<br />
|*	Rev.No. 4  ciB60asy81  01 Aug 14 rhaitsma<br />
|* Porting of KB 1502299, In case part of the invoice lines are exempt from tax,<br />
|* the taxable amount as shown in the tax summary is not correct. It shows the<br />
|* complete invoice amount and not the amount for which the tax applies.<br />
|* (InforXtreme: 453343)<br />
|*	Rev.No. 3  ciB60asy82  02 Sep 14 bpape<br />
|* BP-suramnt: Add r.mpr.surch.amnt and r.mpr.tot.surch to the report input<br />
|* fields (not yet available in the integration)<br />
|*	Rev.No. 2  ciB6111sy01  16 Dec 14 rhaitsma<br />
|* Title is derived from the contact of the invoice-to BP. If not present then<br />
|* the title of the invoice-to BP is used.<br />
|*	Rev.No. 3  ciB6111sy01  17 Dec 14 bpape<br />
|* Conversion: cisli.srtp -&gt; tcsli.srtp<br />
|*	Rev.No. 4  ciB6111sy01  17 Dec 14 bpape<br />
|* citcslisrtp: Replace cisli.srtp with the identical tcsli.srtp<br />
|*	Rev.No. 5  ciB6111sy01  19 Dec 14 bpape<br />
|* citcslisrtp: Replace cisli.ortp with tcsli.srtp<br />
|*	Rev.No. 6  ciB6111sy01  29 Dec 14 bpape<br />
|* When printing to MS SSRS, only the first due date is present (r.due.date),<br />
|* but all other payment terms are not, due to these being arrays. New input<br />
|* fields should be set and rpi.write.additional.row should be used.<br />
|* DF 481328; KB 1583946<br />
|*	Rev.No. 7  ciB6111sy01  28 Jan 15 rhaitsma<br />
|* LND2-2486, Domain of cisli505.pksp changed from tcmcs.st30m into tcpksp.<br />
|* Domain of cisli505.pksl changed from tcmcs.st30m into tcpksl.<br />
|*	Rev.No. 2  ciB6112sy01  08 May 15 eprovoos<br />
|* Porting KB 1444682, German requirement for &quot;Korrekturrechnung&quot;.<br />
|* InforXtreme 495634<br />
|*	Rev.No. 3  ciB6112sy01  08 May 15 fvantoly<br />
|* LND2-2061 Terminology Change billing.request -&gt; invoicing.batch<br />
|*	Rev.No. 4  ciB6112sy01  11 May 15 fvantoly<br />
|* LND2-2061 terminology change for reports<br />
|*	Rev.No. 5  ciB6112sy01  01 Jun 15 inforln<br />
|* TIV number of component set to 2020<br />
|*	Rev.No. 2  ciB6113sy01  12 Jun 15 rhaitsma<br />
|* LND2-5420, Intercompany Trade. Remove obsolete source types.<br />
|*	Rev.No. 2  ciB6116sy01  04 Mar 16 fvantoly<br />
|* Installment Invoicing - Prorate installments.CD #54407.<br />
|*	Rev.No. 3  ciB6116sy01  24 Mar 16 hbohemen<br />
|* lnd2-5078: Logistic fields reference to logistic/operational tables.<br />
|*	Rev.No. 4  ciB6116sy01  24 Mar 16 hbohemen<br />
|* fp16-debug<br />
|*	Rev.No. 5  ciB6116sy01  30 Mar 16 rhaitsma<br />
|* LND2-5158, removed direct use of tcmcs.dll0036.<br />
|*	Rev.No. 6  ciB6116sy01  31 Mar 16 rhaitsma<br />
|* LND2-10517, removal of tp-specific domains.<br />
|*	Rev.No. 7  ciB6116sy01  13 May 16 hbohemen<br />
|* lnd2-5078: Logistic fields reference to logistic/operational tables.<br />
|******************************************************************************<br />
declaration:<br />
#ident &quot;@(#)cisli120011000  ciB6116sy01  NLBAWAPPSDEV1  Rev.No. 7  13 May 16  hbohemen&quot;<br />
#ident &quot;@(#)cisli120011000  ciB6113sy01  NLBAWAPPSDEV1  Rev.No. 2  12 Jun 15  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB6112sy01  NLBAWAPPSDEV1  Rev.No. 4  11 May 15  fvantoly&quot;<br />
#ident &quot;@(#)cisli120011000  ciB6111sy01  NLBAWAPPSDEV1  Rev.No. 7  28 Jan 15  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy82  NLBAWAPPSDEV1  Rev.No. 3  02 Sep 14  bpape&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy81  NLBAWAPPSDEV1  Rev.No. 4  01 Aug 14  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy79  NLBAWAPPSDEV1  Rev.No. 7  26 Jun 14  fvantoly&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy77  nlbaudv3  Rev.No. 13  19 Mar 14  bpape&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy76  nlbaudv3  Rev.No. 2  05 Jul 13  bpape&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy74  nlbaudv3  Rev.No. 4  16 May 13  rmahesh&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy72  nlbaudv3  Rev.No. 6  11 Feb 13  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy67  nlbaudv3  Rev.No. 4  10 Oct 12  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy66  nlbaudv3  Rev.No. 3  17 Sep 12  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy65  nlbaudv3  Rev.No. 2  04 Jul 12  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy63  nlbaudv3  Rev.No. 3  26 Apr 12  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy61  nlbaudv3  Rev.No. 21  14 Mar 12  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy61  nlbaudv1  Rev.No. 10  04 Nov 11  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy59  nlbaudv1  Rev.No. 4  15 Dec 10  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy57  nlbaudv1  Rev.No. 4  21 Sep 10  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy54  nlbaudv1  Rev.No. 5  18 Feb 10  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60ast6  nlbaudv1  Rev.No. 5  19 Oct 09  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy53  nlbaudv1  Rev.No. 2  23 Sep 09  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy52  nlbaudv1  Rev.No. 5  17 Sep 09  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy51  nlbaudv1  Rev.No. 5  31 Aug 09  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy50  nlbaudv1  Rev.No. 4  22 Jul 09  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy49  nlbaudv1  Rev.No. 2  09 Jun 09  rhaitsma&quot;<br />
#ident &quot;@(#)cisli120011000  ciB60asy48  nlbaudv1  Rev.No. 9  25 May 09  rhaitsma&quot;<br />
<br />
	#include &lt;bic_text&gt;<br />
	#include &quot;itccom0000&quot;	|* Multicurrency variables and handling<br />
	#include &quot;itcmcs0012&quot;<br />
<br />
	#define monospace					|#800-179186.n<br />
	#define	MAX.NO.DISCOUNTS	11<br />
<br />
<br />
	table	tcisli305	| Invoice Header<br />
	table	tcisli310	| Invoice Lines<br />
	table	ttcibd001	| Items<br />
	table	ttdsls400	| Sales Orders<br />
	table	ttccom140	| Contacts<br />
	table	ttccom130	| Addresses<br />
	table	ttcmcs002	| Currencies<br />
<br />
		domain	tcmcs.long	ii<br />
		domain	tcmcs.long	len.paym<br />
		domain	tcmcs.long	no.disc.lines<br />
		domain	tcmcs.long	remaining.empty.header.lines<br />
	extern	domain	tcmcs.long	r.disc.element<br />
<br />
			boolean		repeat.layout<br />
			boolean		get.payment.schedule<br />
		domain	tctax.rndg	tax.rounding.method<br />
<br />
		domain	tcmcs.str12	discount.format<br />
		domain	tcmcs.str12	amount.format<br />
<br />
		domain	tclang		dummy.language<br />
		domain	tcmcs.long	dummy.long<br />
			string		dummy.string(1)<br />
		domain	tcmcs.s300m	dummy.error.message<br />
<br />
	|* General<br />
	extern	domain	tcmcs.st35	r.doc.type.string<br />
	extern		boolean		r.end.invoice<br />
|*	extern	domain	tcmcs.str12	r.discount	|* old TCS 800-172163<br />
	extern	domain	tcmcs.str14	r.discount	|* new TCS 800-172163<br />
|	extern	domain	tcamnt		r.goods.net.amnt	|#1061448.o<br />
	extern	domain	tcamnt		r.transport.amount<br />
	extern	domain	tctax.rndg	r.tax.rounding.method<br />
	extern	domain	tcgld.date	invoice.date<br />
	extern	domain	tcbool		r.print.discount.value	|#1504265.n<br />
	extern	domain	tcbool		r.print.discount	|#1398488.sn<br />
	extern	domain	tcbool		r.aggregated.line<br />
	extern	domain	tcpono		r.activity		|#1398488.en<br />
	extern	domain	tcbool		r.hide.price		|#800-192539.n<br />
<br />
	|* Lots and Serials<br />
		domain	tcmcs.long	lot.serial.element<br />
|	extern	domain	tcmcs.str100	r.lot.serial.string	|#1419676.o<br />
	extern	domain	tcmcs.str100	r.lots.serials(1)		based<br />
	extern	domain	tcqiv1		r.lot.qty(1)			based<br />
								|#1419676.so<br />
|	extern	domain	tcmcs.long	r.no.lots.serials	|#1025761.n<br />
								|#1419676.eo<br />
	|* Tax Summary<br />
|			boolean		tax.by.tax.authority<br />
|			boolean		tax.by.tax.code<br />
|		domain	tcmcs.long	sql.id.tax.authority<br />
|		domain	tcmcs.long	sql.id.tax.code<br />
	extern	domain	tcmcs.ctau	r.tax.authority<br />
	extern	domain	tcdsca		r.tax.authority.desc<br />
	extern	domain	tcyesno		r.tax.line.exempt	|#1502299.n<br />
	extern	domain	tcfovn		r.tax.authority.exempt<br />
	extern	domain	tcamnt		r.tax.authority.base.am<br />
	extern	domain	tcpvat		r.tax.authority.percent<br />
	extern	domain	tcamnt		r.tax.authority.am<br />
	extern	domain	tcamnt		r.tax.authority.am.hc<br />
	extern	domain	tcmcs.str10	r.jurisdiction.level	|#1001034.n<br />
|	extern	domain	tcamnt		r.tax.authority.am.hc(MAX.CURRENCIES)<br />
			boolean		g.tax.summary<br />
			boolean		g.tax.code.present<br />
			boolean		g.tax.authority.present<br />
		domain	tctxtn		g.tax.text<br />
			long		g.current.tax.authority.record<br />
			long		g.current.tax.code.record<br />
|		domain	tcccty		g.current.tax.country<br />
|		domain	tccvat		g.current.tax.code<br />
		domain	tcmcs.long	g.no.of.records<br />
		domain	tcmcs.long	g.no.of.tax.codes<br />
		domain	tcmcs.long	g.no.of.home.currencies<br />
		domain	tcmcs.long	i<br />
	extern	domain	tcmcs.ctau	r.ts.tax.authority(1)		based<br />
	extern	domain	tcdsca		r.ts.tax.authority.desc(1)	based<br />
								|#1502299.sn<br />
	extern	domain	tcyesno		r.ts.tax.line.exempt(1)		based<br />
								|#1502299.en<br />
	extern	domain	tcfovn		r.ts.tax.authority.exempt(1)	based<br />
	extern	domain	tcamnt		r.ts.tax.authority.base.am(1)	based<br />
	extern	domain	tcpvat		r.ts.tax.authority.percent(1)	based<br />
	extern	domain	tcamnt		r.ts.tax.authority.am(1)	based<br />
	extern	domain	tcamnt		r.ts.tax.authority.am.hc(1, 1)	based<br />
								|#1001034.sn<br />
	extern	domain	tcmcs.str10	r.ts.juris.level(1)		based<br />
								|#1001034.en<br />
	extern	domain	tcccty		r.ts.tax.country.array(1)	based<br />
	extern	domain	tccvat		r.ts.tax.code.array(1)		based<br />
								|#1869187.sn<br />
	extern	domain	tctxtn		r.ts.tax.text.array(1)		based<br />
								|#1869187.en<br />
								|#aggr_tax.sn<br />
	extern	domain	tccvat		r.ts.line.tax.code.array(1)	based<br />
								|#aggr_tax.en<br />
<br />
	|* Payment Schedules<br />
		domain	tcmcs.long	no.paym.sched.lines<br />
		domain	tcgld.date	paym.sched.due.date.local.arr(1)   based<br />
|	extern	domain	tcmcs.long	r.paym.sched.element	|#1583946.so<br />
|	extern	domain	tcamnt		r.paym.sched.tot.amount<br />
|	extern	domain	tcccur		r.paym.sched.euro	|#1583946.eo<br />
	extern	domain	tcmcs.long	r.ps.element		|#1583946.sn<br />
	extern	domain	tcamnt		r.ps.total.amount<br />
	extern	domain	tcccur		r.ps.euro		|#1583946.en<br />
	extern	domain	tcamnt		r.paym.sched.amount.arr(1)	   based<br />
	extern	domain	tcamnt		r.paym.sched.amount.eur.arr(1)	   based<br />
	extern	domain	tcpaym		r.paym.sched.payment.method.arr(1) based<br />
	extern	domain	tcdate		r.paym.sched.due.date.arr(1)	   based<br />
	|* Variables specific for MS SSRS			|#1583946.sn<br />
	extern	domain	tcbool		r.ps.line<br />
	extern	domain	tcdate		r.ps.due.date<br />
	extern	domain	tcamnt		r.ps.amount<br />
	extern	domain	tcamnt		r.ps.amount.eur<br />
	extern	domain	tcpaym		r.ps.paym.method	|#1583946.en<br />
<br />
|	|* Delivery Notes<br />
|		domain	tcmcs.long	length.delivery.notes<br />
|		domain	tcmcs.long	pos.of.next.delivery.note<br />
|		domain	tcmcs.str300m	delivery.notes<br />
<br />
	|* Service Contract Configurations<br />
			boolean		dummy.bool		|#1451250.sn<br />
		domain	tcmcs.long	configurations.counter	|#1451250.en<br />
<br />
	|* Kitting Components<br />
	static		boolean		g.arrays.filled<br />
		domain	tcmcs.long	g.actual.component.line<br />
		domain	tcmcs.long	g.max.no.of.components<br />
		domain	tcshpm		g.component.shipment(1)		based<br />
		domain	tcpono		g.component.shipment.line(1)	based<br />
								|#800-176216.sn<br />
		domain	tcshpm		g.component.receipt(1)		based<br />
		domain	tcpono		g.component.receipt.line(1)	based<br />
								|#800-176216.en<br />
		domain	tcncmp		g.logistic.company(1)		based<br />
								|#1869550.sn<br />
		domain	cisli.seqn	g.dummy.sequence(1)		based<br />
								|#1869550.en<br />
		domain	tcitem		g.component(1)			based<br />
		domain	tcqiv1		g.delivered.qty.inv.unit(1)	based<br />
		domain	tcqsl1		g.delivered.qty.order.unit(1)	based<br />
		domain	tccuni		g.order.unit(1)			based<br />
		domain	tcconv		g.conversion.factor(1)		based<br />
		domain	tcdate		g.delivery.date(1)		based<br />
		domain	tccdec		g.terms.of.delivery(1)		based<br />
		domain	tcptpa		g.point.of.title.passage(1)	based<br />
		domain	tcguid		g.lot.and.serial.set(1)		based<br />
		domain	tccrte		g.route(1)			based<br />
		domain	tccfrw		g.carrier.lsp(1)		based<br />
		domain	tctxtn		g.component.text(1)		based<br />
		domain	tctxtn		g.item.text(1)			based<br />
	extern	domain	tcitem		r.component.item<br />
	extern	domain	tcdsca		r.component.item.dsca<br />
	extern	domain	tcqsl1		r.component.ordered.qty<br />
	extern	domain	tcqiv1		r.component.ordered.qty.inv<br />
	extern	domain	tcqsl1		r.component.delivered.qty<br />
	extern	domain	tcqiv1		r.component.delivered.qty.inv<br />
	extern	domain	tccuni		r.component.sales.unit<br />
	extern	domain	tccuni		r.component.inventory.unit<br />
	extern	domain	tcmcs.s100m	r.component.terms.of.delivery.dsca<br />
	extern	domain	tcshpm		r.component.shipment<br />
	extern	domain	tcpono		r.component.shipment.line<br />
	extern	domain	tcshpm		r.component.receipt	|#800-176216.n<br />
	extern	domain	tcpono		r.component.receipt.line|#800-176216.n<br />
	extern	domain	tcdate		r.component.delivery.date<br />
	extern	domain	tccrte		r.component.route<br />
	extern	domain	tcdsca		r.component.route.dsca<br />
	extern	domain	tccfrw		r.component.carrier.lsp<br />
	extern	domain	tcdsca		r.component.carrier.lsp.dsca<br />
	extern	domain	tcmcs.str30	r.component.text.label<br />
	extern	domain	tcmcs.str30	r.item.text.label<br />
<br />
	|* Material Pricing lines				|#lnd-8235.sn<br />
		domain	tcmcs.long	mpr.current.line<br />
	extern	domain	tcmcs.long	r.mpr.num.lines<br />
	extern	domain	tcbool		r.mpr.is.detail<br />
	extern	domain	tcpono		r.mpr.line.arr(1) based<br />
	extern	domain	tcmpr.matr	r.mpr.material.arr(1) based<br />
	extern	domain	tcdsca		r.mpr.material.description.arr(1) based<br />
	extern	domain	tcqrd3		r.mpr.content.quantity.arr(1) based<br />
	extern	domain	tccuni		r.mpr.material.unit.arr(1) based<br />
	extern	domain	tcqrd3		r.mpr.quantity.factor.arr(1) based<br />
	extern	domain	tcmcs.fact	r.mpr.billable.quantity.factor.arr(1) based<br />
	extern	domain	tcpric		r.mpr.base.price.arr(1) based<br />
	extern	domain	tccuni		r.mpr.price.unit.arr(1) based<br />
	extern	domain	tcpric		r.mpr.tot.base.price.arr(1) based<br />
	extern	domain	tcpric		r.mpr.actual.price.arr(1) based<br />
	extern	domain	tcpric		r.mpr.tot.actual.price.arr(1) based<br />
	extern	domain	tcyesno		r.mpr.manual.actual.price.arr(1) based<br />
	extern	domain	tcyesno		r.mpr.manual.arr(1) based<br />
	extern	domain	tctxtn		r.mpr.text.arr(1) based<br />
								|#BP-suramnt.sn<br />
	extern	domain	tcamnt		r.mpr.surch.amnt.arr(1) based<br />
								|#BP-suramnt.en<br />
<br />
	extern	domain	tcpono		r.mpr.line<br />
	extern	domain	tcmpr.matr	r.mpr.material<br />
	extern	domain	tcdsca		r.mpr.mat.desc<br />
	extern	domain	tcqrd3		r.mpr.cont.quan<br />
	extern	domain	tccuni		r.mpr.mat.unit<br />
	extern	domain	tcqrd3		r.mpr.quan.fact<br />
	extern	domain	tcmcs.fact	r.mpr.bill.fact<br />
	extern	domain	tcpric		r.mpr.base.price<br />
	extern	domain	tccuni		r.mpr.price.unit<br />
	extern	domain	tcpric		r.mpr.tot.base<br />
	extern	domain	tcpric		r.mpr.actual.pric<br />
	extern	domain	tcpric		r.mpr.tot.actual<br />
	extern	domain	tcyesno		r.mpr.man.actual<br />
	extern	domain	tcyesno		r.mpr.manual<br />
	extern	domain	tctxtn		r.mpr.line.text		|#lnd-8235.en<br />
	extern	domain	tcamnt		r.mpr.surch.amnt	|#BP-suramnt.n<br />
<br />
	extern	domain	tcmcs.str30	r.210.irdt.label	|#800-179680.n<br />
	extern	domain	tcmcs.str30	r.210.irai.label	|#800-179680.n<br />
<br />
	extern	domain	tcmcs.str15	ship_to<br />
	extern	domain	tcwght		weight, total.wght, s.total.wght<br />
	extern	domain	tcmcs.str30	del.tel, del.fax, del.attn, del.name, tel, fax, attn<br />
	extern	domain	tcqiv1		s.total.qty, total.qty<br />
	extern	domain	tcamnt		total.amount<br />
	extern	domain  tcmcs.str132    amnt.word2, noted.bottom.1, noted.bottom.2, noted.bottom.3, noted.bottom.4, noted.bottom.5, noted.bottom.6<br />
<br />
<br />
	string amt.txt(11), chr.sgl(1), word.sgl(10)<br />
    	string chr.ten(1), word.ten(10), amt.inword(132)<br />
    	string word.A(10), word.B(10), word.c(10), word.D(10), word.E(10)<br />
    	string word.F(10), word.G(10), word.H(10), Word.I(10), word.J(10)<br />
    	string str.A(1), str.B(1), str.c(1), str.D(1), str.E(1)<br />
    	string str.F(1), str.G(1), str.H(1), str.I(1), str.J(1)<br />
	string unit.mil(10), unit.tsd(10), unit.hrd(10), unit.cen(10), unit.hts(10)<br />
	string ccur.desc(20)<br />
<br />
	#define TEXT.HANDLING	{validate.textline()}<br />
<br />
before.program:<br />
	e = rdi.domain(	&quot;tcdisc&quot;,<br />
			discount.format,<br />
			dummy.string,<br />
			dummy.string,<br />
			dummy.long,<br />
		   	dummy.string,<br />
		   	dummy.long)<br />
<br />
	e = rdi.domain(	&quot;tcamnt&quot;,<br />
			amount.format,<br />
			dummy.string,<br />
			dummy.string,<br />
			dummy.long,<br />
		  	dummy.string,<br />
		  	dummy.long)<br />
<br />
	e = rdi.domain.string(<br />
			domainof(r.paym.sched.payment.method.arr),<br />
			len.paym,<br />
			dummy.long)<br />
<br />
	r.slash = &quot;/&quot;						|#800-184626.n<br />
<br />
|******************************************************************************<br />
|* BEFORE LAYOUTS<br />
|******************************************************************************<br />
before.r.copy.nr.10:					|* Invoice Header<br />
before.layout:<br />
	if r.document.type = cisli.doct.invoice and<br />
	   r.source.type = tcsli.srtp.debit.credit then<br />
		r.doc.type.string = form.text$(	&quot;cislis255506&quot;,<br />
					  	 lattr.language$)<br />
	else<br />
								|#1444682.sn<br />
		if r.document.type = cisli.doct.credit and<br />
		   (r.source.type = tcsli.srtp.sales.order or<br />
|		    r.source.type = tcsli.srtp.wareh.order or	|#LND2-5420.o<br />
		    r.source.type = tcsli.srtp.service.order or<br />
		    r.source.type = tcsli.srtp.service.contr or<br />
		    r.source.type = tcsli.srtp.project) then<br />
		    	|* For Germany negative invoices should be marked<br />
		    	|* as &quot;Korrekturrechnung&quot; and not as &quot;Gutschrift&quot;<br />
			r.doc.type.string = form.text$(	&quot;cislis255517&quot;,<br />
					  	 lattr.language$)<br />
		else						|#1444682.en<br />
			r.doc.type.string = enum.descr$(<br />
						domainof(r.document.type),<br />
					    	r.document.type,<br />
					    	lattr.language$)<br />
		endif						|#1444682.n<br />
	endif<br />
<br />
before.r.copy.nr.20:					|* Invoice Header<br />
before.layout:<br />
	if r.document.type = cisli.doct.invoice and<br />
	   r.source.type = tcsli.srtp.debit.credit then<br />
		r.doc.type.string = form.text$(	&quot;cislis255506&quot;,<br />
					   	lattr.language$)<br />
	else<br />
								|#1444682.sn<br />
		if r.document.type = cisli.doct.credit and<br />
		   (r.source.type = tcsli.srtp.sales.order or<br />
|		    r.source.type = tcsli.srtp.wareh.order or	|#LND2-5420.o<br />
		    r.source.type = tcsli.srtp.service.order or<br />
		    r.source.type = tcsli.srtp.service.contr or<br />
		    r.source.type = tcsli.srtp.project) then<br />
		    	|* For Germany negative invoices should be marked<br />
		    	|* as &quot;Korrekturrechnung&quot; and not as &quot;Gutschrift&quot;<br />
			r.doc.type.string = form.text$(	&quot;cislis255517&quot;,<br />
					  	 lattr.language$)<br />
		else						|#1444682.en<br />
			r.doc.type.string = enum.descr$(<br />
						domainof(r.document.type),<br />
					    	r.document.type,<br />
					    	lattr.language$)<br />
		endif						|#1444682.n<br />
	endif<br />
<br />
before.r.copy.nr.25:					|* Empty Header Line<br />
after.layout:<br />
	remaining.empty.header.lines = remaining.empty.header.lines - 1<br />
	if remaining.empty.header.lines &gt; 0 then<br />
		layout.again()<br />
	endif<br />
<br />
before.r.copy.nr.50:					|* Invoice Header<br />
before.layout:<br />
	message(&quot;before.r.copy.nr.50: %s&quot;, r.ih.trns.typ &amp; &quot; &quot; &amp; str$(r.ih.doc.nr))<br />
	<br />
	select cisli305.*<br />
	from cisli305<br />
	where cisli305.tran = :r.ih.trns.typ and cisli305.idoc = :r.ih.doc.nr<br />
	selectdo<br />
		if cisli305.ofad = cisli305.stoa then<br />
			ship_to = &quot;&quot;<br />
		else<br />
			ship_to = &quot;Delivered To : &quot;<br />
			get.del.contact()<br />
		endif<br />
	endselect<br />
<br />
	get.customer.contact()<br />
	<br />
|	lattr.pageno = 1<br />
	remaining.empty.header.lines = r.no.empty.hdlin<br />
|	r.transport.amount = 0.0<br />
|	r.paym.sched.tot.amount = 0.0				|#1583946.o<br />
	r.end.invoice = false<br />
<br />
	invoice.date = get.report.invoice.date(<br />
					r.invoice.comp,<br />
					r.print.option,<br />
|					r.billing.req.id,	|#1061448.o<br />
					r.invoicing.batch,	|#1061448.n<br />
					r.ih.idat)<br />
<br />
<br />
before.r.copy.nr.56:						|#800-179260.sn<br />
before.layout:<br />
	if r.invoice.origin = 6 then<br />
		|* Service Contracts do not have a ship-to address.<br />
		lattr.print = false<br />
	endif							|#800-179260.en<br />
<br />
before.r.shipto.loca.add.27:					|#800-179260.sn<br />
before.layout:<br />
	if r.invoice.origin = 6 then<br />
		|* Service Contracts do not have a ship-to address.<br />
		lattr.print = false<br />
	endif							|#800-179260.en<br />
<br />
before.r.copy.nr.81:<br />
before.layout:<br />
	message(&quot;before.r.copy.nr.81: %s&quot;, r.ih.trns.typ &amp; &quot; &quot; &amp; str$(r.ih.doc.nr))<br />
<br />
|before.r.copy.nr.82:<br />
|before.layout:<br />
|	select cisli310.*<br />
|	from cisli310<br />
|	where cisli310.tran = :r.ih.trns.typ and cisli310.idoc = :r.ih.doc.nr<br />
|	selectdo<br />
|	endselect<br />
|<br />
|	select tcibd001.*<br />
|	from tcibd001<br />
|	where tcibd001.item = :cisli310.item <br />
|	selectdo<br />
|		weight = round((tcibd001.cdf_lent * tcibd001.cdf_lewt), 3, 1) * r.delv.qty.iou<br />
|	endselect<br />
|<br />
|after.layout:<br />
|	calculate.total.quantity(r.delv.qty.iou)<br />
|	calculate.total.weight(weight)<br />
<br />
<br />
<br />
|before.r.sort.key30.50:					|* Delivery Note<br />
|before.layout:<br />
|	delivery.notes = strip$(r.delv.notes)<br />
|	length.delivery.notes = len(delivery.notes)<br />
|	if length.delivery.notes &gt; 100 then<br />
|		pos.of.next.delivery.note = rpos(delivery.notes(1;100),&quot; &quot;)<br />
|	else<br />
|		pos.of.next.delivery.note = 100<br />
|	endif<br />
|<br />
|	r.delv.note = delivery.notes(1;pos.of.next.delivery.note)<br />
|	delivery.notes = delivery.notes(pos.of.next.delivery.note + 1)<br />
|<br />
|before.r.sort.key30.51:					|* Delivery Note<br />
|before.layout:<br />
|	length.delivery.notes = len(delivery.notes)<br />
|	if length.delivery.notes &gt; 132 then<br />
|		pos.of.next.delivery.note = rpos(delivery.notes(1;132),&quot; &quot;)<br />
|	else<br />
|		pos.of.next.delivery.note = 132<br />
|	endif<br />
|<br />
|	r.delv.note = delivery.notes(1;pos.of.next.delivery.note)<br />
|	delivery.notes = delivery.notes(pos.of.next.delivery.note + 1)<br />
|<br />
|after.layout:<br />
|	if not isspace(delivery.notes) then<br />
|		layout.again()<br />
|	endif<br />
<br />
|******************************************************************************<br />
|* DETAIL LAYOUTS<br />
|******************************************************************************<br />
<br />
detail.1:							|#243517.sn<br />
before.layout:<br />
	initialize.invoice.line.data()				|#243517.en<br />
<br />
	select cisli310.*<br />
	from cisli310<br />
	where cisli310.tran = :r.ih.trns.typ and cisli310.idoc = :r.ih.doc.nr<br />
	selectdo<br />
	endselect<br />
<br />
	select tcibd001.*<br />
	from tcibd001<br />
	where tcibd001.item = :cisli310.item <br />
	selectdo<br />
		weight = round((tcibd001.cdf_lent * tcibd001.cdf_lewt), 3, 1) * r.delv.qty.iou<br />
	endselect<br />
<br />
	layout.again()<br />
<br />
after.layout:<br />
	calculate.total.quantity(r.delv.qty.iou)<br />
	calculate.total.weight(weight)<br />
<br />
<br />
|detail.6:							|#800-179680.sn<br />
|detail.7:							|#REL_INV.o<br />
detail.9:							|#REL_INV.n<br />
before.layout:<br />
	r.210.irdt.label = form.text$(&quot;cislis21102&quot;)<br />
	|* Interest as on Date<br />
	r.210.irai.label = form.text$(&quot;cislis21101&quot;)<br />
	|* Open Invoice Amount					|#800-179680.en<br />
<br />
detail.13:							|#1451250.sn<br />
before.layout:<br />
	if r.no.of.configs &gt; 0 then<br />
		if configurations.counter &lt;= r.no.of.configs then<br />
		    |* no need to pass counter, function will get next config.<br />
		    dummy.bool = ciint.dlltsctm.read.service.contract.config(<br />
					r.logistical.comp,<br />
					r.order.nr,<br />
					r.order.line,<br />
					r.config.line,<br />
					r.cluster,<br />
					r.config.item,<br />
					r.item.serial.num)<br />
		else<br />
			lattr.print = false<br />
		endif<br />
	endif<br />
after.layout:<br />
	if configurations.counter &lt; r.no.of.configs then<br />
		configurations.counter = configurations.counter + 1<br />
		layout.again()<br />
	endif							|#1451250.en<br />
								|#1398488.sn<br />
detail.18:						|* Service Activity<br />
before.layout:<br />
	if r.aggregated.line and r.activity = 0 then<br />
		lattr.print = false<br />
	endif							|#1398488.en<br />
<br />
<br />
detail.30:						|* Kit Item Label<br />
before.layout:<br />
	if not print.sales.order.invoice.component.lines(<br />
					r.kitting.order,<br />
					r.print.kit.comp,<br />
					r.delv.qty.iiu) then<br />
		lattr.print = false<br />
	endif<br />
<br />
detail.31:				|* Invoice Line (Amount, Discount)<br />
before.layout:<br />
|	initialize.invoice.line.data()				|#243517.o<br />
<br />
	r.print.discount.value = false				|#1504265.n<br />
<br />
	|* In the discount column either the discount percentage or<br />
	|* discount amount is printed. Formatting this field is done here.<br />
|	if r.disc.perct.arr(1) &lt;&gt; 0 then<br />
	if double.cmp(			r.disc.perct.arr(1),<br />
					0.0,<br />
					0.0001) &lt;&gt; 0 then<br />
		|* percentage should be printed.<br />
		r.print.discount.value = true			|#1504265.n<br />
		|* Print discount percentage according format<br />
		r.discount = sprintf$(&quot;%@&quot; &amp; discount.format &amp; &quot;@&quot;,<br />
				 		  r.disc.perct.arr(1))<br />
|		r.discount = shiftr$(r.discount)		|#800-170429.o<br />
		r.discount = shiftr$(r.discount) &amp; &quot; %&quot;		|#800-170429.n<br />
<br />
		|* Shorten the print condition			|#1398488.sn<br />
		if r.print.gross.net&lt;&gt;tcgrnt.nett then<br />
			r.print.discount = true<br />
		else<br />
			r.print.discount = false<br />
		endif						|#1398488.en<br />
<br />
	else<br />
		|* No discount percentage defined. Hence print discount amount<br />
		|* according format. This is only applicable for sales invoices.<br />
		if r.invoice.origin = 4 then<br />
			r.discount =<br />
				sprintf$(amount.format &amp; &quot;,&quot; &amp; r.ih.ccur,<br />
					 r.disc.amount.arr(1))<br />
			r.discount = shiftr$(r.discount)<br />
|			if val(r.discount) &lt;&gt; 0.00 then<br />
			if double.cmp(	val(r.discount),	|#1504265.sn<br />
					0.0,<br />
					0.0001) &lt;&gt; 0 then<br />
				r.print.discount.value = true<br />
			endif					|#1504265.en<br />
		endif<br />
	endif<br />
<br />
after.layout:<br />
	r.transport.amount = r.transport.amount + r.amount<br />
<br />
detail.32:						|* Discounts<br />
before.layout:<br />
	|* Determine number of discount lines to be printed.<br />
	|* note that the first discount element is already printed in detail.31<br />
	if r.invoice.origin = 4 and<br />
	   no.disc.lines = 0 then<br />
		for ii = 2 to MAX.NO.DISCOUNTS<br />
|			if r.disc.perct.arr(ii) &lt;&gt; 0 or<br />
			if double.cmp(	r.disc.perct.arr(ii),<br />
					0.0,<br />
					0.0001) &lt;&gt; 0 or<br />
			   not EQUAL.TO(domainof(r.disc.amount.arr),<br />
					r.disc.amount.arr(ii), 0.0) then<br />
				no.disc.lines = ii<br />
			endif<br />
		endfor<br />
	endif<br />
<br />
	|* In the discount column either the discount percentage or<br />
	|* discount amount is printed. Formatting this field is done here.<br />
	if r.invoice.origin = 4 and<br />
	   r.disc.element &lt;= no.disc.lines then<br />
|		if r.disc.perct.arr(r.disc.element) &lt;&gt; 0 then<br />
		if double.cmp(		r.disc.perct.arr(r.disc.element),<br />
					0.0,<br />
					0.0001) &lt;&gt; 0 then<br />
			|* Print discount percentage according format<br />
			r.discount =<br />
				sprintf$(&quot;%@&quot; &amp; discount.format &amp; &quot;@&quot;,<br />
					 r.disc.perct.arr(r.disc.element))<br />
|			r.discount = shiftr$(r.discount)	|#800-170429.o<br />
			r.discount = shiftr$(r.discount) &amp; &quot; %&quot;	|#800-170429.n<br />
		else<br />
			|No discount percentage defined.<br />
			|Hence print discount amount according format<br />
			r.discount =<br />
				sprintf$(amount.format &amp; &quot;,&quot; &amp; r.ih.ccur,<br />
					 r.disc.amount.arr(r.disc.element))<br />
			r.discount =<br />
				shiftr$(r.discount)<br />
		endif<br />
	else<br />
		lattr.print = false<br />
	endif<br />
<br />
after.layout:<br />
	if r.disc.element &lt;= no.disc.lines then<br />
		r.disc.element = r.disc.element + 1<br />
		layout.again()<br />
	endif<br />
<br />
detail.33:							|#800-192539.sn<br />
before.layout:<br />
	if r.order.unit.dsun &lt;&gt; r.price.unit.dsun and<br />
	   not r.aggregated.line and<br />
	   not r.hide.price then<br />
		lattr.print = true<br />
	else<br />
		lattr.print = false<br />
	endif							|#800-192539.en<br />
<br />
detail.65:						|* Tax Code<br />
before.layout:<br />
	ciint.dlltctax.get.tax.rounding.method(<br />
					r.ih.fin.comp,<br />
					tax.rounding.method)<br />
	r.tax.rounding.method = tax.rounding.method<br />
<br />
detail.90:						|* Lots and Serials<br />
before.layout:<br />
	if lot.serial.element &lt;= r.no.lots.serials then<br />
								|#1419676.so<br />
|		r.lot.serial.string = r.lots.serials(1, lot.serial.element)<br />
								|#1419676.eo<br />
								|#1419676.sn<br />
		r.lot.serial.str = r.lots.serials(1, lot.serial.element)<br />
								|#1419676.en<br />
		if not EQUAL.TO(domainof(r.lot.qty),<br />
				r.lot.qty(lot.serial.element),<br />
				0.0) then<br />
								|#1419676.so<br />
|			r.lot.serial.string =<br />
|				strip$(r.lot.serial.string) &amp; &quot; &quot; &amp;<br />
|				str$(r.lot.qty(lot.serial.element))<br />
								|#1419676.eo<br />
								|#1419676.sn<br />
			r.lot.serial.str =<br />
				strip$(r.lot.serial.str) &amp; &quot; &quot; &amp;<br />
				str$(r.lot.qty(lot.serial.element))<br />
								|#1419676.en<br />
		endif<br />
	else<br />
		lattr.print = false<br />
	endif<br />
<br />
after.layout:<br />
	if lot.serial.element &lt; r.no.lots.serials then<br />
		lot.serial.element = lot.serial.element + 1<br />
		layout.again()<br />
	        r.lot.serial.line = true			|#1419676.sn<br />
	        rpi.write.additional.row()<br />
	        r.lot.serial.line = false			|#1419676.en<br />
	endif<br />
<br />
detail.135:						|* Kitting Components<br />
before.layout:<br />
	if not print.sales.order.invoice.component.lines(<br />
					r.kitting.order,<br />
					r.print.kit.comp,<br />
					r.delv.qty.iiu) then<br />
		lattr.print = false<br />
	else<br />
|		handle.sales.order.invoice.component.lines(<br />
|					r.logistical.comp,<br />
|					r.order.type,<br />
|					tckoor.act.sls,<br />
|					r.order.nr,<br />
|					r.order.set,<br />
|					r.order.line,<br />
|					r.invoice.line,<br />
|					r.shipment.id)<br />
								|#800-191132.so<br />
|		handle.sales.order.invoice.component.lines(<br />
|					r.ih.fin.comp,<br />
|					r.ih.trns.typ,<br />
|					r.ih.doc.nr,<br />
|					r.invoice.line)<br />
								|#800-191132.eo<br />
<br />
		if r.print.option = cisli.prno.draft then	|#1869550.sn<br />
			handle.billable.line.component.lines(<br />
						r.logistical.comp,<br />
						r.source.type,<br />
						r.order.nr,<br />
						r.order.line,<br />
						r.order.reference,<br />
						r.tech.reference,<br />
						r.billing.seqn)<br />
		else						|#1869550.en<br />
									|#800-191132.sn<br />
			handle.sales.order.invoice.component.lines(<br />
						r.logistical.comp,<br />
	|					r.order.type,		|#citcslisrtp.o<br />
						r.source.type,		|#citcslisrtp.n<br />
						tckoor.act.sls,<br />
						r.order.nr,<br />
						r.order.set,<br />
						r.order.line,<br />
						r.order.sequence,<br />
						r.shipment.id)<br />
									|#800-191132.en<br />
		endif						|#1869550.n<br />
	endif<br />
after.layout:<br />
	if g.actual.component.line &lt; g.max.no.of.components then<br />
		layout.again()<br />
	else<br />
		g.actual.component.line = 0<br />
		g.arrays.filled = false<br />
		free.mem(g.component.shipment)<br />
		free.mem(g.component.shipment.line)<br />
		free.mem(g.component.receipt)			|#800-176216.n<br />
		free.mem(g.component.receipt.line)		|#800-176216.n<br />
		free.mem(g.component)<br />
		free.mem(g.delivered.qty.inv.unit)<br />
		free.mem(g.delivered.qty.order.unit)<br />
		free.mem(g.order.unit)<br />
		free.mem(g.conversion.factor)<br />
		free.mem(g.delivery.date)<br />
		free.mem(g.terms.of.delivery)<br />
		free.mem(g.point.of.title.passage)<br />
		free.mem(g.lot.and.serial.set)<br />
		free.mem(g.route)<br />
		free.mem(g.carrier.lsp)<br />
		free.mem(g.component.text)<br />
		free.mem(g.item.text)<br />
	endif<br />
<br />
detail.200:				|* Tax Summary<br />
before.layout:<br />
	initialize.tax.summary.data()<br />
<br />
|	need(8 + g.no.of.records)				|#aggr_tax.o<br />
	need(8 + (g.no.of.records * 2))				|#aggr_tax.n<br />
<br />
|detail.201:		|* Tax Summary - Tax by Tax Authority	|#1001034.o<br />
detail.210:		|* Tax Summary - Tax by Tax Authority	|#1001034.n<br />
before.layout:<br />
|	if not g.tax.authority.present then<br />
	r.tax.text = 0						|#aggr_tax.n<br />
	if g.no.of.records = 0 or				|#mah.n<br />
	   (g.current.tax.authority.record &lt;= g.no.of.records and<br />
	   isspace(r.ts.tax.country.array(<br />
	   				1,<br />
	   				g.current.tax.authority.record))) then<br />
		lattr.print = false<br />
	else<br />
		r.tax.country = r.ts.tax.country.array(		|#aggr_tax.sn<br />
					1, g.current.tax.authority.record)<br />
		r.tax.code = r.ts.line.tax.code.array(<br />
					1, g.current.tax.authority.record)<br />
								|#aggr_tax.en<br />
		r.tax.authority = r.ts.tax.authority(<br />
					1, g.current.tax.authority.record)<br />
		r.tax.authority.desc = r.ts.tax.authority.desc(<br />
					1, g.current.tax.authority.record)<br />
		if not isspace(r.tax.authority.desc) then	|#1502299.sn<br />
			r.tax.line.exempt = r.ts.tax.line.exempt(<br />
					g.current.tax.authority.record)<br />
		else<br />
			r.tax.line.exempt = empty<br />
		endif						|#1502299.en<br />
		r.tax.authority.exempt = r.ts.tax.authority.exempt(<br />
					1, g.current.tax.authority.record)<br />
		r.tax.authority.base.am = r.ts.tax.authority.base.am(<br />
					g.current.tax.authority.record)<br />
		r.tax.authority.percent = r.ts.tax.authority.percent(<br />
					g.current.tax.authority.record)<br />
		r.tax.authority.am = r.ts.tax.authority.am(<br />
					g.current.tax.authority.record)<br />
		r.tax.authority.am.hc = r.ts.tax.authority.am.hc(<br />
					g.current.tax.authority.record, 1)<br />
		ciint.dlltcmcs.get.text.of.tax.code(		|#aggr_tax.sn<br />
					r.tax.country,<br />
					r.tax.code,<br />
					g.tax.text)<br />
		r.tax.text = g.tax.text				|#aggr_tax.en<br />
	endif<br />
after.layout:<br />
	if g.current.tax.authority.record &lt; g.no.of.records then<br />
		inc(g.current.tax.authority.record)<br />
		layout.again()<br />
	endif<br />
								|#aggr_tax.so<br />
||detail.202:		|* Tax Summary - Tax by Tax Code	|#1001034.o<br />
|detail.215:		|* Tax Summary - Tax by Tax Code	|#1001034.n<br />
|before.layout:<br />
||	if not g.tax.code.present then<br />
|	if g.no.of.records = 0 or				|#mah.n<br />
|	   (g.current.tax.text.record &lt;= g.no.of.records and<br />
|	   isspace(r.ts.tax.country.array(<br />
|	   				1,<br />
|	   				g.current.tax.text.record))) then<br />
|		lattr.print = false<br />
|	else<br />
|		r.tax.country = r.ts.tax.country.array(<br />
|					1, g.current.tax.text.record)<br />
||		r.tax.code = r.ts.tax.code.array(		|#aggr_tax.o<br />
|		r.tax.code = r.ts.line.tax.code.array(		|#aggr_tax.n<br />
|					1, g.current.tax.text.record)<br />
||		if not isspace(g.current.tax.country) and<br />
||		   not isspace(g.current.tax.code) and<br />
||		   g.current.tax.country = r.tax.country and<br />
||		   g.current.tax.code = r.tax.code then<br />
||			|* In case of multiple tax, the tax code should be<br />
||			|* printed only once in the tax summary.<br />
||			inc(g.current.tax.code.record)<br />
||			lattr.print = false<br />
||		endif<br />
|		r.tax.text = 0<br />
|		ciint.dlltcmcs.get.text.of.tax.code(<br />
|					r.tax.country,<br />
|					r.tax.code,<br />
|					g.tax.text)<br />
|		r.tax.text = g.tax.text<br />
||		g.current.tax.country = r.tax.country<br />
||		g.current.tax.code = r.tax.code<br />
|	endif<br />
|after.layout:<br />
||	if g.current.tax.code.record &lt; g.no.of.records then<br />
|	if g.current.tax.code.record &lt; g.no.of.records then<br />
|		inc(g.current.tax.code.record)<br />
|		layout.again()<br />
|	endif							|#aggr_tax.eo<br />
<br />
|detail.203:		|* Tax Summary				|#1001034.o<br />
detail.220:		|* Tax Summary - Internal tax		|#1001034.n<br />
before.layout:<br />
|	if not g.tax.authority.present and<br />
|	   not g.tax.code.present then<br />
|	if g.current.tax.authority.record &lt; g.no.of.records or<br />
|	   g.current.tax.code.record &lt; g.no.of.records then<br />
	if g.current.tax.authority.record &lt; g.no.of.tax.codes then<br />
		lattr.print = false<br />
	endif<br />
after.layout:<br />
	closing.tax.summary.data()<br />
<br />
detail.240:		|* Tax Summary - External Tax<br />
before.layout:<br />
	initialize.tax.summary.data()<br />
<br />
	need(8 + g.no.of.records)<br />
<br />
detail.250:		|* Tax Summary - Tax by Tax Authority	|#1001034.sn<br />
before.layout:<br />
	if g.no.of.records = 0 or<br />
	   (g.current.tax.authority.record &lt;= g.no.of.records and<br />
	   isspace(r.ts.tax.country.array(<br />
	   				1,<br />
	   				g.current.tax.authority.record))) then<br />
		lattr.print = false<br />
	else<br />
		r.tax.authority = r.ts.tax.authority(<br />
					1, g.current.tax.authority.record)<br />
		r.tax.authority.desc = r.ts.tax.authority.desc(<br />
					1, g.current.tax.authority.record)<br />
		if not isspace(r.tax.authority.desc) then	|#1502299.sn<br />
			r.tax.line.exempt = r.ts.tax.line.exempt(<br />
					g.current.tax.authority.record)<br />
		else<br />
			r.tax.line.exempt = empty<br />
		endif						|#1502299.en<br />
		r.tax.authority.exempt = r.ts.tax.authority.exempt(<br />
					1, g.current.tax.authority.record)<br />
		r.tax.authority.base.am = r.ts.tax.authority.base.am(<br />
					g.current.tax.authority.record)<br />
		r.tax.authority.percent = r.ts.tax.authority.percent(<br />
					g.current.tax.authority.record)<br />
		r.tax.authority.am = r.ts.tax.authority.am(<br />
					g.current.tax.authority.record)<br />
		r.tax.authority.am.hc = r.ts.tax.authority.am.hc(<br />
					g.current.tax.authority.record, 1)<br />
		r.jurisdiction.level = r.ts.juris.level(<br />
					1, g.current.tax.authority.record)<br />
	endif<br />
after.layout:<br />
	if g.current.tax.authority.record &lt; g.no.of.records then<br />
		inc(g.current.tax.authority.record)<br />
		layout.again()<br />
	endif							|#1001034.en<br />
<br />
detail.260:		|* Tax Summary - External Tax		|#1001034.n<br />
before.layout:<br />
	if g.current.tax.code.record &lt; g.no.of.tax.codes then<br />
		lattr.print = false<br />
	endif<br />
after.layout:<br />
	closing.tax.summary.data()<br />
<br />
								|#lnd-8235.sn<br />
detail.140:						|* Material Pricing<br />
before.layout:<br />
	if mpr.current.line &lt;= r.mpr.num.lines then<br />
		r.mpr.line = r.mpr.line.arr(mpr.current.line)<br />
		r.mpr.material = r.mpr.material.arr(1,mpr.current.line)<br />
		r.mpr.mat.desc = r.mpr.material.description.arr(1,mpr.current.line)<br />
		r.mpr.cont.quan = r.mpr.content.quantity.arr(mpr.current.line)<br />
		r.mpr.mat.unit = r.mpr.material.unit.arr(1,mpr.current.line)<br />
		r.mpr.quan.fact = r.mpr.quantity.factor.arr(mpr.current.line)<br />
		r.mpr.bill.fact = r.mpr.billable.quantity.factor.arr(mpr.current.line)<br />
		r.mpr.base.price = r.mpr.base.price.arr(mpr.current.line)<br />
		r.mpr.price.unit = r.mpr.price.unit.arr(1,mpr.current.line)<br />
		r.mpr.tot.base = r.mpr.tot.base.price.arr(mpr.current.line)<br />
		r.mpr.actual.pric = r.mpr.actual.price.arr(mpr.current.line)<br />
		r.mpr.tot.actual = r.mpr.tot.actual.price.arr(mpr.current.line)<br />
		r.mpr.man.actual = r.mpr.manual.actual.price.arr(mpr.current.line)<br />
		r.mpr.manual = r.mpr.manual.arr(mpr.current.line)<br />
		r.mpr.line.text = r.mpr.text.arr(mpr.current.line)<br />
								|#BP-suramnt.sn<br />
		r.mpr.surch.amnt = r.mpr.surch.amnt.arr(mpr.current.line)<br />
								|#BP-suramnt.en<br />
	else<br />
		lattr.print = false<br />
	endif<br />
<br />
after.layout:<br />
	if mpr.current.line &lt; r.mpr.num.lines then<br />
		inc(mpr.current.line)<br />
		layout.again()<br />
		r.mpr.is.detail = true<br />
		rpi.write.additional.row()<br />
		r.mpr.is.detail = false<br />
	endif							|#lnd-8235.en<br />
<br />
|******************************************************************************<br />
|* AFTER LAYOUTS<br />
|******************************************************************************<br />
after.r.copy.nr.5:<br />
before.layout:<br />
	r.end.invoice = true<br />
<br />
|after.r.copy.nr.10:			|* Tax Summary<br />
|before.layout:<br />
|	need(calculate.needed.lines.for.tax.summary(<br />
|					r.ih.fin.comp,<br />
|					r.ih.trns.typ,<br />
|					r.ih.doc.nr))<br />
|	if draft.print then<br />
|		alloc.mem(tax.country,d.length(4),array.index.2)<br />
|		import(&quot;tax.country&quot;,tax.country)<br />
|		alloc.mem(tax.id.array, d.length(5), array.index.2)<br />
|		import(&quot;tax.id.array&quot;,tax.id.array)<br />
|		if tax.amounts.by.authority then<br />
|			alloc.mem(tax.authority, d.length(1), array.index.1)<br />
|			import(&quot;tax.authority&quot;, tax.authority)<br />
|			alloc.mem(tax.authority.desc,d.length(2), array.index.1)<br />
|			import(&quot;tax.authority.desc&quot;,tax.authority.desc)<br />
|			alloc.mem(tax.exempt.numb,d.length(3), array.index.1)<br />
|			import(&quot;tax.exempt.numb&quot;,tax.exempt.numb)<br />
|			alloc.mem(tax.base.amnt.inv, array.index.1)<br />
|			import(&quot;tax.base.amnt.inv&quot;,tax.base.amnt.inv)<br />
|			alloc.mem(tax.percent,array.index.1)<br />
|			import(&quot;tax.percent&quot;,tax.percent)<br />
|			alloc.mem(tax.amnt.inv,array.index.1)<br />
|			import(&quot;tax.amnt.inv&quot;,tax.amnt.inv)<br />
|			alloc.mem(tax.amnt.home,array.index.1,no.currencies)<br />
|			import(&quot;tax.amnt.home&quot;,tax.amnt.home)<br />
|		endif<br />
|	endif<br />
|<br />
|	tax.by.tax.authority = false<br />
|	sql.id.tax.authority = sql.parse(<br />
|		&quot;select	 cisli209.ctau:r.tax.authority,	&quot; 	  &amp;<br />
|			&quot;cisli209.dsca:r.tax.authority.desc, &quot; 	  &amp;<br />
|			&quot;cisli209.exno:r.tax.authority.exempt, &quot;  &amp;<br />
|			&quot;cisli209.tbai:r.tax.authority.base.am, &quot; &amp;<br />
|			&quot;cisli209.perc:r.tax.authority.percent,	&quot; &amp;<br />
|			&quot;cisli209.txai:r.tax.authority.am, &quot; 	  &amp;<br />
|			&quot;cisli209.txah:r.tax.authority.am.hc &quot;	  &amp;<br />
|		&quot;from	 cisli209 &quot; 				  &amp;<br />
|		&quot;where	 cisli209._index1 = {:r.ih.fin.comp, &quot; 	  &amp;<br />
|					    &quot;:r.ih.trns.typ, &quot;	  &amp;<br />
|					    &quot;:r.ih.doc.nr} &quot;)<br />
|	sql.exec(sql.id.tax.authority)<br />
|<br />
|	if not sql.fetch(sql.id.tax.authority) then<br />
|		tax.by.tax.authority = true<br />
|	else<br />
|		sql.close(sql.id.tax.authority)<br />
|	endif<br />
|<br />
|	tax.by.tax.code = false<br />
|	sql.id.tax.code = sql.parse(<br />
|		&quot;select  cisli206.txct:r.tax.country, &quot;		&amp;<br />
|			&quot;cisli206.txid:r.tax.code &quot;		&amp;<br />
|		&quot;from 	 cisli206 &quot; 				&amp;<br />
|		&quot;where	 cisli206._index1 = {:r.ih.fin.comp, &quot;	&amp;<br />
|					    &quot;:r.ih.trns.typ, &quot;	&amp;<br />
|					    &quot;:r.ih.doc.nr} &quot;)<br />
|<br />
|	sql.exec(sql.id.tax.code)<br />
|<br />
|	if not sql.fetch(sql.id.tax.code) then<br />
|		tax.by.tax.code = true<br />
|	else<br />
|		sql.close(sql.id.tax.code)<br />
|	endif<br />
|<br />
|	if not tax.by.tax.authority and<br />
|	   not tax.by.tax.code then<br />
|		lattr.print = false<br />
|	endif<br />
<br />
|after.r.copy.nr.11:			|* Tax Summary - Tax by Tax Authority<br />
|before.layout:<br />
|	if not tax.by.tax.authority then<br />
|		lattr.print = false<br />
|	endif<br />
|<br />
|after.layout:<br />
|	if not sql.fetch(sql.id.tax.authority) then<br />
|		layout.again()<br />
|	else<br />
|		lattr.print = false<br />
|		sql.close(sql.id.tax.authority)<br />
|	endif<br />
<br />
|after.r.copy.nr.12:			|* Tax Summary - Tax by Tax Code<br />
|before.layout:<br />
|	if not tax.by.tax.code then<br />
|		lattr.print = false<br />
|	else<br />
|		r.tax.text = 0<br />
|		select tcmcs036.txta:r.tax.text<br />
|		from   tcmcs036<br />
|		where  tcmcs036._index1={	:r.tax.country,<br />
|    						:r.tax.code}<br />
|		as set with 1 rows<br />
|		selectdo<br />
|		endselect<br />
|	endif<br />
<br />
|after.layout:<br />
|	if not sql.fetch(sql.id.tax.code) then<br />
|		layout.again()<br />
|	else<br />
|		lattr.print = false<br />
|		sql.close(sql.id.tax.code)<br />
|	endif<br />
<br />
|after.r.copy.nr.13:			|* Tax Summary<br />
|before.layout:<br />
|	if not tax.by.tax.authority and<br />
|	   not tax.by.tax.code then<br />
|		lattr.print = false<br />
|	endif<br />
<br />
<br />
after.r.copy.nr.24:<br />
before.layout:<br />
	skip.to(spool.pg.length - 15)	<br />
	<br />
	total.amount = r.ih.am.goods + r.ih.am.tax<br />
	total.qty = s.total.qty<br />
	total.wght = s.total.wght<br />
<br />
<br />
	if r.ih.trns.typ = &quot;SIN&quot; or r.ih.trns.typ = &quot;S01&quot; then<br />
	<br />
		amt.txt =edit$(round(total.amount,2,1), &quot;99999999VD99&quot;)<br />
<br />
			str.B =amt.txt(2;1)     |get million<br />
			chr.sgl =str.B<br />
			get.chrsgl()<br />
			word.B = word.sgl<br />
  <br />
			str.A = amt.txt(1;1)<br />
			chr.ten = Str.A<br />
			get.chrten()<br />
			word.A = word.ten  <br />
<br />
			if str.A =&quot;1&quot; then <br />
				word.B =&quot;&quot;<br />
			endif <br />
		<br />
			<br />
			if val(amt.txt(1;2)) &gt;0 then<br />
				unit.mil =&quot;million &quot;  <br />
			else unit.mil = &quot;&quot;<br />
			endif <br />
       <br />
			str.C =amt.txt(3;1)     |get hundred thousand<br />
			chr.sgl =str.C<br />
			get.chrsgl()<br />
			word.C = word.sgl <br />
<br />
			if val(str.c) &gt;0 then<br />
				unit.hts =&quot;hundred &quot;<br />
			else unit.hts = &quot;&quot;<br />
			endif    <br />
	<br />
			str.E =amt.txt(5;1)<br />
			chr.sgl =str.E<br />
			get.chrsgl()<br />
			word.E = word.sgl<br />
  <br />
			str.D = amt.txt(4;1)<br />
			chr.ten = Str.D<br />
			get.chrten()<br />
			word.D = word.ten  <br />
	<br />
			if str.D =&quot;1&quot; then <br />
				word.E =&quot;&quot;<br />
			endif <br />
	<br />
			if val(amt.txt(3;3)) &gt;0 then<br />
				unit.tsd =&quot;thousand &quot;<br />
			else unit.tsd = &quot;&quot;	<br />
			endif <br />
<br />
			str.F =amt.txt(6;1)     |get hundred <br />
			chr.sgl =str.F<br />
			get.chrsgl()<br />
			word.F = word.sgl <br />
<br />
			if val(str.F) &gt;0 then<br />
				unit.hrd =&quot;hundred &quot;<br />
			else unit.hrd = &quot;&quot;<br />
			endif    <br />
<br />
			str.H =amt.txt(8;1)<br />
			chr.sgl =str.H<br />
			get.chrsgl()<br />
			word.H = word.sgl<br />
  <br />
			str.G = amt.txt(7;1)<br />
			chr.ten = Str.G<br />
			get.chrten()<br />
			word.G = word.ten  <br />
<br />
			if str.G =&quot;1&quot; then <br />
				word.H =&quot;&quot;<br />
			endif <br />
<br />
			str.J =amt.txt(11;1)<br />
			chr.sgl =str.J<br />
			get.chrsgl()<br />
			word.J = word.sgl<br />
  <br />
			str.I = amt.txt(10;1)<br />
			chr.ten = Str.I<br />
			get.chrten()<br />
			word.I = word.ten  <br />
<br />
			if str.I =&quot;1&quot; then <br />
				word.J =&quot;&quot;<br />
			endif <br />
	<br />
			if val(amt.txt(10;2)) &gt;0 then<br />
				if val(amt.txt(1;8)) &gt; 0 then<br />
				unit.cen =&quot;and cent &quot;<br />
			else<br />
				unit.cen =&quot;cent &quot;<br />
			endif<br />
			else unit.cen = &quot;&quot;<br />
			endif  <br />
<br />
		get.ccurdesc()<br />
		<br />
		amt.inword = strip$(ccur.desc) &amp; &quot; &quot; &amp; word.A &amp; word.B &amp; unit.mil &amp; word.C &amp; unit.hts <br />
				&amp; word.D &amp; word.E &amp; unit.tsd &amp; word.F &amp; unit.hrd<br />
				&amp; word.G &amp; word.H &amp; unit.cen &amp; word.I &amp; word.J &amp; &quot;only&quot;<br />
<br />
		amnt.word2 = toupper$(amt.inword)<br />
<br />
	else if r.ih.trns.typ = &quot;SCN&quot; then<br />
		<br />
		amt.txt =edit$(round(total.amount,2,1), &quot;-9999999VD99&quot;)<br />
<br />
			str.B =amt.txt(2;1)     |get million<br />
			chr.sgl =str.B<br />
			get.chrsgl()<br />
			word.B = word.sgl<br />
  <br />
			str.A = amt.txt(1;1)<br />
			chr.ten = Str.A<br />
			get.chrten()<br />
			word.A = word.ten  <br />
<br />
			if str.A =&quot;1&quot; then <br />
				word.B =&quot;&quot;<br />
			endif <br />
		<br />
			<br />
			if val(amt.txt(1;2)) &gt;0 then<br />
				unit.mil =&quot;million &quot;  <br />
			else unit.mil = &quot;&quot;<br />
			endif <br />
       <br />
			str.C =amt.txt(3;1)     |get hundred thousand<br />
			chr.sgl =str.C<br />
			get.chrsgl()<br />
			word.C = word.sgl <br />
<br />
			if val(str.c) &gt;0 then<br />
				unit.hts =&quot;hundred &quot;<br />
			else unit.hts = &quot;&quot;<br />
			endif    <br />
	<br />
			str.E =amt.txt(5;1)<br />
			chr.sgl =str.E<br />
			get.chrsgl()<br />
			word.E = word.sgl<br />
  <br />
			str.D = amt.txt(4;1)<br />
			chr.ten = Str.D<br />
			get.chrten()<br />
			word.D = word.ten  <br />
	<br />
			if str.D =&quot;1&quot; then <br />
				word.E =&quot;&quot;<br />
			endif <br />
	<br />
			if val(amt.txt(3;3)) &gt;0 then<br />
				unit.tsd =&quot;thousand &quot;<br />
			else unit.tsd = &quot;&quot;	<br />
			endif <br />
<br />
			str.F =amt.txt(6;1)     |get hundred <br />
			chr.sgl =str.F<br />
			get.chrsgl()<br />
			word.F = word.sgl <br />
<br />
			if val(str.F) &gt;0 then<br />
				unit.hrd =&quot;hundred &quot;<br />
			else unit.hrd = &quot;&quot;<br />
			endif    <br />
<br />
			str.H =amt.txt(8;1)<br />
			chr.sgl =str.H<br />
			get.chrsgl()<br />
			word.H = word.sgl<br />
  <br />
			str.G = amt.txt(7;1)<br />
			chr.ten = Str.G<br />
			get.chrten()<br />
			word.G = word.ten  <br />
<br />
			if str.G =&quot;1&quot; then <br />
				word.H =&quot;&quot;<br />
			endif <br />
<br />
			str.J =amt.txt(11;1)<br />
			chr.sgl =str.J<br />
			get.chrsgl()<br />
			word.J = word.sgl<br />
  <br />
			str.I = amt.txt(10;1)<br />
			chr.ten = Str.I<br />
			get.chrten()<br />
			word.I = word.ten  <br />
<br />
			if str.I =&quot;1&quot; then <br />
				word.J =&quot;&quot;<br />
			endif <br />
	<br />
			if val(amt.txt(10;2)) &gt;0 then<br />
				if val(amt.txt(1;8)) &gt; 0 then<br />
				unit.cen =&quot;and cent &quot;<br />
			else<br />
				unit.cen =&quot;cent &quot;<br />
			endif<br />
			else unit.cen = &quot;&quot;<br />
			endif  <br />
<br />
		get.ccurdesc()<br />
		<br />
		amt.inword = strip$(ccur.desc) &amp; word.A &amp; word.B &amp; unit.mil &amp; word.C &amp; unit.hts <br />
				&amp; word.D &amp; word.E &amp; unit.tsd &amp; word.F &amp; unit.hrd<br />
				&amp; word.G &amp; word.H &amp; unit.cen &amp; word.I &amp; word.J &amp; &quot;only&quot;<br />
<br />
		amnt.word2 = toupper$(amt.inword)<br />
<br />
	endif<br />
	endif<br />
	<br />
	noted.bottom.1 = &quot;E.&amp; O.E.&quot;<br />
	noted.bottom.2 = &quot;General terms and conditions of sales apply.&quot;<br />
	noted.bottom.3 = &quot;We reserve the right to charge interest at the rate of 1.5% per month on overdue accounts.&quot;<br />
	noted.bottom.4 = &quot;All cheques, should be made payable to Everlast Access Technologies Sdn. Bhd. and crossed 'A/C payee only'.&quot;<br />
	noted.bottom.5 = &quot;Any discrepancy shall be served within 7 days hereof. Otherwise, the sales amount is considered final and fully accepted by you.&quot;<br />
	noted.bottom.6 = &quot;This is a computer generated invoice. No signature required.&quot;<br />
<br />
<br />
<br />
<br />
|after.r.copy.nr.25:			|* Amounts by Document	|#1061448.so<br />
|before.layout:<br />
|	r.goods.net.amnt = r.ih.am.goods +<br />
|			   r.ih.am.service +<br />
|			   r.ih.am.cost +<br />
|			   r.ih.am.rema -<br />
|			   r.ih.am.disc -<br />
|			   r.ih.settl.am			|#1061448.eo<br />
<br />
after.r.copy.nr.70:			|* Payment Schedule by Document<br />
before.layout:<br />
	if get.payment.schedule then<br />
		if not isspace(r.ih.terms.of.pay) and<br />
|		   r.document.type &lt;&gt; cisli.doct.credit and	|#FIN-083.o<br />
		   not r.source.type = tcsli.srtp.debit.credit and<br />
		   not IS.ZERO(r.ih.am) then<br />
			if not cisli.dll0063.get.due.date.and.due.amnt(<br />
					r.ih.fin.comp,<br />
					r.ih.itbp,<br />
					r.ih.pbbp,<br />
					r.ih.terms.of.pay,<br />
					r.ih.paym,		|#1039380.n<br />
					r.ih.ccur,<br />
					r.ih.am,<br />
					0.0,		|* VAT Amount<br />
					r.ih.idat,<br />
					no.paym.sched.lines,<br />
					r.paym.sched.amount.arr,<br />
					paym.sched.due.date.local.arr,<br />
					r.paym.sched.payment.method.arr,<br />
					dummy.error.message) then<br />
				return<br />
			endif<br />
								|#1039380.so<br />
|			if no.paym.sched.lines &lt;&gt; 0 and		|#236047.sn<br />
|			   not isspace(r.ih.paym) then<br />
|			   |* Payment Method array is filled. The filling is<br />
|			   |* done either from the Payment Schedule Lines or<br />
|			   |* from the Invoice-to BP. In case of this last<br />
|			   |* situation the payment method of the header should<br />
|			   |* overrule.<br />
|				if not terms.of.payment.has.methods.on.schedule(<br />
|						r.ih.fin.comp,<br />
|						r.ih.terms.of.pay) then<br />
|				   for ii = 1 to no.paym.sched.lines<br />
|					r.paym.sched.payment.method.arr(1,ii) =<br />
|								r.ih.paym<br />
|				   endfor<br />
|				endif<br />
|			endif					|#236047.en<br />
								|#1039380.eo<br />
			if no.paym.sched.lines = 0 then<br />
				no.paym.sched.lines = 1<br />
								|#1472358.so<br />
|				r.paym.sched.payment.method.arr(1,1) = r.ih.paym<br />
								|#1472358.eo<br />
			endif<br />
<br />
			alloc.mem(r.paym.sched.due.date.arr,<br />
				  no.paym.sched.lines)<br />
<br />
			for ii = 1 to no.paym.sched.lines<br />
				local.to.utc(<br />
					paym.sched.due.date.local.arr(ii),<br />
					time.num(),<br />
					r.paym.sched.due.date.arr(ii))<br />
			endfor<br />
		else<br />
			no.paym.sched.lines = 1<br />
			alloc.mem(r.paym.sched.due.date.arr, 1)<br />
			alloc.mem(r.paym.sched.amount.arr, 1)<br />
			alloc.mem(r.paym.sched.payment.method.arr, len.paym, 1)<br />
			r.paym.sched.due.date.arr(1) = r.due.date<br />
			r.paym.sched.amount.arr(1) = r.ih.am<br />
			r.paym.sched.payment.method.arr(1,1) = r.ih.paym<br />
		endif<br />
<br />
|		r.paym.sched.tot.amount = 0.0			|#1583946.o<br />
		r.ps.total.amount = 0.0				|#1583946.n<br />
<br />
		alloc.mem(r.paym.sched.amount.eur.arr, no.paym.sched.lines)<br />
		for ii = 1 to no.paym.sched.lines<br />
								|#1583946.so<br />
|			r.paym.sched.tot.amount = r.paym.sched.tot.amount +<br />
|						  r.paym.sched.amount.arr(ii)<br />
								|#1583946.eo<br />
			r.ps.total.amount = r.ps.total.amount +<br />
						r.paym.sched.amount.arr(ii)<br />
<br />
			if r.print.euro = tcyesno.yes then<br />
				convert.amount.to.euro(<br />
					r.ih.fin.comp,<br />
					r.ih.ccur,<br />
					r.paym.sched.amount.arr(ii),<br />
					r.ih.idat,<br />
					r.ih.rate.type,<br />
|					r.paym.sched.euro,	|#1583946.o<br />
					r.ps.euro,		|#1583946.n<br />
					r.paym.sched.amount.eur.arr(ii))<br />
			else<br />
				e = set.mem(r.paym.sched.amount.eur.arr, 0.0)<br />
			endif<br />
		endfor<br />
<br />
		get.payment.schedule = false<br />
|		r.paym.sched.element = 1			|#1583946.o<br />
		r.ps.element = 1				|#1583946.n<br />
	endif<br />
<br />
|	if r.paym.sched.element &gt; no.paym.sched.lines then	|#1583946.o<br />
	if r.ps.element &lt;= no.paym.sched.lines then		|#1583946.sn<br />
		r.ps.due.date = r.paym.sched.due.date.arr(r.ps.element)<br />
		r.ps.amount = r.paym.sched.amount.arr(r.ps.element)<br />
		r.ps.paym.method = r.paym.sched.payment.method.arr(1,r.ps.element)<br />
		r.ps.amount.eur = r.paym.sched.amount.eur.arr(r.ps.element)<br />
	else							|#1583946.en<br />
		lattr.print = false<br />
	endif<br />
<br />
after.layout:<br />
|	if r.paym.sched.element &lt;= no.paym.sched.lines then	|#1583946.o<br />
	if r.ps.element &lt;= no.paym.sched.lines then		|#1583946.sn<br />
		r.ps.line = true<br />
		rpi.write.additional.row()<br />
		r.ps.line = false				|#1583946.en<br />
<br />
|		r.paym.sched.element = r.paym.sched.element + 1	|#1583946.o<br />
		inc(r.ps.element)				|#1583946.n<br />
		layout.again()<br />
	else<br />
		free.mem(paym.sched.due.date.local.arr)<br />
		free.mem(r.paym.sched.amount.arr)<br />
		free.mem(r.paym.sched.payment.method.arr)<br />
		free.mem(r.paym.sched.due.date.arr)<br />
	endif<br />
<br />
after.r.copy.nr.110:					|* Payment Slip<br />
before.layout:<br />
	|* Payment slip should always be printed at the bottom of the page.<br />
	|* Layout length of r.copy.nr.85 = 23<br />
	skip.to(spool.pg.length - 23)<br />
<br />
|******************************************************************************<br />
|* TEXTS<br />
|******************************************************************************<br />
<br />
field.r.header.text:<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
field.r.add.text:<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
field.r.footer.text:<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
field.r.detail.text:<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
field.r.line.text1:<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
field.r.line.text2:<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
field.r.comp.text:<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
field.r.comp.item.text:<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
|field.r.rebate.agr.txt:					|#800-196848.o<br />
field.r.invoice.txt:						|#800-196848.n<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
field.r.srv.item.text:						|#1468471.sn<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
field.r.tax.text:<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
field.r.top.text:<br />
before.print:<br />
	TEXT.HANDLING<br />
<br />
field.r.tod.text:<br />
before.print:<br />
	TEXT.HANDLING						|#1468471.en<br />
<br />
after.program:<br />
	free.mem(r.lots.serials)<br />
	free.mem(r.lot.qty)<br />
<br />
	free.mem(r.mpr.line.arr)				|#lnd-8235.sn<br />
	free.mem(r.mpr.material.arr)<br />
	free.mem(r.mpr.material.description.arr)<br />
	free.mem(r.mpr.content.quantity.arr)<br />
	free.mem(r.mpr.material.unit.arr)<br />
	free.mem(r.mpr.quantity.factor.arr)<br />
	free.mem(r.mpr.billable.quantity.factor.arr)<br />
	free.mem(r.mpr.base.price.arr)<br />
	free.mem(r.mpr.price.unit.arr)<br />
	free.mem(r.mpr.tot.base.price.arr)<br />
	free.mem(r.mpr.actual.price.arr)<br />
	free.mem(r.mpr.tot.actual.price.arr)<br />
	free.mem(r.mpr.manual.actual.price.arr)<br />
	free.mem(r.mpr.manual.arr)<br />
	free.mem(r.mpr.text.arr)				|#lnd-8235.en<br />
	free.mem(r.mpr.surch.amnt.arr)				|#BP-suramnt.n<br />
<br />
functions:<br />
								|#1039380.so<br />
|function boolean terms.of.payment.has.methods.on.schedule(	|#236047.sn<br />
|		domain	tcncmp		i.financial.company,<br />
|		domain	tccpay		i.terms.of.payment)<br />
|{<br />
|	if ciint.dlltcmcs.terms.of.paym.has.methods.on.sched.lines(<br />
|					i.financial.company,<br />
|					i.terms.of.payment) then<br />
|		return(true)<br />
|	endif<br />
|<br />
|	return(false)<br />
|}								|#236047.en<br />
								|#1039380.eo<br />
<br />
|function domain tcmcs.long calculate.needed.lines.for.tax.summary(<br />
|			domain	tcncmp		i.financial.company,<br />
|			domain	tfgld.ttyp	i.transaction.type,<br />
|			domain	tfgld.docn	i.document.number)<br />
|{<br />
|		domain	tcmcs.long	no.tax.authority.lines<br />
|		domain	tcmcs.long	no.tax.code.lines<br />
|<br />
|	select	count(*):no.tax.authority.lines<br />
|	from	cisli209<br />
|	where	cisli209._index1 = {	:i.financial.company,<br />
|					:i.transaction.type,<br />
|					:i.document.number}<br />
|	as set with 1 rows<br />
|	selectdo<br />
|	endselect<br />
|<br />
|	select	count(*):no.tax.code.lines<br />
|	from	cisli206<br />
|	where	cisli206._index1 = {	:i.financial.company,<br />
|					:i.transaction.type,<br />
|					:i.document.number}<br />
|	as set with 1 rows<br />
|	selectdo<br />
|	endselect<br />
|<br />
|	return(8 + no.tax.authority.lines + no.tax.code.lines)<br />
|}<br />
<br />
function validate.textline()<br />
<br />
{<br />
	|* Skip printing of internal text.<br />
	|* Internal text is text with on the first position the '&lt;' sign.<br />
	|* External text is text with on the first position the '&gt;' sign.<br />
<br />
	if ( lattr.prline(1;1) = &quot;&gt;&quot; ) then<br />
		lattr.prline = lattr.prline(2)<br />
	else<br />
		if ( lattr.prline(1;1) = &quot;&lt;&quot; ) then<br />
			lattr.print = false<br />
		endif<br />
	endif<br />
}<br />
<br />
function void initialize.tax.summary.data()<br />
{<br />
		domain	tcmcs.long	array.index<br />
		domain	tcmcs.long	tax.authority.length<br />
		domain	tcmcs.long	description.length<br />
		domain	tcmcs.long	exempt.certificate.length<br />
		domain	tcmcs.long	jurisdiction.length	|#1001034.n<br />
		domain	tcmcs.long	tax.country.length<br />
		domain	tcmcs.long	tax.code.length<br />
<br />
		domain	tcmcs.long	dummy.ret<br />
<br />
	array.index = 0<br />
	tax.authority.length = 0<br />
	description.length = 0<br />
	exempt.certificate.length = 0<br />
	tax.country.length = 0<br />
	tax.code.length = 0<br />
<br />
	import(&quot;r.ts.tax.summary&quot;, g.tax.summary)<br />
	import(&quot;r.ts.present&quot;, g.tax.code.present)<br />
	import(&quot;r.ts.tax.country.length&quot;, tax.country.length)<br />
	import(&quot;r.ts.tax.code.length&quot;, tax.code.length)<br />
	import(&quot;r.ts.no.home.currencies&quot;, g.no.of.home.currencies)<br />
	import(&quot;r.ts.array.index&quot;, array.index)<br />
	import(&quot;r.ts.no.tax.codes&quot;, g.no.of.tax.codes)<br />
	import(&quot;r.ts.tax.authority.length&quot;, tax.authority.length)<br />
	import(&quot;r.ts.description.length&quot;, description.length)<br />
	import(&quot;r.ts.exempt.certificate.length&quot;, exempt.certificate.length)<br />
	import(&quot;r.ts.jurisdiction.length&quot;, jurisdiction.length)	|#1001034.n<br />
<br />
	if array.index &gt; 0 then<br />
		dummy.ret = alloc.mem(	r.ts.tax.country.array,<br />
					tax.country.length,<br />
					array.index)<br />
		dummy.ret = alloc.mem(	r.ts.tax.code.array,<br />
					tax.code.length,<br />
					array.index)<br />
								|#aggr_tax.sn<br />
		dummy.ret = alloc.mem(	r.ts.line.tax.code.array,<br />
					tax.code.length,<br />
					array.index)		|#aggr_tax.en<br />
		dummy.ret = alloc.mem(	r.ts.tax.authority,<br />
					tax.authority.length,<br />
					array.index)<br />
		dummy.ret = alloc.mem(	r.ts.tax.authority.desc,<br />
					description.length,<br />
					array.index)<br />
		dummy.ret = alloc.mem(	r.ts.tax.line.exempt,	|#1502299.n<br />
					array.index)		|#1502299.n<br />
		dummy.ret = alloc.mem(	r.ts.tax.authority.exempt,<br />
					exempt.certificate.length,<br />
					array.index)<br />
		dummy.ret = alloc.mem(	r.ts.tax.authority.base.am,<br />
					array.index)<br />
		dummy.ret = alloc.mem(	r.ts.tax.authority.percent,<br />
					array.index)<br />
		dummy.ret = alloc.mem(	r.ts.tax.authority.am,<br />
					array.index)<br />
		dummy.ret = alloc.mem(	r.ts.tax.authority.am.hc,<br />
					array.index,<br />
					g.no.of.home.currencies)<br />
		dummy.ret = alloc.mem(	r.ts.tax.text.array, 	|#1869187.n<br />
					array.index) 		|#1869187.n<br />
		dummy.ret = alloc.mem(	r.ts.juris.level,	|#1001034.sn<br />
					jurisdiction.length,<br />
					array.index)		|#1001034.en<br />
		import(&quot;r.ts.tax.country.array&quot;, r.ts.tax.country.array)<br />
		import(&quot;r.ts.tax.code.array&quot;, r.ts.tax.code.array)<br />
								|#aggr_tax.sn<br />
		import(&quot;r.ts.line.tax.code.array&quot;, r.ts.line.tax.code.array)<br />
								|#aggr_tax.en<br />
		import(&quot;r.ts.tax.authority&quot;, r.ts.tax.authority)<br />
		import(&quot;r.ts.tax.authority.desc&quot;, r.ts.tax.authority.desc)<br />
								|#1502299.sn<br />
		import(&quot;r.ts.tax.line.exempt&quot;, r.ts.tax.line.exempt)<br />
								|#1502299.en<br />
		import(&quot;r.ts.tax.authority.exempt&quot;, r.ts.tax.authority.exempt)<br />
		import(&quot;r.ts.tax.authority.base.am&quot;, r.ts.tax.authority.base.am)<br />
		import(&quot;r.ts.tax.authority.percent&quot;, r.ts.tax.authority.percent)<br />
		import(&quot;r.ts.tax.authority.am&quot;, r.ts.tax.authority.am)<br />
		import(&quot;r.ts.tax.authority.am.hc&quot;, r.ts.tax.authority.am.hc)<br />
		import(&quot;r.ts.tax.text.array&quot;, r.ts.tax.text.array) |#1869187.n<br />
		import(&quot;r.ts.juris.level&quot;, r.ts.juris.level)	|#1001034.n<br />
	endif<br />
<br />
	g.current.tax.authority.record = 1<br />
	g.current.tax.code.record = 1<br />
	g.no.of.records = array.index<br />
}<br />
<br />
function void closing.tax.summary.data()<br />
{<br />
	free.mem(r.ts.tax.country.array)<br />
	free.mem(r.ts.tax.code.array)<br />
	free.mem(r.ts.line.tax.code.array)			|#aggr_tax.n<br />
	free.mem(r.ts.tax.authority)<br />
	free.mem(r.ts.tax.authority.desc)<br />
	free.mem(r.ts.tax.line.exempt)				|#1502299.n<br />
	free.mem(r.ts.tax.authority.exempt)<br />
	free.mem(r.ts.tax.authority.base.am)<br />
	free.mem(r.ts.tax.authority.percent)<br />
	free.mem(r.ts.tax.authority.am)<br />
	free.mem(r.ts.tax.authority.am.hc)<br />
	free.mem(r.ts.tax.text.array) 				|#1869187.n<br />
	free.mem(r.ts.juris.level)				|#1001034.n<br />
}<br />
<br />
function void initialize.invoice.line.data()<br />
{<br />
		long		string.length			|#lnd-8235.n<br />
<br />
	no.disc.lines = 0<br />
	lot.serial.element = 1<br />
	mpr.current.line = 1					|#lnd-8235.n<br />
	r.disc.element = 2<br />
	no.paym.sched.lines = 0<br />
	get.payment.schedule = true<br />
	g.arrays.filled = false<br />
	g.actual.component.line = 0<br />
	g.max.no.of.components = 0<br />
	configurations.counter = 1				|#1451250.n<br />
	r.discount = &quot;&quot;						|#247593.n<br />
								|#1419676.so<br />
|	r.no.lots.serials = 0					|#1025761.sn<br />
|	import(&quot;r.no.lots.serials&quot;, r.no.lots.serials)		|#1025761.en<br />
								|#1419676.eo<br />
<br />
<br />
	if r.no.lots.serials &gt; 0 then<br />
		alloc.mem(r.lots.serials, 100, r.no.lots.serials)<br />
		alloc.mem(r.lot.qty, r.no.lots.serials)<br />
		import(&quot;r.lots.serials&quot;, r.lots.serials)<br />
		import(&quot;r.lot.qty&quot;, r.lot.qty)<br />
	endif<br />
<br />
	if r.mpr.num.lines &gt; 0 then				|#lnd-8235.sn<br />
		alloc.mem(r.mpr.line.arr, r.mpr.num.lines)<br />
<br />
		rdi.domain.string(&quot;tcmpr.matr&quot;, string.length, dummy.long)<br />
		alloc.mem(r.mpr.material.arr, string.length, r.mpr.num.lines)<br />
<br />
		rdi.domain.string(&quot;tcdsca&quot;, string.length, dummy.long)<br />
		alloc.mem(r.mpr.material.description.arr,<br />
				string.length, r.mpr.num.lines)<br />
<br />
		rdi.domain.string(&quot;tccuni&quot;, string.length, dummy.long)<br />
		alloc.mem(r.mpr.material.unit.arr,<br />
				string.length, r.mpr.num.lines)<br />
		alloc.mem(r.mpr.price.unit.arr, string.length, r.mpr.num.lines)<br />
<br />
		alloc.mem(r.mpr.content.quantity.arr, r.mpr.num.lines)<br />
		alloc.mem(r.mpr.quantity.factor.arr, r.mpr.num.lines)<br />
		alloc.mem(r.mpr.billable.quantity.factor.arr, r.mpr.num.lines)<br />
		alloc.mem(r.mpr.base.price.arr, r.mpr.num.lines)<br />
		alloc.mem(r.mpr.tot.base.price.arr, r.mpr.num.lines)<br />
		alloc.mem(r.mpr.actual.price.arr, r.mpr.num.lines)<br />
		alloc.mem(r.mpr.tot.actual.price.arr, r.mpr.num.lines)<br />
		alloc.mem(r.mpr.manual.actual.price.arr, r.mpr.num.lines)<br />
		alloc.mem(r.mpr.manual.arr, r.mpr.num.lines)<br />
		alloc.mem(r.mpr.text.arr, r.mpr.num.lines)<br />
								|#BP-suramnt.sn<br />
		alloc.mem(r.mpr.surch.amnt.arr, r.mpr.num.lines)<br />
								|#BP-suramnt.en<br />
<br />
		import(&quot;r.mpr.line.arr&quot;, r.mpr.line.arr)<br />
		import(&quot;r.mpr.material.arr&quot;, r.mpr.material.arr)<br />
		import(&quot;r.mpr.material.description.arr&quot;,<br />
				r.mpr.material.description.arr)<br />
		import(&quot;r.mpr.content.quantity.arr&quot;, r.mpr.content.quantity.arr)<br />
		import(&quot;r.mpr.material.unit.arr&quot;, r.mpr.material.unit.arr)<br />
		import(&quot;r.mpr.quantity.factor.arr&quot;, r.mpr.quantity.factor.arr)<br />
		import(&quot;r.mpr.billable.quantity.factor.arr&quot;,<br />
				r.mpr.billable.quantity.factor.arr)<br />
		import(&quot;r.mpr.base.price.arr&quot;, r.mpr.base.price.arr)<br />
		import(&quot;r.mpr.price.unit.arr&quot;, r.mpr.price.unit.arr)<br />
		import(&quot;r.mpr.tot.base.price.arr&quot;, r.mpr.tot.base.price.arr)<br />
		import(&quot;r.mpr.actual.price.arr&quot;, r.mpr.actual.price.arr)<br />
		import(&quot;r.mpr.tot.actual.price.arr&quot;, r.mpr.tot.actual.price.arr)<br />
		import(&quot;r.mpr.manual.actual.price.arr&quot;,<br />
				r.mpr.manual.actual.price.arr)<br />
		import(&quot;r.mpr.manual.arr&quot;, r.mpr.manual.arr)<br />
		import(&quot;r.mpr.text.arr&quot;, r.mpr.text.arr)<br />
								|#BP-suramnt.sn<br />
		import(&quot;r.mpr.surch.amnt.arr&quot;, r.mpr.surch.amnt.arr)<br />
								|#BP-suramnt.en<br />
	endif							|#lnd-8235.en<br />
}<br />
<br />
|function void handle.sales.order.invoice.component.lines(<br />
|		domain	tcncmp		i.source.logistic.company,<br />
|		domain	cisli.ortp	i.order.type,<br />
|		domain	tckoor		i.kind.of.order,<br />
|		domain	tcorno		i.sales.order,<br />
|		domain	tcwset		i.order.set,<br />
|		domain	tcpono		i.line.number,<br />
|		domain	tcpono		i.invoice.line,<br />
|		domain	tcshpm		i.shipment)<br />
								|#800-191132.so<br />
|function void handle.sales.order.invoice.component.lines(<br />
|		domain	tcncmp		i.financial.company,<br />
|		domain	tctran		i.transaction.type,<br />
|		domain	tcgld.docn	i.invoice.number,<br />
|		domain	tciseq		i.invoice.line)<br />
								|#800-191132.eo<br />
								|#800-191132.sn<br />
function void handle.sales.order.invoice.component.lines(<br />
		domain	tcncmp		i.logistic.company,<br />
|		domain	cisli.ortp	i.order.type,		|#citcslisrtp.o<br />
		domain	tcsli.srtp	i.source.type,		|#citcslisrtp.n<br />
		domain	tckoor		i.kind.of.order,<br />
		domain	tcorno		i.order.number,<br />
		domain	tcwset		i.order.set,<br />
		domain	tcpono		i.order.line,<br />
		domain	tcpono		i.order.invoice.line,	|#LND2-8.n<br />
|		domain	tcpono		i.order.sequence,	|#LND2-8.o<br />
		domain	tcshpm		i.shipment)<br />
								|#800-191132.en<br />
{<br />
		domain	tcmcs.long	length.of.component.shipment<br />
		domain	tcmcs.long	length.of.component<br />
		domain	tcmcs.long	length.of.order.unit<br />
		domain	tcmcs.long	length.of.terms.of.delivery<br />
		domain	tcmcs.long	length.of.point.of.title.passage<br />
		domain	tcmcs.long	length.of.lot.and.serial.set<br />
		domain	tcmcs.long	length.of.route<br />
		domain	tcmcs.long	length.of.carrier.lsp<br />
<br />
								|#800-191132.sn<br />
		domain	tcncmp		financial.company<br />
		domain	tctran		transaction.type<br />
		domain	tcgld.docn	invoice.number<br />
		domain	tciseq		invoice.line<br />
<br />
<br />
	e = cisli.dll0310.get.invoice.line.from.sales.order.data(<br />
					i.logistic.company,<br />
|					i.order.type,		|#citcslisrtp.o<br />
					i.source.type,		|#citcslisrtp.n<br />
					i.kind.of.order,<br />
					i.order.number,<br />
					i.order.set,<br />
					i.order.line,<br />
					i.order.invoice.line,	|#LND2-8.n<br />
|					i.order.sequence,	|#LND2-8.o<br />
					i.shipment,<br />
					financial.company,<br />
					transaction.type,<br />
					invoice.number,<br />
					invoice.line)<br />
								|#800-191132.en<br />
<br />
	if not g.arrays.filled then<br />
|		cisli.dll0247.count.component.lines.of.sales.invoice.line(<br />
|					i.source.logistic.company,<br />
|					i.order.type,<br />
|					i.kind.of.order,<br />
|					i.sales.order,<br />
|					i.order.set,<br />
|					i.line.number,<br />
|					i.invoice.line,<br />
|					i.shipment,<br />
|					false,		|* Do not force count.<br />
|					g.max.no.of.components)<br />
		cisli.dll0312.invoice.line.satellite.count.component.lines(<br />
								|#800-191132.so<br />
|					i.financial.company,<br />
|					i.transaction.type,<br />
|					i.invoice.number,<br />
|					i.invoice.line,<br />
								|#800-191132.eo<br />
								|#800-191132.sn<br />
					financial.company,<br />
					transaction.type,<br />
					invoice.number,<br />
					invoice.line,<br />
								|#800-191132.en<br />
					false,		|* Do not force count.<br />
					g.max.no.of.components)<br />
								|#800-191132.sn<br />
		if g.max.no.of.components = 0 then<br />
			|* No component lines to print<br />
			return<br />
		endif<br />
								|#800-191132.en<br />
		dummy.long = rdi.domain.string(<br />
					&quot;tcshpm&quot;,<br />
					length.of.component.shipment,<br />
					dummy.long)<br />
		dummy.long = rdi.domain.string(<br />
					&quot;tcitem&quot;,<br />
					length.of.component,<br />
					dummy.long)<br />
		dummy.long = rdi.domain.string(<br />
					&quot;tccuni&quot;,<br />
					length.of.order.unit,<br />
					dummy.long)<br />
		dummy.long = rdi.domain.string(<br />
					&quot;tccdec&quot;,<br />
					length.of.terms.of.delivery,<br />
					dummy.long)<br />
		dummy.long = rdi.domain.string(<br />
					&quot;tcptpa&quot;,<br />
					length.of.point.of.title.passage,<br />
					dummy.long)<br />
		dummy.long = rdi.domain.string(<br />
					&quot;tcguid&quot;,<br />
					length.of.lot.and.serial.set,<br />
					dummy.long)<br />
		dummy.long = rdi.domain.string(<br />
					&quot;tccrte&quot;,<br />
					length.of.route,<br />
					dummy.long)<br />
		dummy.long = rdi.domain.string(<br />
					&quot;tccfrw&quot;,<br />
					length.of.carrier.lsp,<br />
					dummy.long)<br />
		alloc.mem(		g.component.shipment,<br />
					length.of.component.shipment,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.component.shipment.line,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.component.receipt,	|#800-176216.sn<br />
					length.of.component.shipment,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.component.receipt.line,<br />
					g.max.no.of.components)	|#800-176216.en<br />
		alloc.mem(		g.logistic.company,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.component,<br />
					length.of.component,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.delivered.qty.inv.unit,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.delivered.qty.order.unit,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.order.unit,<br />
					length.of.order.unit,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.conversion.factor,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.delivery.date,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.terms.of.delivery,<br />
					length.of.terms.of.delivery,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.point.of.title.passage,<br />
					length.of.point.of.title.passage,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.lot.and.serial.set,<br />
					length.of.lot.and.serial.set,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.route,<br />
					length.of.route,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.carrier.lsp,<br />
					length.of.carrier.lsp,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.component.text,<br />
					g.max.no.of.components)<br />
		alloc.mem(		g.item.text,<br />
					g.max.no.of.components)<br />
<br />
|		cisli.dll0247.sales.order.invoice.component.line.get.array(<br />
|					i.source.logistic.company,<br />
|					i.order.type,<br />
|					i.kind.of.order,<br />
|					i.sales.order,<br />
|					i.order.set,<br />
|					i.line.number,<br />
|					i.invoice.line,<br />
|					i.shipment,<br />
		cisli.dll0312.invoice.line.satellite.get.component.lines(<br />
								|#800-191132.so<br />
|					i.financial.company,<br />
|					i.transaction.type,<br />
|					i.invoice.number,<br />
|					i.invoice.line,<br />
								|#800-191132.eo<br />
								|#800-191132.sn<br />
					financial.company,<br />
					transaction.type,<br />
					invoice.number,<br />
					invoice.line,<br />
								|#800-191132.en<br />
					g.component.shipment,<br />
					g.component.shipment.line,<br />
					g.component.receipt,	|#800-176216.sn<br />
					g.component.receipt.line,<br />
								|#800-176216.en<br />
					g.logistic.company,<br />
					g.component,<br />
					g.delivered.qty.inv.unit,<br />
					g.delivered.qty.order.unit,<br />
					g.order.unit,<br />
					g.conversion.factor,<br />
					g.delivery.date,<br />
					g.terms.of.delivery,<br />
					g.point.of.title.passage,<br />
					g.lot.and.serial.set,<br />
					g.route,<br />
					g.carrier.lsp,<br />
					g.component.text,<br />
					g.item.text)<br />
		g.arrays.filled = true<br />
	endif<br />
<br />
	inc(g.actual.component.line)<br />
	fill.report.fields.for.printing.kitting.components(<br />
|			i.source.logistic.company,<br />
			g.component.shipment(1, g.actual.component.line),<br />
			g.component.shipment.line(g.actual.component.line),<br />
								|#800-176216.sn<br />
			g.component.receipt(1, g.actual.component.line),<br />
			g.component.receipt.line(g.actual.component.line),<br />
								|#800-176216.en<br />
			g.logistic.company(g.actual.component.line),<br />
			g.component(1, g.actual.component.line),<br />
			g.delivered.qty.inv.unit(g.actual.component.line),<br />
			g.delivered.qty.order.unit(g.actual.component.line),<br />
			g.order.unit(1, g.actual.component.line),<br />
			g.conversion.factor(g.actual.component.line),<br />
			g.delivery.date(g.actual.component.line),<br />
			g.terms.of.delivery(1, g.actual.component.line),<br />
			g.point.of.title.passage(1, g.actual.component.line),<br />
			g.lot.and.serial.set(1, g.actual.component.line),<br />
			g.route(1, g.actual.component.line),<br />
			g.carrier.lsp(1, g.actual.component.line),<br />
			g.component.text(g.actual.component.line),<br />
			g.item.text(g.actual.component.line))<br />
}<br />
<br />
								|#1869550.sn<br />
function void handle.billable.line.component.lines(<br />
		domain	tcncmp		i.logistic.company,<br />
		domain	tcsli.srtp	i.source.type,<br />
		domain	tcorno		i.order.number,<br />
		domain	tcpono		i.order.line,<br />
		domain	tcsli.oref	i.order.reference,<br />
		domain	tcsli.tref	i.technical.reference,<br />
		domain	tcpono		i.billing.sequence)<br />
{<br />
	if not g.arrays.filled then<br />
<br />
		if cisli.dll0812.get.billable.line.component.lines(<br />
					i.logistic.company,<br />
					i.source.type,<br />
					i.order.number,<br />
					i.order.line,<br />
					i.order.reference,<br />
					i.technical.reference,<br />
					i.billing.sequence,<br />
					g.max.no.of.components,<br />
					g.dummy.sequence,<br />
					g.component.shipment,<br />
					g.component.shipment.line,<br />
					g.component.receipt,<br />
					g.component.receipt.line,<br />
					g.component,<br />
					g.delivered.qty.inv.unit,<br />
					g.delivered.qty.order.unit,<br />
					g.order.unit,<br />
					g.conversion.factor,<br />
					g.delivery.date,<br />
					g.terms.of.delivery,<br />
					g.point.of.title.passage,<br />
					g.lot.and.serial.set,<br />
					g.route,<br />
					g.carrier.lsp,<br />
					g.component.text,<br />
					g.item.text) or <br />
 					g.max.no.of.components = 0 then<br />
			|* No component lines to print<br />
			return<br />
		else<br />
			g.arrays.filled = true<br />
		endif<br />
	endif<br />
<br />
	inc(g.actual.component.line)<br />
	fill.report.fields.for.printing.kitting.components(<br />
			g.component.shipment(1, g.actual.component.line),<br />
			g.component.shipment.line(g.actual.component.line),<br />
			g.component.receipt(1, g.actual.component.line),<br />
			g.component.receipt.line(g.actual.component.line),<br />
			i.logistic.company,<br />
			g.component(1, g.actual.component.line),<br />
			g.delivered.qty.inv.unit(g.actual.component.line),<br />
			g.delivered.qty.order.unit(g.actual.component.line),<br />
			g.order.unit(1, g.actual.component.line),<br />
			g.conversion.factor(g.actual.component.line),<br />
			g.delivery.date(g.actual.component.line),<br />
			g.terms.of.delivery(1, g.actual.component.line),<br />
			g.point.of.title.passage(1, g.actual.component.line),<br />
			g.lot.and.serial.set(1, g.actual.component.line),<br />
			g.route(1, g.actual.component.line),<br />
			g.carrier.lsp(1, g.actual.component.line),<br />
			g.component.text(g.actual.component.line),<br />
			g.item.text(g.actual.component.line))<br />
}<br />
								|#1869550.en<br />
<br />
function boolean print.sales.order.invoice.component.lines(<br />
		domain	tcyesno		i.kit.handling,<br />
			boolean		i.print.components.of.kit,<br />
		domain	tcqsl1		i.delivered.quantity)<br />
{<br />
	|* Components must be printed if:<br />
	|* - the setting of 'Print Components of Kit' is checked in the billing<br />
	|*   request addition.<br />
	|* - the delivered quantity is zero.<br />
	|*<br />
	|* Note: if the delivered quantity is zero, then the setting of 'Print<br />
	|* Components of Kit' is ignored.<br />
<br />
	if i.kit.handling = tcyesno.no then<br />
		|* Sales Order Invoice Line does not have component lines in<br />
		|* cisli247 (Sales Order Invoice Component Lines).<br />
		return(false)<br />
	endif<br />
<br />
	if not i.print.components.of.kit and<br />
	   NOT.ZERO(i.delivered.quantity) then<br />
		return(false)<br />
	endif<br />
<br />
	return(true)<br />
}<br />
<br />
function void fill.report.fields.for.printing.kitting.components(<br />
|		domain	tcncmp		i.source.logistic.company,<br />
		domain	tcshpm		i.component.shipment,<br />
		domain	tcpono		i.component.shipment.line,<br />
		domain	tcshpm		i.component.receipt,	|#800-176216.sn<br />
		domain	tcpono		i.component.receipt.line,<br />
								|#800-176216.en<br />
		domain	tcncmp		i.logistic.company,<br />
		domain	tcitem		i.item,<br />
		domain	tcqsl1		i.delivered.qty.inventory.unit,<br />
		domain	tcqsl1		i.ordered.qty.sales.unit,<br />
		domain	tccuni		i.sales.unit,<br />
		domain	tcconv		i.conversion.factor,<br />
		domain	tcdate		i.delivery.date,<br />
		domain	tccdec		i.terms.of.delivery,<br />
		domain	tcptpa		i.point.of.title.passage,<br />
		domain	tcguid		i.lot.and.serial.set,<br />
		domain	tccrte		i.route,<br />
		domain	tccfrw		i.carrier.lsp,<br />
		domain	tctxtn		i.component.text,<br />
		domain	tctxtn		i.item.text)<br />
{<br />
		domain	tcdsca		item.description<br />
		domain	tcdsca		route.description<br />
		domain	tcdsca		carrier.lsp.description<br />
		domain	tccuni		inventory.unit<br />
<br />
			boolean		dummy.terms.of.del.desc.extended<br />
		domain	tctxtn		dummy.terms.of.del.text<br />
			long		dummy.long<br />
<br />
	item.description = &quot;&quot;<br />
	inventory.unit = &quot;&quot;<br />
<br />
	r.component.item = i.item<br />
	ciint.dlltcibd.get.item.description(<br />
					i.logistic.company,<br />
					i.item,<br />
					item.description)<br />
	r.component.item.dsca = item.description<br />
	r.component.ordered.qty = i.ordered.qty.sales.unit<br />
	r.component.delivered.qty = i.delivered.qty.inventory.unit<br />
	r.component.sales.unit = i.sales.unit<br />
	if NOT.ZERO(i.conversion.factor) then<br />
		r.component.ordered.qty.inv = i.ordered.qty.sales.unit *<br />
					      i.conversion.factor<br />
		r.component.delivered.qty.inv = i.delivered.qty.inventory.unit *<br />
						i.conversion.factor<br />
	else<br />
		r.component.ordered.qty.inv = i.ordered.qty.sales.unit<br />
		r.component.delivered.qty.inv = i.delivered.qty.inventory.unit<br />
	endif<br />
	ciint.dlltcibd.get.item.inventory.unit(<br />
					i.logistic.company,<br />
					i.item,<br />
					inventory.unit)<br />
	r.component.inventory.unit = inventory.unit<br />
<br />
	if cisli.dll1200.get.terms.of.delivery.data(<br />
					i.logistic.company,	|#lnd2-5078.n<br />
					i.terms.of.delivery,<br />
					i.point.of.title.passage,<br />
					r.ship.from.cadr,<br />
					r.ship.to.cadr,<br />
					lattr.language$,<br />
					dummy.terms.of.del.desc.extended,<br />
					r.component.terms.of.delivery.dsca,<br />
					dummy.terms.of.del.text) then<br />
		r.component.terms.of.delivery.dsca = &quot;&quot;<br />
	endif<br />
<br />
	r.component.shipment = i.component.shipment<br />
	r.component.shipment.line = i.component.shipment.line<br />
	r.component.receipt = i.component.receipt		|#800-176216.n<br />
	r.component.receipt.line = i.component.receipt.line	|#800-176216.n<br />
	r.component.delivery.date = i.delivery.date<br />
	r.component.route = i.route<br />
	ciint.dlltcmcs.read.route.description(<br />
					i.logistic.company,	|#lnd2-5078.n<br />
					i.route,<br />
					route.description)<br />
	r.component.route.dsca = route.description<br />
	r.component.carrier.lsp = i.carrier.lsp<br />
	dummy.long = ciint.dlltcmcs.get.description.of.carrier(<br />
					i.logistic.company,	|#lnd2-5078.n<br />
					i.carrier.lsp,<br />
					carrier.lsp.description)<br />
	r.component.carrier.lsp.dsca = carrier.lsp.description<br />
	if i.component.text then<br />
		r.comp.text = i.component.text<br />
		r.component.text.label = tt.field.desc(&quot;cisli312.txta&quot;)<br />
	else<br />
		r.comp.text = 0<br />
		r.component.text.label = &quot;&quot;<br />
	endif<br />
	if i.item.text then<br />
		r.comp.item.text = i.item.text<br />
		r.item.text.label = tt.field.desc(&quot;cisli312.txtb&quot;)<br />
	else<br />
		r.comp.item.text = 0<br />
		r.item.text.label = &quot;&quot;<br />
	endif<br />
}<br />
<br />
function void convert.amount.to.euro(<br />
		domain	tcncmp		i.company,<br />
		domain	tcccur		i.invoice.currency,<br />
		domain	tcamnt		i.invoice.amount,<br />
		domain	tcdate		i.rate.date,<br />
		domain	tcrtyp		i.exchange.rate.type,<br />
	ref	domain	tcccur		o.euro.ccur,<br />
	ref	domain	tfgld.amnt	o.euro.amount)<br />
{<br />
	|* translate EMU currency amount to Euros<br />
	o.euro.amount = 0<br />
	o.euro.ccur = &quot;&quot;<br />
<br />
	e = ciint.dlltfcmg.translate.emu.amount.into.euro.ext(<br />
					i.company,<br />
					i.invoice.currency,<br />
					i.invoice.amount,<br />
					i.rate.date,<br />
					i.exchange.rate.type,<br />
					o.euro.ccur,<br />
					o.euro.amount)<br />
}<br />
<br />
function domain	tcgld.date get.report.invoice.date(<br />
		domain	tcncmp		i.invoice.company,<br />
		domain	cisli.prno	i.print.option,<br />
|		domain	cisli.brid	i.billing.request,	|#fd49686.o<br />
		domain	tcorno		i.invoicing.batch,	|#fd49686.n<br />
		domain	tcdate		i.invoice.date.utc)<br />
<br />
{<br />
		domain	tcgld.date	report.invoice.date<br />
		domain	cisli.user	original.user<br />
		domain	tctimz		current.time.zone<br />
		domain	tctimz		original.time.zone<br />
		domain	tcmcs.long	dummy.time<br />
<br />
	if i.print.option = cisli.prno.reprint then<br />
		e = get.time.zone(current.time.zone)<br />
		select	cisli200.user:original.user<br />
		from	cisli200<br />
		where	cisli200._index1 = {	:i.invoice.company,<br />
						:i.invoicing.batch}<br />
		as set with 1 rows<br />
		selectdo<br />
			select	ttams110.tzon:original.time.zone<br />
			from	ttaad200, ttams110<br />
	 		where	ttaad200.user = :original.user<br />
	 		and	ttaad200.tusd = ttams110.ctmp<br />
			and	ttaad200._compnr = 0<br />
			and	ttams110._compnr = 0<br />
			as set with 1 rows<br />
			selectdo<br />
			endselect<br />
			e = set.time.zone(original.time.zone)<br />
			utc.to.local(	i.invoice.date.utc,<br />
					|* Output<br />
					report.invoice.date,<br />
					dummy.time)<br />
			e = set.time.zone(current.time.zone)<br />
		endselect<br />
	else<br />
		utc.to.local(	i.invoice.date.utc,<br />
				|*Output<br />
				report.invoice.date,<br />
				dummy.time)<br />
	endif<br />
<br />
	return(report.invoice.date)<br />
}<br />
<br />
<br />
function get.del.contact()<br />
{<br />
	select tdsls400.*<br />
	from tdsls400<br />
	where tdsls400.stbp = :cisli305.stbp<br />
	selectdo<br />
		<br />
		select tccom130.*<br />
		from tccom130<br />
		where tccom130.cadr = :cisli305.stoa<br />
		selectdo<br />
			del.name = tccom130.nama<br />
		endselect<br />
<br />
		select tccom140.*<br />
		from tccom140<br />
		where tccom140.ccnt = :tdsls400.stcn<br />
		selectdo<br />
			del.tel = &quot;Tel: &quot; &amp; tccom140.telp<br />
			del.fax = &quot;Fax: &quot; &amp; tccom140.tefx<br />
			del.attn = &quot;Attn: &quot; &amp; tccom140.fuln<br />
		endselect<br />
	endselect<br />
}<br />
<br />
<br />
function get.customer.contact()<br />
{<br />
	select tdsls400.*<br />
	from tdsls400<br />
	where tdsls400.ofbp = :cisli305.ofbp<br />
	selectdo<br />
		select tccom140.*<br />
		from tccom140<br />
		where tccom140.ccnt = :tdsls400.ofcn<br />
		selectdo<br />
			tel = &quot;Tel: &quot; &amp; tccom140.telp<br />
			fax = &quot;Fax: &quot; &amp; tccom140.tefx<br />
			attn = &quot;Attn: &quot; &amp; tccom140.fuln<br />
		endselect<br />
	endselect<br />
}<br />
<br />
<br />
function calculate.total.quantity(domain tcqiv1 t.qty)<br />
{<br />
	s.total.qty = s.total.qty + t.qty<br />
}<br />
<br />
<br />
function calculate.total.weight(domain tcwght t.wght)<br />
{<br />
	s.total.wght = s.total.wght + t.wght<br />
}<br />
<br />
<br />
function get.chrsgl()<br />
{<br />
  on case chr.sgl<br />
    case &quot;0&quot;:<br />
     word.sgl = &quot;&quot;  <br />
     break<br />
    case &quot;1&quot;:<br />
     word.sgl = &quot;one &quot;  <br />
     break<br />
    case &quot;2&quot;:<br />
     word.sgl = &quot;two &quot; <br />
     break<br />
    case &quot;3&quot;: <br />
     word.sgl = &quot;three &quot;<br />
     break<br />
    case &quot;4&quot;:<br />
     word.sgl = &quot;four &quot; <br />
     break<br />
    case &quot;5&quot;:<br />
     word.sgl = &quot;five &quot;<br />
     break<br />
    case &quot;6&quot;:<br />
     word.sgl = &quot;six &quot;  <br />
     break<br />
    case &quot;7&quot;:<br />
     word.sgl = &quot;seven &quot;<br />
     break<br />
    case &quot;8&quot;:<br />
     word.sgl = &quot;eight &quot;<br />
     break<br />
    case &quot;9&quot;:<br />
     word.sgl = &quot;nine &quot;<br />
     break<br />
  endcase   <br />
}<br />
<br />
<br />
function get.chrten()<br />
{<br />
  on case chr.ten<br />
    case &quot;0&quot;:<br />
     word.ten = &quot;&quot;<br />
     break<br />
    case &quot;1&quot;:<br />
      word.sgl =&quot;&quot;<br />
         on case chr.sgl<br />
           case &quot;0&quot;: <br />
             word.ten = &quot;ten &quot;      <br />
             break<br />
           case &quot;1&quot;: <br />
             word.ten = &quot;eleven &quot; <br />
             break<br />
           case &quot;2&quot;: <br />
             word.ten = &quot;twelve &quot;   <br />
             break<br />
           case &quot;3&quot;: <br />
             word.ten = &quot;thirteen &quot;<br />
             break <br />
           case &quot;4&quot;: <br />
             word.ten = &quot;fourteen &quot; <br />
             break<br />
           case &quot;5&quot;:<br />
             word.ten = &quot;fifteen &quot;  <br />
             break<br />
           case &quot;6&quot;: <br />
             word.ten = &quot;sixteen &quot; <br />
             break<br />
           case &quot;7&quot;: <br />
             word.ten = &quot;seventeen &quot;<br />
             break<br />
           case &quot;8&quot;: <br />
             word.ten = &quot;eighteen &quot;<br />
             break<br />
           case &quot;9&quot;: <br />
             word.ten = &quot;nineteen &quot;   <br />
             break<br />
       endcase<br />
       break    <br />
    case &quot;2&quot;:<br />
     word.ten = &quot;twenty &quot;<br />
     break<br />
    case &quot;3&quot;:<br />
     word.ten = &quot;thirty &quot;<br />
     break<br />
    case &quot;4&quot;:<br />
     word.ten = &quot;forty &quot;<br />
     break<br />
    case &quot;5&quot;:<br />
     word.ten = &quot;fifty &quot;<br />
     break<br />
    case &quot;6&quot;:<br />
     word.ten = &quot;sixty &quot;<br />
     break<br />
    case &quot;7&quot;:<br />
     word.ten = &quot;seventy &quot;<br />
     break<br />
    case &quot;8&quot;:<br />
     word.ten = &quot;eighty &quot;<br />
     break<br />
    case &quot;9&quot;:<br />
     word.ten = &quot;ninety &quot;<br />
     break<br />
   endcase   <br />
}<br />
<br />
<br />
function get.ccurdesc()<br />
{<br />
    	select tcmcs002.dsca<br />
	from tcmcs002<br />
	where tcmcs002.ccur = :r.ih.ccur<br />
	<br />
	selectdo<br />
		ccur.desc = tcmcs002.dsca<br />
	endselect<br />
	<br />
	ccur.desc = tcmcs002.dsca<br />
}<br />
<br />
<br />
|****************************** END OF REPORT SCRIPT ***************************<br />
<br />
<br />
<br />
Please advise. Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">19th October 2017, 15:13</div></div><div class="posttext">I would just put the report in debug mode and run one with just one record.  Stepping thru the report to see if the session script was sending the record twice or if the report itself was just printing the record twice.  That would tell you where you need to look - report or session script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tracylee</div><div class="date">20th October 2017, 04:15</div></div><div class="posttext">I would just put the report in debug mode and run one with just one record.  Stepping thru the report to see if the session script was sending the record twice or if the report itself was just printing the record twice.  That would tell you where you need to look - report or session script.<br />
<br />
Thanks for your reply. I think is session script sending the record twice. I try to put the message to show Invoices no., it is prompt the record twice. So, how can i to do it for my reporting side to show one time record? Because at session script I cannot do any modification. Please advise.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">srprks</div><div class="date">20th October 2017, 08:17</div></div><div class="posttext">Hi,<br />
<br />
In which detail section you are printing your SO, item and other details.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tracylee</div><div class="date">20th October 2017, 09:03</div></div><div class="posttext">Hi,<br />
<br />
In which detail section you are printing your SO, item and other details.<br />
<br />
Hi, <br />
<br />
In detail.1. Please advise. Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">srprks</div><div class="date">20th October 2017, 11:51</div></div><div class="posttext">Hi<br />
<br />
1. What I see there is a layout.again() function is used. If possible try to comment that line. <br />
<br />
2. Please use index in where clause of cisli310 and tcibd001.<br />
<br />
Thanks</div></div><hr />



</div>
</body>
</html>