<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="AFS Issue in Auto PO/PO line generation, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] AFS Issue in Auto PO/PO line generation AFS/DDC/OLE: Function servers" />
	
	<title>AFS Issue in Auto PO/PO line generation [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="index.html">Newbaanboard</a> &gt; <a href="index.html">Baan SIGs</a> &gt; <a href="index.html">AFS/DDC/OLE: Function servers</a> &gt; AFS Issue in Auto PO/PO line generation</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">beluver_2k</div><div class="date">16th November 2012, 07:52</div></div><div class="posttext">I am trying to create PO and PO lines using AFS based on details available in one Customized table. and update these PO and PO lines number in that table. The steps I followed is as follows.<br />
1. Open the cust. table in update mode <br />
2. AFS for PO header and localised data <br />
3. PO line insertion using db.inisert(Reason for that is I am unable to insert any record in session tdpur4102s000 if it doesn't have any record in tdpur041, as the control on that session gets lost. this is a crude way but I had to do that, any solution to this is welcome.)<br />
4. Execute find option in AFS for 4102s000<br />
5. Delete the record from tdpur041 which has been inserted in step 3.<br />
6. Insert the actual lines with proper data with PO line AFS. <br />
7. Try to update the record in customized table. (At this point it gives me Record not locked eror.)<br />
8. So as a bypass mode i have opened the customized table in RO mode. Use another customize table having same index as first one and inserted the PO and line details in that table. <br />
9. Once, all the lines are generated. Opened the first customized table in update mode and updated PO and line of each record with the records of second customized table.<br />
10. Delete all the records in second customized table.<br />
<br />
Kindly suggest me some remedy for steps 3 to 5 and 8 to 10.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bdittmar</div><div class="date">16th November 2012, 09:57</div></div><div class="posttext">I am trying to create PO and PO lines using AFS based on details available in one Customized table. and update these PO and PO lines number in that table. The steps I followed is as follows.<br />
1. Open the cust. table in update mode <br />
2. AFS for PO header and localised data <br />
3. PO line insertion using db.inisert(Reason for that is I am unable to insert any record in session tdpur4102s000 if it doesn't have any record in tdpur041, as the control on that session gets lost. this is a crude way but I had to do that, any solution to this is welcome.)<br />
4. Execute find option in AFS for 4102s000<br />
5. Delete the record from tdpur041 which has been inserted in step 3.<br />
6. Insert the actual lines with proper data with PO line AFS. <br />
7. Try to update the record in customized table. (At this point it gives me Record not locked eror.)<br />
8. So as a bypass mode i have opened the customized table in RO mode. Use another customize table having same index as first one and inserted the PO and line details in that table. <br />
9. Once, all the lines are generated. Opened the first customized table in update mode and updated PO and line of each record with the records of second customized table.<br />
10. Delete all the records in second customized table.<br />
<br />
Kindly suggest me some remedy for steps 3 to 5 and 8 to 10.<br />
<br />
Hello,<br />
<br />
use the right forum, please.<br />
There's a special forum for AFS !<br />
<br />
Maybe a admin is able to move this thread.<br />
<br />
Regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">16th November 2012, 17:52</div></div><div class="posttext">Well your system is different from my but I use tdpur4101m000 to create PO's, which calls session 4107s000 to add lines.  I have no problem adding lines, creating lines, modifying lines, etc.  I would recommend searching on the sessions in question in this forum.  I do not see a reason why you can't add thru tdpur4102s000 - does not mean it will work.  Sometimes you just have to play with them, tweak them and do some not standard things to get them to work.  My code is probably in here somewhere, but we use A&amp;D and it requires handling the pegging session which is really not pretty.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">beluver_2k</div><div class="date">17th November 2012, 06:01</div></div><div class="posttext">bdittmar: I am sorry, I shall take acre of the same. <br />
<br />
Mark: Will it be convenient for you to move this thread to proper forum? Also, I have checked your posts and code and tried here, but of no avail. tdpur4107s000 gets activated from tdpur4101m000, if you have Project implemented in your company else it will open tdpur4102s000.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">17th November 2012, 20:13</div></div><div class="posttext">Can you post your code from entering header information to launching the lines?  Also have you checked with infor on updates for stpapi code or the session - sometimes those do make a difference.  Even better would be if you owned source code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">beluver_2k</div><div class="date">19th November 2012, 08:40</div></div><div class="posttext">Mark,<br />
Thank you for transferring the thread to proper forum. Code is attached.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">19th November 2012, 16:03</div></div><div class="posttext">Here is a thread with code that works (http://www.baanboard.com/baanboard/showthread.php?t=38867&amp;highlight=tdind0271s000).<br />
<br />
<br />
function extern	domain tcpono insert.po.line(domain tcorno orno, domain tcpono pono, domain tccprj cprj, domain tcitem item, domain tccwar cwar, domain tccuni cupp, domain tcqrd1 oqua, domain tcpric pric, domain tcdate ddta, domain tfgld.leac pacn, domain tfgld.dimx dim1, domain tfgld.dimx dim2, domain tfgld.dimx dim3, domain tfgld.dimx dim4, domain tfgld.dimx dim5, domain tcdate odat)<br />
{<br />
	domain 	tcsuno	suno<br />
	domain 	tcpono	pono1, ret.pono<br />
        tdpur4101m000f.put.Purchase_Order(orno)<br />
        ret = stpapi.find(&quot;tdpur4101m000&quot;,error)<br />
        if ret = 0 then<br />
		message(error)<br />
		message(&quot;Failed in finding PO Header.&quot;)<br />
		stpapi.recover(&quot;tdpur4101m000&quot;, error )<br />
		ret.pono = 0<br />
	endif<br />
        if ret = 1 then<br />
        	found = 0<br />
		stpapi.handle.subproc( &quot;tdpur4101m000&quot;, &quot;tdpur4102s000&quot;, &quot;add&quot; )<br />
		stpapi.continue.process( &quot;tdpur4101m000&quot;, error )<br />
		if(strip$(error)&lt;&gt;&quot;&quot;) then<br />
			message(&quot;Error: %s&quot;,error)<br />
			stpapi.end.session( &quot;tdpur4101m000 - failed activating tdpur4102s000&quot; )<br />
			return<br />
		endif<br />
| Answer questions for tdpur4102<br />
		stpapi.enum.answer(&quot;tdpur4102s000&quot;, &quot;tdpur4101.01&quot;, tcyesno.yes)<br />
| Handle sub processes to tdpur4102s000<br />
                tdpur4102s000f.handle.sub.process(&quot;lhpur1542s000&quot;, &quot;kill&quot;)<br />
        	tdpur4102s000f.put.Project(cprj)<br />
        	tdpur4102s000f.put.Item(item)<br />
		tdpur4102s000f.put.Purchase_Unit(cupp)			|R.R.Patni.13.12.07.n<br />
        	tdpur4102s000f.put.Ordered_Quantity(oqua)<br />
	        tdpur4102s000f.handle.sub.process(&quot;tdind0271s000&quot;, &quot;kill&quot;)<br />
        	ret = stpapi.insert(&quot;tdpur4102s000&quot;, 1, error )<br />
        	if ret = 0 then<br />
			message(error)<br />
			message(&quot;Insert Fail in lines , Session tdpur4102s000&quot;)<br />
			stpapi.recover(&quot;tdpur4102s000&quot;, error )<br />
			ret.pono = 0<br />
        	endif<br />
        	ret.pono = tdpur4102s000f.get.Position_Number.tdpur041.pono()<br />
        	tdpur4102s000f.end()<br />
        	tdpur4101m000f.end()<br />
	endif        	<br />
	return(ret.pono)<br />
}<br />
<br />
Not sure exacting what is lhpur1542s000 - so not sure if that kill is necessary.  In my code I just ignore tdpur4503s000.  The above code was were I was winging it based off my code and kind of what I would expect to happen.  Take a look at both and maybe you can solve the issue for steps 3 thru 5.<br />
<br />
Steps 8 thru 10 I would expect just a simple select for update, with a call the AFS code in the selectdo.  Below is how we do inventory adjustments<br />
<br />
function process.records()<br />
{<br />
| First process all the records.<br />
	db.retry.point()<br />
	select	tdudi020.*<br />
	from	tdudi020 for update<br />
	where	tdudi020._index1 = {:tdudi020.logn, :tdudi020.seqn}<br />
	selectdo<br />
		msg = &quot;&quot;<br />
		proc.status = sprintf$(&quot;Processing line %d&quot;, tdudi020.line)<br />
		display(&quot;proc.status&quot;)<br />
		if strip$(tdudi020.errm) = &quot;Processed&quot; then<br />
			continue<br />
		endif<br />
|		msg = process.file.checks()<br />
		<br />
		select	tipgc004.*<br />
		from	tipgc004<br />
		where	tipgc004._index1 = {:tdudi020.cwar}<br />
		as set with 1 rows<br />
		selectdo<br />
		selectempty<br />
			tipgc004.ccot = &quot; &quot;<br />
		endselect<br />
		<br />
		msg = process.file.checks()<br />
		if isspace(msg) then<br />
			rc = adjust_inventory( tipgc004.ccot,<br />
				tdudi020.item,<br />
				tdudi020.quan,<br />
                                tdudi020.cwar,<br />
                                tdudi020.loca,<br />
				tdudi020.clot,<br />
				tdudi020.date,<br />
				tiitm001.cuni,<br />
				tiitm001.stgu,<br />
				tdudi020.cprj,<br />
				tdudi020.butm,<br />
				tdudi020.sbtm,<br />
				tdudi020.prog,<br />
				tdudi020.eser,<br />
				tdudi020.eseq,<br />
				tdudi020.cspa,<br />
				tdudi020.prea,<br />
				tdudi020.irea,<br />
				tdudi020.frea,<br />
				tdudi020.cref,<br />
				tdudi020.ival,<br />
				msg)<br />
		endif<br />
<br />
		if not isspace(msg) then<br />
                                      |Write error msg for record<br />
			tdudi020.errm = msg<br />
			db.update(ttdudi020,db.retry)<br />
		else<br />
                                       | Archive processed records.<br />
			import(&quot;exp.orno&quot;,exp.orno)<br />
			import(&quot;exp.sern&quot;,exp.sern)<br />
			archive.processed.records()<br />
			db.insert(ttdudi025,db.retry)<br />
			db.delete(ttdudi020,db.retry)<br />
			|tdudi020.errm = &quot;Processed&quot;<br />
		endif<br />
		|db.update(ttdudi020,db.retry)<br />
		commit.transaction()<br />
	endselect<br />
| Move all processed records to history	<br />
	archive.processed.records()<br />
	proc.status = &quot;&quot;<br />
	display.all()<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">beluver_2k</div><div class="date">20th November 2012, 07:08</div></div><div class="posttext">Thank You, Mark!!! <br />
I shall check and get back.</div></div><hr />



</div>
</body>
</html>