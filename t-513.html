<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="CODE: Creating your own ttstpconv Sample, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] CODE: Creating your own ttstpconv Sample Code &amp; Utilities" />
	
	<title>CODE: Creating your own ttstpconv Sample [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="index.html">Newbaanboard</a> &gt; <a href="index.html">Baan SIGs</a> &gt; <a href="index.html">Code &amp; Utilities</a> &gt; CODE: Creating your own ttstpconv Sample</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">30th November 2001, 17:47</div></div><div class="posttext">Below is a sample of device driver which could be used in replace of ttstpconv.  The original source was posted by Kevin Brock.  I modified it for my use on our system.  This is just a sample of what you could do.  I have another version that uses a table and tells which macro to launch for excel.<br />
See the attached zip file for a copy of the device data.<br />
<br />
<br />
|***************************************************************************<br />
|* tuddcconv2  0  VRC B40C c3 dev <br />
|***************************************************************************<br />
|* Title                : tuddcconv2 - Download file, start excel, clean up<br />
|* Description:         : This program removes downloads a report, starts excel,<br />
|*                        and cleans up after itself.<br />
|* Original Author      : Kevin Brock<br />
|* Modified by          : Mark Holland<br />
|* Date                 : 11/29/01<br />
|***************************************************************************<br />
|* Category             : Utility<br />
|* Platform             : UNIX<br />
|* <br />
|* License for tuddcconv2<br />
|*<br />
|* Copyright 2001 by Mark Holland<br />
|*<br />
|* All Rights Reserved <br />
|*<br />
|* Permission to use, copy, modify, and distribute this software and its<br />
|* documentation for any purpose and without fee is hereby granted,<br />
|* provided that the above copyright notice appear in all copies and that<br />
|* both that copyright notice and this permission notice appear in<br />
|* supporting documentation. <br />
|*<br />
|* Mark Holland and Baanboard.com DISCLAIM ALL WARRANTIES WITH REGARD TO THIS<br />
|* SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY<br />
|* AND FITNESS, IN NO EVENT SHALL &lt;author&gt; nor Baanboard.com BE LIABLE FOR ANY<br />
|* SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES <br />
|* WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, <br />
|* WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER <br />
|* TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE<br />
|* OR PERFORMANCE OF THIS SOFTWARE.<br />
|***************************************************************************<br />
|                                                                                <br />
|*************************** DECLARATION SECTION ***************************<br />
	#pragma nowarnings<br />
	#include &lt;bic_tt&gt;	|include tools functions<br />
	<br />
function main()<br />
{<br />
| This session will run the standard program conversion session<br />
|   ttstpconv using a temporary output file and the arguments<br />
|   passed in 3+ verbatim.<br />
| Arguments are passed from Baan spooler as follows:<br />
|    1 = Name of input (temporary) file contain dev independent report<br />
|    2 = Name of output file<br />
|    3 = Additional arguments (from Device data)<br />
|    4 = Specilar parm for ttstpconv (unknown reason)<br />
<br />
	string	tmp.file(1024)		| Temporary file name.<br />
	string	local.path(1024)	| Location on client for report.<br />
	long	rc			| Return code.<br />
	string	appl(132)		| Application to start.<br />
	long	app_id			| Application id.<br />
	string	start(1024)		| Parameter for the app_start<br />
					| function which has application<br />
					| and file to use.<br />
<br />
| Convert the report file into the temp file.<br />
	tmp.file = creat.tmp.file$( bse.tmp.dir$() )<br />
	wait.and.activate(&quot;ttstpconv&quot;, argv$(1), tmp.file, argv$(3),argv$(4))<br />
	<br />
| Set the path on the client's pc and send the file down. Let the user<br />
| enter the path and filename to be downloaded.<br />
	local.path = strip$(spool.fileout)<br />
	<br />
| Copy file to the client.<br />
	send.report.to.client(tmp.file, strip$(local.path))<br />
	<br />
| Start the file.	<br />
	appl = &quot;C:\program files\microsoft office\office\excel.exe&quot;<br />
	start= appl&amp;&quot; &quot;&amp;local.path<br />
	<br />
| Start the apllication	<br />
	app_id = app_start(start,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;)<br />
	<br />
|Check status of Application.	<br />
	rc = app_status(app_id)<br />
	if(rc = 0) then<br />
		message(&quot;Application start failed.&quot;)<br />
	endif<br />
<br />
| Remove our work file<br />
	seq.unlink(tmp.file)<br />
<br />
}<br />
<br />
function send.report.to.client(const string src(), const string dest())<br />
{<br />
        long err<br />
<br />
        err = server2client(src, dest, 1)<br />
        if (err) then<br />
            message(&quot;Error %d copying file to PC (may not have permission)&quot;, <br />
                err)<br />
        endif<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Thomas</div><div class="date">22nd February 2002, 14:19</div></div><div class="posttext">Hi Mark,<br />
<br />
I'd tried to install your program, but the error status isn't cleared (I used compile flag -b ottdllbw) :<br />
When script type = 4:<br />
tuddcconv20:<br />
std_gen6.1 -b ottdllbw -s ptuddcconv20 -pacc B40CUS03 -qe /baanprog/bse/tmp/tmp059325143<br />
bic6.1  -Pvariant=0 -b ottdllbw ptuddcconv2g -u -d ottstpstandard -o otuddcconv2<br />
 -f /baanprog/bse/tmp/tmp059325142 -pacc B40CUS03 -qe /baanprog/bse/tmp/tmp05932<br />
5144<br />
<br />
So no error message is shown, but it doesn't work.  What 's wrong ?<br />
<br />
Now we are using a device &quot;EXCELIT&quot; using  as 4GL-program: ttstpconv and argument: ASCII:excel.  This works good, but it is annoying that always a new excel application starts, also when excel is already running.  Is this resolved with your script, and/or are there other advantages ?<br />
<br />
Thanks<br />
<br />
Thomas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">22nd February 2002, 15:42</div></div><div class="posttext">I use the -d ottdllbw option on the compile. I am sorry to say that it will not solve the problem of launching multiple copies of excel.  I have never really thought about that.  I am not really sure how you stop that.  Now that I think about the way that I use it I would prefer it to start multiple copies of excel.  Usually (not always) when I down load to excel I kick off a macro.  This way I can run the same report(different parameters) multiple times and have multiple macros running at once.  See below.<br />
<br />
This program was mainly just a sample of what you could do on your own.  The way we use it hear at this site actually involves a couple of tables. One to hold the application to start and one to hold the macro that gets kicked off at the start of the app.  <br />
<br />
Examples:<br />
<br />
table 1<br />
report name(key) : rtisfc960001000<br />
site (key)       : lou<br />
download filename: c:\baan\tmp\somefile.txt<br />
macro name       : somemacro.xls<br />
macro location   : f:\common\macro<br />
<br />
table 2<br />
site(key)        : lou<br />
appl             : c:\somedir\excel.exe<br />
<br />
I designed this for excel, but others discovered you could set up other applications.  To get this to work the user selects the device PCEXCEL and puts the site key in the output file.  Not elegant , but it is functional.<br />
<br />
<br />
Mark</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tjbyfield</div><div class="date">15th June 2002, 10:03</div></div><div class="posttext">Can you please tell where function  server2client() can be found<br />
or give me some idea of what is required.<br />
<br />
(We use baan4c4)<br />
<br />
Your help will be appreciated<br />
<br />
Terry</div></div><hr />


<div class="post"><div class="posttop"><div class="username">alejandro</div><div class="date">15th June 2002, 13:35</div></div><div class="posttext">It is located in ttdllbw.<br />
<br />
you can see many threads related with its use in the forum.<br />
<br />
Include this line in your code and then use it.<br />
#pragma used dll ottdllbw<br />
<br />
If you want more infromation use (in Unix), bic_info6.1 ottdllbw -eu, or use session &quot;Print Objects by Program Script / Libraries&quot; (ttadv2439m000)<br />
<br />
Hope this helps.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tjbyfield</div><div class="date">15th June 2002, 16:01</div></div><div class="posttext">Originally posted by alejandro <br />
It is located in ttdllbw.<br />
<br />
you can see many threads related with its use in the forum.<br />
<br />
Include this line in your code and then use it.<br />
#pragma used dll ottdllbw<br />
<br />
If you want more infromation use (in Unix), bic_info6.1 ottdllbw -eu, or use session &quot;Print Objects by Program Script / Libraries&quot; (ttadv2439m000)<br />
<br />
Hope this helps.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tjbyfield</div><div class="date">15th June 2002, 16:22</div></div><div class="posttext">Thank you I will try it right away. <br />
<br />
I didn't know about  bic_info<br />
<br />
Regards<br />
<br />
Terry</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tjbyfield</div><div class="date">15th June 2002, 16:38</div></div><div class="posttext">Thank you I will try it right away. <br />
<br />
I didn't know about  bic_info<br />
<br />
Regards<br />
<br />
Terry</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gentercz</div><div class="date">11th December 2002, 10:48</div></div><div class="posttext">Hi mark,<br />
<br />
i read your post on how you use excel together with a macro.<br />
<br />
we plan to do the same, but until now i could not find the way to start excel with a special macro.<br />
<br />
can you please tell me the syntax how to start excel with a specific file AND launch a macro after opening this file.<br />
<br />
Thanx,<br />
jochen</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">11th December 2002, 15:26</div></div><div class="posttext">To launch excel with a macro just do:<br />
<br />
excel somepath\macrofile.xls<br />
<br />
Please note that Excel must be in your path or you have to include the path with excel.  The way I do this is the macrofile.xls contains the macro code. It uses the auto_open() subroutine to start processing.  This macro knows where the data file is located and pulls it in to process it.<br />
<br />
So I have a table that has report name and download file location and macro. My ttstpconv program looks up the report name and gets the download location. It the uses server2client to download the file to that location.  Next my ttstpconv launches Excel with the macro from the table.  <br />
<br />
<br />
Mark</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mclime</div><div class="date">28th August 2003, 17:43</div></div><div class="posttext">Hi Mark!<br />
<br />
How can Your ttstpconv replacement know about the report that it was called by?<br />
<br />
Is there a magic variable to import?<br />
Or do You just parse the report data for a heading (which is the least best I'd like)<br />
<br />
I'd be interested in the technical report name, same as in Your &quot;table 1&quot; mentioned earlier in this thread, because in my ttstpconv replacement (or wrapper actually) I want to do some processing dependig on the report name<br />
<br />
Thanks a lot</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mclime</div><div class="date">29th August 2003, 21:42</div></div><div class="posttext">Hrmm, hrrm,<br />
<br />
very embarrassing! That one was a clean RTFM!<br />
<br />
There are predefinde variables for this:<br />
(it's even in the online-manual)<br />
<br />
<br />
DESCRIPTION <br />
The following predefined variables are used within the spooler functions: <br />
<br />
<br />
  long spool.date                  date to print<br />
  long spool.fontnumber            number of font, 1=LARGE, 2=SMALL,<br />
                                   3=MIDDLE<br />
  long spool.id                    identification of spooler<br />
  long spool.left.mrg              left margin<br />
  long spool.pr.copies             number of copies<br />
  long spool.pg.length             length of page<br />
  long spool.pg.width              width of page, incl left margin<br />
  long spool.time                  time to print<br />
  long spool.view.rtl              report in bidirectional language,<br />
                                   true = yes, false = no<br />
  string spool.device(14)          name of spooler device<br />
  string spool.fileout(100)        path name of spooler output file<br />
  string spool.paper.type(6)       type of paper<br />
  string spool.pr.line(300)        line to print<br />
  string spool.report(20)          report to be printed<br />
<br />
<br />
Those varables are available to ttstpconv or a replacement program<br />
<br />
Thanks anyway</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pilekes</div><div class="date">14th November 2003, 14:17</div></div><div class="posttext">I'm trying to make the clientfile read-only, but haven't succeeded sofar....<br />
I am able to make the file in the Unix dir read-only, but what I am trying to achieve is not letting server2client overwrite the file on clientside...<br />
Any ideas?<br />
<br />
Greetz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mclime</div><div class="date">14th November 2003, 14:48</div></div><div class="posttext">Hi Pilekes,<br />
<br />
assume You have a bwclient, just got this idea (untested):<br />
<br />
string	dest(1024)	| Temporary file name holds full client-side file path (i.e. C:\temp\foo.txt)<br />
<br />
| do the server2client(src, dest, 0) stuff here<br />
...<br />
| now set dest to r/o on BW Client<br />
app_start(&quot;ATTRIB +R &quot; &amp; dest ,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;)<br />
<br />
Of course, errorchecking should be done on app_start, but this shoud work.<br />
<br />
bye</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mclime</div><div class="date">14th November 2003, 15:20</div></div><div class="posttext">Wait a minute,<br />
what are You trying to achieve?<br />
With the piece of code I just posted, the next server2client() will run on an error if the destination file is write-protected (as it does if it's currently opened, btw)<br />
<br />
What You'd need additionally is probably a code that checks the returncode of server2client() and then changes the filename (or lets the user do it).<br />
<br />
Or You should probably generate a unique filename in the form of prefix+timestamp or something in the firstplace.<br />
<br />
bye</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pilekes</div><div class="date">14th November 2003, 19:16</div></div><div class="posttext">I was trying to rename a file after I had read its info into a table (2 actually, but ok) and save this file clientside with a unique name.<br />
So I thought of using an extension .000 - .999 so if server2client would fail it would mean .000 had to be increased to .001.<br />
But since server2client overwrites the file I was trying to make it read-only...<br />
Since I couldn't get this to work I used a date&amp;time stamp instead ;)<br />
So now the name of the file is like YYYYMMDDHHMMSS.txt that was a lot easier, since now I don't have to set read-only to the files.<br />
So now my program works :)<br />
<br />
Thanx 4 the effort anyway!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rzamora</div><div class="date">19th December 2003, 22:27</div></div><div class="posttext">I am new in the Baan word.<br />
I find your code very interesting y and I want to probe it, but I donÂ´t know how to compile it.<br />
Sorry, but can you help me.<br />
<br />
Thanks <br />
<br />
Ralph</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Reshma</div><div class="date">26th May 2004, 15:49</div></div><div class="posttext">I would like to know that after the parameters are passed to the script, the format of main function for getting the parameters using argv$() and checking them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">26th May 2004, 16:05</div></div><div class="posttext">I am not sure I understand the question.  Anyway you can use argc$() to see how many parameters are passed.  Then you can set variables to the argv$() and check them.  For example if your first argument was project, you could set a variable project=argv$(1).  Then use tt.align.according.domain to get the correct justification and then check against a table.  I am not sure if the variables are all passed as strings.<br />
<br />
Mark</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ltannous</div><div class="date">28th September 2004, 20:38</div></div><div class="posttext">this program started excel, but the data is in text format and each line of data is in one cell/row. How can this work so the the rows/columns of data are separated??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">28th September 2004, 20:49</div></div><div class="posttext">The code and thread were just an example of how you could write your own device driver. There are actually several ways to accomplish this - use the tool ~Vamsi posted, NAZDAQ program, etc. Or you could modify a report to put the data in a comma delimited format, download and run it.  Or as you see at the beggining of the thread a method where we created a table to hold macro information by report.  When our device is selected it downloads the file to the PC and launches an excel macro to format the report according to our users wishes.  The macros are stored by site and report name - this way we could format the same report differently for each of our sites.<br />
<br />
Our simple excel device does not use a custom &quot;ottstpconv&quot; program. It downloads it and launches excel.  The data is in the format you mentioned - all in one row.  Our users know to use the text to columns option under data on the menu.<br />
<br />
Mark</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jroberts</div><div class="date">22nd November 2005, 23:57</div></div><div class="posttext">Thank you very much for the sample, it is very interesting.<br />
<br />
We modified the sample so that it would email the Baan Print File to the users.  We want to be able to pass the email data;<br />
<br />
 email subject<br />
 email to address<br />
 email from address<br />
 email message body<br />
 <br />
from the calling program to the tuddcconv4 device driver.<br />
<br />
If we print manually, and put the email data into the input string variables, it sends the bpf as expected.  We are using 'BLAT' to actually send the email.<br />
<br />
Now my problem:<br />
I can't make the tuddcconv4 script import the email data that I have exported in my source program.<br />
<br />
Is there a special function to import variables from a 4GL script into a 3GL script ?<br />
<br />
main program :<br />
<br />
choice.cont.process:<br />
on.choice:<br />
	export(&quot;email.from&quot;, email.from)<br />
	export(&quot;email.to&quot;, email.to)	<br />
	export(&quot;email.body&quot;, email.body)<br />
	export(&quot;email.subject&quot;, email.subject)<br />
	export(&quot;email.attach.send&quot;, email.attach.send)<br />
<br />
<br />
tuddcconv4 :<br />
<br />
|******************************************************************************<br />
|* Title	: tuddcconv4 - email bpf to user<br />
|* Author	: John Roberts<br />
|* Co-Author	: Bert Klunder<br />
|* Date		: &lt;2005-Nov-22&gt; <br />
|******************************************************************************<br />
|* Script Type	: Library<br />
|* Description	: <br />
|* Category	: Utility to email bpf<br />
|* License	:<br />
|* Copyright 2005 by Bert Klunder &amp; John Roberts<br />
|* <br />
|* All Rights Reserved <br />
|* <br />
|* Permission to use, copy, modify, and distribute this software and its<br />
|* documentation for any purpose and without fee is hereby granted,<br />
|* provided that the above copyright notice appear in all copies and that<br />
|* both that copyright notice and this permission notice appear in<br />
|* supporting documentation. <br />
|* <br />
|* Bert Klunder, John Roberts and Baanboard.com DISCLAIM ALL WARRANTIES WITH REGARD TO THIS<br />
|* SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY<br />
|* AND FITNESS, IN NO EVENT SHALL &lt;author&gt; nor Baanboard.com BE LIABLE FOR ANY<br />
|* SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES <br />
|* WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, <br />
|* WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER <br />
|* TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE<br />
|* OR PERFORMANCE OF THIS SOFTWARE.<br />
|******************************************************************************<br />
                        long            ret, rc, i<br />
         extern  domain	tcmcs.str100    email.attach, email.from, email.server, email.to, email.body, email.attach.send, email.subject<br />
           		string		application(300)<br />
<br />
        #pragma used dll ottdllbw<br />
        #pragma used dll ottdllinputstr<br />
<br />
	string 		path.file(128)		|Log file path<br />
	long		fp.file<br />
<br />
function main()<br />
{<br />
<br />
        email.from = strip$(argv$(2))<br />
	email.server = strip$(argv$(3))<br />
	email.attach = strip$(argv$(1))<br />
	write.log.line(&quot;Temp File Name : &quot; &amp; email.attach)<br />
	write.log.line(&quot;Email.From : &quot; &amp; email.from)<br />
<br />
	get.var(parent,&quot;email.to&quot;,email.to) <br />
	get.var(parent,&quot;email.attach&quot;,email.attach) <br />
	import(&quot;email.from&quot;, email.from)<br />
	import(&quot;email.to&quot;, email.to)<br />
	import(&quot;email.body&quot;, email.body)<br />
	import(&quot;email.attach.send&quot;, email.attach.send)<br />
	<br />
        message(&quot;email.to :&quot; &amp; strip$(email.to))<br />
        message(&quot;email.attach :&quot; &amp; strip$(email.attach))<br />
        if not job.process then<br />
        	if strip$(email.to) = &quot;&quot; then<br />
		ret = input.string(&quot;Destination&quot;, &quot;Enter list of recipients seperated with a ',' no spaces&quot;, 100, 50, email.to)<br />
		endif<br />
<br />
	        for i = 1 to len(email.to)<br />
        	        if email.to(i;1) = chr$(34) then<br />
                	        email.to(i;1) = &quot;.&quot;<br />
        	        endif<br />
	        endfor<br />
	        if strip$(email.subject) = &quot;&quot; then<br />
		ret = input.string(&quot;Subject&quot;, &quot;Please enter a subject for the email&quot;, 100, 50, email.subject)<br />
		endif<br />
<br />
	        for i = 1 to len(email.subject)<br />
        	        if email.subject(i;1) = chr$(34) then<br />
                	        email.subject(i;1) = &quot;'&quot;<br />
        	        endif<br />
	        endfor<br />
	        if strip$(email.body) = &quot;&quot; then<br />
		ret = input.string(&quot;Email Body&quot;, &quot;Enter text for the email body&quot;, 100, 50, email.body)<br />
		endif<br />
<br />
	        for i = 1 to len(email.body)<br />
        	        if email.body(i;1) = chr$(34) then<br />
                	        email.body(i;1) = &quot;'&quot;<br />
        	        endif<br />
	        endfor<br />
	        if strip$(email.attach.send) = &quot;&quot; then<br />
		ret = input.string(&quot;Attachment&quot;, &quot;Enter a name for the file to be sent&quot;, 100, 50, email.attach.send)<br />
		endif<br />
<br />
|		check to make sure no illegal characters have been used for the attachment name. Change to a &quot;.&quot; if it has<br />
	        for i = 1 to len(email.attach.send)<br />
        	        if email.attach.send(i;1) = &quot;/&quot; or <br />
        	        	email.attach.send(i;1) = &quot;\&quot; or <br />
        	        	email.attach.send(i;1) = &quot;:&quot; or <br />
        	        	email.attach.send(i;1) = &quot;*&quot; or <br />
        	        	email.attach.send(i;1) = &quot;?&quot; or <br />
        	        	email.attach.send(i;1) = chr$(34) or <br />
        	        	email.attach.send(i;1) = &quot;&lt;&quot; or <br />
        	        	email.attach.send(i;1) = &quot;&gt;&quot; or <br />
        	        	email.attach.send(i;1) = &quot;|&quot;<br />
        	        	then<br />
                	        email.attach.send(i;1) = &quot;.&quot;<br />
        	        endif<br />
	        endfor<br />
<br />
	else<br />
<br />
        endif<br />
<br />
	email.file()<br />
<br />
}<br />
<br />
function email.file()<br />
{<br />
	long appid <br />
<br />
        | make sure the final file has a valid extension<br />
	appid = file.cp(email.attach, email.attach.send &amp; &quot;.bpf&quot;)<br />
	<br />
        for i = 1 to len(email.attach.send)<br />
                if email.attach.send(i;1) = &quot;/&quot; then<br />
                        email.attach.send(i;1) = &quot;\&quot;<br />
                endif<br />
        endfor<br />
        <br />
	application = &quot;/c blat c:\temp\blank.txt -t &quot; &amp; strip$(email.to) &amp; <br />
	&quot; -f &quot; 	&amp; email.from &amp; <br />
	&quot; -attach &quot; &amp; chr$(34) &amp; email.attach.send &amp; &quot;.bpf&quot; &amp; chr$(34) &amp;<br />
	&quot; -server &quot; &amp; email.server &amp; <br />
	&quot; -body &quot; &amp; chr$(34) &amp; email.body &amp; chr$(34) &amp;<br />
	&quot; -S &quot; &amp; chr$(34) &amp; email.subject &amp; chr$(34)<br />
	&amp; &quot; -log c:\temp\blat.log&quot;<br />
<br />
<br />
	appid = run.prog(&quot;cmd.exe&quot;, application, RP_NOWAIT)<br />
}<br />
<br />
<br />
|**************************** end of script *****************************</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">23rd November 2005, 16:57</div></div><div class="posttext">In the old days (before management rejected my program) I had an email device.  I can not find a copy of the calling program.  I do remember it called a 4gl session to prompt for the subject, etc.  I could have sworn I used import/export.<br />
<br />
Try making it(your conversion session) a 4gl program - the form can just be blank.  I believe the argv params will still be the same. Then in the init.form section you can do something like this:<br />
<br />
<br />
form.1:<br />
init.form:<br />
	import(&quot;mess&quot;, parm)<br />
	execute(cont.process)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vahdani</div><div class="date">23rd November 2005, 18:04</div></div><div class="posttext">Hi John,<br />
<br />
use get.var in your 3 GL script,  in following example I get the name of the session printing the report:<br />
<br />
<br />
function main()<br />
{<br />
	extern	string	print.session(20)<br />
	extern	long	session.id<br />
<br />
	import(&quot;parent&quot;, session.id)<br />
	get.var(session.id, &quot;prog.name$&quot;, print.session)<br />
	.....<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jroberts</div><div class="date">23rd November 2005, 18:36</div></div><div class="posttext">Thanks for the help,<br />
<br />
I changed my import statements to be get.var statements :<br />
<br />
<br />
	import(&quot;parent&quot;, session.id)<br />
	get.var(session.id, &quot;email.from&quot;, email.from)<br />
	get.var(session.id, &quot;email.to&quot;, email.to)<br />
	get.var(session.id, &quot;email.subject&quot;, email.subject)<br />
	get.var(session.id, &quot;email.attach.send&quot;, email.attach.send)<br />
	get.var(session.id, &quot;email.body&quot;, email.body)<br />
<br />
<br />
and now the script works, and emails users bpf files.<br />
<br />
Thanks very much for the help.<br />
John</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vahdani</div><div class="date">24th November 2005, 14:39</div></div><div class="posttext">Hi John,<br />
<br />
glad to e of some help! Maybe in return you can tell me how you create your pdf's.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jroberts</div><div class="date">24th November 2005, 15:18</div></div><div class="posttext">Using the other posts in this thread &amp; ghost script,<br />
we have tested the creation of pdf's before, <br />
but we are distributing bpf's via the automated e-mail.<br />
<br />
Sorry,<br />
John</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vahdani</div><div class="date">24th November 2005, 15:38</div></div><div class="posttext">oh I get it bpf as Baan Print File!<br />
<br />
Sorry I misread!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Kingsto88</div><div class="date">11th January 2006, 09:12</div></div><div class="posttext">Hi Mark,<br />
<br />
Will your suggestion above, launch excel everytime during print.<br />
<br />
Can I print to file with excel format without launching excel.<br />
<br />
Thanks and regards,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">11th January 2006, 16:25</div></div><div class="posttext">With this solution you can pretty much make it do what you want.  In this example it should launch excel every time.  We have another version that launches excel with a different macro for a defined report.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Kingsto88</div><div class="date">13th January 2006, 06:26</div></div><div class="posttext">Hi Mark,<br />
<br />
Sorry, but i do not understand you.<br />
<br />
I just want a version that does not launch excel at all. But I want it to save the file in excel format. I will email this file to user and the user can just open it with excel without needing to go to Open file wizard to set the delimiter.<br />
ie. it should already be in xls format.<br />
<br />
thanks and regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jeffersyuan</div><div class="date">12th March 2008, 05:22</div></div><div class="posttext">Hi, Mark,<br />
I found a very strange problem,<br />
If add a &quot;XML&quot; parameter, then the convert problem cannot work.<br />
<br />
And if we don't use parameter, then it works.<br />
<br />
What's the problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">12th March 2008, 19:18</div></div><div class="posttext">Not sure about your system, but on mine it gives me a message - &quot;Conversion to XML is not support yet.&quot;  I am on 4c4 and I do not know what is supported on 5 and LN, so I will not be much help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">steventay</div><div class="date">10th November 2009, 04:53</div></div><div class="posttext">any update on this..<br />
<br />
i want the export file to open with excel and the delimiter will auto split into cell.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">baan999</div><div class="date">21st May 2011, 07:09</div></div><div class="posttext">all,<br />
<br />
i am using windows operating system.<br />
<br />
please send me script for the same.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bdittmar</div><div class="date">4th June 2011, 13:42</div></div><div class="posttext">all,<br />
<br />
i am using windows operating system.<br />
<br />
please send me script for the same.<br />
<br />
Hello,<br />
the script is located in the ZIP-File from Mark.<br />
<br />
Download and install the file.<br />
Modify for your use as necessary.<br />
<br />
Regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RameshS</div><div class="date">18th April 2012, 12:19</div></div><div class="posttext">How to capture the temp report file name. like &quot;tmp055915121_20972.bpf&quot; whether any body  tried it successfully.   <br />
<br />
spooler.fileout etc... not giving any output file name.  <br />
<br />
thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">18th April 2012, 15:27</div></div><div class="posttext">Do you mean spool.fileout - not spooler.fileout?  Of course if this is ln then I really cannot help since I am on 4c4.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bdittmar</div><div class="date">18th April 2012, 18:02</div></div><div class="posttext">Do you mean spool.fileout - not spooler.fileout?  Of course if this is ln then I really cannot help since I am on 4c4.<br />
<br />
<br />
in LN it's <br />
string   spool.fileout(100) Path name for spooler output file. <br />
also.<br />
<br />
Regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">9th January 2013, 16:16</div></div><div class="posttext">Hi Mark, I am unable to download your attachment. Can you post it back?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">9th January 2013, 22:47</div></div><div class="posttext">I did not have a problem with downloading the original attachment zip file, but here are the two files it contains.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">10th January 2013, 09:08</div></div><div class="posttext">Thanks Mark. I will try it</div></div><hr />


<div class="post"><div class="posttop"><div class="username">baanspider</div><div class="date">10th April 2013, 17:15</div></div><div class="posttext">Hi experts<br />
<br />
After using the script in this thread, i am getting this error<br />
Error -2 during seq.open<br />
<br />
Does anyone know how to resolve this?<br />
<br />
thanks n regards,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">10th April 2013, 17:23</div></div><div class="posttext">It means that the file does not exist.  Which seq.open - make sure that the file on the client is not in a path with spaces in it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bdittmar</div><div class="date">10th April 2013, 18:13</div></div><div class="posttext">Hi experts<br />
<br />
After using the script in this thread, i am getting this error<br />
Error -2 during seq.open<br />
<br />
Does anyone know how to resolve this?<br />
<br />
thanks n regards,<br />
<br />
Hello,<br />
<br />
it's a indicator for OS error !<br />
-2  cannot open the master pty<br />
<br />
Check directory rights, spaces in filenames, .......<br />
<br />
Regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">baanspider</div><div class="date">24th April 2013, 13:05</div></div><div class="posttext">Hi Mark<br />
<br />
I am getting two different text files.<br />
<br />
When I use the normal ASCIF device, i get the textfile zz208437. This is correct.<br />
<br />
But when I use your script in this thread, the output file is like zok208437. I do not wish to have the special characters in this file.<br />
<br />
What must I do? Please advise<br />
<br />
thanks and regards,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">24th April 2013, 15:35</div></div><div class="posttext">Basically what this script does is take the baan created report in the tmp directory(this should be file 1 with the special characters), convert it ascii(into a temp file), then download this file to some destination(in spool.fileout).  Then launch excel to pull in the ascii test file.  The final step is to remove the tmp file it creates.  So you should end up with 1 normal baan report on the baan server and 1 ascii text file on the client. Bottom line - you end up with 2 reports, excel only launches against the plain text file that was created and downloaded to the client.<br />
<br />
The normal baan report left on the server should be handled by whatever is setup on your system.  We are on 4c4 and I think we set it to remove using the delete delay time(1 hr) on the user setup.  This prevents the tmp directory from filling up.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">benito</div><div class="date">19th July 2013, 23:01</div></div><div class="posttext">i'm getting the above error on this line:<br />
<br />
activate(&quot;ttstpconv&quot;, argv$(1), argv$(2), argv$(3), argv$(4))<br />
<br />
full error is:<br />
<br />
Cannot open file (error -2)<br />
Conversion cancelled<br />
<br />
I thought i should change the object ostpconv to 755 permissions but it didn't help. anything else i should check? this is a test system and env is similar to Prod. i also tested on BaanIVc4 and LN FP8. the same error.<br />
<br />
thanks<br />
ben</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">19th July 2013, 23:37</div></div><div class="posttext">Well I use wait.and.activate, but I am not sure that is the problem.  It sounds like one of the filles cannot be opened.  So the question is - which file?  So in this code:<br />
<br />
| Convert the report file into the temp file.<br />
	tmp.file = creat.tmp.file$( bse.tmp.dir$() )<br />
	wait.and.activate(&quot;ttstpconv&quot;, argv$(1), tmp.file, argv$(3),argv$(4))<br />
<br />
In debug mode I would make sure that the tmp.file is created under the baan tmp directory.  Then make sure that argv$(1) points to the report that was created. Make sure the report is there and has data in it for the conversion.  Then right after the ttstpconv you should be able to more the tmp.file and see the ASCII or whatever report.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">benito</div><div class="date">22nd July 2013, 15:11</div></div><div class="posttext">thank you mark. i have made sure that it created a temp file. i even created the temp file in my home directory just to make sure that it's not a permission issue. that's how far my debug session could go because i get that error almost immediately. almost leads me to believe that it's not opening the ttstpconv.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">22nd July 2013, 15:25</div></div><div class="posttext">Did you check the argv$(1) - make sure that file was available?  When you run the session and pick the device - are you putting a file name into the output file name?  Not sure that makes a difference. My ttstpconv on 4c4 is 660 for permissions and is owned by bsp and in the bsp group.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">benito</div><div class="date">22nd July 2013, 16:51</div></div><div class="posttext">thanks mark. i got over this issue. the problem was i was working on a dev server that wasn't setup properly so the environment variables were screwed up. i am actually working on html device to print logo. i do have an issue but it seems similar to the other poster.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gerardd</div><div class="date">2nd October 2014, 16:10</div></div><div class="posttext">Hi Mark H <br />
and all<br />
Thanks for this.<br />
It works and solves my problem. <br />
<br />
Thanks <br />
<br />
Gerard</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ajesh</div><div class="date">13th June 2016, 11:40</div></div><div class="posttext">Hello Mark<br />
<br />
Where are you exactly prompting the User to mention the Path? And How?<br />
<br />
<br />
| Set the path on the client's pc and send the file down. Let the user<br />
| enter the path and filename to be downloaded.<br />
	local.path = strip$(spool.fileout)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">13th June 2016, 12:41</div></div><div class="posttext">Hi Ajesh,<br />
<br />
Its the path you see when system pops up device selection form(ttstpsplopen). If you are on latest TIV, the path will have a check if the folder exists on server. In that case, you can allow the user to put only file name in device path and then make a little change in the script - <br />
<br />
| Set the path on the client's pc and send the file down. Let the user<br />
| enter the path and filename to be downloaded.<br />
	local.path = &quot;${BSE_TMP}\&quot; &amp; strip$(spool.fileout)<br />
<br />
This will make sure the file is transferred from the temp file to users tmp folder and the file name is taken as the user entered in the Device selection form.</div></div><hr />



</div>
</body>
</html>