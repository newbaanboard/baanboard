<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="Session not available, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] Session not available AFS/DDC/OLE: Function servers" />
	
	<title>Session not available [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="index.html">Newbaanboard</a> &gt; <a href="index.html">Baan SIGs</a> &gt; <a href="index.html">AFS/DDC/OLE: Function servers</a> &gt; Session not available</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">3rd November 2009, 13:32</div></div><div class="posttext">Hello,<br />
<br />
I have next code. I can insert records in tfgld1101m000 session. But, when I execute Continue button with the function , the result is &quot;Session not available&quot; message. I need insert records into tfacp1110s000 subsession.  I don´t know If I have a bad code... <br />
<br />
Thanks,<br />
<br />
María<br />
<br />
function main()<br />
{<br />
extern string err.msg(60), recover.msg(60), sesion(13),tabla(8)<br />
extern domain tcboolerrores<br />
domain tcmcs.int ret<br />
<br />
<br />
stpapi.put.field(&quot;tfgld1101m000&quot;,&quot;tfgld101.ttyp&quot;,&quot;HGT&quot;)<br />
stpapi.put.field(&quot;tfgld1101m000&quot;,&quot;tfgld101.tedt&quot;, str$(date.to.num(2009,11,03)))<br />
<br />
if stpapi.insert(&quot;tfgld1101m000&quot;,1,err.msg) = 0 then<br />
  message(&quot;%s&quot;,err.msg)<br />
else<br />
  stpapi.continue.process(&quot;tfgld1101m000&quot;, err.msg)<br />
<br />
  stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.suno&quot;,&quot;HG0687&quot;)<br />
  stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.amat&quot;,&quot;50&quot;)<br />
  stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.cvat&quot;,&quot;00EN00&quot;)<br />
  stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.refr&quot;,&quot;Prueba AFS&quot;)<br />
  stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.isup&quot;,&quot;facturaSUNO&quot;)<br />
  stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.docd&quot;,str$(date.to.num(2009,11,03)))<br />
  stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.dved&quot;,str$(date.to.num(2009,11,03)))<br />
  if not stpapi.insert(&quot;tfgld1110s000&quot;,1,err.msg) then<br />
	stpapi.recover(&quot;tfgld1110s000&quot;,recover.msg)<br />
        message(&quot;%s&quot;,err.msg)<br />
  endif<br />
<br />
  stpapi.end.session(&quot;tfacp1110s000&quot;)<br />
  stpapi.end.session(&quot;tfgld1101m000&quot;)<br />
endif<br />
<br />
stpapi.end.session(&quot;tfgld1101m000&quot;)<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kbartelds</div><div class="date">3rd November 2009, 13:48</div></div><div class="posttext">Hello,<br />
<br />
Before using the continue.process you will have to add the subsession to the main session:<br />
stpapi.handle.subproc(&quot;tfgld1101m000,&quot;tfacp1110s000&quot;,add)<br />
<br />
Since multiple records could be present in tfgld1101m000, possible a mark should be executed.<br />
<br />
Regards,<br />
Klaas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">3rd November 2009, 14:17</div></div><div class="posttext">Hi,<br />
<br />
I call the function but I think I'm writing it in a wrong place. i get the same error...<br />
<br />
        if stpapi.insert(&quot;tfgld1101m000&quot;,1,err.msg) = 0 then<br />
            message(&quot;%s&quot;,err.msg)<br />
	else<br />
<br />
		stpapi.handle.subproc(&quot;tfgld1101m000&quot;,&quot;tfacp1110s000&quot;,&quot;add&quot;)<br />
<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.suno&quot;,&quot;HG0687&quot;)			| Proveedor<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.amat&quot;,&quot;50&quot;)				| Importe<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.cvat&quot;,&quot;00EN00&quot;)			| IVA exento<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.refr&quot;,&quot;Prueba AFS&quot;)			| Referencia<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.isup&quot;,&quot;facturaSUNO&quot;)			| Núm. factura Proveedor<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.docd&quot;,str$(date.to.num(2009,11,03)))	| Fecha documento<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.dved&quot;,str$(date.to.num(2009,11,03)))	| Fecha vencimiento<br />
<br />
		stpapi.continue.process(&quot;tfacp1110s000&quot;, err.msg)<br />
<br />
	        if not stpapi.insert(&quot;tfgld1110s000&quot;,1,err.msg) then<br />
			stpapi.recover(&quot;tfgld1110s000&quot;,recover.msg)<br />
        		message(&quot;%s&quot;,err.msg)<br />
		endif<br />
<br />
	        stpapi.end.session(&quot;tfacp1110s000&quot;)<br />
	        stpapi.end.session(&quot;tfgld1101m000&quot;)<br />
        endif</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">3rd November 2009, 15:05</div></div><div class="posttext">Yes it looks like it is the wrong spot.  Put it before the insert on tfgld1101m000.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kbartelds</div><div class="date">3rd November 2009, 16:42</div></div><div class="posttext">the correct sequence seems to me:<br />
put fields of tfgld1101m000 and insert<br />
handle.subproc(&quot;tfgld1101m000&quot;,tfacp1110s000&quot;,add)<br />
mark occurrence in tfgld1101m000<br />
stpapi.continue.process(&quot;tfgld1101m000&quot;,err.mess)     (not tfacp1110s000)<br />
put fields of tfacp1110s000 and insert<br />
end both sessions<br />
<br />
and of course the error handling.<br />
<br />
Regards,<br />
Klaas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">3rd November 2009, 17:17</div></div><div class="posttext">Sorry but I have not yet achieved... but I think I´m near...<br />
<br />
- I don´t know how I have to mark an occurrence in tfgld1101m000<br />
- I´ve changed the instruction stpapi.continue.process(&quot;tfgld1101m000&quot;, err.msg) instead tfacp1110s000<br />
- I tried to put the line stpapi.handle.subproc(&quot;tfgld1101m000&quot;,&quot;tfacp1110s000&quot;,&quot;add&quot;) before the insert in tfgld1101m000 but I have the message &quot;session is not available&quot; again.<br />
<br />
<br />
Thanks a lot,<br />
<br />
María</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kbartelds</div><div class="date">4th November 2009, 09:53</div></div><div class="posttext">Marking can be done by: <br />
retval = stpapi.mark(&quot;tfgld1101m000&quot;,err.mess)<br />
don't forget the recover in case marking does not succeed<br />
<br />
Regards,<br />
Klaas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">4th November 2009, 14:41</div></div><div class="posttext">I have found that stpapi.mark does not always work in some cases you have to a browse or a find to the record.  In our case we know the record is the only one of the batch.  So here is a piece of our code and keep in mind it may not work for you.<br />
<br />
<br />
	rc = stpapi.browse.set(sess.gld1101, &quot;last.set&quot;, e.msg) <br />
	<br />
	| 2.3 Select Transaction button (continue option)<br />
	stpapi.handle.subproc(sess.gld1101, sess.acp1110, &quot;add&quot;)<br />
	stpapi.continue.process(sess.gld1101, e.msg)<br />
	<br />
	stpapi.save(sess.acp1110,e.msg)<br />
<br />
	| 3.  tfacp1110s000 (Maintain Pur Inv)<br />
	| 3.0 Input pur inv data<br />
	stpapi.put.field(sess.acp1110, &quot;tfacp200.ttyp&quot;, &quot;CTR&quot;) <br />
	stpapi.put.field(sess.acp1110, &quot;tfacp200.ninv&quot;, str$(tfgld011.dsrn)) <br />
	stpapi.put.field(sess.acp1110, &quot;ref.po&quot;, strip$(tccom020.refa)) <br />
	stpapi.put.field(sess.acp1110, &quot;tfacp200.suno&quot;, strip$(tcudi005.suno)) 	| 20070518.end<br />
	rc = string.scan(tccom001.nama,&quot;%s,%s&quot;,firsthalf,lasthalf)<br />
	lastname = shiftl$(firsthalf(1;8))<br />
	rc = string.scan(shiftl$(lasthalf),&quot;%s %s&quot;,firstname,middileinit)<br />
	firstinit = firstname(1;1)<br />
	<br />
	t.refr = sprintf$(&quot;%02d%02d%02d%04d%s%s%s&quot;, mm, dd, tfgld911.serc,inv.count, firstinit, middileinit,lastname) <br />
	stpapi.put.field(sess.acp1110, &quot;tfacp200.isup&quot;, t.refr)<br />
	stpapi.put.field(sess.acp1110, &quot;tfacp200.docd&quot;, str$(date.t))<br />
	t.refr = sprintf$(&quot;C%02d%02d%02d%-06d%s&quot;, mm, dd, tfgld911.serc, tccom001.emno, strip$(tccom001.nama))<br />
	stpapi.put.field(sess.acp1110, &quot;tfacp200.refr&quot;, t.refr)  <br />
	stpapi.put.field(sess.acp1110, &quot;screen.amnt&quot;, str$(round(tfgld911.amnt, 2, 0))) <br />
	stpapi.put.field(sess.acp1110, &quot;tfacp200.reas&quot;, &quot;5&quot;) <br />
	stpapi.put.field(sess.acp1110, &quot;tfacp200.orno&quot;, strip$(tccom020.refa)) <br />
<br />
	stpapi.get.field(sess.acp1110, &quot;tfacp200.orno&quot;, io.fld) <br />
	stpapi.put.field(sess.acp1110, &quot;tfacp200.orno&quot;, strip$(tccom020.refa)) <br />
<br />
	| 3.1 Insert a purchase invoice<br />
	stpapi.handle.subproc(sess.acp1110, sess.acp1230, &quot;add&quot;)<br />
	rc = stpapi.insert(sess.acp1110, 1, e.msg) <br />
	if not isspace(e.msg) then<br />
		stpapi.end.session(sess.acp1110) <br />
		return<br />
	endif</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">4th November 2009, 17:24</div></div><div class="posttext">I tried with the 2 ideas but I think I´m writing a wrong code...<br />
<br />
Option 1:<br />
<br />
#pragma used dll ottstpapihand<br />
<br />
function main()<br />
{<br />
	|table	ttscmn040	| Tabla de datos temporales Hojas de gasto - Exportación desde la Intranet<br />
<br />
	|Variables generales gestión del AFS<br />
	extern	string	err.msg(60), recover.msg(60), sesion(13),tabla(8)<br />
	extern	domain	tcbool	errores<br />
<br />
	|Variables del programa<br />
	extern	domain tccuno cl<br />
	domain tcmcs.int ret<br />
<br />
<br />
        stpapi.put.field(&quot;tfgld1101m000&quot;,&quot;tfgld101.ttyp&quot;,&quot;HGT&quot;)	| Tipo de asiento<br />
        stpapi.put.field(&quot;tfgld1101m000&quot;,&quot;tfgld101.tedt&quot;, str$(date.to.num(2009,11,03))) | Fecha de introducción del asiento<br />
<br />
        if stpapi.insert(&quot;tfgld1101m000&quot;,1,err.msg) = 0 then<br />
            message(&quot;%s&quot;,err.msg)<br />
	else<br />
<br />
		stpapi.browse.set(&quot;tfgld1101m000&quot;, &quot;last.set&quot;, err.msg)<br />
		stpapi.handle.subproc(&quot;tfgld1101m000&quot;,&quot;tfacp1110s000&quot;,&quot;add&quot;)<br />
		stpapi.continue.process(&quot;tfgld1101m000&quot;, err.msg)<br />
<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.suno&quot;,&quot;HG0687&quot;)			| Proveedor<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.amat&quot;,&quot;50&quot;)				| Importe<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.cvat&quot;,&quot;00EN00&quot;)			| IVA exento<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.refr&quot;,&quot;Prueba AFS&quot;)			| Referencia<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.isup&quot;,&quot;facturaSUNO&quot;)			| Núm. factura Proveedor<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.docd&quot;,str$(date.to.num(2009,11,03)))	| Fecha documento<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.dved&quot;,str$(date.to.num(2009,11,03)))	| Fecha vencimiento<br />
<br />
<br />
	        if not stpapi.insert(&quot;tfgld1110s000&quot;,1,err.msg) then<br />
			stpapi.recover(&quot;tfgld1110s000&quot;,recover.msg)<br />
        		message(&quot;%s&quot;,err.msg)<br />
		endif<br />
<br />
	        stpapi.end.session(&quot;tfacp1110s000&quot;)<br />
	        stpapi.end.session(&quot;tfgld1101m000&quot;)<br />
        endif<br />
<br />
        stpapi.end.session(&quot;tfgld1101m000&quot;)<br />
}<br />
<br />
<br />
<br />
Option 2:<br />
#pragma used dll ottstpapihand<br />
<br />
function main()<br />
{<br />
	|table	ttscmn040	| Tabla de datos temporales Hojas de gasto - Exportación desde la Intranet<br />
<br />
	|Variables generales gestión del AFS<br />
	extern	string	err.msg(60), recover.msg(60), sesion(13),tabla(8)<br />
	extern	domain	tcbool	errores<br />
<br />
	|Variables del programa<br />
	extern	domain tccuno cl<br />
	domain tcmcs.int ret<br />
<br />
<br />
        stpapi.put.field(&quot;tfgld1101m000&quot;,&quot;tfgld101.ttyp&quot;,&quot;HGT&quot;)	| Tipo de asiento<br />
        ||stpapi.put.field(&quot;tfgld1101m000&quot;,&quot;tfgld101.tedt&quot;, str$(date.to.num(2009,11,03))) | Fecha de introducción del asiento<br />
<br />
        if stpapi.insert(&quot;tfgld1101m000&quot;,1,err.msg) = 0 then<br />
            message(&quot;%s&quot;,err.msg)<br />
	else<br />
<br />
		stpapi.handle.subproc(&quot;tfgld1101m000&quot;,&quot;tfacp1110s000&quot;,&quot;add&quot;)<br />
		stpapi.mark(&quot;tfgld1101m000&quot;, err.msg)<br />
		stpapi.continue.process(&quot;tfgld1101m000&quot;, err.msg)<br />
<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.suno&quot;,&quot;HG0687&quot;)			| Proveedor<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.amat&quot;,&quot;50&quot;)				| Importe<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.cvat&quot;,&quot;00EN00&quot;)			| IVA exento<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.refr&quot;,&quot;Prueba AFS&quot;)			| Referencia<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.isup&quot;,&quot;facturaSUNO&quot;)			| Núm. factura Proveedor<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.docd&quot;,str$(date.to.num(2009,11,03)))	| Fecha documento<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.dved&quot;,str$(date.to.num(2009,11,03)))	| Fecha vencimiento<br />
<br />
<br />
	        if not stpapi.insert(&quot;tfgld1110s000&quot;,1,err.msg) then<br />
			stpapi.recover(&quot;tfgld1110s000&quot;,recover.msg)<br />
        		message(&quot;%s&quot;,err.msg)<br />
		endif<br />
<br />
	        stpapi.end.session(&quot;tfacp1110s000&quot;)<br />
	        stpapi.end.session(&quot;tfgld1101m000&quot;)<br />
        endif<br />
<br />
        stpapi.end.session(&quot;tfgld1101m000&quot;)<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">5th November 2009, 19:23</div></div><div class="posttext">Do you always get session unavailable?  It could be that you need new stpapi libraries or even new session code.  In debug mode on the top set of code when stpapi.continue.process(&quot;tfgld1101m000&quot;, err.msg) gets executed does tfacp1110s000 get started?  Check the processes you have running in the background.  Does the create batch work?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">18th November 2009, 14:41</div></div><div class="posttext">Hello,<br />
<br />
I was reading the code again and I´ve seen that I call the function tfgld1110s000 instead tfacp1110s000... It was the error.<br />
<br />
But, another question. If I have to execute the cont.process twice (then I have 3 sessions opened at the same time), how I have to use the stpapi.handle.subproc function?<br />
<br />
I type my code.<br />
<br />
Thanks in advanced,<br />
<br />
María<br />
<br />
<br />
<br />
function main()<br />
{<br />
	|table	ttscmn040	| Tabla de datos temporales Hojas de gasto - Exportación desde la Intranet<br />
<br />
	|Variables generales gestión del AFS<br />
	extern	string	err.msg(60), recover.msg(60), sesion(13),tabla(8)<br />
	extern	domain	tcbool	errores<br />
<br />
	|Variables del programa<br />
	extern	domain tccuno cl<br />
	domain tcmcs.int ret<br />
<br />
<br />
        stpapi.put.field(&quot;tfgld1101m000&quot;,&quot;tfgld101.ttyp&quot;,&quot;HGT&quot;)	| Tipo de asiento<br />
        ||stpapi.put.field(&quot;tfgld1101m000&quot;,&quot;tfgld101.tedt&quot;, str$(date.to.num(2009,11,03))) | Fecha de introducción del asiento<br />
<br />
        if stpapi.insert(&quot;tfgld1101m000&quot;,1,err.msg) = 0 then<br />
            message(&quot;%s&quot;,err.msg)<br />
	else<br />
<br />
		stpapi.handle.subproc(&quot;tfgld1101m000&quot;,&quot;tfacp1110s000&quot;,&quot;add&quot;)<br />
		stpapi.mark(&quot;tfgld1101m000&quot;, err.msg)<br />
		stpapi.continue.process(&quot;tfgld1101m000&quot;, err.msg)<br />
<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.suno&quot;,&quot;HG0687&quot;)			| Proveedor<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.amat&quot;,&quot;50&quot;)				| Importe<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.cvat&quot;,&quot;00EN00&quot;)			| IVA exento<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.refr&quot;,&quot;Prueba AFS miércoeles&quot;)	| Referencia<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.isup&quot;,&quot;facturaSUNO&quot;)			| Núm. factura Proveedor<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.docd&quot;,str$(date.to.num(2009,11,03)))	| Fecha documento<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.dved&quot;,str$(date.to.num(2009,11,03)))	| Fecha vencimiento<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.vatc&quot;,&quot;  1&quot;)				| País IVA <br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.cvat&quot;,&quot;00NE00&quot;)			| Código IVA<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.vaty&quot;,&quot;2009&quot;)			| Año IVA<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;tfacp200.vatp&quot;,&quot;01&quot;)				| Período IVA<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;screeen.amnt&quot;,&quot;75&quot;)				| Importe<br />
	        stpapi.put.field(&quot;tfacp1110s000&quot;,&quot;screeen.vata&quot;,&quot;2&quot;)				| Importe IVA<br />
		<br />
	        if not stpapi.insert(&quot;tfacp1110s000&quot;,1,err.msg) then<br />
			stpapi.recover(&quot;tfacp1110s000&quot;,recover.msg)<br />
        		message(&quot;%s&quot;,err.msg)<br />
		endif<br />
<br />
		stpapi.handle.subproc(&quot;tfacp1110s000&quot;,&quot;tfacp1120s000&quot;,&quot;add&quot;)<br />
		stpapi.continue.process(&quot;tfacp1110s000&quot;, err.msg)<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.leac&quot;,&quot;629200687&quot;)			| Cuenta contable<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.dim1&quot;,&quot;C00004&quot;)			| Dimensión 1<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.dim2&quot;,&quot;III000&quot;)			| Dimensión 2<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.dim3&quot;,&quot;&quot;)				| Dimensión 3<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.dim4&quot;,&quot;&quot;)				| Dimensión 4<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.dim5&quot;,&quot;&quot;)				| Dimensión 5	<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.ccty&quot;,&quot;  1&quot;)				| País IVA<br />
|	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.cvat&quot;,&quot;&quot;)				| Código IVA<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;amount&quot;,&quot;89.6&quot;)				| Importe neto<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.vamt&quot;,&quot;25&quot;)				| Importe IVA<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.dbcr&quot;,&quot;2&quot;)				| Debe/Haber<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.qty1&quot;,&quot;&quot;)				| Cantidad 1<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.qty2&quot;,&quot;&quot;)				| Cantidad 2<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.refr&quot;,&quot;Referencia tercera AFS&quot;)	| Referencia<br />
<br />
	        if not stpapi.insert(&quot;tfacp1120s000&quot;,1,err.msg) then<br />
			stpapi.recover(&quot;tfacp1120s000&quot;,recover.msg)<br />
        		message(&quot;%s&quot;,err.msg)<br />
		endif<br />
<br />
<br />
	        stpapi.end.session(&quot;tfacp1120s000&quot;)<br />
 <br />
	        stpapi.end.session(&quot;tfacp1110s000&quot;)<br />
        endif<br />
<br />
        stpapi.end.session(&quot;tfgld1101m000&quot;)<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">18th November 2009, 15:46</div></div><div class="posttext">But, another question. If I have to execute the cont.process twice (then I have 3 sessions opened at the same time), how I have to use the stpapi.handle.subproc function?<br />
<br />
What session do you have to hit continue twice in?  I have not seen a session like that - usually something happens with just a continue and the sessions open 1 at a time. You can only really process in one session at a time.  What you can do is try defining the three subproc's before calling the continue command. That might work, but without knowing the sessions there is no guarantee.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">18th November 2009, 16:48</div></div><div class="posttext">The process that I have to automate includes the following sessions:<br />
<br />
tfgld1101m000 (Maintain Transactions)-&gt; tfacp1110s000 (Register Purchase Invoices) -&gt; tfacp1120s000 (Maintain Transactions Purchase Invoices)<br />
<br />
The descriptions are aproximations, because I work with spanish language :confused:<br />
<br />
Thanks,<br />
<br />
María</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">18th November 2009, 18:21</div></div><div class="posttext">I executed my afs in debug mode. The log generated is:<br />
<br />
6dll-&gt;serv (getxml)<br />
6dll-&gt;serv (starttfgld1101m000100)<br />
8serv&lt;-4gl (api.child.startedtfgld1101m0006)<br />
8serv&lt;-4gl (init.ready)<br />
tfgld1101m000(8)-RUNNING:<br />
LOGGING STARTED<br />
18/11/2009<br />
&gt;tfgld1101m000(8) put.field:tfgld101.ttyp HGT<br />
&gt;tfgld1101m000 insert<br />
6dll-&gt;serv (add.set+save8)<br />
tfgld1101m000(8)-RUNNING:add.set+save<br />
8serv&lt;-4gl (add.set+save01)<br />
tfgld1101m000(8)-RUNNING:<br />
&lt;tfgld1101m000 <br />
&gt;tfgld1101m000 handle.subproc tfacp1110s000 add<br />
6dll-&gt;serv (handle.subsessiontfacp1110s00028)<br />
&gt;tfgld1101m000 mark<br />
6dll-&gt;serv (mark.occur8)<br />
tfgld1101m000(8)-RUNNING:mark.occur<br />
8serv&lt;-4gl (mark.occur0)<br />
tfgld1101m000(8)-RUNNING:<br />
&lt;tfgld1101m000 mark successful<br />
&gt;tfgld1101m000 continue.process<br />
6dll-&gt;serv (cont.process8)<br />
tfgld1101m000(8)-RUNNING:cont.process<br />
9serv&lt;-4gl (api.child.startedtfacp1110s0008)<br />
9serv&lt;-4gl (init.ready)<br />
tfacp1110s000(9)-RUNNING:<br />
&lt;tfgld1101m000 <br />
&gt;tfacp1110s000(9) put.field:tfacp200.suno HG0687<br />
&gt;tfacp1110s000(9) put.field:tfacp200.amat 50<br />
&gt;tfacp1110s000(9) put.field:tfacp200.cvat 00EN00<br />
&gt;tfacp1110s000(9) put.field:tfacp200.refr Prueba AFS miércoeles<br />
&gt;tfacp1110s000(9) put.field:tfacp200.isup facturaSUNO<br />
&gt;tfacp1110s000(9) put.field:tfacp200.docd 733714<br />
&gt;tfacp1110s000(9) put.field:tfacp200.dved 733714<br />
&gt;tfacp1110s000(9) put.field:tfacp200.vatc   1<br />
&gt;tfacp1110s000(9) put.field:tfacp200.cvat 00NE00<br />
&gt;tfacp1110s000(9) put.field:tfacp200.vaty 2009<br />
&gt;tfacp1110s000(9) put.field:tfacp200.vatp 01<br />
&gt;tfacp1110s000(9) put.field:screen.amnt 75<br />
&gt;tfacp1110s000(9) put.field:screeen.vata 2<br />
&gt;tfacp1110s000 insert<br />
6dll-&gt;serv (add.set+save9)<br />
tfacp1110s000(9)-RUNNING:add.set+save<br />
10serv&lt;-4gl (api.child.startedtfacp1120s0009)<br />
10serv&lt;-4gl (init.ready)<br />
tfacp1120s000(10)-RUNNING:<br />
&lt;tfacp1110s000 <br />
&gt;tfacp1110s000 handle.subproc tfacp1120s000 add<br />
6dll-&gt;serv (handle.subsessiontfacp1120s00029)<br />
&gt;tfacp1110s000 continue.process<br />
tfacp1110s000waiting for prev cont.proc<br />
tfacp1110s000waiting timed out<br />
6dll-&gt;serv (cont.process9)<br />
tfacp1110s000(9)-RUNNING:cont.process</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">18th November 2009, 18:41</div></div><div class="posttext">Here is what I see from looking at your afs.log:<br />
<br />
<br />
	        if not stpapi.insert(&quot;tfacp1110s000&quot;,1,err.msg) then<br />
			stpapi.recover(&quot;tfacp1110s000&quot;,recover.msg)<br />
        		message(&quot;%s&quot;,err.msg)<br />
		endif<br />
<br />
		stpapi.handle.subproc(&quot;tfacp1110s000&quot;,&quot;tfacp1120s000&quot;,&quot;add&quot;)<br />
		stpapi.continue.process(&quot;tfacp1110s000&quot;, err.msg)<br />
<br />
In the above code when you do the insert on tfacp1110s00 it is starting tfacp1120s000, so in that case you can try this:<br />
<br />
	stpapi.handle.subproc(&quot;tfacp1110s000&quot;,&quot;tfacp1120s000&quot;,&quot;add&quot;)<br />
	if not stpapi.insert(&quot;tfacp1110s000&quot;,1,err.msg) then<br />
			stpapi.recover(&quot;tfacp1110s000&quot;,recover.msg)<br />
        		message(&quot;%s&quot;,err.msg)<br />
	endif<br />
<br />
	|	stpapi.continue.process(&quot;tfacp1110s000&quot;, err.msg)<br />
             | Continue not needed since tfacp1120s000 is already running so just start<br />
             | putting the fields on tfacp1120s000.<br />
	        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.leac&quot;,&quot;629200687&quot;)			        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.dim1&quot;,&quot;C00004&quot;)			        stpapi.put.field(&quot;tfacp1120s000&quot;,&quot;tfgld102.dim2&quot;,&quot;III000&quot;)<br />
<br />
<br />
Try that.  In the meantime I will look to see if I have code that includes tfacp1120s000.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">18th November 2009, 18:47</div></div><div class="posttext">Okay - what I posted before is what my code looks like.  See below:<br />
<br />
function api.create.invoice()<br />
{<br />
	domain	tcmcs.str80	hold.msg<br />
	<br />
|Active the tfacp1110s000 session.<br />
	stpapi.continue.process(&quot;tfgld1101s000&quot;, e.msg)<br />
	<br />
| Clear insert mode.<br />
	stpapi.save(&quot;tfacp1110s000&quot;,e.msg)<br />
| Add the new record - note isup and refr must be unique on our system.<br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;tfacp200.suno&quot;, strip$(tfudi030.suno))<br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;tfacp200.isup&quot;, str$(tfudi030.isup))<br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;tfacp200.docd&quot;, str$(date.num()))<br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;tfacp200.refr&quot;, tfudi035.pref &amp; str$(sel.refr))  <br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;screen.amnt&quot;, str$(round(tfudi030.amnt, 2, 0))) <br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;tfacp200.reas&quot;, tfudi030.reas ) <br />
	stpapi.handle.subproc(&quot;tfacp1110s000&quot;, &quot;tfacp1120s000&quot;, &quot;add&quot;)<br />
	rc = stpapi.insert(&quot;tfacp1110s000&quot;, 1, e.msg) <br />
	if not isspace(e.msg) then<br />
		stpapi.end.session(&quot;tfacp1110s000&quot;) <br />
		return<br />
	endif<br />
|Insert the account on tfacp1120s000	<br />
	stpapi.put.field(&quot;tfacp1120s000&quot;, &quot;tfgld102.leac&quot;, tfudi030.leac) <br />
	rc = stpapi.insert(&quot;tfacp1120s000&quot;, 1, e.msg)<br />
	if not isspace(e.msg) then<br />
		stpapi.end.session(&quot;tfacp1120s000&quot;)<br />
		hold.msg = e.msg<br />
		stpapi.delete(&quot;tfacp1110s000&quot;, true, e.msg)<br />
		e.msg = hold.msg<br />
		stpapi.end.session(&quot;tfacp1110s000&quot;) <br />
		return<br />
	endif<br />
| End the two sessions<br />
	stpapi.end.session(&quot;tfacp1120s000&quot;)<br />
	stpapi.end.session(&quot;tfacp1110s000&quot;) <br />
}<br />
<br />
Of course on tfacp1120s000 I only input the ledger account.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">18th November 2009, 19:41</div></div><div class="posttext">Hello Mark,<br />
<br />
the first code run well. I comment the second stpapi.continue.process and the invoice was created ok. I´m going to prove it more...<br />
<br />
A last thing (I hope :) ). The session tfgld1101m000 has 2 posibilities:<br />
a) Insert a  new date with a new tfgld101.btno (icon: &gt;|&lt;)<br />
b) Use a tfgld101.btno created and insert a new register witha a new type (icon: add)<br />
<br />
I did my development with the option b)<br />
How I can create a record with option a)? I'm trying with next code:<br />
<br />
<br />
stpapi.put.field(&quot;tfgld1101m000&quot;,&quot;tedt.f&quot;,str$(date.to.num(2009,11,18)))<br />
stpapi.put.field(&quot;tfgld1101m000&quot;,&quot;tfgld101.year&quot;,&quot;2009&quot;)	        <br />
stpapi.put.field(&quot;tfgld1101m000&quot;,&quot;tfgld101.ttyp&quot;,&quot;HGT&quot;)	<br />
if stpapi.insert(&quot;tfgld1101m000&quot;,1,err.msg) = 0 then<br />
      message(&quot;%s&quot;,err.msg)<br />
endif<br />
<br />
<br />
Thanks,<br />
<br />
María</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">18th November 2009, 21:05</div></div><div class="posttext">Here is most of my code to do that.  What I do is read from a table and write transactions from the table. As it reads the transactions it writes a history table and error messages go into the main table.  The routine you need is the api..create.batch.<br />
<br />
<br />
Function process.selected.date()<br />
{<br />
	sel.date = tfudi030.date<br />
	sel.ttyp = tfudi030.ttyp<br />
| Added just because the user might get cute and try to process a Transaction<br />
| type thru the session that it is not designed for.<br />
	if sel.ttyp&lt;&gt;&quot;APG&quot; and sel.ttyp&lt;&gt;&quot;APD&quot; then<br />
		message(&quot;Transaction type not defined by program.&quot;)<br />
		return<br />
	endif<br />
| Create batch - note subroutine leaves the two tfgld sessions open	<br />
	if api.create.batch() then<br />
		stpapi.end.session(&quot;tfgld1101s000&quot;) <br />
		stpapi.end.session(&quot;tfgld1100m000&quot;)<br />
		return<br />
	endif<br />
<br />
|Start processing the data selected.<br />
	select	a.srno:sel.srno<br />
	from	tfudi030 a<br />
	where	a._index1 = {:sel.date, :sel.ttyp}<br />
	selectdo<br />
		db.retry.point()<br />
		select	tfudi030.*<br />
		from	tfudi030 for update<br />
		where	tfudi030._index1 = {:sel.date, :sel.ttyp, :sel.srno}<br />
		as set with 1 rows<br />
		selectdo<br />
| 20080207.st Reverse the oncase statement since get.max.refr needs tiudi035.pref<br />
| to already be set.<br />
| Did a case statement because they might add transaction types later.<br />
			on case sel.ttyp<br />
			case &quot;APG&quot;:<br />
				tfudi035.pref = &quot;G&quot;<br />
				break<br />
			case &quot;APD&quot;:<br />
				tfudi035.pref = &quot;D&quot;<br />
				break<br />
			endcase<br />
			sel.refr = get.max.refr()	| 20080207.en<br />
			api.create.invoice()<br />
			if isspace(e.msg) then<br />
				tfudi035.date = sel.date<br />
				tfudi035.ttyp = tfudi030.ttyp<br />
				tfudi035.srno = get.max.srno()<br />
				tfudi035.suno = tfudi030.suno<br />
				tfudi035.isup = tfudi030.isup<br />
				tfudi035.reas = tfudi030.reas<br />
				tfudi035.leac = tfudi030.leac<br />
				tfudi035.amnt = tfudi030.amnt<br />
				tfudi035.refr = sel.refr<br />
				tfudi035.dtep = date.num()<br />
				tfudi035.btno = sel.btno<br />
				tfudi035.user = logname$<br />
				db.insert(ttfudi035)<br />
				db.delete(ttfudi030,db.retry)<br />
			else<br />
				tfudi030.err = e.msg<br />
				db.update(ttfudi030,db.retry)<br />
			endif<br />
		endselect<br />
		commit.transaction()<br />
	endselect<br />
	stpapi.end.session(&quot;tfgld1101s000&quot;) <br />
	stpapi.end.session(&quot;tfgld1100m000&quot;)<br />
}<br />
function domain tcorno get.max.srno()<br />
{<br />
	domain	tcorno	max.srno<br />
	max.srno = 0<br />
	select 	max(a.srno):max.srno<br />
	from	tfudi035 a<br />
	where	a._index1 = {:sel.date, :sel.ttyp}<br />
	selectdo<br />
	endselect<br />
	max.srno = max.srno + 1<br />
	return(max.srno)<br />
}<br />
| Reference number must be unique<br />
function domain tcorno get.max.refr()<br />
{<br />
	domain	tcorno	max.refr<br />
	select	max(a.refr):max.refr<br />
	from	tfudi035 a<br />
	where	a.pref = :tfudi035.pref<br />
	selectdo<br />
	selectempty<br />
		max.refr = 9999<br />
	endselect<br />
	max.refr = max.refr + 1<br />
	return(max.refr)<br />
}<br />
function api.create.invoice()<br />
{<br />
	domain	tcmcs.str80	hold.msg<br />
	<br />
|Active the tfacp1110s000 session.<br />
	stpapi.continue.process(&quot;tfgld1101s000&quot;, e.msg)<br />
	<br />
| Clear insert mode.<br />
	stpapi.save(&quot;tfacp1110s000&quot;,e.msg)<br />
| Add the new record - note isup and refr must be unique on our system.<br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;tfacp200.suno&quot;, strip$(tfudi030.suno))<br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;tfacp200.isup&quot;, str$(tfudi030.isup))<br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;tfacp200.docd&quot;, str$(date.num()))<br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;tfacp200.refr&quot;, tfudi035.pref &amp; str$(sel.refr))  <br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;screen.amnt&quot;, str$(round(tfudi030.amnt, 2, 0))) <br />
	stpapi.put.field(&quot;tfacp1110s000&quot;, &quot;tfacp200.reas&quot;, tfudi030.reas ) <br />
	stpapi.handle.subproc(&quot;tfacp1110s000&quot;, &quot;tfacp1120s000&quot;, &quot;add&quot;)<br />
	rc = stpapi.insert(&quot;tfacp1110s000&quot;, 1, e.msg) <br />
	if not isspace(e.msg) then<br />
		stpapi.end.session(&quot;tfacp1110s000&quot;) <br />
		return<br />
	endif<br />
|Insert the account on tfacp1120s000	<br />
	stpapi.put.field(&quot;tfacp1120s000&quot;, &quot;tfgld102.leac&quot;, tfudi030.leac) <br />
	rc = stpapi.insert(&quot;tfacp1120s000&quot;, 1, e.msg)<br />
	if not isspace(e.msg) then<br />
		stpapi.end.session(&quot;tfacp1120s000&quot;)<br />
		hold.msg = e.msg<br />
		stpapi.delete(&quot;tfacp1110s000&quot;, true, e.msg)<br />
		e.msg = hold.msg<br />
		stpapi.end.session(&quot;tfacp1110s000&quot;) <br />
		return<br />
	endif<br />
| End the two sessions<br />
	stpapi.end.session(&quot;tfacp1120s000&quot;)<br />
	stpapi.end.session(&quot;tfacp1110s000&quot;) <br />
}<br />
function long	api.create.batch()<br />
{<br />
	<br />
|  tfgld1100m000 (Maintain Transactions) <br />
|  Put data and create batch<br />
	stpapi.put.field(&quot;tfgld1100m000&quot;, &quot;tfgld100.tedt&quot;, str$(date.num())) <br />
	stpapi.put.field(&quot;tfgld1100m000&quot;, &quot;tfgld100.bref&quot;, sprintf$(&quot;Garnishments %D(%02m/%02d/%02y)&quot;, date.num())) <br />
	rc = stpapi.insert(&quot;tfgld1100m000&quot;, 1, e.msg) <br />
	if not isspace(e.msg) then<br />
		message(&quot;Unable to create transaction type.&quot;)<br />
		return(true)<br />
	endif<br />
| Get the batch created.	<br />
	stpapi.get.field(&quot;tfgld1100m000&quot;,&quot;tfgld100.btno&quot;,e.msg)<br />
	sel.btno = val(strip$(e.msg))<br />
| Activate tfgld1101s000 subsession	<br />
	stpapi.handle.subproc(&quot;tfgld1100m000&quot;, &quot;tfgld1101s000&quot;, &quot;add&quot;)<br />
	stpapi.continue.process(&quot;tfgld1100m000&quot;, e.msg)<br />
| Clear the input mode the session starts in	<br />
	stpapi.save(&quot;tfgld1101s000&quot;,e.msg)<br />
| Put the transaction type	<br />
	stpapi.put.field(&quot;tfgld1101s000&quot;, &quot;tfgld101.ttyp&quot;, strip$(tfudi030.ttyp)) <br />
	rc = stpapi.insert(&quot;tfgld1101s000&quot;, 1, e.msg) 	<br />
	if not isspace(e.msg) then<br />
		message(&quot;Unable to create transaction type.&quot;)<br />
		return(true)<br />
	endif<br />
	return(false)<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">20th November 2009, 11:08</div></div><div class="posttext">Hi Mark,<br />
<br />
I think the complete AFS is running well. I´m using now, in first place,  the session tfgld1100m000 instead tfgld1101m000. I didn´t know that session.<br />
<br />
Now I´m working in the register of errors.<br />
<br />
Thanks a lot,<br />
<br />
María</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">26th November 2009, 12:27</div></div><div class="posttext">Hello,<br />
<br />
I have an AFS session working well but, there is a behaviour that I don´t understand...<br />
<br />
When I detect a record with an error,   I want to save it in the tfcmn041 table:<br />
<br />
<br />
  {...<br />
     if error then<br />
            registrar.borrar.errores(t_idhg) <br />
     endif<br />
    ...<br />
   }<br />
<br />
function registrar.borrar.errores(domain tcmcs.str11 t_idhg)<br />
{<br />
	db.retry.point()<br />
	select	tfcmn040.* <br />
	from	tfcmn040 for update<br />
	where 	tfcmn040.idhg = :t_idhg<br />
	selectdo<br />
		insertar.error.tfcmn041(&quot;Error en la hoja &quot; &amp; str$(t_idhg) )<br />
		db.delete(ttfcmn040,db.retry)	<br />
	endselect<br />
	commit.transaction()<br />
}<br />
<br />
function insertar.error.tfcmn041(domain tcstr.200 mensaje)<br />
{<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.idin&quot;, str$(tfcmn040.idin))<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.idhg&quot;, str$(tfcmn040.idhg))<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.emno&quot;, str$(tfcmn040.emno))<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.cprj&quot;, str$(tfcmn040.cprj))<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.desc&quot;, str$(tfcmn040.desc))<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.amnt&quot;, str$(tfcmn040.amnt))<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.suno&quot;, str$(tfcmn040.suno))<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.ninv&quot;, str$(tfcmn040.ninv))<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.refe&quot;, str$(tfcmn040.refe))<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.qan1&quot;, str$(tfcmn040.qan1))<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.qan2&quot;, str$(tfcmn040.qan2))<br />
<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.date&quot;, str$(date.num()))<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.erro&quot;, mensaje)<br />
	stpapi.put.field(&quot;tfcmncm041m00&quot;, &quot;tfcmn041.time&quot;, calcular.hora())<br />
<br />
	if not stpapi.insert(&quot;tfcmncm041m00&quot;,1,err.msg) = 1 then<br />
		stpapi.recover(&quot;tfcmncm041m00&quot;,recover.msg)<br />
	endif<br />
	stpapi.end.session(&quot;tfcmncm041m00&quot;)<br />
}<br />
<br />
<br />
If I execute the session in debug mode, the records are saved in tfcmn041. But If I compile the program without debug mode, then the function registrar.borrar.errores() seems not be executed, because the records are not inserted in the tfcmn041 table ¿?<br />
<br />
Thanks,<br />
<br />
María</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">27th November 2009, 14:33</div></div><div class="posttext">Try putting in a suspend statement after the stpapi.end.session.  That usually works - it gives the session time to close and cleanup before continuing in the current session.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">21st April 2010, 14:48</div></div><div class="posttext">Hello,<br />
<br />
I had open this thread for a development that it´s finish. The AFS session run well in a test server. Today I implement the session in the production server and the AFS session hangs in session tfacp1120s000, executing next code.... I debug the session but I don´t understand why the code stops in that instruction ¿? See the last lines at this code..<br />
<br />
Thanks in advanced!<br />
<br />
form.1:<br />
init.form:<br />
	if zoomfield$ = &quot;tfacp2110&quot; then<br />
		|* Maintain corrections purchase invoices<br />
		tfacp200.ttyp = main.tinv<br />
		tfacp200.ninv = main.ninv<br />
		tfacp200.line = main.line<br />
		tfacp200.tdoc = main.tdoc<br />
		tfacp200.docn = main.corr<br />
		tfacp200.lino = main.lino<br />
		payments.found = false<br />
		db.eq(ttfacp200)				<br />
	else<br />
		tfacp200.ttyp = main.ttyp<br />
		tfacp200.ninv = main.docn<br />
		tfacp200.line = 0<br />
		tfacp200.tdoc = &quot;&quot;<br />
		tfacp200.docn = 0<br />
		tfacp200.lino = 0<br />
		db.eq(ttfacp200)			<br />
		if tfcmg000.avat = tcyesno.yes then<br />
			read.payments()<br />
		else<br />
			payments.found = false<br />
		endif<br />
	endif<br />
	if db.error(ttfacp200) then			<br />
		mess(&quot;tfacpt2001&quot;,1)<br />
		|* Invoice not found<br />
		end()<br />
	endif<br />
	if not isspace(tfacp200.cpay) then<br />
		tcmcs013.cpay = tfacp200.cpay<br />
		db.eq(ttcmcs013)<br />
	endif	<br />
	if zoomfield$ = &quot;tfacp1110&quot; then<br />
		|* Maintain purchase invoices<br />
		if tfacp200.appr &lt;&gt; tfacp.matc.no then<br />
			mess(&quot;tfacps0146&quot;,1)<br />
			|* Invoice must be matched with orders<br />
			end()<br />
		endif<br />
		main.vyer = tfacp200.vaty<br />
		main.vprd = tfacp200.vatp<br />
		main.rate = tfacp200.rate<br />
		|#euro.46340.sn<br />
		main.ratf = tfacp200.ratf<br />
		main.docd = tfacp200.docd<br />
		|#euro.46340.en<br />
	endif<br />
	tccom020.suno = tfacp200.suno<br />
	if db.eq(ttccom020) then<br />
		mess(&quot;tccomt0201&quot;,1)<br />
		|* Supplier not found<br />
		end()<br />
	endif<br />
	tfgld011.ttyp = main.ttyp<br />
	if db.eq(ttfgld011) then<br />
		mess(&quot;tfgldt0111&quot;,1)<br />
		|* Transaction type not found<br />
		end()<br />
	endif<br />
	calculate.amounts()<br />
	tfgld102.cono = get.compnr()<br />
	tfgld102.year = main.year<br />
	tfgld102.btno = main.btno<br />
	tfgld102.ttyp = main.ttyp<br />
	tfgld102.docn = main.docn<br />
	set.max(tfgld102.lino)<br />
	tfgld102.serl = 0<br />
	tfgld102.srno = 0<br />
	store.occ.max()<br />
	tfgld102.lino = 0<br />
	tfgld102.serl = 0<br />
	tfgld102.srno = 0<br />
	store.occ.min()<br />
	execute(find.data)<br />
<br />
	select	tccom999.*					<br />
	from	tccom999<br />
	as set with 1 rows<br />
	selectdo<br />
	endselect						<br />
<br />
	if not filled.occ then<br />
		execute(start.set)<br />
		if not filled.occ then<br />
			execute(add.set)		endif<br />
	endif</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">21st April 2010, 15:46</div></div><div class="posttext">Well I do not know why the execute(add.set) would cause the session to lock up.  Have you compared the session code between production and development for tfacp1120s000?  The only time I have seen this problem is when (1) the libraries and tools patches were different between dev and test and (2) the session itself was different between dev and prod.  I can't say for sure that is the case, but something you can check on.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">manish_patel</div><div class="date">21st April 2010, 15:51</div></div><div class="posttext">If the session runs through AFS, starting choices automatically (e.g. starting the add.set when no records are present) can result in undesired results. <br />
<br />
Hence it is better to skip Execute(…) function when session runs in API-mode.<br />
<br />
<br />
if not api.mode then<br />
	if not filled.occ then<br />
		execute(start.set)<br />
		if not filled.occ then<br />
			execute(add.set)		<br />
		endif<br />
	endif<br />
endif<br />
<br />
Yes, still question remain unanswered - Why it is not working in production server?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">21st April 2010, 17:36</div></div><div class="posttext">I compared dev script with production script and they are identical.<br />
I modify the instruction execute(add.set) in the production script with api.mode condition, but now the session hangs in another place.<br />
<br />
How I could to know all the libraries related?<br />
<br />
I´m very surprised ¿?<br />
<br />
Thanks,<br />
<br />
María</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">21st April 2010, 22:09</div></div><div class="posttext">I was thinking of the stpapi libraries - not all libraries.  A little typo. I usually have our BaaN admin just callup baan and get the latest.  Then when everything tests out he applies them to production.  I have never really tried to compare two systems - in my case the app admin is suppose to keep things in sync.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mjpedreira1</div><div class="date">23rd April 2010, 15:48</div></div><div class="posttext">Here is a new trace. Hoping you can see something strange!<br />
<br />
&gt;tail afs.log<br />
<br />
LOGGING STARTED<br />
23/04/2010<br />
8-&gt;get.fields<br />
8&lt;-get.fields0tfgld100.tedt1tfgld100.year1tfgld006.ydsc0tfgld100.btno1tfgld100.bref1fyer.f0tfgld003.psep0tfgld100.fprd1ryer.f0tfgld003.psep0tfgld100.rprd1tfgld100.vyer1tfgld003.psep0tfgld100.vprd1tfgld100.stat0tfgld100.user0<br />
&gt;tfgld1100m000 put.field:tfgld100.tedt 733885<br />
&gt;tfgld1100m000 put.field:tfgld100.bref Nueva HGT 04/23/10<br />
&gt;tfgld1100m000 insert<br />
8-&gt;add.set+save<br />
8&lt;-add.set+save0<br />
&lt;tfgld1100m000<br />
&gt;tfgld1100m000 get.field:tfgld100.btno<br />
&lt;tfgld1100m000 get.field:tfgld100.btno=1603<br />
&gt;tfgld1100m000 handle.subproc tfgld1101s000 add<br />
&gt;tfgld1100m000 continue.process<br />
8-&gt;cont.process<br />
9&lt;-api.child.startedtfgld1101s0008<br />
9-&gt;get.fields<br />
9&lt;-get.fields0tedt.f1tfgld101.year1tfgld006.ydsc0tfgld101.btno1bref.f1fyer.f0tfgld003.psep0fprd.f1ryer.f0tfgld003.psep0rprd.f1vyer.f1tfgld003.psep0vprd.f1actual.occ0tfgld101.ttyp1tfgld011.desc0tfgld101.stat0tfgld101.amnt1tedt.f0tfgld101.year1tfgld006.ydsc0tfgld101.btno1bref.f0fyer.f0tfgld003.psep0fprd.f0ryer.f0tfgld003.psep0rprd.f0vyer.f0tfgld003.psep0vprd.f0tfgld101.ttyp1tfgld101.user0tfgld101.emsg0<br />
&lt;tfgld1100m000<br />
&gt;tfgld1101s000 save<br />
9-&gt;update.db<br />
9&lt;-update.db0<br />
&lt;tfgld1101s000<br />
&gt;tfgld1101s000 put.field:tfgld101.ttyp HGT<br />
&gt;tfgld1101s000 insert<br />
9-&gt;add.set+save<br />
9&lt;-add.set+save0<br />
&lt;tfgld1101s000<br />
&gt;tfgld1101s000 handle.subproc tfacp1110s000 add<br />
&gt;tfgld1101s000 continue.process<br />
9-&gt;cont.process<br />
10&lt;-api.child.startedtfacp1110s0009<br />
10-&gt;get.fields<br />
10&lt;-get.fields0tfacp200.year1tfacp200.btno1tfacp200.ttyp0tfacp200.ninv1tfacp200.line1tfacp200.tdoc1tfacp200.docn1tfacp200.lino1tfacp200.suno1tccom020.nama0tfacp200.docd1tfacp200.ccur1ratf.f0ccur10tfacp200.rate1ccur20screen.amnt1fixed.ratf0euro.f0fixed.rate0cemu.f0user.ccur0screen.amth0tfacp200.spot1tfacp200.vatc1tfacp200.cvat1tfacp200.vaty1tfgld003.psep0tfacp200.vatp1screen.vata1user.ccur0screen.vath0tfacp200.isup1tfacp200.refr1tfacp200.bloc1tfacp002.desc0tfacp200.bdat1tfacp200.bref1tfacp003.desc0tfacp200.loco1tccom000.nama0tfacp200.proj1tfacp200.recd1tfacp200.orno1tfacp200.disp1tfacp200.bank0tfacp200.year1text.yn0tfacp200.btno1tfacp200.ttyp0tfacp200.ninv1tfacp200.line1tfacp200.tdoc1tfacp200.docn1tfacp200.lino1tfacp200.cpay1tcmcs013.dsca0tfacp200.dued1schedule0tfacp200.ccrs1tcmcs011.dsca0tfacp200.paym1tfcmg003.desc0tfacp200.bank1tccom025.bano0tfacp200.reas1tfcmg002.desc0tfacp200.otyp1tfacp200.oinv1tfacp200.appr1tfacp200.subc1tfacp200.lvat1tfacp200.stap0tfacp200.tapr0tfacp200.dapr0<br />
&lt;tfgld1101s000<br />
&gt;tfacp1110s000 save<br />
10-&gt;update.db<br />
10&lt;-update.db0<br />
&lt;tfacp1110s000<br />
&gt;tfacp1110s000 put.field:tfacp200.suno HG0695<br />
&gt;tfacp1110s000 put.field:tfacp200.amat 5.15<br />
&gt;tfacp1110s000 put.field:tfacp200.amnt 5.15<br />
&gt;tfacp1110s000 put.field:tfacp200.cvat    00NE00<br />
&gt;tfacp1110s000 put.field:tfacp200.isup 30000000360<br />
&gt;tfacp1110s000 put.field:tfacp200.docd 733885<br />
&gt;tfacp1110s000 put.field:tfacp200.refr 13/04/2010-16/04/2010<br />
&gt;tfacp1110s000 put.field:tfacp200.vatc   1<br />
&gt;tfacp1110s000 put.field:screen.amnt 5.15<br />
&gt;tfacp1110s000 insert<br />
10-&gt;add.set+save<br />
11&lt;-api.child.startedtfacp1120s00010<br />
(baanexpl)/home/mpl&gt;clear<br />
(baanexpl)/home/mpl&gt;tail -200 afs.log<br />
LOGGING STARTED<br />
23/04/2010<br />
8-&gt;get.fields<br />
8&lt;-get.fields0tfgld100.tedt1tfgld100.year1tfgld006.ydsc0tfgld100.btno1tfgld100.bref1fyer.f0tfgld003.psep0tfgld100.fprd1ryer.f0tfgld003.psep0tfgld100.rprd1tfgld100.vyer1tfgld003.psep0tfgld100.vprd1tfgld100.stat0tfgld100.user0<br />
&gt;tfgld1100m000 put.field:tfgld100.tedt 733885<br />
&gt;tfgld1100m000 put.field:tfgld100.bref Nueva HGT 04/23/10<br />
&gt;tfgld1100m000 insert<br />
8-&gt;add.set+save<br />
8&lt;-add.set+save0<br />
&lt;tfgld1100m000<br />
&gt;tfgld1100m000 get.field:tfgld100.btno<br />
&lt;tfgld1100m000 get.field:tfgld100.btno=1603<br />
&gt;tfgld1100m000 handle.subproc tfgld1101s000 add<br />
&gt;tfgld1100m000 continue.process<br />
8-&gt;cont.process<br />
9&lt;-api.child.startedtfgld1101s0008<br />
9-&gt;get.fields<br />
9&lt;-get.fields0tedt.f1tfgld101.year1tfgld006.ydsc0tfgld101.btno1bref.f1fyer.f0tfgld003.psep0fprd.f1ryer.f0tfgld003.psep0rprd.f1vyer.f1tfgld003.psep0vprd.f1actual.occ0tfgld101.ttyp1tfgld011.desc0tfgld101.stat0tfgld101.amnt1tedt.f0tfgld101.year1tfgld006.ydsc0tfgld101.btno1bref.f0fyer.f0tfgld003.psep0fprd.f0ryer.f0tfgld003.psep0rprd.f0vyer.f0tfgld003.psep0vprd.f0tfgld101.ttyp1tfgld101.user0tfgld101.emsg0<br />
&lt;tfgld1100m000<br />
&gt;tfgld1101s000 save<br />
9-&gt;update.db<br />
9&lt;-update.db0<br />
&lt;tfgld1101s000<br />
&gt;tfgld1101s000 put.field:tfgld101.ttyp HGT<br />
&gt;tfgld1101s000 insert<br />
9-&gt;add.set+save<br />
9&lt;-add.set+save0<br />
&lt;tfgld1101s000<br />
&gt;tfgld1101s000 handle.subproc tfacp1110s000 add<br />
&gt;tfgld1101s000 continue.process<br />
9-&gt;cont.process<br />
10&lt;-api.child.startedtfacp1110s0009<br />
10-&gt;get.fields<br />
10&lt;-get.fields0tfacp200.year1tfacp200.btno1tfacp200.ttyp0tfacp200.ninv1tfacp200.line1tfacp200.tdoc1tfacp200.docn1tfacp200.lino1tfacp200.suno1tccom020.nama0tfacp200.docd1tfacp200.ccur1ratf.f0ccur10tfacp200.rate1ccur20screen.amnt1fixed.ratf0euro.f0fixed.rate0cemu.f0user.ccur0screen.amth0tfacp200.spot1tfacp200.vatc1tfacp200.cvat1tfacp200.vaty1tfgld003.psep0tfacp200.vatp1screen.vata1user.ccur0screen.vath0tfacp200.isup1tfacp200.refr1tfacp200.bloc1tfacp002.desc0tfacp200.bdat1tfacp200.bref1tfacp003.desc0tfacp200.loco1tccom000.nama0tfacp200.proj1tfacp200.recd1tfacp200.orno1tfacp200.disp1tfacp200.bank0tfacp200.year1text.yn0tfacp200.btno1tfacp200.ttyp0tfacp200.ninv1tfacp200.line1tfacp200.tdoc1tfacp200.docn1tfacp200.lino1tfacp200.cpay1tcmcs013.dsca0tfacp200.dued1schedule0tfacp200.ccrs1tcmcs011.dsca0tfacp200.paym1tfcmg003.desc0tfacp200.bank1tccom025.bano0tfacp200.reas1tfcmg002.desc0tfacp200.otyp1tfacp200.oinv1tfacp200.appr1tfacp200.subc1tfacp200.lvat1tfacp200.stap0tfacp200.tapr0tfacp200.dapr0<br />
&lt;tfgld1101s000<br />
&gt;tfacp1110s000 save<br />
10-&gt;update.db<br />
10&lt;-update.db0<br />
&lt;tfacp1110s000<br />
&gt;tfacp1110s000 put.field:tfacp200.suno HG0695<br />
&gt;tfacp1110s000 put.field:tfacp200.amat 5.15<br />
&gt;tfacp1110s000 put.field:tfacp200.amnt 5.15<br />
&gt;tfacp1110s000 put.field:tfacp200.cvat    00NE00<br />
&gt;tfacp1110s000 put.field:tfacp200.isup 30000000360<br />
&gt;tfacp1110s000 put.field:tfacp200.docd 733885<br />
&gt;tfacp1110s000 put.field:tfacp200.refr 13/04/2010-16/04/2010<br />
&gt;tfacp1110s000 put.field:tfacp200.vatc   1<br />
&gt;tfacp1110s000 put.field:screen.amnt 5.15<br />
&gt;tfacp1110s000 insert<br />
10-&gt;add.set+save<br />
11&lt;-api.child.startedtfacp1120s00010<br />
(baanexpl)/home/mpl&gt;ls<br />
.profile            afs.log             dbs.log             procesos2_web       traza_DN            ttpcmn010900.S<br />
.sh_history         afs.log_v0          gastos              procesos_web        ttccom001900.S      ttpcmn011900.S<br />
0416ttfcmn040900.S  datos_DN            pepito.txt          trace               ttfacr204900.S      usu<br />
(baanexpl)/home/mpl&gt;tail -200 afs.log<br />
LOGGING STARTED<br />
23/04/2010<br />
8-&gt;get.fields<br />
8&lt;-get.fields0tfgld100.tedt1tfgld100.year1tfgld006.ydsc0tfgld100.btno1tfgld100.bref1fyer.f0tfgld003.psep0tfgld100.fprd1ryer.f0tfgld003.psep0tfgld100.rprd1tfgld100.vyer1tfgld003.psep0tfgld100.vprd1tfgld100.stat0tfgld100.user0<br />
&gt;tfgld1100m000 put.field:tfgld100.tedt 733885<br />
&gt;tfgld1100m000 put.field:tfgld100.bref Nueva HGT 04/23/10<br />
&gt;tfgld1100m000 insert<br />
8-&gt;add.set+save<br />
8&lt;-add.set+save0<br />
&lt;tfgld1100m000<br />
&gt;tfgld1100m000 get.field:tfgld100.btno<br />
&lt;tfgld1100m000 get.field:tfgld100.btno=1603<br />
&gt;tfgld1100m000 handle.subproc tfgld1101s000 add<br />
&gt;tfgld1100m000 continue.process<br />
8-&gt;cont.process<br />
9&lt;-api.child.startedtfgld1101s0008<br />
9-&gt;get.fields<br />
9&lt;-get.fields0tedt.f1tfgld101.year1tfgld006.ydsc0tfgld101.btno1bref.f1fyer.f0tfgld003.psep0fprd.f1ryer.f0tfgld003.psep0rprd.f1vyer.f1tfgld003.psep0vprd.f1actual.occ0tfgld101.ttyp1tfgld011.desc0tfgld101.stat0tfgld101.amnt1tedt.f0tfgld101.year1tfgld006.ydsc0tfgld101.btno1bref.f0fyer.f0tfgld003.psep0fprd.f0ryer.f0tfgld003.psep0rprd.f0vyer.f0tfgld003.psep0vprd.f0tfgld101.ttyp1tfgld101.user0tfgld101.emsg0<br />
&lt;tfgld1100m000<br />
&gt;tfgld1101s000 save<br />
9-&gt;update.db<br />
9&lt;-update.db0<br />
&lt;tfgld1101s000<br />
&gt;tfgld1101s000 put.field:tfgld101.ttyp HGT<br />
&gt;tfgld1101s000 insert<br />
9-&gt;add.set+save<br />
9&lt;-add.set+save0<br />
&lt;tfgld1101s000<br />
&gt;tfgld1101s000 handle.subproc tfacp1110s000 add<br />
&gt;tfgld1101s000 continue.process<br />
9-&gt;cont.process<br />
10&lt;-api.child.startedtfacp1110s0009<br />
10-&gt;get.fields<br />
10&lt;-get.fields0tfacp200.year1tfacp200.btno1tfacp200.ttyp0tfacp200.ninv1tfacp200.line1tfacp200.tdoc1tfacp200.docn1tfacp200.lino1tfacp200.suno1tccom020.nama0tfacp200.docd1tfacp200.ccur1ratf.f0ccur10tfacp200.rate1ccur20screen.amnt1fixed.ratf0euro.f0fixed.rate0cemu.f0user.ccur0screen.amth0tfacp200.spot1tfacp200.vatc1tfacp200.cvat1tfacp200.vaty1tfgld003.psep0tfacp200.vatp1screen.vata1user.ccur0screen.vath0tfacp200.isup1tfacp200.refr1tfacp200.bloc1tfacp002.desc0tfacp200.bdat1tfacp200.bref1tfacp003.desc0tfacp200.loco1tccom000.nama0tfacp200.proj1tfacp200.recd1tfacp200.orno1tfacp200.disp1tfacp200.bank0tfacp200.year1text.yn0tfacp200.btno1tfacp200.ttyp0tfacp200.ninv1tfacp200.line1tfacp200.tdoc1tfacp200.docn1tfacp200.lino1tfacp200.cpay1tcmcs013.dsca0tfacp200.dued1schedule0tfacp200.ccrs1tcmcs011.dsca0tfacp200.paym1tfcmg003.desc0tfacp200.bank1tccom025.bano0tfacp200.reas1tfcmg002.desc0tfacp200.otyp1tfacp200.oinv1tfacp200.appr1tfacp200.subc1tfacp200.lvat1tfacp200.stap0tfacp200.tapr0tfacp200.dapr0<br />
&lt;tfgld1101s000<br />
&gt;tfacp1110s000 save<br />
10-&gt;update.db<br />
10&lt;-update.db0<br />
&lt;tfacp1110s000<br />
&gt;tfacp1110s000 put.field:tfacp200.suno HG0695<br />
&gt;tfacp1110s000 put.field:tfacp200.amat 5.15<br />
&gt;tfacp1110s000 put.field:tfacp200.amnt 5.15<br />
&gt;tfacp1110s000 put.field:tfacp200.cvat    00NE00<br />
&gt;tfacp1110s000 put.field:tfacp200.isup 30000000360<br />
&gt;tfacp1110s000 put.field:tfacp200.docd 733885<br />
&gt;tfacp1110s000 put.field:tfacp200.refr 13/04/2010-16/04/2010<br />
&gt;tfacp1110s000 put.field:tfacp200.vatc   1<br />
&gt;tfacp1110s000 put.field:screen.amnt 5.15<br />
&gt;tfacp1110s000 insert<br />
10-&gt;add.set+save<br />
11&lt;-api.child.startedtfacp1120s00010<br />
(baanexpl)/home/mpl&gt;pg -200 afs.log<br />
LOGGING STARTED<br />
23/04/2010<br />
8-&gt;get.fields<br />
8&lt;-get.fields0tfgld100.tedt1tfgld100.year1tfgld006.ydsc0tfgld100.btno1tfgld100.bref1fyer.f0tfgld003.psep0tfgld100.fprd1ryer.f0tfgld003.psep0tfgld100.rprd1tfgld100.vyer1tfgld003.psep0tfgld100.vprd1tfgld100.stat0tfgld100.user0<br />
&gt;tfgld1100m000 put.field:tfgld100.tedt 733885<br />
&gt;tfgld1100m000 put.field:tfgld100.bref Nueva HGT 04/23/10<br />
&gt;tfgld1100m000 insert<br />
8-&gt;add.set+save<br />
8&lt;-add.set+save0<br />
&lt;tfgld1100m000<br />
&gt;tfgld1100m000 get.field:tfgld100.btno<br />
&lt;tfgld1100m000 get.field:tfgld100.btno=1603<br />
&gt;tfgld1100m000 handle.subproc tfgld1101s000 add<br />
&gt;tfgld1100m000 continue.process<br />
8-&gt;cont.process<br />
9&lt;-api.child.startedtfgld1101s0008<br />
9-&gt;get.fields<br />
9&lt;-get.fields0tedt.f1tfgld101.year1tfgld006.ydsc0tfgld101.btno1bref.f1fyer.f0tfgld003.psep0fprd.f1ryer.f0tfgld003.psep0rprd.f1vyer.f1tfgld003.psep0vprd.f1actual.occ0tfgld101.ttyp1tfgld011.desc0tfgld101.stat0tfgld101.amnt1tedt.f0tfgld101.year1tfgld006.ydsc0tfgld101.btno1bref.f0fyer.f0tfgld003.psep0fprd.f0ryer.f0tfgld003.psep0rprd.f0vyer.f0tfgld003.psep0vprd.f0tfgld101.ttyp1tfgld101.user0tfgld101.emsg0<br />
&lt;tfgld1100m000<br />
&gt;tfgld1101s000 save<br />
9-&gt;update.db<br />
9&lt;-update.db0<br />
&lt;tfgld1101s000<br />
&gt;tfgld1101s000 put.field:tfgld101.ttyp HGT<br />
&gt;tfgld1101s000 insert<br />
9-&gt;add.set+save<br />
9&lt;-add.set+save0<br />
&lt;tfgld1101s000<br />
&gt;tfgld1101s000 handle.subproc tfacp1110s000 add<br />
&gt;tfgld1101s000 continue.process<br />
9-&gt;cont.process<br />
10&lt;-api.child.startedtfacp1110s0009<br />
10-&gt;get.fields<br />
10&lt;-get.fields0tfacp200.year1tfacp200.btno1tfacp200.ttyp0tfacp200.ninv1tfacp200.line1tfacp200.tdoc1tfacp200.docn1tfacp200.lino1tfacp200.suno1tccom020.nama0tfacp200.docd1tfacp200.ccur1ratf.f0ccur10tfacp200.rate1ccur20screen.amnt1fixed.ratf0euro.f0fixed.rate0cemu.f0user.ccur0screen.amth0tfacp200.spot1tfacp200.vatc1tfacp200.cvat1tfacp200.vaty1tfgld003.psep0tfacp200.vatp1screen.vata1user.ccur0screen.vath0tfacp200.isup1tfacp200.refr1tfacp200.bloc1tfacp002.desc0tfacp200.bdat1tfacp200.bref1tfacp003.desc0tfacp200.loco1tccom000.nama0tfacp200.proj1tfacp200.recd1tfacp200.orno1tfacp200.disp1tfacp200.bank0tfacp200.year1text.yn0tfacp200.btno1tfacp200.ttyp0tfacp200.ninv1tfacp200.line1tfacp200.tdoc1tfacp200.docn1tfacp200.lino1tfacp200.cpay1tcmcs013.dsca0tfacp200.dued1schedule0tfacp200.ccrs1tcmcs011.dsca0tfacp200.paym1tfcmg003.desc0tfacp200.bank1tccom025.bano0tfacp200.reas1tfcmg002.desc0tfacp200.otyp1tfacp200.oinv1tfacp200.appr1tfacp200.subc1tfacp200.lvat1tfacp200.stap0tfacp200.tapr0tfacp200.dapr0<br />
&lt;tfgld1101s000<br />
&gt;tfacp1110s000 save<br />
10-&gt;update.db<br />
10&lt;-update.db0<br />
&lt;tfacp1110s000<br />
&gt;tfacp1110s000 put.field:tfacp200.suno HG0695<br />
&gt;tfacp1110s000 put.field:tfacp200.amat 5.15<br />
&gt;tfacp1110s000 put.field:tfacp200.amnt 5.15<br />
&gt;tfacp1110s000 put.field:tfacp200.cvat    00NE00<br />
&gt;tfacp1110s000 put.field:tfacp200.isup 30000000360<br />
&gt;tfacp1110s000 put.field:tfacp200.docd 733885<br />
&gt;tfacp1110s000 put.field:tfacp200.refr 13/04/2010-16/04/2010<br />
&gt;tfacp1110s000 put.field:tfacp200.vatc   1<br />
&gt;tfacp1110s000 put.field:screen.amnt 5.15<br />
&gt;tfacp1110s000 insert<br />
10-&gt;add.set+save<br />
11&lt;-api.child.startedtfacp1120s00010<br />
(baanexpl)/home/mpl&gt;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">26th April 2010, 15:19</div></div><div class="posttext">From that trace it almost looks like it works. Is it still hanging?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BaaNovva</div><div class="date">29th April 2010, 18:00</div></div><div class="posttext">How To Debug Afs By Generating Afs Logs ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">29th April 2010, 19:58</div></div><div class="posttext">In your bwc file you use -- -set AFSLOG=1.  This creates the AFS log.  Then as you look at the log file it will(sometimes) point to where the problem might be.  I don't think you can completely solve a problem with the AFS log, but it will usually give you something to start looking at.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BaaNovva</div><div class="date">30th April 2010, 11:25</div></div><div class="posttext">Good reply there. Thank you!, Mark.</div></div><hr />



</div>
</body>
</html>