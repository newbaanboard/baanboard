<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="keywords" content="Issues with AFS for tdilc4113s000, baan,baanerp,erp,forum,discussion,bulletin board" />
	<meta name="description" content="[Archive] Issues with AFS for tdilc4113s000 AFS/DDC/OLE: Function servers" />
	
	<title>Issues with AFS for tdilc4113s000 [Archive]  - Baanboard.com</title>
	<link rel="stylesheet" type="text/css" href="../styles.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar"><a href="index.html">Newbaanboard</a> &gt; <a href="index.html">Baan SIGs</a> &gt; <a href="index.html">AFS/DDC/OLE: Function servers</a> &gt; Issues with AFS for tdilc4113s000</div>
<hr />
<div class="pda"></div>

<hr />

<div class="post"><div class="posttop"><div class="username">sgoupil</div><div class="date">29th September 2015, 22:58</div></div><div class="posttext">Hey guys, I've look around and got some very good help for that AFS, but I'm getting into a problem that I did not find any post for it. The AFS hangs forever when I try to end tdilc4113s000. Here is my code. Any idea? BaanIVc4, SP32<br />
<br />
| Create Receipts<br />
        stpapi.handle.subproc(&quot;tdpur4120m000&quot;, &quot;tdpur4224s000&quot;, &quot;add&quot;)<br />
        stpapi.put.field(&quot;tdpur4120m000&quot;, &quot;form.dino&quot;, str$(f.pacn))<br />
        ret.v = stpapi.change.view(&quot;tdpur4120m000&quot;)<br />
        stpapi.put.field(&quot;tdpur4224s000&quot;, &quot;form.orno&quot;, str$(keep.orno))<br />
        stpapi.continue.process(&quot;tdpur4224s000&quot;, p.error.code )<br />
        stpapi.end.session(&quot;tdpur4224s000&quot;)<br />
        stpapi.get.field(&quot;tdpur4120m000&quot;, &quot;tdpur045.reno&quot;, hold.reno)<br />
        stpapi.end.session(&quot;tdpur4120m000&quot;)<br />
<br />
	| Modify receipt<br />
	boi.call = &quot;tdboidll0011.Create&quot;<br />
	stpapi.put.field(&quot;tdpur4120m000&quot;, &quot;tdpur045.reno&quot;, str$(hold.reno))<br />
        stpapi.put.field(&quot;tdpur4120m000&quot;, &quot;tdpur045.orno&quot;, str$(keep.orno))<br />
        stpapi.put.field(&quot;tdpur4120m000&quot;, &quot;tdpur045.pono&quot;, str$(keep.pono))<br />
        r = stpapi.find(&quot;tdpur4120m000&quot;, p.error.code)<br />
        if r = 1 then<br />
		if tiitm001.kltc &lt;&gt; tckltc.none then<br />
                	stpapi.handle.subproc(&quot;tdpur4120m000&quot;, &quot;tdilc4113s000&quot;, &quot;add&quot;)<br />
                endif	<br />
                stpapi.put.field(&quot;tdpur4120m000&quot;, &quot;tdpur045.diqu&quot;, str$(f.oqua))<br />
                stpapi.put.field(&quot;tdpur4120m000&quot;, &quot;tdpur045.date&quot;, str$(receipt.date))<br />
                if tiitm001.kltc &lt;&gt; tckltc.none then<br />
                	stpapi.put.field(&quot;tdpur4120m000&quot;, &quot;tdpur045.dqua&quot;, str$(f.oqua))<br />
                endif<br />
                stpapi.update(&quot;tdpur4120m000&quot;, 1, p.error.code)            |update<br />
                if not isspace(p.error.code) then<br />
			message(p.error.code&quot;)<br />
			stpapi.end.session(&quot;tdilc4113s000&quot;)<br />
			stpapi.end.session(&quot;tdpur4120m000&quot;)<br />
                else<br />
                        if tiitm001.kltc &lt;&gt; tckltc.none then<br />
	                        stpapi.put.field(&quot;tdilc4113s000&quot;, &quot;tdilc402.clot&quot;, str$(f.clot))<br />
                                stpapi.put.field(&quot;tdilc4113s000&quot;, &quot;tdilc402.date&quot;, str$(receipt.date))<br />
                                stpapi.put.field(&quot;tdilc4113s000&quot;, &quot;tdilc402.stun&quot;, str$(f.cuni))<br />
                                stpapi.put.field(&quot;tdilc4113s000&quot;, &quot;tdilc402.qstr&quot;, str$(f.oqua))<br />
                                stpapi.insert(&quot;tdilc4113s000&quot;, 1, p.error.code)            |update<br />
                                if not isspace(p.error.code) then<br />
        	                      	message(&quot;p.error.code&quot;)<br />
                                        stpapi.end.session(&quot;tdilc4113s000&quot;)<br />
                                else<br />
                                        stpapi.end.session(&quot;tdilc4113s000&quot;)		|||| Hangs here<br />
                                endif<br />
                        endif<br />
<br />
	else<br />
                           p.error.code = &quot;Receipt not found&quot;<br />
	            message(&quot;p.error.code&quot;)	<br />
        endif<br />
        stpapi.end.session(&quot;tdpur4120m000&quot;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgoupil</div><div class="date">29th September 2015, 23:04</div></div><div class="posttext">Please see attachment, a lot more readable. Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">30th September 2015, 09:44</div></div><div class="posttext">Hi,<br />
<br />
To format your code, you can add code tags around it.<br />
<br />
At which point does the session hangs? I can see you have couple of end.session() for that session.<br />
<br />
Also, have a look at this - &gt; thread (http://www.baanboard.com/baanboard/showthread.php?t=66581)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgoupil</div><div class="date">30th September 2015, 15:39</div></div><div class="posttext">Hello Bhushan,<br />
<br />
IT hangs when I try to end tdilc4113s000. If you look at the code, at the right I have a comment saying where it hangs.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">30th September 2015, 15:45</div></div><div class="posttext">Yes, somehow missed that comment. Unfortunately, I can't try this as I don't have this session in my environment. Probably someone else can try. One question, can you debug the code and check the process browser when that statement is executed? There might be some other session still running/not killed. In that case, you might need to use suspend() after every end.session() to make sure the session is destroyed before going forward. <br />
<br />
Also, there are scenarios where you might need to execute end.session() 2 times.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">30th September 2015, 16:07</div></div><div class="posttext">My code is a little different from yours.  Bhushan is correct - you might want to put in debug mode and make sure the parent process ID is tdilc4120m000.  Sometimes when a session hangs on the end you really do not have control of it.  Also note - my code may not work on your system.  There could be difference in the session or in the libraries themselves.  I believe we are on SP32 or SP33 - this code works.  I create the receipt in a different routine.<br />
<br />
Here is my routine:<br />
<br />
<br />
function extern modify_receipt(	domain	tcrcno		receipt.number,<br />
				domain  tcorno		purchase.order,<br />
				domain	tcpono  	purchase.line,<br />
				domain	tcqiv1		packingslip.qty,<br />
				domain	tcqiv1		received.qty,<br />
				domain	tcdate		received.date,<br />
				domain	tdltc.clot	purchase.lot,<br />
				domain	tcdate		purchaselot.date,<br />
				domain	tcconv		conv.factor,<br />
				domain	tccuni		purchase.unit,<br />
				domain	tcitem		purchase.item,<br />
				ref     string          msg())<br />
{<br />
		string	dummy(6), error_code(16)<br />
	domain	tcorno	get.orno<br />
	domain	tcpono	get.pono<br />
	<br />
	select	tiitm001.stgu, tiitm001.kitm<br />
	from	tiitm001<br />
	where	tiitm001._index1 = {:purchase.item}<br />
	as set with 1 rows<br />
	selectdo<br />
	endselect<br />
	<br />
	msg = &quot;&quot;<br />
	boi.call = &quot;tdboidll0011.Create&quot;<br />
 	stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.reno&quot;,str$(receipt.number))<br />
  	stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.orno&quot;,str$(purchase.order))<br />
 	stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.pono&quot;,str$(purchase.line))<br />
	rc = stpapi.find(&quot;tdpur4120m000&quot;,msg)<br />
	if not isspace(msg) or rc&lt;&gt;1 then<br />
		stpapi.end.session(&quot;tdpur4120m000&quot;)<br />
		return<br />
	endif<br />
	stpapi.get.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.orno&quot;,dummy)<br />
	get.orno = val(dummy)<br />
	stpapi.get.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.pono&quot;,dummy)<br />
	get.pono = val(dummy)<br />
| Prepare to handle lot controlled items.	<br />
	if ((not isspace(purchase.lot) or conv.factor&gt;1 or  purchase.unit &lt;&gt; tiitm001.stgu)<br />
	and (tiitm001.kitm=tckitm.purchase or tiitm001.kitm = tckitm.manufacture))	then<br />
		stpapi.handle.subproc(&quot;tdpur4120m000&quot;,&quot;tdilc4113s000&quot;,&quot;add&quot;)<br />
	endif<br />
	<br />
	stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.diqu&quot;,str$(packingslip.qty))<br />
	stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.date&quot;,str$(received.date))<br />
	stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.dqua&quot;,str$(received.qty))<br />
	rc = stpapi.update(&quot;tdpur4120m000&quot;,1,msg)<br />
	if not isspace(msg) or rc&lt;&gt;1 then<br />
		if not isspace(purchase.lot) or conv.factor&gt;1 then<br />
			stpapi.end.session(&quot;tdilc4113s000&quot;)<br />
		endif<br />
		stpapi.end.session(&quot;tdpur4120m000&quot;)<br />
		return<br />
	endif<br />
<br />
| Need to handle the conversion factor.<br />
	if ((not isspace(purchase.lot) or conv.factor&gt;1 or  purchase.unit &lt;&gt; tiitm001.stgu)<br />
	and (tiitm001.kitm=tckitm.purchase or tiitm001.kitm = tckitm.manufacture))	then<br />
		stpapi.put.field(&quot;tdilc4113s000&quot;, &quot;tdilc402.clot&quot;,purchase.lot)<br />
		stpapi.put.field(&quot;tdilc4113s000&quot;, &quot;tdilc402.date&quot;,str$(purchaselot.date))<br />
		stpapi.put.field(&quot;tdilc4113s000&quot;, &quot;tdilc402.qstr&quot;,str$(received.qty*conv.factor))<br />
		stpapi.put.field(&quot;tdilc4113s000&quot;, &quot;tdilc402.qstc&quot;,str$(received.qty*conv.factor))<br />
		rc = stpapi.insert(&quot;tdilc4113s000&quot;,1,msg)<br />
		error_code = stpapi.get.mess.code(&quot;tdilc4113s000&quot;,msg)<br />
		|20080331.st Add the command cancelled check.<br />
		if strip$(error_code) = &quot;tdilc40062&quot; or strip$(msg) = &quot;Command cancelled&quot; then<br />
			msg = &quot;&quot;<br />
		endif<br />
		stpapi.end.session(&quot;tdilc4113s000&quot;)<br />
	endif<br />
 	stpapi.end.session(&quot;tdpur4120m000&quot;)<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">30th September 2015, 16:13</div></div><div class="posttext">OH - I forgot to mention.  When the session hands on you if you go kill it manually using option dialog, start shell - does it finish and work?  <br />
<br />
I have a could of sessions that work, but I have to kill a session myself in the code to keep it going.  I have a routine somewhere that does that also.  I don't like this solution, but it was the only solution in a few cases.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgoupil</div><div class="date">30th September 2015, 22:40</div></div><div class="posttext">Thanks Mark,<br />
<br />
I based my code pretty much on yours. It's funny, because when I look at the process running, befor I hit the end.session of tdilc4113s000, I only have tdpur4120m000 and tdilc4113s000, when I hit the line, the tdilc4113s000 process is gone, but it hangs there and there is no hints in the afs.log file. No message, nothing, just does not totally completes the end.session....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">30th September 2015, 22:46</div></div><div class="posttext">Hi,<br />
<br />
There is almost a similar thread which relates to same session and has a hanging issue. This (http://www.baanboard.com/baanboard/showthread.php?t=6201) is the link.<br />
<br />
The last comment says - <br />
<br />
I looked at your code and based on where you indicated that you had a problem. I think that your problem is that you need to create the Lot Number in tdltc0101s000 before doing the put in tdilc402.clot. I think that you are getting a Not Found error. <br />
<br />
So, may be the Lot doesn't exists and its just not popping up the error. Are you able to process it manually? May be the update is not working in your case and hence the session hangs on some unshown error message.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">30th September 2015, 22:52</div></div><div class="posttext">And on little investigation - <br />
<br />
This thread (http://www.baanboard.com/baanboard/showthread.php?t=13037) gives a nice hack! Try it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhushanchanda</div><div class="date">30th September 2015, 22:54</div></div><div class="posttext">One more search and an indepth solution.<br />
<br />
Wow, the board is full of solutions -&gt; Solution (http://www.baanboard.com/baanboard/showthread.php?t=52857&amp;highlight=tdpur4102s000)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">30th September 2015, 23:11</div></div><div class="posttext">Some good finds Bhushan. Not sure what will happen with an invalid lot. My code creates the lot if it does not exist(another stpapi function server).    Never tried it with an invalid lot.  I would look at that and make sure all the data is valid.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgoupil</div><div class="date">1st October 2015, 16:38</div></div><div class="posttext">Hey guys, I was able to make it progress with Mark and Bhushan. Here is my code that (almost) work. It now does not hang on the tdilc4113s000 end.session, it hangs on the tdpur4120m000 end.session (last line). When I look at the prosesses, after executing the end.session on tdltc0101m000, the process realy ends, when the code execute the end.session on tdilc4113s000, it does not hang, but the session is still running in the processes, so when it tries to end.session tdpur4120m000, it hangs. In debug mode, after executing tdilc4113s000 end.session, I killed the process manually and then executed the end.session of tdpur4120m00, it then worked fine. I tried putting a handle sub.session with &quot;kill&quot; on tdilc4113s000 and it did not change anything. Also putting lines of the afs.log file. It seems like tdpur4120m000 is waiting for some cont.proc, there are none in the code. Also, seems to have a switch.to.process on tdilc4113s000, which I am not sure exactly what it means.<br />
<br />
boi.call = &quot;tdboidll0011.Create&quot;<br />
<br />
        stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.reno&quot;,str$(hold.reno))<br />
        stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.orno&quot;,str$(keep.orno))<br />
        stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.pono&quot;,str$(keep.pono))<br />
        r = stpapi.find(&quot;tdpur4120m000&quot;,p.error.code)<br />
        if not isspace(p.error.code) or r&lt;&gt;1 then<br />
                stpapi.end.session(&quot;tdpur4120m000&quot;)<br />
                return<br />
        endif<br />
<br />
        stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.diqu&quot;,str$(f.oqua))<br />
        stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.date&quot;,str$(receipt.date))<br />
        stpapi.put.field(&quot;tdpur4120m000&quot;,&quot;tdpur045.dqua&quot;,str$(f.oqua))<br />
        r = stpapi.update(&quot;tdpur4120m000&quot;,1,p.error.code)<br />
        if not isspace(p.error.code) or r&lt;&gt;1 then<br />
                stpapi.end.session(&quot;tdpur4120m000&quot;)<br />
                return<br />
        endif<br />
<br />
        stpapi.put.field(&quot;tdilc4113s000&quot;, &quot;tdilc402.clot&quot;,f.clot)<br />
        stpapi.put.field(&quot;tdilc4113s000&quot;, &quot;tdilc402.date&quot;,str$(receipt.date))<br />
        stpapi.put.field(&quot;tdilc4113s000&quot;, &quot;tdilc402.qstr&quot;,str$(f.oqua))<br />
        stpapi.handle.subproc(&quot;tdilc4113s000&quot;, &quot;tdltc0101s000&quot;, &quot;add&quot;)<br />
        r = stpapi.insert(&quot;tdilc4113s000&quot;,1,p.error.code)<br />
        stpapi.end.session(&quot;tdltc0101s000&quot;)<br />
        stpapi.end.session(&quot;tdilc4113s000&quot;)<br />
        stpapi.end.session(&quot;tdpur4120m000&quot;)<br />
<br />
AFS.LOG entries:<br />
<br />
&gt;tdilc4113s000 end.session<br />
51dll-&gt;serv (end.program^A58)<br />
tdilc4113s000(58)-RUNNING:end.program<br />
58serv&lt;-4gl (switch^A57)<br />
&lt;tdilc4113s000 switch.to.process<br />
57serv&lt;-4gl (switch^A58)<br />
58serv&lt;-4gl (end.program^A0)<br />
tdilc4113s000(58)-RUNNING:<br />
&gt;tdpur4120m000 end.session<br />
tdpur4120m000waiting for prev cont.proc<br />
tdpur4120m000waiting timed out<br />
51dll-&gt;serv (end.program^A57)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mark_h</div><div class="date">1st October 2015, 20:41</div></div><div class="posttext">Do you have the source code?  That would make this so much easier.  I am also curious why tdltc0101s000 is popping up on your system.  I tried finding something to receive on our end to see if I could make it pop manually, but no luck so far.</div></div><hr />



</div>
</body>
</html>